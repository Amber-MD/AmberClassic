#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass scrbook
\begin_preamble
\usepackage{multicol}
\usepackage{tocbibind}
%\usepackage[scaled=.85]{couriers}

\usepackage[font=it]{caption}
\usepackage{indentfirst}
\usepackage{textcomp}
\usepackage{placeins}

% Label subsections
\newrefformat{subsec}{Subsection \ref{#1}}

% Following to get bold-face typewriter font in LyXCode
\renewenvironment{lyxcode}
  {\begin{list}{}{
    \setlength{\rightmargin}{\leftmargin}
    \raggedright
    \setlength{\itemsep}{0pt}
    \setlength{\parsep}{0pt}
    \normalfont\bfseries\ttfamily}%
    \item[]}
  {\end{list}}

\addtokomafont{labelinglabel}{\texttt}
\end_preamble
\options sort&compress
\use_default_options false
\maintain_unincluded_children false
\language american
\language_package default
\inputencoding iso8859-1
\fontencoding global
\font_roman "times" "default"
\font_sans "helvet" "default"
\font_typewriter "courier" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 90 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures false
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 10
\spacing single
\use_hyperref true
\pdf_bookmarks true
\pdf_bookmarksnumbered false
\pdf_bookmarksopen true
\pdf_bookmarksopenlevel 0
\pdf_breaklinks true
\pdf_pdfborder true
\pdf_colorlinks true
\pdf_backref false
\pdf_pdfusetitle true
\pdf_quoted_options "linkcolor=blue,citecolor=blue,urlcolor=blue"
\papersize letterpaper
\use_geometry true
\use_package amsmath 2
\use_package amssymb 2
\use_package cancel 1
\use_package esint 0
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine natbib
\cite_engine_type numerical
\biblio_style plainnat
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\use_minted 0
\branch advanced
\selected 0
\filename_suffix 0
\color #faf0e6
\end_branch
\branch basic
\selected 1
\filename_suffix 0
\color #faf0e6
\end_branch
\index Index
\shortcut idx
\color #008000
\end_index
\paperwidth 6in
\paperheight 9in
\leftmargin 1.2in
\topmargin 1in
\rightmargin 1in
\bottommargin 1.2in
\secnumdepth 3
\tocdepth 1
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 2
\paperpagestyle default
\listings_params "basicstyle={\small\bfseries\ttfamily},frame=single,frameround=tttt,upquote=true"
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\align center

\series bold
\size giant
Msander Reference Manual 
\end_layout

\begin_layout Standard
\align center

\size huge
\emph on
\begin_inset VSpace bigskip
\end_inset


\end_layout

\begin_layout Standard
Msander (
\begin_inset Quotes eld
\end_inset

modern sander
\begin_inset Quotes erd
\end_inset

) is an updated version of 
\emph on
sander
\emph default
, the basic energy minimizer and molecular dynamics program in the 
\emph on
AmberTools suite.

\emph default
 This program relaxes the structure by iteratively moving the atoms down
 the energy gradient until a sufficiently low average gradient is obtained.
 The molecular dynamics portion generates configurations of the system by
 integrating Newtonian equations of motion.
 MD will sample more configurational space than minimization, and will allow
 the structure to cross over small potential energy barriers.
 Configurations may be saved at regular intervals during the simulation
 for later analysis, and basic free energy calculations using thermodynamic
 integration may be performed.
 More elaborate conformational searching and modeling MD studies can also
 be carried out using the 
\emph on
sander
\emph default
 module.
 This allows a variety of constraints to be added to the basic force field,
 and has been designed especially for the types of calculations involved
 in NMR, Xray or cryo-EM structure refinement.
 
\end_layout

\begin_layout Standard
\align center

\series bold
\size largest
Principal contributors to the current codes:
\series default
\size default
 
\end_layout

\begin_layout Standard
\begin_inset VSpace bigskip
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="1" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="2.6in">
<column alignment="center" valignment="top" width="2.6in">
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
David A.
 Case (Rutgers) 
\begin_inset Newline newline
\end_inset

 Carlos Simmerling (Stony Brook) 
\begin_inset Newline newline
\end_inset

Adrian Roitberg (Florida)
\begin_inset Newline newline
\end_inset

Kenneth M.
 Merz (Michigan State)
\begin_inset Newline newline
\end_inset

Tom Darden (OpenEye)
\begin_inset Newline newline
\end_inset

Celeste Sagui (NCSU)
\begin_inset Newline newline
\end_inset

Feng Pan (FSU)
\begin_inset Newline newline
\end_inset

Jason Swails (Entos)
\begin_inset Newline newline
\end_inset

Andreas W.
 Götz (UC San Diego)
\begin_inset Newline newline
\end_inset

David Cerutti (Rutgers)
\begin_inset Newline newline
\end_inset

Tyler Luchko (CSU Northridge)
\begin_inset Newline newline
\end_inset

Vinícius Wilian D.
 Cruzeiro (UC San Diego)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\size small
Madushanka Manathunga (Michigan State)
\begin_inset Newline newline
\end_inset

Nikolai R.
 Skrynnikov (Purdue, SPbU)
\begin_inset Newline newline
\end_inset

Oleg Mikhailovskii (Purdue, SPbU)
\begin_inset Newline newline
\end_inset

Yi Xue (Tsinghua)
\begin_inset Newline newline
\end_inset

Sergei A.
 Izmailov (SPbU)
\begin_inset Newline newline
\end_inset

Alexey Onufriev (Virginia Tech)
\begin_inset Newline newline
\end_inset

Saeed Izadi (Virginia Tech, Genentech)
\begin_inset Newline newline
\end_inset

Xiongwu Wu (NIH) 
\end_layout

\begin_layout Plain Layout

\size small
George Giambasu (Rutgers)
\begin_inset Newline newline
\end_inset

Jian Liu (Peking Univ.)
\begin_inset Newline newline
\end_inset

Andriy Kovalenko (NINT)
\begin_inset Newline newline
\end_inset

 
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Chapter

\series bold
msander 
\begin_inset CommandInset label
LatexCommand label
name "chap:sander"

\end_inset


\end_layout

\begin_layout Section

\series bold
Introduction
\end_layout

\begin_layout Standard
This is a guide to 
\shape italic
msander
\shape default
, an Amber module which carries out energy minimization, molecular dynamics,
 and NMR refinements.
 The acronym stands for 
\series bold
S
\series default
imulated 
\series bold
A
\series default
nnealing with 
\series bold
N
\series default
MR-
\series bold
D
\series default
erived 
\series bold
E
\series default
nergy 
\series bold
R
\series default
estraints, but this module is used for a variety of simulations that have
 nothing to do with NMR refinement.
 Some general features are outlined in the following paragraphs:
\end_layout

\begin_layout Enumerate

\shape italic
Sander
\shape default
 provides direct support for several force fields for proteins and nucleic
 acids, and for several water models and other organic solvents.
 The basic force field implemented here has the following form, which is
 about the simplest functional form that preserves the essential nature
 of molecules in condensed phases:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
V(\mathbf{r}) & = & \sum_{bonds}K_{b}(b-b_{0})^{2}+\sum_{angles}K_{\theta}(\theta-\theta_{o})^{2}\\
 &  & +\sum_{dihedrals}(V_{n}/2)(1+\cos[n\phi-\delta]\\
 &  & +\sum_{nonb\,ij}(A_{ij}/r_{ij}^{12})-(B_{ij}/r_{ij}^{6})+(q_{i}q_{j}/r_{ij})
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Standard
In addition, charges that are not centered on atoms, but are off-center
 (as for lone-pairs or "extra points") can be included in the force field.
\end_layout

\end_deeper
\begin_layout Enumerate
The particle-mesh Ewald (PME) procedure is used to handle long-range electrostat
ic interactions.
 Long-range van der Waals interactions are estimated by a continuum model.
 Biomolecular simulations in the NVE ensemble (
\begin_inset Formula $i.e.$
\end_inset

 with Newtonian dynamics) conserve energy well over multi-nanosecond runs
 without modification of the equations of motion.
\end_layout

\begin_layout Enumerate
Translational periodic (P1) symmetry is supported, but no other space-group
 symmetry is.
 The size of the unit cell can be coupled to a given external pressure,
 and velocities can be coupled to a given external temperature by several
 schemes.
 The external conditions and coupling constants can be varied over time,
 so various simulated annealing protocols can be specified in a simple and
 flexible manner.
\end_layout

\begin_layout Enumerate
It is also possible to carry out non-periodic simulations in which aqueous
 solvation effects are represented 
\shape italic
implicitly
\shape default
 by a generalized Born/ surface area model by adding the following two terms
 to the "vacuum" potential function:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Formula 
\[
\Delta G_{sol}=\sum_{ij}(1-\frac{1}{\varepsilon})(q_{i}q_{j}/f_{GB}(r_{ij})+A\sum_{i}\sigma_{i}
\]

\end_inset


\end_layout

\begin_layout Standard
The first term accounts for the polar part of solvation (free) energy, designed
 to provide an approximation for the reaction field potential, and the second
 represents the non-polar contribution which is taken to be proportional
 to the surface area of the molecule.
\end_layout

\end_deeper
\begin_layout Enumerate
Users can define internal restraints on bonds, valence angles, and torsions,
 and the force constants and target values for the restraints can vary during
 the simulation.
 The relative weights of various terms in the force field can be varied
 over time, allowing one to implement a variety of simulated annealing protocols
 in a single run.
\end_layout

\begin_layout Enumerate
Internal restraints can be defined to be "time-averaged", that is, restraint
 forces are applied based on the averaged value of an internal coordinate
 over the course of the dynamics trajectory, not only on its current value.
 Alternatively, restraints can be "ensemble-averaged" using the locally-enhanced
-sampling (LES) option.
\end_layout

\begin_layout Enumerate
Restraints can be directly defined in terms of NOESY intensities (calculated
 with a relaxation matrix technique), residual dipolar couplings, scalar
 coupling constants and proton chemical shifts.
 There are provisions for handling overlapping peaks or ambiguous assignments.
 In conjunction with distance and angle constraints, this provides a powerful
 and flexible approach to NMR structural refinements.
\end_layout

\begin_layout Enumerate
Xray and cryoEM refinements can be carried out in reciprocal space, with
 GPU-accelerated structure factor calculations.
 Real-space electron density maps can also be used as restraints for refinement.
\end_layout

\begin_layout Enumerate
Replica exchange calculations can allow simultaneous sampling at a variety
 of conditions (such as temperature), and allow the user to construct Boltzmann
 samples in ways that converge more quickly than standard MD simulations.
 Other variants of biased MD simulations can also be used to improve sampling.
\end_layout

\begin_layout Enumerate
Restraints can also be defined in terms of the root-mean-square coordinate
 distance from some reference structure.
 This allows one to bias trajectories either towards or away from some target.
 Free energies can be estimated from non-equilibrium simulations based on
 targetting restraints.
\end_layout

\begin_layout Enumerate
Free energy calculations, using thermodynamic integration (TI) with a linear
 or non-linear mixing of the "unperturbed" and "perturbed" Hamiltonian,
 can be carried out.
 Alternatively, potentials of mean force can be computed using umbrella
 sampling.
\end_layout

\begin_layout Enumerate
QMMM Calculations where part of the system can be treated quantum mechanically
 allowing bond breaking and formation during a simulation.
 Semi-empirical and DFTB Hamiltonians are provided directly within 
\shape italic
sander
\shape default
.
 More advanced 
\emph on
ab initio
\emph default
 and DFT Hamiltonians are available via an interface to external QM software
 packages.
\end_layout

\begin_layout Section
Main changes from the 
\emph on
sander
\emph default
 code in AmberTools
\end_layout

\begin_layout Enumerate
Some pieces are missing from the sander program in AmberTools:
\end_layout

\begin_deeper
\begin_layout Enumerate
Things that should be easy to re-introduce later: emil, sebomd, pbsa, APBS,
 the charge-relocation option.
\end_layout

\begin_layout Enumerate
Things are are problably gone for good, but which don't represent the best
 current practice: Path-integral methods, thermostats that don't follow
 the "middle" scheme, Berendsen barostat
\end_layout

\begin_layout Enumerate
Things that might be useful, but really complicate the code: EVB potentials,
 some parts of adaptive QM/MM, nudged elastic band, constant pH and constant
 redox potential simulations.
\end_layout

\begin_layout Enumerate
Non-periodic 3D-RISM has been removed for now, in an attempt to get the
 simplest possible RISM code, perhaps as a basis for future GPU work.
\end_layout

\end_deeper
\begin_layout Enumerate
Key pieces of code that are still there, and being emphasized:
\end_layout

\begin_deeper
\begin_layout Enumerate
Periodic and non-periodic simulations, with all of Amber's GB models
\end_layout

\begin_layout Enumerate
3D-RISM in periodic boundary conditions
\end_layout

\begin_layout Enumerate
QM/MM, including hooks to external codes
\end_layout

\begin_layout Enumerate
NMR, cryoEM and Xray restraints (including quite a bit of new code; Xray
 restraints include NVIDIA GPU-enabled capabilities)
\end_layout

\begin_layout Enumerate
Thermodynamic integration and non-equilibrium sampling methods
\end_layout

\begin_layout Enumerate
Replica exchange capabilities, except for constant pH and redox potential
 simulations
\end_layout

\end_deeper
\begin_layout Section
Installation
\end_layout

\begin_layout LyX-Code
./configure --help    # then choose options
\end_layout

\begin_layout LyX-Code
make install
\end_layout

\begin_layout LyX-Code
make test             # optional--more info is below
\end_layout

\begin_layout Standard
The test suite also serves as a source of example input files.
 Look especially in the 
\emph on
rism
\emph default
, 
\emph on
xray
\emph default
 and 
\emph on
cryoem
\emph default
 folders to see sample inputs for these sorts of calculation.
\end_layout

\begin_layout Section

\series bold
File usage
\end_layout

\begin_layout LyX-Code
msander [-help] [-O] [-A] -i mdin -o mdout -p prmtop -c inpcrd -r restrt
\end_layout

\begin_layout LyX-Code
-ref refc -mtmd mtmd -x mdcrd -y inptraj -v mdvel -frc mdfrc -e mden
\end_layout

\begin_layout LyX-Code
-inf mdinfo
\end_layout

\begin_layout LyX-Code
-O  Overwrite output files if they exist.
 
\end_layout

\begin_layout LyX-Code
-A  Append output files if they exist (used mainly for replica exchange).
\end_layout

\begin_layout Standard
Here is a brief description of the files referred to above; the first five
 files are used for every run, whereas the remainder are only used when
 certain options are chosen.
\end_layout

\begin_layout Description
mdin 
\emph on
input
\emph default
 control data for the min/md run 
\end_layout

\begin_layout Description
mdout 
\emph on
output
\emph default
 user readable state info and diagnostics -o stdout will send output to
 stdout (to the terminal) instead of to a file.
 
\end_layout

\begin_layout Description
mdinfo 
\emph on
output
\emph default
 latest mdout-format energy info 
\end_layout

\begin_layout Description
prmtop 
\emph on
input
\emph default
 molecular topology, force field, periodic box type, atom and residue names
 
\end_layout

\begin_layout Description
inpcrd 
\emph on
input
\emph default
 initial coordinates and (optionally) velocities and periodic box size 
\end_layout

\begin_layout Description
refc 
\emph on
input
\emph default
 (optional) reference coords for position restraints; also used for targeted
 MD 
\end_layout

\begin_layout Description
mtmd 
\emph on
input
\emph default
 (optional) containing list of files and parameters for targeted MD to multiple
 targets
\end_layout

\begin_layout Description
mdcrd 
\emph on
output
\emph default
 coordinate sets saved over trajectory 
\end_layout

\begin_layout Description
inptraj 
\emph on
input
\emph default
 coordinate sets in trajectory format, when imin=5 
\end_layout

\begin_layout Description
mdvel 
\emph on
output
\emph default
 velocity sets saved over trajectory
\end_layout

\begin_layout Description
mdfrc 
\emph on
output
\emph default
 force sets saved over trajectory
\end_layout

\begin_layout Description
mden 
\emph on
output
\emph default
 extensive energy data over trajectory (not synchronized with mdcrd or mdvel)
\end_layout

\begin_layout Description
restrt 
\emph on
output
\emph default
 final coordinates, velocity, and box dimensions if any - for restarting
 run
\end_layout

\begin_layout Description
suffix 
\emph on
output
\emph default
 this string will be added to all unspecified output files that are printed
 (for 
\emph on
multisander
\emph default
 runs, it will append this suffix to all output files)
\end_layout

\begin_layout Section

\series bold
Example input files
\end_layout

\begin_layout Standard
Here are a couple of sample files, just to establish a basic syntax and
 appearance.
 There are more examples of NMR-related files later in this chapter.

\series bold
 
\end_layout

\begin_layout Subsection*

\series bold
1.
 Simple restrained minimization
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Minimization with Cartesian restraints
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

imin=1, maxcyc=200, (invoke minimization)
\end_layout

\begin_layout Plain Layout

ntpr=5, (print frequency)
\end_layout

\begin_layout Plain Layout

ntr=1, (turn on Cartesian restraints)
\end_layout

\begin_layout Plain Layout

restraint_wt=1.0, (force constant for restraint)
\end_layout

\begin_layout Plain Layout

restraintmask=':1-58', (atoms in residues 1-58 restrained)
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout Subsection*

\series bold
2.
 "Plain" molecular dynamics run
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

molecular dynamics run
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

imin=0, irest=1, ntx=5, (restart MD)
\end_layout

\begin_layout Plain Layout

ntt=3, temp0=300.0, gamma_ln=5.0, (temperature control)
\end_layout

\begin_layout Plain Layout

ntp=1, taup=2.0, (pressure control)
\end_layout

\begin_layout Plain Layout

ntb=2, ntc=2, ntf=2, (SHAKE, periodic bc.)
\end_layout

\begin_layout Plain Layout

nstlim=500000, (run for 0.5 nsec)
\end_layout

\begin_layout Plain Layout

ntwx=1000, ntpr=200, (output frequency)
\end_layout

\end_inset


\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout Section

\series bold
Namelist Input Syntax
\end_layout

\begin_layout Standard
Namelist provides list-directed input, and convenient specification of default
 values, and is a part of the Fortran 90 standard, Namelist input groups
 take the form:
\end_layout

\begin_layout LyX-Code
&name
\end_layout

\begin_layout LyX-Code
var1=value, var2=value, var3(sub)=value,
\end_layout

\begin_layout LyX-Code
var4(sub,sub,sub)=value,value,
\end_layout

\begin_layout LyX-Code
var5=repeat*value,value,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Standard
The variables must be names in the Namelist variable list.
 The order of the variables in the input list is of no significance, except
 that if a variable is specified more than once, later assignments may overwrite
 earlier ones.
 Blanks may occur anywhere in the input, except embedded in constants (other
 than string constants, where they count as ordinary characters).
\end_layout

\begin_layout Standard
It is common in older inputs for the ending "/" to be replaced by "&end";
 this is non-standard-conforming.
\end_layout

\begin_layout Standard
Letter case is ignored in all character comparisons, but case is preserved
 in string constants.
 String constants must be enclosed by single quotes (').
 If the text string itself contains single quotes, indicate them by two
 consecutive single quotes, e.g.
 C1' becomes 'C1
\begin_inset Quotes erd
\end_inset

' as a character string constant.
\end_layout

\begin_layout Standard
Array variables may be subscripted or unsubscripted.
 An unsubscripted array variable is the same as if the subscript (1) had
 been specified.
 If a subscript list is given, it must have either one constant, or exactly
 as many as the number in the declared dimension of the array.
 Bounds checking is performed for ALL subscript positions, although if only
 one is given for a multi-dimension array, the check is against the entire
 array size, not against the first dimension.
 If more than one constant appears after an array assignment, the values
 go into successive locations of the array.
 It is NOT necessary to input all elements of an array.
\end_layout

\begin_layout Standard
Any constant may optionally be preceded by a positive (1,2,3,..) integer repeat
 factor, so that, for example, 25*3.1415 is equivalent to twenty-five successive
 values 3.1415.
 The repeat count separator, *, may be preceded and followed by 0 or more
 blanks.
 Valid LOGICAL constants are 0, F, .F., .FALSE., 1, T, .T., and .TRUE.; lower case
 versions of these also work.
\end_layout

\begin_layout Section

\series bold
Overview of the information in the input file
\begin_inset CommandInset label
LatexCommand label
name "sec:mdin-info"

\end_inset


\end_layout

\begin_layout Description
General
\begin_inset space ~
\end_inset

minimization
\begin_inset space ~
\end_inset

and
\begin_inset space ~
\end_inset

dynamics
\begin_inset space ~
\end_inset

input 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
One or more title lines, followed by the (required) &cntrl and (optional)
 &pb, &ewald, &qmmm, &amoeba or &debugf namelist blocks.
 Described in Sections 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:General-minimization"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Potential-function-parameters"

\end_inset

.
\end_layout

\end_deeper
\begin_layout Description
Varying
\begin_inset space ~
\end_inset

conditions
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
Parameters for changing temperature, restraint weights, etc., during the
 MD run.
 Each parameter is specified by a separate &wt namelist block, ending with
 &wt type="END", /.
 Described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Varying-conditions"

\end_inset

.
\end_layout

\end_deeper
\begin_layout Description
File
\begin_inset space ~
\end_inset

redirection
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
TYPE=
\shape italic
filename
\shape default
 lines.
 Section ends with the first non-blank line which does not correspond to
 a recognized redirection.
 Described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:File-redirection-commands"

\end_inset

.
 
\end_layout

\end_deeper
\begin_layout Description
Group
\begin_inset space ~
\end_inset

information
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
Read if 
\shape italic
ntr
\shape default
, 
\shape italic
ibelly
\shape default
 or 
\shape italic
idecomp
\shape default
 are set to nonzero values, and if some other conditions are satisfied;
 see sections on these variables, below.
 Described in Appendix 
\begin_inset CommandInset ref
LatexCommand ref
reference "cha:GROUP-Specification"

\end_inset

.
\end_layout

\end_deeper
\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:General-minimization"

\end_inset


\series bold
General minimization and dynamics parameters
\end_layout

\begin_layout Standard
Each of the variables listed below is input in a namelist statement with
 the namelist identifier &cntrl.cmmu can enter the parameters in any order,
 using keyword identifiers.
 Variables that are not given in the namelist input retain their default
 values.
 Support for namelist input is included in almost all current Fortran compilers,
 and is a standard feature of Fortran 90.
 A detailed description of the namelist convention is given in Appendix
 A.
\end_layout

\begin_layout Standard
In general, namelist input consists of an arbitrary number of comment cards,
 followed by a record whose first seven characters after a " &" (e.g.
 " &cntrl ") name a group of variables that can be set by name.cmsys is followed
 by statements of the form " maxcyc=500, diel=2.0, ...
 ", and is concluded by an " / " token.
 The first line of input contains a title, which is then followed by the
 &cntrl namelist.
 Note that the first character on each line of a namelist block must be
 a blank.
\end_layout

\begin_layout Standard
Some of the options and variables are much more important, and commonlycmrdified
, than are others.
 We have denoted the "common" options by printing them in 
\series bold
boldface
\series default
 below.
 In general, you can skip reading about the non-bold options on a first
 pass, and you should change these from their defaults only if you think
 you know what you are doing.
\end_layout

\begin_layout Subsection

\series bold
General flags describing the calculation
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
imin
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
imin
\end_layout

\end_inset


\series default
 Flag to run minimization.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (default) Run molecular dynamics without any minimization.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Perform an energy minimization.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 Read in a trajectory for analysis.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
Although sander will write energy information in the output files (using
 
\shape italic
ntpr
\shape default
), it is often desirable to calculate the energies of a set of structures
 at a later point.
 In particular, one may wish to post-process a set of structures using a
 different energy function than was used to generate the structures.
 An example of this is MM-PBSA analysis, where the explicit water is removed
 and replaced with a continuum model.
\end_layout

\begin_layout Standard
If 
\shape italic
imin
\shape default
 is set to 5, sander will read a trajectory file (the 
\begin_inset Quotes eld
\end_inset

inptraj
\begin_inset Quotes erd
\end_inset

 argument, specified using 
\family typewriter
-y
\family default
 on the command line), and will perform the functions described in the mdin
 file (e.g., an energy minimization) for each of the structures in this file.
 The final structure from each minimization will be written out to the normal
 mdcrd file.
 If you wish to read in a binary (i.e., NetCDF format) trajectory, be sure
 to set 
\shape italic
ioutfm
\shape default
 to 1 (see below).
 Note that this will result in the output trajectory having NetCDF format
 as well.
\end_layout

\begin_layout Standard
For example, when 
\shape italic
imin
\shape default
 = 5 and 
\shape italic
maxcyc
\shape default
 = 1000, sander will minimize each structure in the trajectory for 1000
 steps and write a minimized coordinate set for each frame to the mdcrd
 file.
 If 
\shape italic
maxcyc
\shape default
 = 1, the output file can be used to extract the energies of each of the
 coordinate sets in the inptraj file.
\end_layout

\begin_layout Standard
Trajectories containing box coordinates can be post-processed.
 In order to read trajectories with box coordinates, 
\shape italic
ntb
\shape default
 should be greater than 0.
\end_layout

\begin_layout Standard

\series bold
IMPORTANT CAVEAT:
\series default
 The initial coordinates input file used (
\family typewriter
-c
\family default
\shape italic
 
\shape default
<inpcrd>) should be the same as the initial coordinates input file used
 to generate the original trajectory.
 This is because sander sets up parameters for PME from the box coordinates
 in the initial coordinates input file.
 
\end_layout

\end_deeper
\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
nmropt
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
nmropt
\end_layout

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (default) No nmr-type analysis will be done.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 NMR restraints and weight changes will be read.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 NMR restraints, weight changes, NOESY volumes, chemical shifts and residual
 dipolar restraints will be read.
\end_layout

\end_deeper
\begin_layout Subsection

\series bold
Nature and format of the input
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
ntx
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntx
\end_layout

\end_inset


\series default
 Option to read the initial coordinates, velocities, and box size from the
 inpcrd file.
 Option 1 must be used when one is starting from minimized or model-built
 coordinates.
 If an MD restrt file is specified for inpcrd then option 5 is generally
 used (unless you explicitly wish to ignore the velocities that are present).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

1 (default) Coordinates, but no velocities, will be read; either formatted
 (ASCII) files or NetCDF files can be used, as the input file type will
 be auto-detected.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 Coordinates and velocities will be read from either a NetCDF or a formatted
 (ASCII) coordinate file.
 Box information will be read if 
\shape italic
ntb
\shape default
 
\begin_inset Formula $>$
\end_inset

 0.
 The velocity information will only be used if 
\shape italic
irest
\shape default
 = 1 (see below).
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
irest
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
irest
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "irest-flag"

\end_inset


\series default
 Flag to restart a simulation.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (default) Do not restart the simulation; instead, run as a new simulation.
 Velocities in the input coordinate file, if any, will be ignored, and the
 time step count will be set to 0 (unless overridden by 
\shape italic
t
\shape default
; see below).
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Restart the simulation, reading coordinates and velocities from a previously
 saved restart file.
 The velocity information is necessary when restarting, so 
\shape italic
ntx
\shape default
 (see above) must be 5 (for Amber versions much older than 20, ntx must
 be greater than or equal to 4), if 
\shape italic
irest
\shape default
 = 1.
\end_layout

\end_deeper
\begin_layout Subsection

\series bold
Nature and format of the output
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
ntxo
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ntxo
\end_layout

\end_inset

 Format of the final coordinates, velocities, and box size (if a constant
 volume or pressure run) written to file "restrt".
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Formatted (ASCII) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 (default) NetCDF file (recommended, unless you have a workflow that requires
 the formatted form.)
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
ntpr
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset


\series default
 Every 
\shape italic
ntpr
\shape default
 steps, energy information will be printed in human-readable form to files
 "mdout" and "mdinfo".
 "mdinfo" is closed and reopened each time, so it always contains the most
 recent energy and temperature.
 Default 50.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
ntwr
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ntwr
\end_layout

\end_inset

 Every 
\shape italic
ntwr
\shape default
 steps during dynamics, the 
\begin_inset Quotes eld
\end_inset

restrt
\begin_inset Quotes erd
\end_inset

 file will be written, ensuring that recovery from a crash will not be so
 painful.
 No matter what the value of 
\shape italic
ntwr
\shape default
, a restrt file will be written at the end of the run, i.e., after 
\shape italic
nstlim
\shape default
 steps (for dynamics) or 
\shape italic
maxcyc
\shape default
 steps (for minimization).
 If 
\shape italic
ntwr
\shape default
 
\begin_inset Formula $<$
\end_inset

 0, a unique copy of the file, 
\begin_inset Quotes eld
\end_inset

restrt_<nstep>
\begin_inset Quotes erd
\end_inset

, is written every abs(
\shape italic
ntwr
\shape default
) steps.
 This option is useful if for example one wants to run free energy perturbations
 from multiple starting points or save a series of restrt files for minimization.
 Default = nstlim.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
ntwx
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntwx
\end_layout

\end_inset


\series default
 Every 
\shape italic
ntwx
\shape default
 steps, the coordinates will be written to the mdcrd file.
 If 
\shape italic
ntwx
\shape default
 = 0, no coordinate trajectory file will be written.
 Default = 0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
ntwv
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ntwv
\end_layout

\end_inset

 Every 
\shape italic
ntwv
\shape default
 steps, the velocities will be written to the mdvel file.
 If 
\shape italic
ntwv
\shape default
 = 0, no velocity trajectory file will be written.
 If 
\shape italic
ntwv
\shape default
 = -1, velocities will be written to mdcrd, which then becomes a combined
 coordinate/velocity trajectory file, at the interval defined by 
\shape italic
ntwx
\shape default
.
 This option is available only for binary NetCDF output (
\shape italic
ioutfm
\shape default
 = 1).
 Most users will have no need for a velocity trajectory file and so can
 safely leave 
\shape italic
ntwv
\shape default
 at the default.
 Default = 0.
 Note that dumping velocities frequently, like forces or coordinates, will
 introduce potentially significant I/O and communication overhead, hurting
 both performance and parallel scaling.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ionstepvelocities
\begin_inset Index idx
status open

\begin_layout Plain Layout
ionstepvelocities
\end_layout

\end_inset

 Controls whether to print the half-step-ahead velocities (0, default) or
 on-step velocities (1).
 The half-step-ahead velocities can potentially be used to restart calculations,
 but the on-step velocities correspond to calculated kinetic energy/temperature.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntwf
\begin_inset Index idx
status open

\begin_layout Plain Layout
ntwf
\end_layout

\end_inset

 Every 
\emph on
ntwf
\emph default
 steps, the forces will be written to the mdfrc file.
 If 
\emph on
ntwf 
\emph default
= 0, no force trajectory file will be written.
 If 
\emph on
ntwf 
\emph default
= -1, forces will be written to the mdcrd, which then becomes a combind
 coordinate/force trajectory file, at the interval defined by 
\emph on
ntwx
\emph default
.
 This option is available only for binary NetCDF output (
\emph on
ioutfm
\emph default
 = 1).
 Most users will have no need for a force trajectory file and so can safely
 leave 
\emph on
ntwf
\emph default
 at the default.
 Default = 0.
 Note that dumping forces frequently, like velocities or coordinates, will
 introduce potentially significant I/O and communication overhead, hurting
 both performance and parallel scaling.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
ntwe
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ntwe
\end_layout

\end_inset

 Every 
\shape italic
ntwe
\shape default
 steps, the energies and temperatures will be written to file "mden" in
 a compact form.
 If 
\shape italic
ntwe
\shape default
 = 0 then no mden file will be written.
 Note that energies in the mden file are not synchronized with coordinates
 or velocities in the mdcrd or mdvel file(s).
 Assuming identical 
\shape italic
ntwe
\shape default
 and
\shape italic
 ntwx
\shape default
 values the energies are one time step before the coordinates (as well as
 the velocities which are synchronized with the coordinates).
 Consequently, an mden file is rarely written.
 Default = 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
ioutfm
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ioutfm
\end_layout

\end_inset

 The format of coordinate and velocity trajectory files (mdcrd, mdvel and
 inptraj).
 As of Amber 9, the binary format used in previous versions is no longer
 supported; binary output is now in NetCDF trajectory format.
 Binary trajectory files have many advantages: they are smaller, higher
 precision, much faster to read and write, and able to accept a wider range
 of coordinate (or velocity) values than formatted trajectory files.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Formatted ASCII trajectory
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 (default) Binary NetCDF trajectory
\end_layout

\end_deeper
\begin_layout Description

\family sans
ntwprt
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntwprt
\end_layout

\end_inset

 The number of atoms to include in trajectory files (mdcrd and mdvel).
 This flag can be used to decrease the size of the these files, by including
 only the first part of the system, which is usually of greater interest
 (for instance, one might include only the solute and not the solvent).
 If 
\shape italic
ntwprt
\shape default
 = 0, all atoms will be included.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (default) Include all atoms of the system when writing trajectories.
 
\end_layout

\begin_layout Description
>
\begin_inset space ~
\end_inset

0 Include only atoms 1 to 
\shape italic
ntwprt
\shape default
 when writing trajectories.
\end_layout

\end_deeper
\begin_layout Subsection

\series bold
Frozen or restrained atoms
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
ibelly
\begin_inset Index idx
status open

\begin_layout Plain Layout
ibelly
\end_layout

\end_inset


\family default
 Flag for belly type dynamics.
 If set to 1, a subset of the atoms in the system will be allowed to move,
 and the coordinates of the rest will be frozen.
 The 
\shape italic
moving
\shape default
 atoms are specified with 
\shape italic
bellymask
\shape default
.
 This option is not available when 
\shape italic
igb
\begin_inset Formula $>$
\end_inset

0
\shape default
.
 When belly type dynamics is in use, bonded energy terms, vdW interactions,
 and direct space electrostatic interactions are 
\emph on
not calculated
\emph default
 for pairs of frozen atoms.
 Note that this does 
\shape italic
not
\shape default
 provide any significant speed advantage.
 Freezing atoms can be useful for some applications but is maintained primarily
 for backwards compatibility with older versions of Amber.
 Most applications should use the 
\shape italic
ntr
\shape default
 variable instead to restrain parts of the system to stay close to some
 initial configuration.
 Default = 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
ntr
\begin_inset Index idx
status open

\begin_layout Plain Layout
ntr
\end_layout

\end_inset


\family default
\series default
 Flag for restraining specified atoms in Cartesian space using a harmonic
 potential, if ntr > 0.
 The restrained atoms are determined by the 
\shape italic
restraintmask
\shape default
 string.
 The force constant is given by 
\shape italic
restraint_wt
\shape default
.
 The coordinates are read in "restrt" format from the "refc" file.
 Default = 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
restraint_wt
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
restraint
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

wt
\end_layout

\end_inset


\family default
\series default
 The weight (
\begin_inset Formula $\mathrm{kcal}\cdot\mathrm{mol}^{-1}\cdot\mathrm{\AA}^{-2}$
\end_inset

) for the positional restraints.
 The restraint is of the form 
\begin_inset Formula $k(\Delta x)^{2}$
\end_inset

, where 
\begin_inset Formula $k$
\end_inset

 is the value given by this variable, and 
\begin_inset Formula $\Delta x$
\end_inset

 is the difference between one of the Cartesian coordinates of a restrained
 atom and its reference position.
 There is a term like this for each Cartesian coordinate of each restrainted
 atom.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
\series bold
restraintmask
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
restraintmask
\end_layout

\end_inset


\family default
\series default
 String that specifies the 
\shape italic
restrained
\shape default
 atoms when 
\shape italic
ntr=1
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\family sans
bellymask
\begin_inset Index idx
status open

\begin_layout Plain Layout
bellymask
\end_layout

\end_inset


\family default
 String that specifies the 
\shape italic
moving
\shape default
 atoms when 
\shape italic
ibelly=1
\shape default
.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
The syntax for both 
\shape italic
restraintmask
\shape default
 and 
\shape italic
bellymask
\shape default
 is given in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:ambmask"

\end_inset

.
 Note that these mask strings are limited to a maximum of 256 characters.
\end_layout

\end_deeper
\begin_layout Subsection

\series bold
Energy minimization
\begin_inset CommandInset label
LatexCommand label
name "subsec:Energy-minimization"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
maxcyc
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
maxcyc
\end_layout

\end_inset


\series default
 The maximum number of cycles of minimization.
 Default = 1.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntmin
\begin_inset Index idx
status open

\begin_layout Plain Layout
ntmin
\end_layout

\end_inset

 Flag for the method of minimization.
 
\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

3 The XMIN method is used, see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:XMIN"

\end_inset

.
 (default)
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 The LMOD method is used, see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:LMOD"

\end_inset

.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
dx0
\begin_inset Index idx
status open

\begin_layout Plain Layout
dx0
\end_layout

\end_inset

 The initial step length.
 If the initial step length is too big then will give a huge energy; however
 the minimizer is smart enough to adjust itself.
 Default 0.01.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
drms
\begin_inset Index idx
status open

\begin_layout Plain Layout
drms
\end_layout

\end_inset

 The convergence criterion for the energy Derivative: minimization will
 halt when the Root-Mean-Square of the Cartesian elements of the gradient
 of the energy is less than this.
 Default is 
\begin_inset Formula $10^{-4}\mathrm{kcal}\cdot\mathrm{mol}^{-1}\cdot\mathrm{\AA}^{-1}$
\end_inset

.
\end_layout

\begin_layout Subsection

\series bold
Molecular dynamics
\end_layout

\begin_layout Standard
The 
\begin_inset Quotes eld
\end_inset

middle
\begin_inset Quotes erd
\end_inset

 scheme offers a unified framework to develop efficient thermostatting algorithm
s for configurational sampling for the canonical ensemble, as described
 in Refs.
 
\begin_inset CommandInset citation
LatexCommand citep
key "middle-scheme-2017,PIMD-BAOAB-2016, Langevin-virtual-2017, Andersen-virtual-2017, LFMiddle-2018"
literal "true"

\end_inset

.
 It is the only MD scheme implemented in 
\emph on
msander
\emph default
.
 It can be implemented for performing molecular dynamics (MD) or path integral
 molecular dynamics (PIMD), either with or without holonomic constraints.
 The 
\begin_inset Quotes eld
\end_inset

middle
\begin_inset Quotes erd
\end_inset

 scheme allows the use of much larger time intervals (i.e., time stepsizes)
 
\begin_inset Formula $\Delta t$
\end_inset

 to maintain the same accuracy, which significantly improves the configurational
 sampling efficiency.
 That is, it is efficient for calculating structural properties and thermodynami
c observables that depend on coordinate variables.
 Most thermostats control the temperature by updating momenta of the system.
 Some prevailing thermostats include stochastic ones (such as the Andersen
 thermostat and Langevin dynamics) and deterministic ones (such as the Nosé-Hoov
er thermostat and Nosé-Hoover chain).
 In the 
\begin_inset Quotes eld
\end_inset

middle
\begin_inset Quotes erd
\end_inset

 scheme, immediately after the coordinate-updating step for half a time
 interval, the thermostat process for a full time interval takes place,
 which is then followed by the coordinate-updating step for another half
 time interval
\begin_inset CommandInset citation
LatexCommand citep
key "middle-scheme-2017, LFMiddle-2018"
literal "true"

\end_inset

.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
nstlim
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
nstlim
\end_layout

\end_inset


\series default
 Number of MD-steps to be performed.
 Default 1.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nscm
\begin_inset Index idx
status open

\begin_layout Plain Layout
nscm
\end_layout

\end_inset

 Flag for the removal of translational and rotational center-of-mass (COM)
 motion at regular intervals (default is 1000).
 For non-periodic simulations, after every NSCM steps, translational and
 rotational motion will be removed.
 For periodic systems, just the translational center-of-mass motion will
 be removed.
 This flag is ignored for belly simulations.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
For Langevin dynamics, the 
\emph on
position
\emph default
 of the center-of-mass of the molecule is reset to zero every NSCM steps,
 but the velocities are not affected.
 Hence there is no change to either the translation or rotational components
 of the momenta.
 (Doing anything else would destroy the way in which temperature is regulated
 in a Langevin dynamics system.) The only reason to even reset the coordinates
 is to prevent the molecule from diffusing so far away from the origin that
 its coordinates overflow the format used in restart or trajectory files.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
t
\begin_inset Index idx
status open

\begin_layout Plain Layout
t
\end_layout

\end_inset

 The time at the start (psec) this is for your own reference and is not
 critical.
 Start time is taken from the coordinate input file if IREST=1.
 Default 0.0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
dt
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
dt
\end_layout

\end_inset


\series default
 The time step (psec).
 Recommended MAXIMUM is .002 if SHAKE is used, or .001 if it isn't.
 Note that for temperatures above 300K, the step size should be reduced
 since greater temperatures mean increased velocities and longer distance
 traveled between each force evaluation, which can lead to anomalously high
 energies and system blowup.
 Default 0.001.
 
\begin_inset Newline newline
\end_inset

The use of Hydrogen Mass Repartitioning (HMR) (see 
\begin_inset CommandInset citation
LatexCommand cite
key "Hopkins15"
literal "true"

\end_inset

 and references therein for more information), together with SHAKE, allows
 the time step to be increased in a stable fashion by about a factor of
 two (up to .004) by slowing down the high frequency hydrogen motion in the
 system.
 To use HMR, the masses in the topology file need to be altered before starting
 the simulation.
 ParmEd can do this automatically with the HMassRepartition option; see
 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:ParmEd"

\end_inset

 .
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
nrespa
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
nrespa
\end_layout

\end_inset


\series default
 This variable allows the user to evaluate slowly-varying terms in the force
 field less frequently.
 For PME, "slowly-varying" (now) means the reciprocal sum.
 For generalized Born runs, the "slowly-varying" forces are those involving
 derivatives with respect to the effective radii, and pair interactions
 whose distances are greater than the "inner" cutoff, currently hard-wired
 at 8 Å.
 If NRESPA
\begin_inset Formula $>$
\end_inset

1 these slowly-varying forces are evaluated every 
\shape italic
nrespa
\shape default
 steps.
 The forces are adjusted appropriately, leading to an impulse at that step.
 If 
\shape italic
nrespa*dt
\shape default
 is less than or equal to 4 fs then the energy conservation is not seriously
 compromised.
 However if 
\shape italic
nrespa*dt
\shape default
 
\begin_inset Formula $>$
\end_inset

 4 fs then the simulation becomes less stable.
 Note that energies and related quantities are only accessible every 
\shape italic
nrespa
\shape default
 steps, since the values at other times are meaningless.
\end_layout

\begin_layout Subsection

\series bold
Temperature regulation
\begin_inset CommandInset label
LatexCommand label
name "subsec:Temperature-regulation"

\end_inset


\end_layout

\begin_layout Standard
Note: Flag "ntt" is used for the temperature regulation in the default thermosta
t scheme as shown below.
 The "middle" thermostat scheme [Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:middle-scheme"

\end_inset

] is much more efficient than the default scheme to accurately sample the
 configuration/conformation space in the molecular dynamics simulation for
 the NVT ensemble.
  Please read Section           
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:middle-scheme"

\end_inset

 for more details.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ntt
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntt
\end_layout

\end_inset


\series default
 Switch for temperature scaling.
 Note that setting 
\shape italic
ntt
\shape default
=0 corresponds to the microcanonical (NVE) ensemble (which should approach
 the canonical one for large numbers of degrees of freedom).
 Some aspects of the "weak-coupling ensemble" (
\shape italic
ntt
\shape default
=1) have been examined, and roughly interpolate between the microcanonical
 and canonical ensembles.
\begin_inset CommandInset citation
LatexCommand cite
key "Morishita00,Mudi04"
literal "true"

\end_inset

 The 
\shape italic
ntt
\shape default
=2 and 3 options correspond to the canonical (constant T) ensemble.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Constant total energy classical dynamics (assuming that 
\shape italic
ntb
\shape default

\begin_inset Formula $<$
\end_inset

2, as should probably always be the case when 
\shape italic
ntt=0
\shape default
).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 Use Langevin dynamics with the collision frequency 
\begin_inset Formula $\gamma$
\end_inset

 given by 
\shape italic
gamma_ln
\shape default
, discussed below.
 Note that when 
\begin_inset Formula $\gamma$
\end_inset

 has its default value of zero, this is the same as setting 
\shape italic
ntt
\shape default
 = 0.
 Since Langevin simulations are highly susceptible to "synchronization"
 artifacts,
\begin_inset CommandInset citation
LatexCommand citep
key "Uberuaga04,Sindhikara09"
literal "true"

\end_inset

 you should explicitly set the 
\shape italic
ig
\shape default
 variable (described below) to a different value at each restart of a given
 simulation.
 (Setting 
\begin_inset Formula $ig=-1$
\end_inset

 will randomize this starting seed, based on the system clock.)
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

10 Stochastic Isokinetic Nose-Hoover RESPA integrator 
\begin_inset CommandInset citation
LatexCommand citep
key "Tuckerman13"
literal "true"

\end_inset

.
 A novel isokinetic integrator developed by Tuckerman and co-workers that
 invokes an isokinetic constraint on the particle velocities combined with
 
\emph on
nkija
\emph default
 (see below) auxiliary thermostat velocities 
\emph on
v1
\emph default
 and 
\emph on
v2
\emph default
.
 The integrator includes a stochastic component in the equations of motion,
 which introduces white noise into the system, for the purpose of minimizing
 resonance instabilities in the velocities, ultimately allowing for larger
 RESPA steps.
 The isokinetic constraint has the form 
\begin_inset Formula $mv^{2}+\frac{L}{L+1}\sum_{i=1}^{L}Q_{1}v_{1i}^{2}=Lk_{B}T$
\end_inset

.
 Here 
\emph on
L
\emph default
 is the number of additional thermostat degrees of freedom, defined in AMBER
 as 
\emph on
nkija
\emph default
 (see below), and 
\begin_inset Formula $Q_{1}$
\end_inset

is the thermostat mass, determined from 
\emph on
sinrtau
\emph default
 (below), 
\emph on

\begin_inset Formula $v$
\end_inset


\emph default
 is the particle velocity and 
\begin_inset Formula $v_{1}$
\end_inset

 is one of two auxiliary velocities (e.g.
 thermostat velocities), and 
\begin_inset Formula $m$
\end_inset

, 
\begin_inset Formula $k_{B}$
\end_inset

, and 
\begin_inset Formula $T$
\end_inset

, are the particle mass, Boltzmann constant, and system temperature (
\emph on
temp0
\emph default
), respectively.
 In using this integrator, the system is placed in the isokinetic ensemble,
 as such the velocities are NOT canonical and no thermodynamic observables
 can be derived from them.
 This will lead to anomalous temperature readings throughout the simulation
 - for 1 thermostat degree of freedom (
\emph on

\begin_inset Formula $L$
\end_inset


\emph default
 = 
\emph on
nkija
\emph default
 = 1) the temperature will appear about one-half the specified temperature
 (
\emph on
temp0
\emph default
), and with additional thermostat DOF, the temperature will approach, but
 never exceed, the desired temperature, 
\emph on
temp0.
 
\emph default
However, the particle coordinates ARE canonical and it can be said the configura
tions obtained from a simulation were sampled from a Boltzmann distribution
 at the specified temperature (
\emph on
temp0
\emph default
).
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
temp0
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
temp0
\end_layout

\end_inset


\series default
 Reference temperature at which the system is to be kept, if 
\shape italic
ntt
\shape default
 
\begin_inset Formula $>$
\end_inset

 0.
 Note that for temperatures above 300K, the step size should be reduced
 since increased distance traveled between evaluations can lead to SHAKE
 and other problems.
 Default 300.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tempi
\begin_inset Index idx
status open

\begin_layout Plain Layout
tempi
\end_layout

\end_inset

 Initial temperature.
 For the initial dynamics run, (
\shape italic
ntx
\shape default
 = 1 or for Amber versions much older than 20, ntx 
\begin_inset Formula $<$
\end_inset

 3) the velocities are assigned from a Maxwellian distribution at 
\shape italic
tempi
\shape default
 K.
  If 
\shape italic
tempi
\shape default
 = 0.0, the velocities will be calculated from the forces instead.
 
\shape italic
tempi
\shape default
 has no effect if 
\shape italic
ntx
\shape default
 = 5 (for Amber versions much older than 20, if ntx 
\begin_inset Formula $>$
\end_inset

 3).
  Default 0.0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ig
\begin_inset Index idx
status open

\begin_layout Plain Layout
ig
\end_layout

\end_inset

 The seed for the pseudo-random number generator.
 The MD starting velocity is dependent on the random number generator seed
 if 
\shape italic
tempi
\shape default
 is nonzero and 
\shape italic
ntx
\shape default
 = 1 (for Amber versions much older than 20, if ntx 
\begin_inset Formula $<$
\end_inset

 3).
 The value of this seed also affects the set of pseudo-random values used
 for Langevin dynamics or Andersen-like coupling, and hence should be set
 to a different value on each restart if 
\shape italic
ntt
\shape default
 = 2 or 3.
 If 
\emph on
ig
\emph default
 = 
\begin_inset Formula $-1$
\end_inset

 (the default) then the random seed will be based on the current date and
 time, and hence will be different for every run.
 Unless you specifically desire reproducibility, it is recommended that
 you set 
\shape italic
ig
\shape default
 = 
\begin_inset Formula $-1$
\end_inset

 for all runs involving 
\emph on
ntt
\emph default
 = 2 or 3.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
gamma_ln
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
gamma
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

ln
\end_layout

\end_inset


\series default
 The collision frequency 
\begin_inset Formula $\gamma$
\end_inset

, in ps
\begin_inset Formula $^{-1}$
\end_inset

, when 
\shape italic
ntt
\shape default
 = 3.
 Default is 0.
 A.
 See Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:middle-scheme"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for details.
 Note that it is not necessary that 
\begin_inset Formula $\gamma$
\end_inset

 approximate the physical collision frequency, which is about 50 ps
\begin_inset Formula $^{-1}$
\end_inset

 for liquid water.
 In fact, it is often advantageous, in terms of sampling
\begin_inset CommandInset citation
LatexCommand citep
key "Loncharich92,Rhee2008"
literal "true"

\end_inset

 or stability of integration
\begin_inset CommandInset citation
LatexCommand citep
key "Izaguirre01"
literal "true"

\end_inset

, to use much smaller values, around 2 to 5 ps
\begin_inset Formula $^{-1}$
\end_inset

.
\begin_inset CommandInset citation
LatexCommand cite
key "Loncharich92,Izaguirre01"
literal "true"

\end_inset

 For implicit solvent (GB), even much lower values may be useful: for example,
 setting gamma_ln to 0.01 ps
\begin_inset Formula $^{-1}$
\end_inset

 can lead to significant, up to 100-fold in some cases, speedup of conformationa
l sampling.
\begin_inset CommandInset citation
LatexCommand citep
key "Anandakrishnan2015"
literal "true"

\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
The recommended value for 
\shape italic
gamma_ln
\shape default
 is related to the characteristic frequency (
\begin_inset Formula $\tilde{\omega}$
\end_inset

) of the specific system.
 The characteristic time of the potential energy autocorrelation function
 is 
\begin_inset Formula 
\begin{equation}
\tau_{UU}=\int_{0}^{\infty}\frac{\langle U(0)U(t)\rangle-\langle U\rangle^{2}}{\langle U^{2}\rangle-\langle U\rangle^{2}}\,\mathrm{d}t
\end{equation}

\end_inset

The optimal value of the thermostat parameter that produces the minimum
 correlation time of the potential is 
\begin_inset Formula $\xi^{opt}\approx\tilde{\omega}$
\end_inset

 for Langevin dynamics and 
\begin_inset Formula $\xi^{opt}\approx\sqrt{2}\tilde{\omega}$
\end_inset

 for the Andersen thermostat, as the time interval 
\begin_inset Formula $\Delta t$
\end_inset

 approaches zero.
 E.g.
 for a HO molecule, the frequency of the O-H stretch is around 3600 cm
\begin_inset Formula $^{-1}$
\end_inset

(
\begin_inset space ~
\end_inset

680 ps
\begin_inset Formula $^{-1}$
\end_inset

), so one can choose 680 ps
\begin_inset Formula $^{-1}$
\end_inset

 as the value of 
\shape italic
therm_par
\shape default
 when Langevin dynamics is used, or 960 ps
\begin_inset Formula $^{-1}$
\end_inset

 when the Andersen thermostat is employed.
 When the time interval 
\begin_inset Formula $\Delta t$
\end_inset

 is finite in the two thermostatting methods, while the characteristic correlati
on time goes to infinity as the thermostat parameter approaches zero, the
 characteristic correlation time gradually reaches a plateau as the thermostat
 parameter increases.
 (Please see Refs.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Langevin-virtual-2017, Andersen-virtual-2017, LFMiddle-2018"
literal "true"

\end_inset

 for more discussion.) When condensed phase systems are simulated, it is
 not straightforward to estimate the optimal thermostat parameter(s) that
 could be related to the mixing of frequencies (or time scales) of the system
 
\begin_inset CommandInset citation
LatexCommand citep
key "Andersen80"
literal "true"

\end_inset

.
  Some numerical tests are necessary for obtaining the reasonable region
 for the thermostat parameter such that the characteristic time divided
 by the time interval is relatively small.
  (This is true not only for the  
\begin_inset Quotes eld
\end_inset

middle
\begin_inset Quotes erd
\end_inset

 scheme but for all thermostat algorithms.)   For a liquid water system (216
 water molecules in a cell with periodic boundary conditions) with no holonomic
 constraints, the thermostat parameter is usually chosen to be 
\begin_inset Formula $2-50$
\end_inset

 ps
\begin_inset Formula $^{-1}$
\end_inset

.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
vlimit
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
vlimit
\end_layout

\end_inset


\series default
 If not equal to 0.0, then any component of the velocity that is greater
 than abs(VLIMIT) will be reduced to VLIMIT (preserving the sign).
 This can be used to avoid occasional instabilities in molecular dynamics
 runs.
 VLIMIT should generally be set to a value like 20 (the default), which
 is well above the most probable velocity in a Maxwell-Boltzmann distribution
 at room temperature.
 A warning message will be printed whenever the velocities are modified.
 Runs that have more than a few such warnings should be carefully examined.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nkija
\series bold

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series medium
nkija
\end_layout

\end_inset

 
\series default
For use with 
\emph on
ntt=10
\emph default
.
 This specifies the number of additional auxiliary velocity variables 
\emph on
v1
\emph default
 and 
\emph on
v2
\emph default
, which will total nkija
\begin_inset Formula $\times$
\end_inset


\emph on
v1
\emph default
 
\begin_inset Formula $+$
\end_inset

nkija
\begin_inset Formula $\times$
\end_inset


\emph on
v2 
\begin_inset CommandInset citation
LatexCommand citep
key "Tuckerman13"
literal "true"

\end_inset

.

\emph default
 Default is 1.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
sinrtau
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
sinrtau
\end_layout

\end_inset

 For the SINR (Stochastic Isokinetic Nose-Hoover RESPA) integrator (
\emph on
ntt=10
\emph default
), this specifies the time scale for determining the masses associated with
 the two auxiliary velocity variables 
\emph on
v1
\emph default
 and 
\emph on
v2
\emph default
 (e.g.
 thermostat velocities) and hence the magnitude of the coupling of the physical
 velocities with the auxiliary velocities.
 Generally this should be related to the time scale of the system.
 See 
\begin_inset CommandInset citation
LatexCommand citep
key "Tuckerman13"
literal "true"

\end_inset

 for more explanation.
 Default is 1.0.
\end_layout

\begin_layout Subsection

\series bold
Pressure regulation
\end_layout

\begin_layout Standard
In "constant pressure" dynamics, the volume of the unit cell is adjusted
 (by small amounts on each step) to make the computed pressure approach
 the target pressure, 
\shape italic
pres0
\shape default
.
 Equilibration with 
\shape italic
ntp
\shape default
 
\begin_inset Formula $>$
\end_inset

 0 is generally necessary to adjust the density of the system to appropriate
 values.
 Pressure regulation only applies when Constant Pressure periodic boundary
 conditions are used (
\shape italic
ntp > 0
\shape default
).
 The Monte Carlo barostat samples rigorously from the isobaric-isothermal
 ensemble and does not necessitate computing the virial.
 Please note: in general you will need to equilibrate the temperature to
 something like the final temperature using constant volume (
\shape italic
ntp
\shape default
=0) 
\shape italic
before
\shape default
 switching on constant pressure simulations to adjust the system to the
 correct density.
 If you fail to do this, the program will try to adjust the density too
 quickly, and bad things (such as SHAKE failures) are likely to happen.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ntp
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntp
\end_layout

\end_inset


\series default
 Flag for constant pressure dynamics.
 This option should be set to 1 or 2 when Constant Pressure periodic boundary
 conditions are used.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 No pressure scaling (Default)
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 md with isotropic position scaling 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
barostat
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
barostat
\end_layout

\end_inset

 Flag used to control which barostat to use in order to control the pressure.
\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Monte Carlo barostat 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
mcbarint
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
mcbarint
\end_layout

\end_inset

 Number of steps between volume change attempts performed as part of the
 Monte Carlo barostat.
 Default is 100.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
pres0
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
pres0
\end_layout

\end_inset


\series default
 Reference pressure (in units of bars, where 1 bar ≈ 0.987 atm) at which
 the system is maintained ( when NTP 
\begin_inset Formula $>$
\end_inset

 0).
 Default 1.0.
 
\end_layout

\begin_layout Subsubsection*

\series bold
Surface tension regulation
\end_layout

\begin_layout Standard
Constant surface tension is used in statistical ensembles for simulating
 liquid interfaces.
 This is primarily intended for lipid membrane simulations with two or more
 interfaces.
 Constant surface tension is only available for simulations with anisotropic
 pressure or semiisotropic scaling.
 This algorithm is an extension to the Berendsen pressure scaling algorithm
 that adjusts the tangential pressure evaluation in order to maintain a
 
\begin_inset Quotes eld
\end_inset

constant
\begin_inset Quotes erd
\end_inset

 surface tension.
\begin_inset CommandInset citation
LatexCommand citep
key "Zhang95"
literal "true"

\end_inset

 Since the surface tension is a function of the pressure tensor, fluctuations
 of the surface tension will be large.
\end_layout

\begin_layout Standard
In order to use constant surface tension, periodic boundary conditions (ntb
 = 2), anisotropic or semiisotropic pressure scaling (ntp = 2 or ntp =3),
 and an orthogonal box must be used.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
csurften
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
csurften
\end_layout

\end_inset


\series default
 Flag for constant surface tension dynamics.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 No constant surface tension (default)
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Constant surface tension with interfaces in the yz plane
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Constant surface tension with interfaces in the xz plane
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 Constant surface tension with interfaces in the xy plane
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
gamma_ten
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
gamma_ten
\end_layout

\end_inset


\series default
 Surface tension value in units of dyne/cm.
 Default value is 0.0 dyne/cm.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ninterface
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ninterface
\end_layout

\end_inset


\series default
 Number of interfaces in the periodic box.
 There must be at least two interfaces in the periodic box.
 Two interfaces is appropriate for a lipid bilayer system and is the default
 value.
\end_layout

\begin_layout Subsection

\series bold
SHAKE bond length constraints
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ntc
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntc
\end_layout

\end_inset


\series default
 Flag for SHAKE to perform bond length constraints.
\begin_inset CommandInset citation
LatexCommand cite
key "Ryckaert77"
literal "true"

\end_inset

 (See also NTF in the 
\series bold
Potential function
\series default
 section.
 In particular, typically NTF = NTC.) The SHAKE option should be used for
 most MD calculations.
 The size of the MD timestep is determined by the fastest motions in the
 system.
 SHAKE removes the bond stretching freedom, which is the fastest motion,
 and consequently allows a larger timestep to be used.
 For water models, a special "three-point" algorithm is used.
\begin_inset CommandInset citation
LatexCommand cite
key "Miyamoto92"
literal "true"

\end_inset

 Consequently, to employ TIP3P set NTF = NTC = 2.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
Since SHAKE is an algorithm based on dynamics, the minimizer is not aware
 of what SHAKE is doing; for this reason, minimizations generally should
 be carried out without SHAKE.
 One exception is short minimizations whose purpose is to remove bad contacts
 before dynamics can begin.
\end_layout

\begin_layout Standard
For parallel versions of 
\shape italic
sander
\shape default
 only intramolecular atoms can be constrained.
 Thus, such atoms must be in the same chain of the originating PDB file.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 SHAKE is not performed (default) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 bonds involving hydrogen are constrained 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 all bonds are constrained (not available for parallel or qmmm runs in
 
\shape italic
sander
\shape default
) 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
tol
\begin_inset Index idx
status open

\begin_layout Plain Layout
tol
\end_layout

\end_inset

 Relative geometrical tolerance for coordinate resetting in shake.
 Recommended maximum: 
\begin_inset Formula $<$
\end_inset

0.00005 Angstrom Default 0.00001.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
jfastw
\begin_inset Index idx
status open

\begin_layout Plain Layout
jfastw
\end_layout

\end_inset

 Fast water definition flag.
 By default, the system is searched for water residues, and special routines
 are used to SHAKE these systems.
\begin_inset CommandInset citation
LatexCommand cite
key "Miyamoto92"
literal "true"

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Normal operation.
 Waters are identified by the default names (given below), unless they are
 redefined, as described below.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 Do not use the fast SHAKE routines for waters.
 
\end_layout

\begin_layout Standard
The following variables allow redefinition of the default residue and atom
 names used by the program to determine which residues are waters.
 
\end_layout

\begin_layout Description
WATNAM The residue name the program expects for water.
 Default 'WAT '.
 
\end_layout

\begin_layout Description
OWTNM The atom name the program expects for the oxygen of water.
 Default 'O '.
 
\end_layout

\begin_layout Description
HWTNM1 The atom name the program expects for the 1st H of water.
 Default 'H1 '.
 
\end_layout

\begin_layout Description
HWTNM2 The atom name the program expects for the 2nd H of water.
 Default 'H2 '.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
noshakemask
\begin_inset Index idx
status open

\begin_layout Plain Layout
noshakemask
\end_layout

\end_inset

 String that specifies atoms that are not to be shaken (assuming that ntc
\begin_inset Formula $>$
\end_inset

1).
 Any bond that would otherwise be shaken by virtue of the 
\shape italic
ntc
\shape default
 flag, but which involves an atom flagged here, will *not* be shaken.
 The syntax for this string is given in Chap.
 13.5.
 Default is an empty string, which matches nothing.
 A typical use would be to remove SHAKE constraints from all or part of
 a solute, while still shaking rigid water models like TIPnP or SPC/E.
 Another use would be to turn off SHAKE constraints for the parts of the
 system that are being changed with thermodynamic integration, or which
 are the EVB or quantum regions of the system.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
If this option is invoked, then all parts of the potential must be evaluated,
 that is, 
\shape italic
ntf
\shape default
 must be one.
 The code enforces this by setting 
\shape italic
ntf
\shape default
 to 1 when a 
\shape italic
noshakemask
\shape default
 string is present in the input.
\end_layout

\begin_layout Standard
If you want the 
\shape italic
noshakemask
\shape default
 to apply to all or part of the water molecules, you must also set 
\shape italic
jfastw=4
\shape default
, to turn off the special code for water SHAKE.
 (If you are not shaking waters, you presumably also want to issue the "set
 default FlexibleWater on" command in LEaP; see that chapter for more informatio
n.)
\end_layout

\end_deeper
\begin_layout Subsection

\series bold
NMR refinement options
\end_layout

\begin_layout Standard
(Users to should consult the section NMR refinement to see the context of
 how the following parameters would be used.)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iscale
\begin_inset Index idx
status open

\begin_layout Plain Layout
iscale
\end_layout

\end_inset

 Number of additional variables to optimize beyond the 3N structural parameters.
 (Default = 0).
 At present, this is only used with residual dipolar coupling and CSA or
 pseudo-CSA restraints.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
noeskp
\begin_inset Index idx
status open

\begin_layout Plain Layout
noeskp
\end_layout

\end_inset

 The NOESY volumes will only be evaluated if mod(nstep, noeskp) = 0; otherwise
 the last computed values for intensities and derivatives will be used.
 (default = 1, i.e.
 evaluate volumes at every step) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ipnlty
\begin_inset Index idx
status open

\begin_layout Plain Layout
ipnlty
\end_layout

\end_inset

 This parameter determines the the functional form of the penalty function
 for NOESY volume and chemical shift restraints.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

1 the program will minimize the sum of the absolute values of the errors;
 this is akin to minimizing the crystallographic R-factor (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 the program will optimize the sum of the squares of the errors.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 For NOESY intensities, the penalty will be of the form 
\begin_inset Formula $awt[I_{c}^{1/6}-I_{o}^{1/6}]^{2}$
\end_inset

.
 Chemical shift penalties will be as for 
\shape italic
ipnlty=1
\shape default
.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
mxsub
\begin_inset Index idx
status open

\begin_layout Plain Layout
mxsub
\end_layout

\end_inset

 Maximum number of submolecules that will be used.
 This is used to determine how much space to allocate for the NOESY calculations.
 Default 1.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scalm
\begin_inset Index idx
status open

\begin_layout Plain Layout
scalm
\end_layout

\end_inset

 "Mass" for the additional scaling parameters.
 Right now they are restricted to all have the same value.
 The larger this value, the slower these extra variables will respond to
 their environment.
 Default 100 amu.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
pencut
\begin_inset Index idx
status open

\begin_layout Plain Layout
pencut
\end_layout

\end_inset

 In the summaries of the constraint deviations, entries will only be made
 if the penalty for that term is greater than PENCUT.
 Default 0.1.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tausw
\begin_inset Index idx
status open

\begin_layout Plain Layout
tausw
\end_layout

\end_inset

 For noesy volume calculations (
\shape italic
NMROPT = 2
\shape default
), intensities with mixing times less that TAUSW (in seconds) will be computed
 using perturbation theory, whereas those greater than TAUSW will use a
 more exact theory.
 See the theory section (below) for details.
 To always use the "exact" intensities and derivatives, set TAUSW = 0.0;
 to always use perturbation theory, set TAUSW to a value larger than the
 largest mixing time in the input.
 Default is TAUSW of 0.1 second, which should work pretty well for most systems.
\end_layout

\begin_layout Subsection

\series bold
EMAP restraints
\end_layout

\begin_layout Standard
EMAP restraints are used to perform targeted conformational search (TCS)
\begin_inset CommandInset citation
LatexCommand citep
key "Wu13"
literal "true"

\end_inset

.
 EMAP uses maps to define restraints to maintain conformations and/or to
 induce simulation systems to the target conformations.
 The restraint map can be either obtained from electron microscopy experiments
 or derived from known protein structures, or defined from initial simulation
 coordinates.
 EMAP can be used to do rigid docking of molecules into maps and to do flexible
 fitting to obtain conformations defined by experimental maps.
 EMAP can also be used to maintain conformations of protein domains when
 studying large scale conformational change.
 Users should consult the section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:EMAPcons"

\end_inset

 to see how to define EMAP restraints.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iemap
\begin_inset Index idx
status open

\begin_layout Plain Layout
iemap
\end_layout

\end_inset

 Turn on EMAP restrained simulation when 
\shape italic
iemap
\shape default
>0.
 (Default = 0).
 EMAP restraint information must be input from 
\shape italic
&emap
\shape default
 namelists in the input file.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
gammamap
\begin_inset Index idx
status open

\begin_layout Plain Layout
gammamap
\end_layout

\end_inset

 Friction constant for the EMAP restraint maps when allowed to move.
 (Default=1/ps).
 (See Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:EMAPcons"

\end_inset

)
\end_layout

\begin_layout Section

\series bold
\begin_inset CommandInset label
LatexCommand label
name "sec:Potential-function-parameters"

\end_inset

Potential function parameters
\end_layout

\begin_layout Standard
The parameters in this section generally control what sort of force field
 (or potential function) is used for the simulation.
\end_layout

\begin_layout Subsection

\series bold
Generic parameters
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ntf
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntf
\end_layout

\end_inset


\series default
 Force evaluation.
 Note: If SHAKE is used (see NTC), it is not necessary to calculate forces
 for the constrained bonds.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

1 complete interaction is calculated (default) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 bond interactions involving H-atoms omitted (use with NTC=2) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 all the bond interactions are omitted (use with NTC=3) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 angle involving H-atoms and all bonds are omitted 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 all bond and angle interactions are omitted 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

6 dihedrals involving H-atoms and all bonds and all angle interactions are
 omitted 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

7 all bond, angle and dihedral interactions are omitted 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

8 all bond, angle, dihedral and non-bonded interactions are omitted 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ntb
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ntb
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sander_ntb"

\end_inset


\series default
 This variable controls whether or not periodic boundaries are imposed on
 the system during the calculation of non-bonded interactions.
 Bonds spanning periodic boundaries are not yet supported.
 There is no longer any need to set this variable, since it can be determined
 from igb and ntp parameters.
 The 
\begin_inset Quotes eld
\end_inset

proper
\begin_inset Quotes erd
\end_inset

 default for ntb is chosen (ntb=0 when igb > 0, ntb=2 when ntp > 0, and
 ntb=1 otherwise).
 This behavior can be overridden by supplying an explicit value, although
 this is discouraged to prevent errors.
 The allowed values for NTB are
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 no periodicity is applied and PME is off (default when igb > 0)
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 constant volume (default when igb and ntp are both 0, which are their
 defaults) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 constant pressure (default when ntp > 0)
\end_layout

\begin_layout Standard
If NTB is nonzero then there must be a periodic boundary in the topology
 file.
 Constant pressure is not used in minimization (IMIN=1, above).
\end_layout

\begin_layout Standard
For a periodic system, constant pressure is the only way to equilibrate
 density if the starting state is not correct.
 For example, the solvent packing scheme used in LEaP can result in a net
 void when solvent molecules are subtracted which can aggregate into "vacuum
 bubbles" in a constant volume run.
 Another potential problem are small gaps at the edges of the box.
 The upshot is that almost every system needs to be equilibrated at constant
 pressure (
\shape italic
ntb=2, ntp
\begin_inset Formula $>$
\end_inset

0
\shape default
) to get to a proper density.
 But be sure to equilibrate first (at constant volume) to something close
 to the final temperature, before turning on constant pressure.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
dielc
\begin_inset Index idx
status open

\begin_layout Plain Layout
dielc
\end_layout

\end_inset

 Dielectric multiplicative constant for the electrostatic interactions.
 Default is 1.0.
 Please note this is NOT related to dielectric constants for generalized
 Born or Poisson-Boltzmann calculations.
 It should only be used for quasi-vacuum simulations.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
cut
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
cut
\end_layout

\end_inset


\series default
 This is used to specify the nonbonded cutoff, in Angstroms.
 For PME, the cutoff is used to limit direct space sum, and 8.0 is usually
 a good value.
 When 
\shape italic
igb
\begin_inset Formula $>$
\end_inset

0
\shape default
, the cutoff is used to truncate nonbonded pairs (on an atom-by-atom basis);
 here a larger value than the default is generally required.
 A separate parameter (
\series bold
RGBMAX
\series default
) controls the maximum distance between atom pairs that will be considered
 in carrying out the pairwise summation involved in calculating the effective
 Born radii, see the generalized Born section below.
 
\begin_inset Newline newline
\end_inset

When 
\emph on
igb > 0
\emph default
, the default is 9999.0 (effectively infinite)
\begin_inset Newline newline
\end_inset

When 
\emph on
igb==0
\emph default
, the default is 8.0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
fswitch
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
fswitch
\end_layout

\end_inset

 When off,
\shape italic
 fswitch<=0
\shape default
 , uses a truncation cutoff.
 When on 
\shape italic
fswitch>0
\shape default
, sets a force switching region where the force cutoff smoothly approaches
 0 between the region of the fswitch value to the cut value.
 Force values below the fswitch value follow the standard Lennard-Jones
 force.
 Default is -1.
 This option is not supported for use with GB (i.e., only 
\emph on
igb=0
\emph default
 and 
\emph on
ntb>0
\emph default
), nor is it compatible with the 12-6-4 Lennard-Jones model (
\emph on
lj1264=1
\emph default
).
 Due to performance regressions (about 20%) with running with the force
 switching on, it is recommended that simulations run with fswitch off unless
 using a force field that requires or recommends using the force switch.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nsnb
\begin_inset Index idx
status open

\begin_layout Plain Layout
nsnb
\end_layout

\end_inset

 Determines the frequency of nonbonded list updates when 
\shape italic
igb=0
\shape default
 and 
\shape italic
nbflag=0
\shape default
; see the description of 
\shape italic
nbflag
\shape default
 for more information.
 Default is 25.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ifqnt
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
ifqnt
\end_layout

\end_inset


\series default
 Flag for QM/MM run; if set to 1, you must also include a &qmmm namelist.
 See Section 6.4 for details on this option.
 Default is 0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
igb
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
igb
\end_layout

\end_inset


\series default
 Flag for using the generalized Born implicit solvent models.
 See Chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:genborn"

\end_inset

 for information about using this option.
 Default is 0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
irism
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
irism
\end_layout

\end_inset


\series default
 Flag for 3D-reference interaction site model (RISM) molecular solvation
 method.
 See Section
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:RISM"

\end_inset

for information about this option.
 Default is 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lj1264
\series bold

\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
lj1264
\end_layout

\end_inset


\series default
 In general, you should rarely have to set this variable.
 When the Lennard-Jones C-coefficient is found in your prmtop file, the
 default value is set to 1 (meaning it is active).
 When this flag is 
\emph on
not 
\emph default
present in the prmtop file, the default value is set to 0 (meaning the 12-6-4
 potential 
\begin_inset CommandInset citation
LatexCommand cite
key "Li14a"
literal "true"

\end_inset

 is inactive).
 Setting this to 0 when the C-coefficient is present will forcibly turn
 off the 12-6-4 potential.
 Setting lj1264 to 1 when no C-coefficient is present will result in a fatal
 error.
 Therefore, this flag can be used to quickly disable the 
\begin_inset Formula $r^{-4}$
\end_inset

 term.
 However, the remaining L-J parameters will still be optimized for the 12-6-4
 potential, so this should only be done when testing!.
\end_layout

\begin_layout Subsection

\series bold
Particle Mesh Ewald
\end_layout

\begin_layout Standard
The Particle Mesh Ewald (PME) method is always "on", unless 
\shape italic
ntb
\shape default
 = 0.
 PME is a fast implementation of the Ewald summation method for calculating
 the full electrostatic energy of a unit cell (periodic box) in a macroscopic
 lattice of repeating images.
 The PME method is fast since the reciprocal space Ewald sums are B-spline
 interpolated on a grid and since the convolutions necessary to evaluate
 the sums are calculated via fast Fourier transforms (FFTs).
 Note that the accuracy of the PME method is related to the density of the
 charge grid (NFFT1, NFFT2, and NFFT3), the spline interpolation order (ORDER),
 and the direct sum tolerance (DSUM_TOL); see the descriptions below for
 more information.
\end_layout

\begin_layout Standard
The PME method was implemented originally in Amber 3a by Tom Darden and
 has been developed in subsequent versions by many people, in particular
 by Tom Darden, Celeste Sagui, Tom Cheatham and Mike Crowley.
\begin_inset CommandInset citation
LatexCommand cite
key "Darden93,Essmann95,Crowley97,Sagui99"
literal "true"

\end_inset

 Generalizations of this method to systems with polarizable dipoles and
 electrostatic multipoles are described in Refs.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Toukmaji00,Sagui04"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
The &
\family typewriter
ewald
\family default
 namelist is read immediately after the 
\family typewriter
&cntrl
\family default
 namelist.
 We have tried hard to make the defaults for these parameters appropriate
 for solvated simulations.
 
\shape italic
Please take care in changing any values from their defaults.

\shape default
 The 
\family typewriter
&ewald
\family default
 namelist has the following variables: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nfft1,
\begin_inset space ~
\end_inset

nfft2,
\begin_inset space ~
\end_inset

nfft3
\begin_inset Index idx
status open

\begin_layout Plain Layout
nfft3
\end_layout

\end_inset

 These give the size of the charge grid (upon which the reciprocal sums
 are interpolated) in each dimension.
 Higher values lead to higher accuracy (when the DSUM_TOL is also lowered)
 but considerably slow the calculation.
 Generally it has been found that reasonable results are obtained when NFFT1,
 NFFT2 and NFFT3 are approximately equal to A, B and C, respectively, leading
 to a grid spacing (A/NFFT1, etc.) of 1.0 Å.
 Significant performance enhancement in the calculation of the fast Fourier
 transform is obtained by having each of the integer NFFT1, NFFT2 and NFFT3
 values be a 
\shape italic
product of powers
\shape default
 of 2, 3, and/or 5.
 If the values are not given, the program will chose values to meet these
 criteria.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
order
\begin_inset Index idx
status open

\begin_layout Plain Layout
order
\end_layout

\end_inset

 The order of the B-spline interpolation.
 The higher the order, the better the accuracy (unless the charge grid is
 too coarse).
 The minimum order is 3.
 An order of 4 (the default) implies a cubic spline approximation which
 is a good standard value.
 Note that the cost of the PME goes as roughly the order to the third power.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
verbose
\begin_inset Index idx
status open

\begin_layout Plain Layout
verbose
\end_layout

\end_inset

 Standard use is to have VERBOSE = 0.
 Setting VERBOSE to higher values (up to a maximum of 3) leads to voluminous
 output of information about the PME run.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dsum_tol
\begin_inset Index idx
status open

\begin_layout Plain Layout
dsum
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

tol
\end_layout

\end_inset

 This relates to the width of the direct sum part of the Ewald sum, requiring
 that the value of the direct sum at the Lennard-Jones cutoff value (specified
 in CUT as during standard dynamics) be less than DSUM_TOL.
 In practice it has been found that the relative error in the Ewald forces
 (RMS) due to cutting off the direct sum at CUT is between 10.0 and 50.0 times
 DSUM_TOL.
 Standard values for DSUM_TOL are in the range of 10
\begin_inset Formula $^{-6}$
\end_inset

 to 10
\begin_inset Formula $^{-5}$
\end_inset

 , leading to estimated RMS deviation force errors of 0.00001 to 0.0005.
 Default is 10
\begin_inset Formula $^{-5}$
\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
rsum_tol
\begin_inset Index idx
status open

\begin_layout Plain Layout
rsum
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

tol
\end_layout

\end_inset

 This serves as a way to generate the number of reciprocal vectors used
 in an Ewald sum.
 Typically the relative RMS reciprocal sum error is about 5-10 times RSUM_TOL.
 Default is 5 x 10
\begin_inset Formula $^{-5}$
\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mlimit
\begin_inset Index idx
status open

\begin_layout Plain Layout
mlimit
\end_layout

\end_inset

(1,2,3) This allows the user to explicitly set the number of reciprocal
 vectors used in a regular Ewald run.
 Note that the sum goes from -MLIMIT(2) to MLIMIT(2) and -MLIMIT(3) to MLIMIT(3)
 with symmetry being used in first dimension.
 Note also the sum is truncated outside an automatically chosen sphere.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ew_coeff
\begin_inset Index idx
status open

\begin_layout Plain Layout
ew
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

coeff
\end_layout

\end_inset

 Ewald coefficient, in 
\begin_inset Formula $\textrm{Å}^{-1}$
\end_inset

 .
 Default is determined by 
\shape italic
dsum_tol
\shape default
 and 
\shape italic
cutoff
\shape default
.
 If it is explicitly inputed then that value is used, and 
\shape italic
dsum_tol
\shape default
 is computed from 
\shape italic
ew_coeff
\shape default
 and 
\shape italic
cutoff
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nbflag
\begin_inset Index idx
status open

\begin_layout Plain Layout
nbflag
\end_layout

\end_inset

 If 
\shape italic
nbflag = 0
\shape default
, construct the direct sum nonbonded list in the "old" way, 
\begin_inset Formula $i.e.$
\end_inset

 update the list every 
\shape italic
nsnb
\shape default
 steps.
 If 
\shape italic
nbflag = 1
\shape default
 (the default when 
\shape italic
imin = 0
\shape default
 or 
\shape italic
ntb 
\begin_inset Formula $>$
\end_inset

 0
\shape default
), 
\shape italic
nsnb
\shape default
 is ignored, and the list is updated whenever any atom has moved more than
 1/2 
\shape italic
skinnb
\shape default
 since the last list update.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
skinnb
\begin_inset Index idx
status open

\begin_layout Plain Layout
skinnb
\end_layout

\end_inset

 Width of the nonbonded "skin".
 The direct sum nonbonded list is extended to 
\shape italic
cut
\shape default
 + 
\shape italic
skinnb
\shape default
, and the van der Waals and direct electrostatic interactions are truncated
 at 
\shape italic
cut
\shape default
.
 Default is 2.0 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

.
 Use of this parameter is required for energy conservation, and recommended
 for all PME runs.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
netfrc
\begin_inset Index idx
status open

\begin_layout Plain Layout
netfrc
\end_layout

\end_inset

 The basic "smooth" PME implementation used here does not necessarily conserve
 momentum.
 If 
\shape italic
netfrc = 1
\shape default
, (the default) the total force on the system is artificially removed at
 every step.
 This parameter is set to 0 if minimization is requested, which implies
 that the gradient is an accurate derivative of the energy.
 You should only change this parameter if you really know what you are doing.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
vdwmeth
\begin_inset Index idx
status open

\begin_layout Plain Layout
vdwmeth
\end_layout

\end_inset

 Determines the method used for van der Waals interactions beyond those
 included in the direct sum.
 A value of 0 includes no correction; the default value of 1 uses a continuum
 model correction for energy and pressure.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
eedmeth
\begin_inset Index idx
status open

\begin_layout Plain Layout
eedmeth
\end_layout

\end_inset

 Determines how the switch function for the direct sum Coulomb interaction
 is evaluated.
 The default value of 1 uses a cubic spline.
 A value of 2 implies a linear table lookup.
 A value of three implies use of an "exact" subroutine call.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
eedtbdns
\begin_inset Index idx
status open

\begin_layout Plain Layout
eedtbdns
\end_layout

\end_inset

 Density of spline or linear lookup table, if 
\shape italic
eedmeth
\shape default
 is 1 or 2.
 Default is 500 points per unit.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
column_fft
\begin_inset Index idx
status open

\begin_layout Plain Layout
column
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

fft
\end_layout

\end_inset

 1 or 0 flag to turn on or off, respectively, column-mode fft for parallel
 runs.
 The default mode is slab mode which is efficient for low processor counts.
 The column method can be faster for larger processor counts since there
 can be more columns than slabs and the communications pattern is less congested.
 This flag has no effect on non-parallel runs.
 Users should test the efficiency of the method in comparison to the default
 method before performing long calculations.
 Default is 0 (off).
\end_layout

\begin_layout Subsection

\series bold
Using IPS for the calculation of nonbonded interactions
\end_layout

\begin_layout Standard
Isotropic Periodic Sum (IPS) is a method for long-range interaction calculation.
\begin_inset CommandInset citation
LatexCommand cite
key "Wu05,Klauda07,Takahashi07,Wu08,Wu09,Venable09"
literal "true"

\end_inset

 Unlike the Ewald method, which uses periodic boundary images to calculate
 long range interactions, IPS uses isotropic periodic images of a local
 region to calculate the long-range contributions.
 
\end_layout

\begin_layout Standard
The IPS method in the current version is different from that implemented
 in Amber10.
 All IPS potentials use rationalized polynomial forms and the electrostatic
 interaction is calculated using the polar IPS potential.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Wu09"
literal "true"

\end_inset

 In addition, the 3D IPS/DFFT algorithm 
\begin_inset CommandInset citation
LatexCommand citep
key "Wu08"
literal "true"

\end_inset

 is implemented to handle heterogeneous systems as well as finite systems.
 A homogeneous system is defined as the one where a cutoff region (with
 
\shape italic
cut
\shape default
 as its radius) has similar composition throughout the system, such as small
 molecular solutions.
 Otherwise, a system is defined as a heterogeneous system, such as interfacial
 systems or finite systems.
 For heterogeneous systems, a local region larger than the cutoff region,
 normally equal or larger than the periodic boundary box, must be used to
 produce accurate long range interactions.
 For homogeneous systems, it is recommended to use the 3D IPS method (
\shape italic
ips
\shape default
≤3), which uses the cutoff distance,
\shape italic
 cut
\shape default
, to define the local region radius.
 
\shape italic
cut
\shape default
 is typically around 10 Å.
 The 3D IPS/DFFT method (
\shape italic
ips
\shape default
≥4) can be used for any type of systems, but is recommended for heterogeneous
 systems only due to the extra discrete fast Fourier transform (DFFT) expense.
 
\end_layout

\begin_layout Standard
For the amoeba polarizable potentials in 
\emph on
sander
\emph default
, 3D IPS is implemented for interactions between charges, dipoles, and multipole
s.
 The local region radius takes the value of 
\shape italic
ee_dsum_cut
\shape default
 in the amoeba namelist, typically, 7 Å.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ips
\begin_inset Index idx
status open

\begin_layout Plain Layout
ips
\end_layout

\end_inset

 Flag to control nonbonded interaction calculation method.
 The 
\shape italic
cut
\shape default
 value will be used to define the local region radius for 
\shape italic
ips
\shape default
≤3.
 When IPS is used for electrostatic interaction, PME will be turned off.
 When using the amoeba polarizable potentials, 
\shape italic
iamoeba=1
\shape default
, 
\shape italic
ips
\shape default
>0 (same as 
\shape italic
ips
\shape default
=2)will turn on 3D IPS for all charge, dipole, and quadrupole interactions
 and the 
\shape italic
ee_dsum_cut
\shape default
 value will be used to define the local region radius.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 IPS will not be used (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 3D IPS will be used for both electrostatic and L-J interactions.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 3D IPS will be used only for electrostatic, including all multipole, interacti
ons.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 3D IPS will be used only for L-J interactions.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 3D IPS/DFFT will be used for both electrostatic and L-J interactions.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 3D IPS/DFFT will be used only for electrostatic interactions.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

6 3D IPS/DFFT will be used only for L-J interactions.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
raips
\begin_inset Index idx
status open

\begin_layout Plain Layout
raips
\end_layout

\end_inset

 Local region radius.
 
\shape italic
raips
\shape default
 is automatically set to 
\shape italic
cut
\shape default
 for 3D IPS calculations (
\shape italic
ips
\shape default
≤3) and should be set larger than 
\shape italic
cut
\shape default
 for 3D IPS/DFFT calculations (
\shape italic
ips
\shape default
≥4).
 A negative value indicates that it is set to the longest box side of a
 simulation system.
 For finite systems, i.e., system without periodic boundary conditions, 
\shape italic
raips
\shape default
=∞, which corresponding no image interaction.
 The default value is -1 Å.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mipsx,mipsy,mipsz
\begin_inset Index idx
status open

\begin_layout Plain Layout
mipsx
\end_layout

\end_inset

 Number of grids along three periodic boundary sides when using 3D IPS/DFFT
 method (
\shape italic
ips
\shape default
≥4).
 Negative values indicate they are calculated based on the grid size, 
\shape italic
gridips
\shape default
.
 Typical numbers are the lengths of box sides (in Å) divided by 2 Å.
 Default values are -1.
 When 
\shape italic
ips
\shape default
=6 and PME is used for electrostatic interaction, they are set to 
\shape italic
nfft1
\shape default
, 
\shape italic
nfft2
\shape default
, and 
\shape italic
nfft3
\shape default
 defined for PME, respectively.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mipso
\begin_inset Index idx
status open

\begin_layout Plain Layout
mipso
\end_layout

\end_inset

 The order of the B-spline interpolation (
\shape italic
ips
\shape default
≥4).
 The higher the order, the better the accuracy (unless the charge grid is
 too coarse).
 The minimum order is 3.
 An order of 4 (the default) implies a cubic spline approximation which
 is a good standard value.
 The cost for the DFFT calculation goes as roughly the order to the third
 power.
 For 
\shape italic
ips
\shape default
=6 and PME is used to electrostatic interaction, it is set to 
\shape italic
order 
\shape default
defined for PME.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
gridips
\begin_inset Index idx
status open

\begin_layout Plain Layout
gridips
\end_layout

\end_inset

 Grid size for 3D IPS/DFFT calculation (
\shape italic
ips
\shape default
≥4).
 The default value is 2 Å.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dvbips
\begin_inset Index idx
status open

\begin_layout Plain Layout
dvbips
\end_layout

\end_inset

 Volume tolerance for updating IPS function grids (
\shape italic
ips
\shape default
≥4).
 When volume changes like in 
\shape italic
NPT
\shape default
 simulations, the grid size changes and IPS function on grid points need
 be updated.
 The updating only happens when the volume change ratio is more than 
\shape italic
dvbips
\shape default
.
 The default value is 1×10
\begin_inset Formula $^{\text{-8}}$
\end_inset

.
 
\end_layout

\begin_layout Subsection

\series bold
Extra point options 
\begin_inset CommandInset label
LatexCommand label
name "subsec:Extra-point-options"

\end_inset


\end_layout

\begin_layout Standard
Several parameters deal with "extra-points" (sometimes called lone-pairs),
 which are force centers that are not at atomic positions.
 These are currently defined as atoms with "EP" in their names.
 These input variables are really only for the convenience of force-field
 developers; 
\shape italic
do not change the defaults unless you know what you are doing, and have
 read the code.

\shape default
 These variables are set in the &ewald namelist.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
frameon
\begin_inset Index idx
status open

\begin_layout Plain Layout
frameon
\end_layout

\end_inset

 If 
\shape italic
frameon
\shape default
 is set to 1, (default) the bonds, angles and dihedral interactions involving
 the lone pairs/extra points are removed except for constraints added during
 parm.
 The lone pairs are kept in ideal geometry relative to local atoms, and
 resulting torques are transferred to these atoms.
 To treat extra points as regular atoms, set frameon=0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
chngmask
\begin_inset Index idx
status open

\begin_layout Plain Layout
chngmask
\end_layout

\end_inset

 
\shape italic
\emph on
If
\shape default
\emph default
 
\shape italic
chngmask
\shape default
=1 (default), new 1-1, 1-2, 1-3 and 1-4 interactions are calculated.
 An extra point belonging to an atom has a 1-1 interaction with it, and
 participates in any 1-2, 1-3 or 1-4 interaction that atom has.
 For example, suppose (excusing the geometry) C1,C2,C3,C4 form a dihedral
 and each has 1 extra point attached as below
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout LyX-Code
C1------C2------C3------C4
\end_layout

\begin_layout LyX-Code
 
\series bold
|      |       |       |
\end_layout

\begin_layout LyX-Code
Ep1    Ep2     Ep3     Ep4
\end_layout

\begin_layout Standard
The 1-4 interactions include C1-C4, Ep1-C4, C1-Ep4, and Ep1-Ep4.
 (To see a printout of all 1-1, 1-2, 1-3 and 1-4 interactions set verbose=1.)
 These interactions are masked out of nonbonds.
 Thus the amber mask list is rebuilt from these 1-1, 1-2, 1-3 and 1-4 pairs.
 A separate list of 1-4 nonbonds is then compiled.
 This list does not agree in general with the above 1-4, since a 1-4 could
 also be a 1-3 if its in a ring.
 See the 
\shape italic
ephi()
\shape default
 routine for the precise algorithm involved here.
 The list of 1-4 nonbonds is printed if 
\shape italic
verbose=1.
\end_layout

\end_deeper
\begin_layout Subsection

\series bold
Detailed MPI Timings
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
profile_mpi
\begin_inset Index idx
status open

\begin_layout Plain Layout
profile
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

mpi
\end_layout

\end_inset

 Adjusts whether detailed per thread timings should be written to a file
 called profile_mpi when running sander in parallel.
 By default only average timings are printed to the output file.
 This is done for performance reasons, especially when running 
\emph on
multisander
\emph default
 runs.
 However for development it is useful to know the individual timings for
 each mpi thread.
 When running in serial the value of profile_mpi is ignored.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 No detailed MPI timings will be written (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 A detailed breakdown of the timings for each MPI thread will be written
 to the file: profile_mpi.
\end_layout

\end_deeper
\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Varying-conditions"

\end_inset

Varying conditions
\end_layout

\begin_layout Standard
This section of information is read (
\shape italic
if NMROPT 
\begin_inset Formula $>$
\end_inset

 0
\shape default
) as a series of namelist specifications, with name "&wt".
 This namelist is read repeatedly until a namelist &wt statement is found
 with TYPE=END.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
TYPE Defines quantity being varied; valid options are listed below.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ISTEP1,ISTEP2 This change is applied over steps/iterations ISTEP1 through
 ISTEP2.
 If ISTEP2 = 0, this change will remain in effect from step ISTEP1 to the
 end of the run at a value of VALUE1 (VALUE2 is ignored in this case).
 
\shape italic
(default= both 0)
\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
VALUE1,VALUE2 Values of the change corresponding to ISTEP1 and ISTEP2, respectiv
ely.
 If ISTEP2=0, the change is fixed at VALUE1 for the remainder of the run,
 once step ISTEP1 is reached.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
IINC If IINC 
\begin_inset Formula $>$
\end_inset

 0, then the change is applied as a step function, with IINC steps/iterations
 between each change in the target VALUE (ignored if ISTEP2=0).
 If IINC =0, the change is done continuously.
 
\shape italic
(default=0)
\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
IMULT If IMULT=0, then the change will be linearly interpolated from VALUE1
 to VALUE2 as the step number increases from ISTEP1 to ISTEP2.
 
\shape italic
(default)
\shape default
 If IMULT=1, then the change will be effected by a series of multiplicative
 scalings, using a single factor, R, for all scalings.
 i.e.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
\align center
VALUE2 = (R**INCREMENTS) * VALUE1.
 
\end_layout

\begin_layout Standard
INCREMENTS is the number of times the target value changes, which is determined
 by ISTEP1, ISTEP2, and IINC.
 
\end_layout

\end_deeper
\begin_layout Standard
The remainder of this section describes the options for the TYPE parameter.
 For a few types of cards, the meanings of the other variables differ from
 that described above; such differences are noted below.
 Valid Options for TYPE (you must use uppercase) are: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
BOND Varies the relative weighting of bond energy terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ANGLE Varies the relative weighting of valence angle energy terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
TORSION Varies the relative weighting of torsion (and J-coupling) energy
 terms.
 Note that any restraints defined in the input to the PARM program are included
 in the above.
 Improper torsions are handled separately (IMPROP).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
IMPROP Varies the relative weighting of the "improper" torsional terms.
 These are not included in TORSION.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
VDW Varies the relative weighting of van der Waals energy terms.
 This is equivalent to changing the well depth (epsilon) by the given factor.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
HB Varies the relative weighting of hydrogen-bonding energy terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ELEC Varies the relative weighting of electrostatic energy terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
NB Varies the relative weights of the non-bonded (VDW, HB, and ELEC) terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ATTRACT Varies the relative weights of the attractive parts of the van der
 waals and h-bond terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
REPULSE Varies the relative weights of the repulsive parts of the van der
 waals and h-bond terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
RSTAR Varies the effective van der Waals radii for the van der Waals (VDW)
 interactions by the given factor.
 Note that this is done by changing the relative attractive and repulsive
 coefficients, so ATTRACT/REPULSE should not be used over the same step
 range as RSTAR.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
INTERN Varies the relative weights of the BOND, ANGLE and TORSION terms.
 "Improper" torsions (IMPROP) must be varied separately.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ALL Varies the relative weights of all the energy terms above (BOND, ANGLE,
 TORSION, VDW, HB, and ELEC; does not affect RSTAR or IMPROP).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
REST Varies the relative weights of *all* the NMR restraint energy terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
RESTS Varies the weights of the "short-range" NMR restraints.
 Short- range restraints are defined by the SHORT instruction (see below).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
RESTL Varies the weights of any NMR restraints which are not defined as
 "short range" by the SHORT instruction (see below).
 When no SHORT instruction is given, RESTL is equivalent to REST.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
NOESY Varies the overall weight for NOESY volume restraints.
 Note that this value multiplies the individual weights read into the "awt"
 array.
 (Only if NMROPT=2; see Section 4 below).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
SHIFTS Varies the overall weight for chemical shift restraints.
 Note that this value multiplies the individual weights read into the "wt"
 array.
 (Only if NMROPT=2; see section 4 below).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
XRAY Varies the xray_weight restraint weight.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
SHORT Defines the short-range restraints.
 For this instruction, ISTEP1, ISTEP2, VALUE1, and VALUE2 have different
 meanings.
 A short-range restraint can be defined in two ways.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
(1) If the residues containing each pair of bonded atoms comprising the
 restraint are close enough in the primary sequence:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
ISTEP1 
\begin_inset Formula $\le$
\end_inset

 ABS(delta_residue) 
\begin_inset Formula $\le$
\end_inset

 ISTEP2, 
\end_layout

\begin_layout Standard
where delta_residue is the difference in the numbers of the residues containing
 the pair of bonded atoms.
 
\end_layout

\begin_layout Standard
(2) If the distances between each pair of bonded atoms in the restraint
 fall within a prescribed range:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
VALUE1 
\begin_inset Formula $\le$
\end_inset

 distance 
\begin_inset Formula $\le$
\end_inset

 VALUE2.
 
\end_layout

\begin_layout Standard
Only one SHORT command can be issued, and the values of ISTEP1, ISTEP2,
 VALUE1, and VALUE2 remain fixed throughout the run.
 However, if IINC
\begin_inset Formula $>$
\end_inset

0, then the short-range interaction list will be re-evaluated every IINC
 steps.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
TGTRMSD Varies the RMSD target value for targeted MD.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
TEMP0 Varies the target temperature TEMP0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
TEMP0LES Varies the LES target temperature TEMP0LES.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
TAUTP Varies the coupling parameter, TAUTP, used in temperature scaling
 when temperature coupling options NTT=1 is used.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
CUT Varies the non-bonded cutoff distance.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
NSTEP0 If present, this instruction will reset the initial value of the
 step counter (against which ISTEP1/ISTEP2 and NSTEP1/NSTEP2 are compared)
 to the value ISTEP1.
 This only affects the way in which NMR weight restraints are calculated.
 It does not affect the value of NSTEP that is printed as part of the dynamics
 output.
 An NSTEP0 instruction only has an effect at the beginning of a run.
 For this card (only) ISTEP2, VALUE1, VALUE2 and IINC are ignored.
 If this card is omitted, NSTEP0 = 0.
 This card can be useful for simulation restarts, where NSTEP0 is set to
 the final step on the previous run.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
STPMLT If present, the NMR step counter will be changed in increments of
 STPMLT for each actual dynamics step.
 For this card, only VALUE1 is read.
 ISTEP1, ISTEP2, VALUE2, IINC, and IMULT are ignored.
 Default = 1.0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
DISAVE,
\begin_inset space ~
\end_inset

ANGAVE,
\begin_inset space ~
\end_inset

TORAVE If present, then by default time-averaged values (rather than instantaneo
us values) for the appropriate set of restraints will be used.
 DISAVE controls distance data, ANGAVE controls angle data, TORAVE controls
 torsion data.
 See below for the functional form used in generating time-averaged data.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
For these cards: VALUE1 = 
\begin_inset Formula $\tau$
\end_inset

 (characteristic time for exponential decay) VALUE2 = POWER (power used
 in averaging; the nearest integer of value2 is used) Note that the range
 (ISTEP1
\begin_inset Formula $\to$
\end_inset

ISTEP2) applies only to TAU; The value of POWER is not changed by subsequent
 cards with the same ITYPE field, and time-averaging will always be turned
 on for the entire run if one of these cards appears.
\end_layout

\begin_layout Standard
Note also that, due to the way that the time averaged internals are calculated,
 changing 
\begin_inset Formula $\tau$
\end_inset

 at any time after the start of the run will only affect the relative weighting
 of steps occurring after the change in 
\begin_inset Formula $\tau$
\end_inset

 .
 Separate values for 
\begin_inset Formula $\tau$
\end_inset

 and POWER are used for bond, angle, and torsion averaging.
\end_layout

\begin_layout Standard
The default value of 
\begin_inset Formula $\tau$
\end_inset

 (if it is 0.0 here) is 1.0D+6, which results in no exponential decay weighting.
 Any value of 
\begin_inset Formula $\tau$
\end_inset

 
\begin_inset Formula $\ge$
\end_inset

 1.D+6 will result in no exponential decay.
 
\end_layout

\begin_layout Standard
If DISAVE,ANGAVE, or TORAVE is chosen, one can still force use of an instantaneo
us value for specific restraints of the particular type (bond, angle, or
 torsion) by setting the IFNTYP field to "1" when the restraint is defined
 (IFNTYP is defined in the DISANG file).
 
\end_layout

\begin_layout Standard
If time-averaging for a particular class of restraints is being performed,
 all restraints of that class that are being averaged (that is, all restraints
 of that class except those for which IFNTYP=1) *must* have the same values
 of NSTEP1 and NSTEP2 (NSTEP1 and NSTEP2 are defined below).
 (For these cards, IINC and IMULT are ignored) See the discussion of time-averag
ed restraints following the input descriptions.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
DISAVI,
\begin_inset space ~
\end_inset

ANGAVI,
\begin_inset space ~
\end_inset

TORAVI 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
ISTEP1: Ignored.
 
\end_layout

\begin_layout Description
ISTEP2: Sets IDMPAV.
 If IDMPAV 
\begin_inset Formula $>$
\end_inset

 0, 
\shape italic
and
\shape default
 a dump file has been specified (DUMPAVE is set in the file redirection
 section below), then the time-averaged values of the restraints will be
 written every IDMPAV steps.
 Only one value of IDMPAV can be set (corresponding to the first DISAVI/ANGAVI/T
ORAVI card with ISTEP2 
\begin_inset Formula $>$
\end_inset

 0), and 
\shape italic
all
\shape default
 restraints (even those with IFNTYP=1) will be "dumped" to this file every
 IDMPAV steps.
 The values reported reflect the current value of 
\begin_inset Formula $\tau$
\end_inset

.
 
\end_layout

\begin_layout Description
VALUE1: The integral which gives the time-averaged values is undefined for
 the first step.
 By default, for each time-averaged internal, the integral is assigned the
 current value of the internal on the first step.
 If VALUE1
\begin_inset Formula $\ne$
\end_inset

0, this initial value of internal r is reset as follows:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout LyX-Code
-1000.
 
\begin_inset Formula $<$
\end_inset

 VALUE1 
\begin_inset Formula $<$
\end_inset

 1000.: Initial value = r_initial + VALUE 
\begin_inset Newline newline
\end_inset

 VALUE1 
\begin_inset Formula $<$
\end_inset

= -1000.: Initial value = r_target + 1000.
 
\begin_inset Newline newline
\end_inset

 1000.
 
\begin_inset Formula $<$
\end_inset

= VALUE1 : Initial value = r_target - 1000.
 
\end_layout

\begin_layout Standard
r_target is the target value of the internal, given by R2+R3 (or just R3,
 if R2 is 0).
 VALUE1 is in angstroms for bonds, in degrees for angles.
 
\end_layout

\end_deeper
\begin_layout Description
VALUE2: This field can be used to set the value of 
\begin_inset Formula $\tau$
\end_inset

 used in calculating the time-averaged values of the internal restraints
 reported at the end of a simulation (if LISTOUT is specified in the redirection
 section below).
 By default, no exponential decay weighting is used in calculating the final
 reported values, regardless of what value of 
\begin_inset Formula $\tau$
\end_inset

 was used during the simulation.
 If VALUE2
\begin_inset Formula $>$
\end_inset

0, then 
\begin_inset Formula $\tau$
\end_inset

 = VALUE2 will be used in calculating these final reported averages.
 Note that the value of VALUE2 = 
\begin_inset Formula $\tau$
\end_inset

 specified here only affects the reported averaged values in at the end
 of a simulation.
 It does not affect the time-averaged values used during the simulation
 (those are changed by the VALUE1 field of DISAVE, ANGAVE and TORAVE instruction
s).
 
\end_layout

\begin_layout Description
IINC: If IINC = 0, then forces for the class of time-averaged restraints
 will be calculated exactly as (dE/dr_ave) (dr_ave/dx).
 If IINC = 1, then then forces for the class of time-averaged restraints
 will be calculated as (dE/dr_ave) (dr(t)/dx).
 Note that this latter method results in a non-conservative force, and does
 not integrate to a standard form.
 But this latter formulation helps avoid the large forces due to the (1+
\begin_inset Formula $i)$
\end_inset

 term in the exact derivative calculation–and may avert instabilities in
 the molecular dynamics trajectory for some systems.
 See the discussion of time-averaged restraints following the input description.
 Note that the DISAVI, ANGAVI, and TORAVI instructions will have no affect
 unless the corresponding time average request card (DISAVE, ANGAVE or TORAVE,
 respectively) is also present.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
DUMPFREQ Istep1 is the only parameter read, and it sets the frequency at
 which the coordinates in the distance or angle restraints are dumped to
 the file specified by the DUMPAVE command in the I/O redirection section.
 (For these cards, ISTEP1 and IMULT are ignored).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
END END of this section.
\end_layout

\begin_layout Standard

\shape italic
NOTES:
\end_layout

\begin_layout Enumerate
All weights are relative to a default of 1.0 in the standard force field.
\end_layout

\begin_layout Enumerate
Weights are not cumulative.
\end_layout

\begin_layout Enumerate
For any range where the weight of a term is not modified by the above, the
 weight reverts to 1.0.
 For any range where TEMP0, SOFTR or CUTOFF is not specified, the value
 of the relevant constant is set to that specified in the input file.
\end_layout

\begin_layout Enumerate
If a weight is set to 0.0, it is set internally to 1.0D-7.
 This can be overridden by setting the weight to a negative number.
 In this case, a weight of exactly 0.0 will be used.
 
\shape italic
However,
\shape default
 if any weight is set to exactly 0.0, it cannot be changed again during this
 run of the program.
\end_layout

\begin_layout Enumerate
If two (or more) cards change a particular weight over the same range, the
 weight given on the last applicable card will be the one used.
\end_layout

\begin_layout Enumerate
Once any weight change for which NSTEP2=0 becomes active (i.e.
 one which will be effective for the remainder of the run), the weight of
 this term cannot be further modified by other instructions.
\end_layout

\begin_layout Enumerate
Changes to RSTAR result in exponential weighting changes to the attractive
 and repulsive terms (proportional to the scale factor**6 and **12, respectively
).
 For this reason, scaling RSTAR to a very small value (e.g.
 
\begin_inset Formula $\le$
\end_inset

0.1) may result in a zeroing-out of the vdw term.
\end_layout

\begin_layout Section

\series bold
\begin_inset CommandInset label
LatexCommand label
name "sec:File-redirection-commands"

\end_inset

File redirection commands
\end_layout

\begin_layout Standard
Input/output redirection information can be read as described here.
 Redirection cards must follow the end of the weight change information.
 Redirection card input is terminated by the first non-blank line which
 does not start with a recognized redirection TYPE (e.g.
 LISTIN, LISTOUT, etc.).
\end_layout

\begin_layout Standard
The format of the redirection cards is
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_layout Standard
\align center
TYPE = filename 
\end_layout

\begin_layout Standard
where TYPE is any valid redirection keyword (see below), and filename is
 any character string.
 The equals sign ("=") is required, and TYPE must be given in 
\shape italic
uppercase
\shape default
 letters.
\end_layout

\begin_layout Standard
Valid redirection keywords are: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
LISTIN An output listing of the restraints which have been read, and their
 deviations from the target distances 
\shape italic
before
\shape default
 the simulation has been run.
 By default, this listing is not printed.
 cedureIf POUT is used for the filename, these deviations will be printed
 in the normal output file.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
LISTOUT An output listing of the restraints which have been read, and their
 deviations from the target distances 
\shape italic
_after
\shape default
 the simulation has finished.
 By default, this listing is not printed.
 If POUT is used for the filename, these deviations will be printed in the
 normal output file.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
DISANG The file from which the distance and angle restraint information
 described below (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:disang"

\end_inset

) will be read.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
NOESY File from which NOESY volume information (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:noesy"

\end_inset

) will be read.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
SHIFTS File from which chemical shift information (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:shift"

\end_inset

) will be read.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
PCSHIFT File from which paramagnetic shift information (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:shift"

\end_inset

) will be read.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
DIPOLE File from which residual dipolar couplings (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:rdc"

\end_inset

) will be read.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
CSA File from which CSA or pseduo-CSA restraints (Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:csa"

\end_inset

) will be read.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
DUMPAVE File to which the time-averaged values of all restraints will be
 written.
 If DISAVI / ANGAVI / TORAVI has been used to set IDMPAV
\begin_inset Formula $\ne$
\end_inset

0, then averaged values will be output.
 If the DUMPFREQ command has been used, the instantaneous values will be
 output.
\end_layout

\begin_layout Section

\series bold
Getting debugging information
\end_layout

\begin_layout Standard
The debug options in 
\shape italic
sander
\shape default
 are there principally to help developers test new options or to test results
 between two machines or versions of code, but can also be useful to users
 who want to test the effect of parameters on the accuracy of their ewald
 or pme calculations.
 If the debug options are set, 
\shape italic
sander
\shape default
 will exit after performing the debug tasks set by the user.
\end_layout

\begin_layout Standard
To access the debug options, include a &debugf namelist.
 Input parameters are: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
do_debugf
\begin_inset Index idx
status open

\begin_layout Plain Layout
do
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

debugf
\end_layout

\end_inset

 Flag to perform this module.
 Possible values are zero or one.
 Default is zero.
 Set to one to turn on debug options.
\end_layout

\begin_layout Standard
One set of options is to test that the atomic forces agree with numerical
 differentiation of energy.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
atomn
\begin_inset Index idx
status open

\begin_layout Plain Layout
atomn
\end_layout

\end_inset

 Array of atom numbers to test atomic forces on.
 Up to 25 atom numbers can be specified, separated by commas.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nranatm
\begin_inset Index idx
status open

\begin_layout Plain Layout
nranatm
\end_layout

\end_inset

 number of random atoms to test atomic forces on.
 Atom numbers are generated via a random number generator.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ranseed
\begin_inset Index idx
status open

\begin_layout Plain Layout
ranseed
\end_layout

\end_inset

 seed of random number generator used in generating atom numbers default
 is 71277 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
neglgdel
\begin_inset Index idx
status open

\begin_layout Plain Layout
neglgdel
\end_layout

\end_inset

 negative log of delta used in numerical differentiating; e.g.
 4 means delta is 10
\begin_inset Formula $^{-4}$
\end_inset

 Angstroms.
 Default is 5.
 
\shape italic
Note
\shape default
: In general it does no good to set nelgdel larger than about 6.
 This is because the relative force error is at best the square root of
 the numerical error in the energy, which ranges from 10
\begin_inset Formula $^{-15}$
\end_inset

 up to 10
\begin_inset Formula $^{-12}$
\end_inset

 for energies involving a large number of terms.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
chkvir
\begin_inset Index idx
status open

\begin_layout Plain Layout
chkvir
\end_layout

\end_inset

 Flag to test the atomic and molecular virials numerically.
 Default is zero.
 Set to one to test virials.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dumpfrc
\begin_inset Index idx
status open

\begin_layout Plain Layout
dumpfrc
\end_layout

\end_inset

 Flag to dump energies, forces and virials, as well as components of forces
 (bond, angle forces etc.) to the file "forcedump.dat" This produces an ascii
 file.
 Default is zero.
 Set to one to dump forces.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
rmsfrc
\begin_inset Index idx
status open

\begin_layout Plain Layout
rmsfrc
\end_layout

\end_inset

 Flag to compare energies forces and virials as well as components of forces
 (bond, angle forces etc.) to those in the file "forcedump.dat".
 Default is zero.
 Set to one to compare forces.
\end_layout

\begin_layout Standard
Several other options are also possible to modify the calculated forces.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
zerochg
\begin_inset Index idx
status open

\begin_layout Plain Layout
zerochg
\end_layout

\end_inset

 Flag to zero all charges before calculating forces.
 Default zero.
 Set to one to remove charges.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
zerovdw
\begin_inset Index idx
status open

\begin_layout Plain Layout
zerovdw
\end_layout

\end_inset

 Flag to remove all van der Waals interactions before calculating forces.
 Default zero.
 Set to one to remove van der Waals.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
zerodip
\begin_inset Index idx
status open

\begin_layout Plain Layout
zerodip
\end_layout

\end_inset

 Flag to remove all atomic dipoles before calculating forces.
 Only relevant when polarizability is invoked.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
do_dir,
\begin_inset space ~
\end_inset

do_rec,
\begin_inset space ~
\end_inset

do_adj,
\begin_inset space ~
\end_inset

do_self,
\begin_inset space ~
\end_inset

do_bond,
\begin_inset space ~
\end_inset

do_cbond,
\begin_inset space ~
\end_inset

do_angle,
\begin_inset space ~
\end_inset

do_ephi,
\begin_inset space ~
\end_inset

do_xconst,
\begin_inset space ~
\end_inset

do_cap These are flags which turn on or off the subroutines they refer to.
 The defaults are one.
 Set to zero to prevent a subroutine from running.
 For example, set do_dir=0 to turn off the direct sum interactions (van
 der Waals as well as electrostatic).
 These options, as well as the zerochg, zerovdw, zerodip flags, can be used
 to fine tune a test of forces, accuracy, etc.
\end_layout

\begin_layout Standard
EXAMPLES:
\end_layout

\begin_layout Standard
This input list tests the reciprocal sum forces on atom 14 numerically,
 using a delta of 10
\begin_inset Formula $^{-4}$
\end_inset

.
\end_layout

\begin_layout LyX-Code
&debugf
\end_layout

\begin_layout LyX-Code
neglgdel=4, nranatm = 0, atomn = 14,
\end_layout

\begin_layout LyX-Code
do_debugf = 1,do_dir = 0,do_adj = 0,do_rec = 1, do_self = 0,
\end_layout

\begin_layout LyX-Code
do_bond = 1,do_angle = 0,do_ephi = 0, zerovdw = 0, zerochg = 0,
\end_layout

\begin_layout LyX-Code
chkvir = 0,
\end_layout

\begin_layout LyX-Code
dumpfrc = 0,
\end_layout

\begin_layout LyX-Code
rmsfrc = 0,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Standard
This input list causes a dump of force components to "forcedump.dat".
 The bond, angle and dihedral forces are not calculated, and van der Waals
 interactions are removed, so the total force is the Ewald electrostatic
 force, and the only nonzero force components calculated are electrostatic.
\end_layout

\begin_layout LyX-Code
&debugf
\end_layout

\begin_layout LyX-Code
neglgdel=4, nranatm = 0, atomn = 0,
\end_layout

\begin_layout LyX-Code
do_debugf = 1,do_dir = 1,do_adj = 1,do_rec = 1, do_self = 1,
\end_layout

\begin_layout LyX-Code
do_bond = 0,do_angle = 0,do_ephi = 0, zerovdw = 1, zerochg = 0,
\end_layout

\begin_layout LyX-Code
chkvir = 0,
\end_layout

\begin_layout LyX-Code
dumpfrc = 1,
\end_layout

\begin_layout LyX-Code
rmsfrc = 0,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Standard
In this case the same force components as above are calculated, and compared
 to those in "forcedump.dat".
 Typically this is used to get an RMS force error for the Ewald method in
 use.
 To do this, when doing the force dump use ewald or pme parameters to get
 high accuracy, and then normal parameters for the force compare:
\end_layout

\begin_layout LyX-Code
&debugf
\end_layout

\begin_layout LyX-Code
neglgdel=4, nranatm = 0, atomn = 0,
\end_layout

\begin_layout LyX-Code
do_debugf = 1,do_dir = 1,do_adj = 1,do_rec = 1, do_self = 1,
\end_layout

\begin_layout LyX-Code
do_bond = 0,do_angle = 0,do_ephi = 0, zerovdw = 1, zerochg = 0,
\end_layout

\begin_layout LyX-Code
chkvir = 0,
\end_layout

\begin_layout LyX-Code
dumpfrc = 0,
\end_layout

\begin_layout LyX-Code
rmsfrc = 1,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Standard
For example, if you have a 40x40x40 unit cell and want to see the error
 for default pme options (cubic spline, 40x40x40 grid), run 2 jobs—— (assume
 box params on last line of inpcrd file)
\end_layout

\begin_layout Standard
Sample input for 1st job:
\end_layout

\begin_layout LyX-Code
&cntrl
\end_layout

\begin_layout LyX-Code
dielc =1.0,
\end_layout

\begin_layout LyX-Code
cut = 11.0, nsnb = 5, ibelly = 0,
\end_layout

\begin_layout LyX-Code
ntx = 5, irest = 1,
\end_layout

\begin_layout LyX-Code
ntf = 2, ntc = 2, tol = 0.0000005,
\end_layout

\begin_layout LyX-Code
ntb = 1, ntp = 0, temp0 = 300.0, tautp = 1.0,
\end_layout

\begin_layout LyX-Code
nstlim = 1, dt = 0.002, maxcyc = 5, imin = 0, ntmin = 2,
\end_layout

\begin_layout LyX-Code
ntpr = 1, ntwx = 0, ntt = 0, ntr = 0,
\end_layout

\begin_layout LyX-Code
jfastw = 0, nmrmax=0, ntave = 25,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout LyX-Code
&debugf
\end_layout

\begin_layout LyX-Code
do_debugf = 1,do_dir = 1,do_adj = 1,do_rec = 1, do_self = 1,
\end_layout

\begin_layout LyX-Code
do_bond = 0,do_angle = 0,do_ephi = 0, zerovdw = 1, zerochg = 0,
\end_layout

\begin_layout LyX-Code
chkvir = 0,
\end_layout

\begin_layout LyX-Code
dumpfrc = 1,
\end_layout

\begin_layout LyX-Code
rmsfrc = 0,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout LyX-Code
&ewald
\end_layout

\begin_layout LyX-Code
nfft1=60,nfft2=60,nfft3=60,order=6, ew_coeff=0.35,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Standard
Sample input for 2nd job:
\end_layout

\begin_layout LyX-Code
&cntrl
\end_layout

\begin_layout LyX-Code
dielc =1.0,
\end_layout

\begin_layout LyX-Code
cut = 8.0, nsnb = 5, ibelly = 0,
\end_layout

\begin_layout LyX-Code
ntx = 5, irest = 1,
\end_layout

\begin_layout LyX-Code
ntf = 2, ntc = 2, tol = 0.0000005,
\end_layout

\begin_layout LyX-Code
ntb = 1, ntp = 0, temp0 = 300.0, tautp = 1.0,
\end_layout

\begin_layout LyX-Code
nstlim = 1, dt = 0.002, maxcyc = 5, imin = 0, ntmin = 2,
\end_layout

\begin_layout LyX-Code
ntpr = 1, ntwx = 0, ntt = 0, ntr = 0,
\end_layout

\begin_layout LyX-Code
jfastw = 0, nmrmax=0, ntave = 25,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout LyX-Code
&debugf
\end_layout

\begin_layout LyX-Code
do_debugf = 1,do_dir = 1,do_adj = 1,do_rec = 1, do_self = 1,
\end_layout

\begin_layout LyX-Code
do_bond = 0,do_angle = 0,do_ephi = 0, zerovdw = 1, zerochg = 0,
\end_layout

\begin_layout LyX-Code
chkvir = 0,
\end_layout

\begin_layout LyX-Code
dumpfrc = 0,
\end_layout

\begin_layout LyX-Code
rmsfrc = 1,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout LyX-Code
&ewald
\end_layout

\begin_layout LyX-Code
ew_coeff=0.35,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Standard
Note that an Ewald coefficient of 0.35 is close to the default error for
 an 8 Angstrom cutoff.
 However, the first job used an 11 Angstrom cutoff.
 The direct sum forces calculated in the 2nd job are compared to these,
 giving the RMS error due to an 8 Angstrom cutoff, with this value of ew_coeff.
 The reciprocal sum error calculated in the 2nd job is with respect to the
 pme reciprocal forces in the 1st job considered as "exact".
\end_layout

\begin_layout Standard
Note further that if in these two jobs you had not specified "ew_coeff"
 
\shape italic
sander
\shape default
 would have calculated ew_coeff according to the cutoff and the direct sum
 tolerance, defaulted to 10
\begin_inset Formula $^{-5}$
\end_inset

.
 This would give two different ewald coefficients.
 Under these circumstances the direct, reciprocal and adjust energies and
 forces would not agree well between the two jobs.
 However the total energy and forces should agree reaso
\family typewriter
nrespa
\family default
nably, (forces to within about 5x10
\begin_inset Formula $^{-4}$
\end_inset

 relative RMS force error) Since the totals are invariant to the coefficient.
\end_layout

\begin_layout Standard
Finally, note that if other force components are calculated, such as van
 der Waals, bond, angle, etc., then the total force will include these, and
 the relative RMS force errors will be with respect to this total force
 in the denominator.
\end_layout

\begin_layout Section
multisander
\begin_inset CommandInset label
LatexCommand label
name "sec:multisander"

\end_inset


\begin_inset Index idx
status open

\begin_layout Plain Layout
multisander
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The 
\emph on
multisander
\emph default
 functionality is available in the parallel versions of the programs (i.e.,
 
\emph on
sander.MPI
\emph default
).
 This mode allows multiple independent simulations, or replicas, to be run
 in the same program instance.
 It is particularly useful for computer clusters in which priority is given
 to large CPU-count jobs.
 In this case, the command-line usage of sander and pmemd is slightly altered,
 as shown below:
\end_layout

\begin_layout LyX-Code
mpirun -np <#proc> sander.MPI -ng <#groups> -groupfile groupfile
\end_layout

\begin_layout Standard
In this case, 
\family typewriter
#proc
\family default
 processors will be evenly divided among 
\family typewriter
#groups
\family default
 individual simulations (
\family typewriter
#proc
\family default
 must be a multiple of 
\family typewriter
#group
\family default
!).
 The groupfile consists of a number of lines which is the command-line for
 each of the 
\family typewriter
#groups
\family default
 simulations you wish to run.
 Comment lines (i.e., those with # in the first column) are ignored, after
 which the first 
\family typewriter
#groups
\family default
 lines are read as the command-line flags of the 
\begin_inset Formula $N^{th}$
\end_inset

 simulation.
\end_layout

\begin_layout Standard
The multisander and multipmemd mechanisms are also utilized for methods
 requiring multiple simulations to communicate with one another, such as
 thermodynamic integration in sander and replica exchange molecular dynamics
 (both described later).
 An example groupfile and program call are shown below.
\end_layout

\begin_layout Standard
Groupfile:
\end_layout

\begin_layout LyX-Code
# Comment lines must start with a pound sign
\end_layout

\begin_layout LyX-Code
# and there can be as many comment lines as you
\end_layout

\begin_layout LyX-Code
# want, wherever you want them.
\end_layout

\begin_layout LyX-Code
-O -p prmtop1 -c inpcrd1 -i replica1.mdin -suffix replica1
\end_layout

\begin_layout LyX-Code
-O -p prmtop2 -c inpcrd2 -i replica2.mdin -suffix replica2
\end_layout

\begin_layout LyX-Code
-O -p prmtop3 -c inpcrd3 -i replica3.mdin -suffix replica3
\end_layout

\begin_layout LyX-Code
-O -p prmtop4 -c inpcrd4 -i replica4.mdin -suffix replica4
\end_layout

\begin_layout Standard
The 
\family typewriter
-suffix
\family default
 flag behaves slightly differently than it does for classical use.
 In standard simulations (
\emph on
i.e.
\emph default
, without 
\emph on
multisander
\emph default
 or 
\emph on
multipmemd
\emph default
), the provided suffix will be applied only to output files that are printed
 but were not given names on the command-line.
 With multisander, however, each thread has to produce different output
 files so that different replicas do not try to write to the same file.
 As a result, a default suffix of 000, 001, 002, etc.
 is given to the replicas and is added to every unspecified output file.
 If a 
\family typewriter
-suffix
\family default
 is specified in the groupfile, as shown above, every output file—including
 those given an explicit name for that replica—are given the additional
 suffix.
 
\end_layout

\begin_layout Standard
The four simulations shown in the groupfile above can be run on 8 processors
 each with the following command (note, running 
\emph on
sander.MPI
\emph default
 may differ on your system).
\end_layout

\begin_layout LyX-Code
mpirun -np 32 sander.MPI -ng 4 -groupfile groupfile
\end_layout

\begin_layout Standard
The 
\emph on
multisander
\emph default
 and 
\emph on
multipmemd
\emph default
 concepts are implemented via the use of MPI communicators.
 Each replica is assigned a replica-wide communicator along which all communicat
ions required for standard MD simulations are performed (called 
\family typewriter
commsander
\family default
 and 
\family typewriter
pmemd_comm
\family default
 in 
\emph on
sander
\emph default
 and 
\emph on
pmemd
\emph default
, respectively).
 Each replica communicator has a master thread (rank 0 in that communicator),
 and the master thread of each replica are joined in another MPI communicator
 of replica masters (called 
\family typewriter
commmaster
\family default
 and 
\family typewriter
pmemd_master_comm
\family default
 in 
\emph on
sander
\emph default
 and 
\emph on
pmemd
\emph default
, respectively).
 All inter-replica communication is performed via 
\family typewriter
commmaster
\family default
 or 
\family typewriter
pmemd_master_comm
\family default
.
\end_layout

\begin_layout Standard
By default, all 
\begin_inset Formula $N$
\end_inset

 threads are allocated to each of the 
\begin_inset Formula $M$
\end_inset

 groups by dividing the threads sequentially.
 That is, the first 
\begin_inset Formula $N/M$
\end_inset

 threads are assigned to replica 0, the second group of 
\begin_inset Formula $N/M$
\end_inset

 threads are assigned to replica 1, etc.
 The 
\family typewriter
-ng-nonsequential
\family default
 flag will stripe the thread assignments.
 Replica 0 will receive threads 0, 
\begin_inset Formula $N-1$
\end_inset

, 
\begin_inset Formula $2N-1$
\end_inset

, etc., while replica 1 receives threads 1, 
\begin_inset Formula $N$
\end_inset

, 
\begin_inset Formula $2N$
\end_inset

, etc.
\end_layout

\begin_layout Chapter

\series bold
\begin_inset CommandInset label
LatexCommand label
name "sec:genborn"

\end_inset

The Generalized Born/Surface Area Model
\end_layout

\begin_layout Standard
Implicit solvent methods can speed up atomistic simulations by approximating
 the discrete solvent as a continuum, thus drastically reducing the number
 of particles in the system.
 An additional effective speedup often comes from much faster sampling of
 the conformational space afforded by these methods.
\begin_inset CommandInset citation
LatexCommand citep
key "David2000,Feig2007,Amaro2009,Zagrovic2003,Anandakrishnan2015"
literal "true"

\end_inset

 The generalized Born (GB) solvation model is the most commonly used implicit
 solvent model for atomistic MD simulation; it has been most widely tested
 on ff99SB and ff14SBonlysc, but in principle could be used with other non-polar
izable force fields, such as ff03.
 A recent (2019) review gives a good overview.
\begin_inset CommandInset citation
LatexCommand citep
key "Onufriev19"
literal "true"

\end_inset

 To estimate the total solvation free energy of a molecule, 
\begin_inset Formula $\Delta G_{solv}$
\end_inset

, one typically assumes that it can be decomposed into the "electrostatic"
 and "non-electrostatic" parts:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\Delta G_{solv}=\Delta G_{el}+\Delta G_{nonel}
\end{equation}

\end_inset

where 
\begin_inset Formula $\Delta G_{nonel}$
\end_inset

 is the free energy of solvating a molecule from which all charges have
 been removed (i.e.
 partial charges of every atom are set to zero), and 
\begin_inset Formula $\Delta G_{el}$
\end_inset

 is the free energy of first removing all charges in the vacuum, and then
 adding them back in the presence of a continuum solvent environment.
 Generally speaking, 
\begin_inset Formula $\Delta G_{nonel}$
\end_inset

 comes from the combined effect of two types of interaction: the favorable
 van der Waals attraction between the solute and solvent molecules, and
 the unfavorable cost of breaking the structure of the solvent (water) around
 the solute.
 In the current Amber codes, this is taken to be proportional to the total
 solvent accessible surface area (SA) of the molecule, with a proportionality
 constant derived from experimental solvation energies of small non-polar
 molecules, and uses a fast LCPO algorithm 
\begin_inset CommandInset citation
LatexCommand cite
key "Weiser99"
literal "true"

\end_inset

 to compute an analytical approximation to the solvent accessible area of
 the molecule.
\end_layout

\begin_layout Standard
The Poisson-Boltzmann approach described in the next section has traditionally
 been used in calculating 
\begin_inset Formula $\Delta G_{el}$
\end_inset

.
 However, in molecular dynamics applications, the associated computational
 costs are often very high, as the Poisson-Boltzmann equation needs to be
 solved every time the conformation of the molecule changes.
 Amber developers have pursued an alternative approach, the analytic generalized
 Born (GB) method, to obtain a reasonable, computationally efficient estimate
 to be used in molecular dynamics simulations.
 The methodology has become popular,
\begin_inset CommandInset citation
LatexCommand cite
key "Still90,Schaefer96,Edinger97,Jayaram98,Cramer99,Bashford00,Onufriev00,Lee02"
literal "true"

\end_inset

 especially in molecular dynamics applications,
\begin_inset CommandInset citation
LatexCommand cite
key "Dominy99,Tsui00,Calimet01,Onufriev04"
literal "true"

\end_inset

 due to its relative simplicity and computational efficiency, compared to
 the more standard numerical solution of the Poisson-Boltzmann equation.
 Within Amber GB models, each atom in a molecule is represented as a sphere
 of radius 
\begin_inset Formula $R_{i}$
\end_inset

 with a charge 
\begin_inset Formula $q_{i}$
\end_inset

 at its center; the interior of the atom is assumed to be filled uniformly
 with a material of dielectric constant 1.
 The molecule is surrounded by a solvent of a high dielectric 
\begin_inset Formula $\varepsilon$
\end_inset

 (80 for water at 300 K).
 The GB model approximates 
\begin_inset Formula $\Delta G_{el}$
\end_inset

 by an analytical formula,
\begin_inset CommandInset citation
LatexCommand cite
key "Still90,Srinivasan99"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\Delta G_{el}\approx-\frac{1}{2}\sum_{ij}\frac{q_{i}q_{j}}{f_{GB}(r_{ij},R_{i},R_{j})}\left(1-\frac{\exp[-\kappa f_{GB}]}{\varepsilon}\right)\label{eq:gb1}
\end{equation}

\end_inset

where 
\begin_inset Formula $r_{ij}$
\end_inset

 is the distance between atoms 
\begin_inset Formula $i$
\end_inset

 and 
\begin_inset Formula $j$
\end_inset

, the 
\begin_inset Formula $R_{i}$
\end_inset

 are the so-called 
\shape italic
effective Born radii,
\shape default
 and 
\begin_inset Formula $f_{GB}()$
\end_inset

 is a certain smooth function of its arguments.
 The electrostatic screening effects of (monovalent) salt are incorporated
 
\begin_inset CommandInset citation
LatexCommand cite
key "Srinivasan99"
literal "true"

\end_inset

 via the Debye-Huckel screening parameter 
\begin_inset Formula $\kappa$
\end_inset

.
\end_layout

\begin_layout Standard
A common choice 
\begin_inset CommandInset citation
LatexCommand cite
key "Still90"
literal "true"

\end_inset

 of 
\begin_inset Formula $f_{GB}$
\end_inset

 is
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f_{GB}=\left[r_{ij}^{2}+R_{i}R_{j}\exp(-r_{ij}^{2}/4R_{i}R_{j})\right]^{1/2}\label{eq:fgb}
\end{equation}

\end_inset

although other expressions have been tried.
\begin_inset CommandInset citation
LatexCommand cite
key "Jayaram98,Onufriev02"
literal "true"

\end_inset

 The effective Born radius of an atom reflects the degree of its burial
 inside the molecule: for an isolated ion, it is equal to its van der Waals
 (VDW) radius 
\begin_inset Formula $\rho_{i}$
\end_inset

.
 Then one obtains the particularly simple form:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\Delta G_{el}=-\frac{q_{i}^{2}}{2\rho_{i}}\left(1-\frac{1}{\varepsilon}\right)\label{eq:Born}
\end{equation}

\end_inset

where we assumed 
\begin_inset Formula $\kappa=0$
\end_inset

 (pure water).
 This is the famous expression due to Born for the solvation energy of a
 single ion.
 The function 
\begin_inset Formula $f_{GB}()$
\end_inset

 is designed to interpolate, in a clever manner, between the limit 
\begin_inset Formula $r_{ij}\rightarrow0$
\end_inset

, when atomic spheres merge into one, and the opposite extreme 
\begin_inset Formula $r_{ij}\rightarrow\infty$
\end_inset

, when the ions can be treated as point charges obeying the Coulomb's law.
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev00"
literal "true"

\end_inset

 For deeply buried atoms, the effective radii are large, 
\begin_inset Formula $R_{i}\gg\rho_{i}$
\end_inset

, and for such atoms one can use a rough estimate 
\begin_inset Formula $R_{i}\approx L_{i}$
\end_inset

, where 
\begin_inset Formula $L_{i}$
\end_inset

 is the distance from the atom to the molecular surface.
 Closer to the surface, the effective radii become smaller, and for a completely
 solvent exposed side-chain one can expect 
\begin_inset Formula $R_{i}$
\end_inset

 to approach 
\begin_inset Formula $\rho_{i}$
\end_inset

.
\end_layout

\begin_layout Standard
The effective radii depend on the molecule's conformation, and so have to
 be re-computed every time the conformation changes.
 This makes the computational efficiency a critical issue, and various approxima
tions are normally made that facilitate an effective estimate of 
\begin_inset Formula $R_{i}$
\end_inset

.
 With the exception of GBNSR6 (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:gbnsr6"

\end_inset

), the so-called 
\shape italic
Coulomb field approximation
\shape default
, or 
\shape italic
CFA
\shape default
, is used for Amber GB models, which replaces the true electric displacement
 around the atom by the Coulomb field.
 Within this assumption, the following expression can be derived:
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev00"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
R_{i}^{-1}=\rho_{i}^{-1}-\frac{1}{4\pi}\int\theta(|\mathbf{r}|-\rho_{i})r^{-4}d^{3}\mathbf{r}\label{eq:cfa}
\end{equation}

\end_inset

where the integral is over the solute volume surrounding atom 
\begin_inset Formula $i$
\end_inset

.
 For a realistic molecule, the solute boundary (molecular surface) is anything
 but trivial, and so further approximations are made to obtain a closed-form
 analytical expression for the above equation, 
\begin_inset Formula $e.g.$
\end_inset

 the so-called pairwise de-screening approach of Hawkins, Cramer and Truhlar,
\begin_inset CommandInset citation
LatexCommand cite
key "Hawkins96"
literal "true"

\end_inset

 which leads to a GB model implemented in Amber with 
\shape italic
igb=1
\shape default
.
 The 3D integral used in the estimation of the effective radii is performed
 over the van der Waals (VDW) spheres of solute atoms, which implies a definitio
n of the solute volume in terms of a set of spheres, rather than the complex
 molecular surface,
\begin_inset CommandInset citation
LatexCommand cite
key "Richards77"
literal "true"

\end_inset

 commonly used in the PB calculations.
 For macromolecules, this approach tends to underestimate the effective
 radii for buried atoms,
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev00"
literal "true"

\end_inset

 arguably because the standard integration procedure treats the small vacuum–fil
led crevices between the van der Waals (VDW) spheres of protein atoms as
 being filled with water, even for structures with large interior.
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev02"
literal "true"

\end_inset

 This error is expected to be greatest for deeply buried atoms characterized
 by large effective radii, while for the surface atoms it is largely canceled
 by the opposing error arising from the Coulomb approximation, which tends
 
\begin_inset CommandInset citation
LatexCommand cite
key "Schaefer96,Bashford00,Schaefer90"
literal "true"

\end_inset

 to overestimate 
\begin_inset Formula $R_{i}$
\end_inset

.
\end_layout

\begin_layout Standard
The deficiency of the model described above can, to some extent, be corrected
 by noticing that even the optimal packing of hard spheres, which is a reasonabl
e assumption for biomolecules, still occupies only about three quarters
 of the space, and so "scaling-up" of the integral by a factor of four thirds
 should effectively increase the underestimated radii by about the right
 amount, without any loss of computational efficiency.
 This idea was developed and applied in the context of pH titration,
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev00"
literal "true"

\end_inset

 where it was shown to improve the performance of the GB approximation in
 calculating pKa values of protein sidechains.
 However, the one-parameter correction introduced in Ref.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev00"
literal "true"

\end_inset

 was not optimal in keeping the model's established performance on small
 molecules.
 It was therefore proposed 
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev04"
literal "true"

\end_inset

 to re-scale the effective radii with the re-scaling parameters being proportion
al to the degree of the atom's burial, as quantified by the value 
\begin_inset Formula $I_{i}$
\end_inset

 of the 3D integral.
 The latter is large for the deeply buried atoms and small for exposed ones.
 Consequently, one seeks a well-behaved re-scaling function, such that 
\begin_inset Formula $R_{i}\approx(\rho_{i}^{-1}-I_{i})^{-1}$
\end_inset

 for small 
\begin_inset Formula $I_{i}$
\end_inset

, and 
\begin_inset Formula $R_{i}>(\rho_{i}^{-1}-I_{i})^{-1}$
\end_inset

 when 
\begin_inset Formula $I_{i}$
\end_inset

 becomes large.
 The following simple, infinitely differentiable re-scaling function was
 chosen to replace the model's original expression for the effective radii:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
R_{i}^{-1}=\tilde{\rho}_{i}^{-1}-\rho_{i}^{-1}\tanh(\alpha\Psi-\beta\Psi^{2}+\gamma\Psi^{3})
\end{equation}

\end_inset

 where 
\begin_inset Formula $\Psi=I_{i}\tilde{\rho}_{i}$
\end_inset

, and 
\begin_inset Formula $\alpha$
\end_inset

, 
\begin_inset Formula $\beta$
\end_inset

, 
\begin_inset Formula $\gamma$
\end_inset

 are treated as adjustable dimensionless parameters which were optimized
 using the guidelines mentioned earlier (primarily agreement with the PB).
 Currently, Amber supports two GB models ( termed OBC ) based on this idea.
 These differ by the values of 
\begin_inset Formula $\alpha$
\end_inset

, 
\begin_inset Formula $\beta$
\end_inset

, 
\begin_inset Formula $\gamma$
\end_inset

, and are invoked by setting igb to either igb=2 or igb=5.
 The details of the optimization procedure and the performance of the OBC
 model relative to the PB treatment and in MD simulations on proteins is
 described in Ref.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev04"
literal "true"

\end_inset

; an independent comparison to the PB in calculating the electrostatic part
 of solvation free energy on a large data set of proteins can be found in
 Ref.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Feig04"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
Our experience with generalized Born simulations is mainly with
\shape italic
 
\shape default
\emph on
ff99SB, ff14SBonlysc
\emph default
 or 
\shape italic
ff03
\shape default
; the current GB models are not compatible with polarizable force fields.
 Replacing explicit water with a GB model is equivalent to specifying a
 different force field, and users should be aware that none of the GB options
 (in Amber or elsewhere) is as mature as simulations with explicit solvent;
 user discretion is advised.
 For example, it was shown that salt bridges are too strong in some of these
 models 
\begin_inset CommandInset citation
LatexCommand cite
key "Geney06,Okur08"
literal "true"

\end_inset

 and some of them provide secondary structure distributions that differ
 significantly from those obtained using the same protein parameters in
 explicit solvent, with GB having too much 
\begin_inset Formula $\alpha$
\end_inset

-helix present.
\begin_inset CommandInset citation
LatexCommand cite
key "Okur06,Roe07"
literal "true"

\end_inset

 The combination of the 
\emph on
ff14SBonlysc
\emph default
 force field with igb=8 gives the best results for proteins 
\begin_inset CommandInset citation
LatexCommand citep
key "Nguyen2013"
literal "true"

\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Nguyen2014"
literal "true"

\end_inset

, nucleic acids and protein-nucleic acid complexes.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Nguyen15b"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
Despite these limitations, implicit treatment of solvent is widely used
 in molecular simulations for two main reasons: algorithmic/computational
 speed and conformational sampling.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Anandakrishnan2015,Onufriev2010"
literal "true"

\end_inset

 Implicit solvent methods can be algorithmically/computationally faster,
 as measured by simulation time steps per processor (CPU) time, because
 the vast number of individual interactions between the atoms of individual
 solvent molecules do not need to be explicitly computed.
 Implicit-solvent simulations can also sample conformational space faster
 in the low viscosity regime afforded by the implicit solvent model.
\begin_inset CommandInset citation
LatexCommand citep
key "David2000,Feig2007,Amaro2009,Zagrovic2003,Anandakrishnan2015"
literal "true"

\end_inset

 To some extent, the interest in implicit-solvent-based simulations is motivated
 by the need to sample very large conformational spaces for problems such
 as protein folding, binding-affinity calculations, or large-scale fluctuations
 of nucleosomal DNA fragments.
 The speedup of conformational change can vary considerably, depending on
 the details of the transition, and can range from no speedup at all to
 almost a 100-fold speedup.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Anandakrishnan2015"
literal "true"

\end_inset

 In general, the larger the conformational change, the higher the speedup
 one may expect, but this tendency is not universal or uniform.
 These speedup values are also expected to vary by the specific flavour
 of GB model used, a detailed analysis for igb5 can be found in Ref.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Anandakrishnan2015"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
The generalized Born models used here are based on the "pairwise" model
 introduced by Hawkins, Cramer and Truhlar,
\begin_inset CommandInset citation
LatexCommand cite
key "Hawkins95,Hawkins96"
literal "true"

\end_inset

 which in turn is based on earlier ideas by Still and others.
\begin_inset CommandInset citation
LatexCommand cite
key "Still90,Bashford00,Schaefer90,Schaefer98"
literal "true"

\end_inset

 The so-called overlap parameters for most models are taken from the Tinker
 molecular modeling package (http://tinker.wustl.edu).
 The effects of added monovalent salt are included at a level that approximates
 the solutions of the linearized Poisson-Boltzmann equation.
\begin_inset CommandInset citation
LatexCommand cite
key "Srinivasan99"
literal "true"

\end_inset

 The original implementation was by David Case, who thanks Charlie Brooks
 for inspiration.
 Details of our implementation of generalized Born models can be found in
 Refs.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Tsui01,Sosa01"
literal "true"

\end_inset

.
\end_layout

\begin_layout Section

\series bold
GB/SA input parameters
\end_layout

\begin_layout Standard
As outlined above, there are several "flavors" of GB available, depending
 upon the value of 
\shape italic
igb
\shape default
.
 The version that has been most extensively tested corresponds to 
\shape italic
igb
\shape default
=1; the "OBC" models (
\shape italic
igb
\shape default
=2 and 5) are newer, but appear to give significant improvements and are
 recommended for most projects (certainly for peptides or proteins).
 The newest, most advanced, and least extensively tested model, 
\shape italic
GBn
\shape default
 (
\shape italic
igb
\shape default
=7), yields results in considerably better agreement with molecular surface
 Poisson-Boltzmann and explicit solvent results than the "OBC" models under
 many circumstances.
\begin_inset CommandInset citation
LatexCommand cite
key "Roe07"
literal "true"

\end_inset

 The 
\shape italic
GBn
\shape default
 model was parameterized for peptide and protein systems and is not recommended
 for use with nucleic acids.
 A modification on the GBn model (igb=8) further improves agreement between
 Poisson-Boltzmann and explicit solvent data compared to the original formulatio
n (igb=7).
\begin_inset CommandInset citation
LatexCommand citep
key "Nguyen2013"
literal "true"

\end_inset

 Users should understand that all (current) GB models have limitations and
 should proceed with caution.
 Generalized Born simulations can only be run for non-periodic systems,
 
\begin_inset Formula $i.e.$
\end_inset

 where 
\shape italic
ntb
\shape default
=0.
 Unlike its use in explicit solvent PME simulations, short nonbonded cutoff
 values have much stronger impact on accuracy of the GB calculations.
 Essentially, any cutoff values other than 
\shape italic
cut > structure size
\shape default
 can lead to artifacts.
 Current GPU implementation of the GB can not use cutoffs.
 An alternative that retains most of the speed of the GB with a cutoff,
 but without most of its artifacts, is GB-HCP described in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:hcp"

\end_inset

.
 If the nonbonded cutoff is used in GB calculations, it should be greater
 than that for PME calculations, perhaps cut=16.
 The slowly-varying forces generally do not have to be evaluated at every
 step for GB, either nrespa=2 or 4, although that option may lead to some
 artifacts as well.
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
mbondi
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
mbondi2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
mbondi2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
bondi
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\emph on
mbondi3
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:gbradii"

\end_inset

Recommended radii sets for various GB models.
 For values of igb given in the top row, the string in the second row should
 be entered in LEaP as 
\begin_inset Quotes eld
\end_inset

set default PBRadii xxx
\begin_inset Quotes erd
\end_inset

.
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "tbl:radii"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
igb
\begin_inset Index idx
status open

\begin_layout Plain Layout
igb
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sander_igb"

\end_inset


\series default
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 No generalized Born term is used.
 (Default) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 The Hawkins, Cramer, Truhlar
\begin_inset CommandInset citation
LatexCommand cite
key "Hawkins95,Hawkins96"
literal "true"

\end_inset

 pairwise generalized Born model is used, with parameters described by Tsui
 and Case.
\begin_inset CommandInset citation
LatexCommand cite
key "Tsui01"
literal "true"

\end_inset

 This model uses the default radii set up by LEaP.
 It is slightly different from the GB model that was included in Amber6.
 If you want to compare to Amber 6, or need to continue an ongoing simulation,
 you should use the command "set default PBradii amber6" in LEaP, and set
 
\shape italic
igb
\shape default
=1 in 
\shape italic
sander
\shape default
.
 For reference, the Amber6 values are those used by an earlier Tsui and
 Case paper.
\begin_inset CommandInset citation
LatexCommand cite
key "Tsui00"
literal "true"

\end_inset

 Note that most nucleic acid simulations have used this model, so you take
 care when using other values.
 Also note that Tsui and Case used an offset (see below) of 0.13 
\begin_inset Formula $\textrm{Å}$
\end_inset

, which is different from its default value.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Use a modified GB model developed by A.
 Onufriev, D.
 Bashford and D.A.
 Case; the main idea was published earlier,
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev00"
literal "true"

\end_inset

 but the actual implementation here
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev04"
literal "true"

\end_inset

 is an elaboration of this initial idea.
 Within this model, the effective Born radii are re-scaled to account for
 the interstitial spaces between atom spheres missed by the 
\begin_inset Formula $GB^{HCT}$
\end_inset

 approximation.
 In that sense, 
\begin_inset Formula $GB^{OBC}$
\end_inset

 is intended to be a closer approximation to true molecular volume, albeit
 in an average sense.
 With 
\shape italic
igb
\shape default
=2, the inverse of the effective Born radius is given
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
by:cedure
\end_layout

\begin_layout Standard
\begin_inset Formula $R_{i}^{-1}=\overline{\rho}_{i}^{-1}-\tanh\left(\alpha\Psi-\beta\Psi^{2}+\gamma\Psi^{3}\right)/\rho_{i}$
\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $\overline{\rho}_{i}=\rho_{i}-offset$
\end_inset

, and 
\begin_inset Formula $\Psi=I\rho_{i}$
\end_inset

, with 
\begin_inset Formula $I$
\end_inset

 given in our earlier paper.
 The parameters 
\begin_inset Formula $\alpha$
\end_inset

, 
\begin_inset Formula $\beta$
\end_inset

, and 
\begin_inset Formula $\gamma$
\end_inset

 were determined by empirical fits, and have the values 0.8, 0.0, and 2.909125.
 This corresponds to model I in Ref 
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev04"
literal "true"

\end_inset

.
 With this option, you should use the LEaP command "set default PBradii
 mbondi2" to prepare the 
\shape italic
prmtop
\shape default
 file.
 
\end_layout

\end_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

3
\begin_inset space ~
\end_inset

or
\begin_inset space ~
\end_inset

4 These values are unused; they were used in Amber 7 for parameter sets
 that are no longer supported.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 Same as 
\shape italic
igb=2
\shape default
, except that now 
\begin_inset Formula $\alpha,\beta,\gamma$
\end_inset

 are 1.0, 0.8, and 4.85.
 This corresponds to model II in Ref 
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev04"
literal "true"

\end_inset

.
 With this option, you should use the command "set default PBradii mbondi2"
 in setting up the 
\shape italic
prmtop
\shape default
 file, although "set default PBradii bondi" is also OK.
 When tested in MD simulations of several proteins,
\begin_inset CommandInset citation
LatexCommand cite
key "Onufriev04"
literal "true"

\end_inset

 both of the above parameterizations of the "OBC" model showed equal performance
, although further tests 
\begin_inset CommandInset citation
LatexCommand cite
key "Feig04"
literal "true"

\end_inset

 on an extensive set of protein structures revealed that the 
\shape italic
igb=5
\shape default
 variant agrees better with the Poisson-Boltzmann treatment in calculating
 the electrostatic part of the solvation free energy.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

6 With this option, there is no continuum solvent model used at all; this
 corresponds to a non-periodic, "vacuum", model where the non-bonded interaction
s are just Lennard-Jones and Coulomb interactions.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

7 The 
\shape italic
GBn
\shape default
 model described by Mongan, Simmerling, McCammon, Case and Onufriev
\begin_inset CommandInset citation
LatexCommand cite
key "Mongan07"
literal "true"

\end_inset

 is employed.
 This model uses a pairwise correction term to 
\begin_inset Formula $GB^{HCT}$
\end_inset

 to approximate a molecular surface dielectric boundary; that is to eliminate
 interstitial regions of high dielectric smaller than a solvent molecule.
 This correction affects all atoms and is geometry-specific, going beyond
 the geometry-free, "average" re-scaling approach of 
\begin_inset Formula $GB^{OBC}$
\end_inset

, which mostly affects buried atoms.
 With this method, you should use the bondi radii set.
 The overlap or screening parameters in the 
\shape italic
prmtop
\shape default
 file are ignored, and the model-specific 
\shape italic
GBn
\shape default
 optimized values are substituted.
 The model carries little additional computational overhead relative to
 the other GB models described above.
\begin_inset CommandInset citation
LatexCommand cite
key "Mongan07"
literal "true"

\end_inset

 This method is not recommended fcedureor systems involving nucleic acids.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

8 Same GB functional form as the GBn model (igb=7), but with different parameter
s.
 The offset, overlap screening parameters, and gbneckscale are changed.
 In addition, individual α , β , and γ parameters can be specified for each
 of the elements H, C, N, O, S, P.
 Parameters for other elements have not been optimized, and the default
 values used are the ones from igb=5, which were not element-dependent.
 Default values were optimized for H, C, N, O and S atoms in protein systems.
\begin_inset CommandInset citation
LatexCommand citep
key "Nguyen2013"
literal "true"

\end_inset

 Although the parameters for P in proteins can be specified, the default
 values were not optimized and are the igb=5 values.
 Nucleic acids have separate parameters from those used for proteins, and
 default values were optimized for H, C, N, O and P atoms in nucleic acid
 systems.
\begin_inset CommandInset citation
LatexCommand citep
key "Nguyen15b"
literal "true"

\end_inset


\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
The following are the default parameters sander uses with 
\emph on
igb=8
\emph default
: 
\end_layout

\begin_layout LyX-Code
Sh=1.425952, Sc=1.058554, Sn=0.733599,
\end_layout

\begin_layout LyX-Code
So=1.061039, Ss=-0.703469, Sp=0.5,
\end_layout

\begin_layout LyX-Code
offset=0.195141, gbneckscale=0.826836,
\end_layout

\begin_layout LyX-Code
gbalphaH=0.788440, gbbetaH=0.798699, gbgammaH=0.437334,
\end_layout

\begin_layout LyX-Code
gbalphaC=0.733756, gbbetaC=0.506378, gbgammaC=0.205844,
\end_layout

\begin_layout LyX-Code
gbalphaN=0.503364, gbbetaN=0.316828, gbgammaN=0.192915,
\end_layout

\begin_layout LyX-Code
gbalphaOS=0.867814, gbbetaOS=0.876635, gbgammaOS=0.387882,
\end_layout

\begin_layout LyX-Code
gbalphaP=1.0, gbbetaP=0.8, gbgammaP=4.85
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
screen_hnu=1.69654, screen_cnu=1.26890, 
\end_layout

\begin_layout LyX-Code
screen_nnu=1.425974, screen_onu=0.18401, screen_pnu=1.54506, 
\end_layout

\begin_layout LyX-Code
gb_alpha_hnu=0.53705, gb_beta_hnu=0.36286, gb_gamma_hnu=0.11670, 
\end_layout

\begin_layout LyX-Code
gb_alpha_cnu=0.33167, gb_beta_cnu=0.19684, gb_gamma_cnu=0.09342, 
\end_layout

\begin_layout LyX-Code
gb_alpha_nnu=0.68631, gb_beta_nnu=0.46319, gb_gamma_nnu=0.13872, 
\end_layout

\begin_layout LyX-Code
gb_alpha_onu=0.60634, gb_beta_onu=0.46301, gb_gamma_onu=0.14226, 
\end_layout

\begin_layout LyX-Code
gb_alpha_pnu=0.41836, gb_beta_pnu=0.29005, gb_gamma_pnu=0.10642
\end_layout

\begin_layout Standard
Parameters for proteins and for nucleic acids were optimized separately
 and can be independently specified.
 Protein parameters: Sh, Sc, Sn, So, Ss and Sp are scaling parameters, gbalphaX,
 gbbetaX, gbgammaX are the α , β , γ set for element X.
 gbalphaOS, gbbetaOS, gbgammaOS is the α , β , γ set applied to both O and
 S.
 The phosphorus parameters (in proteins) were not optimized and are simply
 taken as the parameters used in the OBC-2 model (igb=5).
 Nucleic acid parameters (end with "nu"): screen_Xnu (X=h, c, n, o, p) are
 scaling parameters, gb_alpha_Xnu (X=h, c, n, o, p) are the α , β , γ set
 for element X.
 
\end_layout

\begin_layout Standard
Since parameters are assigned for each atom based on its residue name (hard-code
d in "sander/egb.F90" (subroutine isnucat)), users need to update the residue
 table in the sander source code if nucleic acids with different names are
 simulated using this GB model.
 
\end_layout

\begin_layout Standard
The default values for offset=0.195141, gbneckscale=0.826836 are recommended
 for both proteins and nucleic acids.
 
\end_layout

\begin_layout Standard
mbondi3 radii are recommended with igb=8 and can be employed with the LEaP
 command "set default PBradii mbondi3".
 The mbondi3 radii were adjusted based on protein simulations, and optimization
 of these radii for nucleic acids is currently underway.
\end_layout

\end_deeper
\begin_layout Description
=10 Calculate the reaction field and nonbonded interactions using a numerical
 Poisson-Boltzmann solver.
 This option is described in the 
\begin_inset CommandInset ref
LatexCommand formatted
reference "cha:PBSA"

\end_inset

.
 Note that this is 
\shape italic
not
\shape default
 a generalized Born simulation, in spite of its use of 
\shape italic
igb
\shape default
; it is rather an alternative continuum solvent model.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
intdiel
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
intdiel
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sander_intdiel"

\end_inset

 Sets the interior dielectric constant of the molecule of interest.
 Default is 1.0.
 Other values have not been extensively tested.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
extdiel
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
extdiel
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sander_extdiel"

\end_inset

 Sets the exterior or solvent dielectric constant.
 Default is 78.5.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
saltcon
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
saltcon
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sander_saltcon"

\end_inset


\series default
 Sets the concentration (M) of 1-1 mobile counterions in solution, using
 a modified generalized Born theory based on the Debye-Hückel limiting law
 for ion screening of interactions.
\begin_inset CommandInset citation
LatexCommand cite
key "Srinivasan99"
literal "true"

\end_inset

 Default is 0.0 M (
\begin_inset Formula $i.e.$
\end_inset

 no Debye-Hückel screening.) Setting 
\shape italic
saltcon
\shape default
 to a nonzero value does result in some increase in computation time.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
rgbmax
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
rgbmax
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "sander_rgbmax"

\end_inset


\series default
 This parameter controls the maximum distance between atom pairs that will
 be considered in carrying out the pairwise summation involved in calculating
 the effective Born radii.
 Atoms whose associated spheres are farther way than 
\shape italic
rgbmax
\shape default
 from given atom will not contribute to that atom's effective Born radius.
 This is implemented in a "smooth" fashion (thanks mainly to W.A.
 Svrcek-Seiler), so that when part of an atom's atomic sphere lies inside
 
\shape italic
rgbmax
\shape default
 cutoff, that part contributes to the low-dielectric region that determines
 the effective Born radius.
 The default is 25 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

, which is usually plenty for single-domain proteins of a few hundred residues.
 Even smaller values (of 10-15 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

) are reasonable, changing the functional form of the generalized Born theory
 a little bit, in exchange for a considerable speed-up in efficiency, and
 without introducing the usual cut-off artifacts such as drifts in the total
 energy.
 
\begin_inset Newline newline
\end_inset

 The 
\shape italic
rgbmax
\shape default
 parameter affects only the effective Born radii (and the derivatives of
 these values with respect to atomic coordinates).
 The 
\shape italic
cut
\shape default
 parameter, on the other hand, determines the maximum distance for the electrost
atic, van der Waals and "off-diagonal" terms of the generalized Born interaction.
 The value of 
\shape italic
rgbmax
\shape default
 might be either greater or smaller than that of 
\shape italic
cut
\shape default
: these two parameters are independent of each other.
 However, values of 
\shape italic
cut
\shape default
 that are too small are more likely to lead to artifacts than are small
 values of 
\shape italic
rgbmax
\shape default
; therefore one typically sets 
\shape italic
rgbmax 
\begin_inset Formula $<$
\end_inset

= cut
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
rbornstat
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
rbornstat
\end_layout

\end_inset

 If 
\shape italic
rbornstat = 1
\shape default
, the statistics of the effective Born radii for each atom of the molecule
 throughout the molecular dynamics simulation are reported in the output
 file.
 Default is 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
offset
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
offset
\end_layout

\end_inset

 The dielectric radii for generalized Born calculations are decreased by
 a uniform value "offset" to give the "intrinsic radii" used to obtain effective
 Born radii.
 Default is 0.09 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
gbsa
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
gbsa
\end_layout

\end_inset


\series default
 Option to carry out GB/SA (generalized Born/surface area) simulations.
 For the default value of 0, surface area will not be computed and will
 not be included in the solvation term.
 If 
\shape italic
gbsa = 1
\shape default
, surface area will be computed using the LCPO model.
\begin_inset CommandInset citation
LatexCommand cite
key "Weiser99"
literal "true"

\end_inset

 If 
\shape italic
gbsa = 2
\shape default
, surface area will be computed by recursively approximating a sphere around
 an atom, starting from an icosahedra.
 Note that no forces are generated in this case, hence, 
\shape italic
gbsa = 2
\shape default
 only works for a single point energy calculation and is mainly intended
 for energy decomposition in the realm of MM-GBSA.
 If 
\shape italic
gbsa = 3, 
\shape default
surface area will be computed using a fast pairwise approximation 
\begin_inset CommandInset citation
LatexCommand citep
key "Huangpwsasa"
literal "true"

\end_inset

 suitable for GPU computing in pmemd.cuda program; the acceleration in pmemd.cuda
 compared with 
\shape italic
gbsa = 2
\shape default
 is ~30 times faster 
\begin_inset CommandInset citation
LatexCommand citep
key "Huangpwsasa"
literal "true"

\end_inset

.
 Note that 
\shape italic
gbsa = 3 
\shape default
is currently not supported in sander, MM-GBSA, QM/MM or libsff.
 Although 
\shape italic
gbsa = 3
\shape default
 is supported in pmemd, the general usage is not recommended as the speed
 gain is trivial, given that the algorithm was particularly designed for
 fast approximation of surface area in GPU-accelerated GB simulations.
 Therefore, we recommend users to use gbsa=3 with pmemd.cuda.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
surften
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
surften
\end_layout

\end_inset


\series default
 Surface tension used to calculate the nonpolar contribution to the free
 energy of solvation (when 
\shape italic
gbsa = 1
\shape default
), as Enp = surften*SA.
 The default is 0.005 kcal/mol/A
\begin_inset Formula $^{2}$
\end_inset

.
\begin_inset CommandInset citation
LatexCommand cite
key "Sitkoff94"
literal "true"

\end_inset

 For 
\shape italic
gbsa = 3
\shape default
, suften works comparably with 
\shape italic
gbsa = 1
\shape default
 given the same value.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Huangpwsasa"
literal "true"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
rdt
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
rdt
\end_layout

\end_inset


\series default
 This parameter is only used for GB simulations with LES (Locally Enhanced
 Sampling).
 In GB+LES simulations, non-LES atoms require multiple effective Born radii
 due to alternate descreening effects of different LES copies.
 When the multiple radii for a non-LES atom differ by less than RDT, only
 a single radius will be used for that atom.
 See 
\begin_inset CommandInset ref
LatexCommand formatted
reference "cha:LES"

\end_inset

 for more details.
 Default is 0.0 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

.
\end_layout

\begin_layout Chapter
Reference Interaction Site Model
\begin_inset CommandInset label
LatexCommand label
name "chap:RISM"

\end_inset


\end_layout

\begin_layout Standard
In addition to explicit and continuum implicit solvation models, Amber also
 has a third type of solvation
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
solvation
\end_layout

\end_inset

 model for molecular mechanics simulations, the reference interaction site
 model (RISM
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
RISM
\end_layout

\end_inset

) of molecular solvation
\begin_inset CommandInset citation
LatexCommand citep
key "Luchko10,Chandler72,Hirata81,Hirata82,Hirata83,Chandler86a,Chandler86b,Beglov95,Beglov97,Kovalenko98,Kovalenko99b,Kovalenko03,Kovalenko00a,Kovalenko00b"
literal "true"

\end_inset

.
 In AmberTools, 1D-RISM
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
1D-RISM
\end_layout

\end_inset

 is available as 
\family sans
rism1d
\family typewriter

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\family typewriter
rism1d
\end_layout

\end_inset


\family default
.
 3D-RISM
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
3D-RISM
\end_layout

\end_inset

 is available as an option in 
\family sans
NAB
\family default
, 
\family sans
MMPBSA.py
\family default
 and 
\family sans
sander
\family default
.
 
\family sans
rism3d.snglpnt
\family default
 is a simplified, standalone interface, ideal for calculating solvation
 thermodynamics on individual structures and trajectories.
 Details specific to using 
\family sans
sander
\family default
 and 
\family sans
sander.MPI
\family default
 can be found in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:sander"

\end_inset

.
\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Standard
RISM is an inherently microscopic approach, calculating the equilibrium
 distribution of the solvent, from which all thermodynamic properties are
 then determined.
 Specifically, RISM is an approximate solution to the Ornstein-Zernike
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
Ornstein-Zernike
\end_layout

\end_inset

 (OZ) equation
\begin_inset CommandInset citation
LatexCommand citep
key "Chandler72,Hansen90,Hirata03a,Kovalenko03,Kovalenko99b"
literal "true"

\end_inset

 
\begin_inset Formula 
\begin{equation}
h(r_{12},\Omega_{1},\Omega_{2})=c(r_{12},\Omega_{1},\Omega_{2})+\rho\int d\mathbf{r}_{3}\,d\Omega_{3}\,c(r_{13},\Omega_{1},\Omega_{3})\,h(r_{32},\Omega_{3},\Omega_{2}),\label{eq:oz_gen}
\end{equation}

\end_inset

where 
\begin_inset Formula $r_{12}$
\end_inset

 is the separation between particles 1 and 2 while 
\begin_inset Formula $\Omega_{1}$
\end_inset

 and 
\begin_inset Formula $\Omega_{2}$
\end_inset

 are their orientations relative to the vector 
\begin_inset Formula $\mathbf{r}_{12}$
\end_inset

.
 The two functions in this relation are 
\begin_inset Formula $h$
\end_inset

, the total correlation function
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
total correlation function
\end_layout

\end_inset

, and 
\begin_inset Formula $c$
\end_inset

, the direct correlation function
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
direct correlation function
\end_layout

\end_inset

.
 The total correlation function is defined as 
\begin_inset Formula 
\[
h_{ab}(r_{ab},\Omega_{a},\Omega_{b})\equiv g_{ab}(r_{ab},\Omega_{a},\Omega_{b})-1,
\]

\end_inset

where 
\begin_inset Formula $g_{ab}$
\end_inset

 is the pair-distribution function
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
pair-distribution function
\end_layout

\end_inset

, which gives the conditional density distribution of species 
\begin_inset Formula $b$
\end_inset

 about 
\begin_inset Formula $a$
\end_inset

.
 In cases where only radial separation is considered, for example by orientation
al averaging over site 
\begin_inset Formula $\alpha$
\end_inset

 of species 
\begin_inset Formula $a$
\end_inset

 and site 
\begin_inset Formula $\gamma$
\end_inset

 of species 
\begin_inset Formula $b$
\end_inset

, gives the familiar one dimensional site-site radial distribution function,
 
\begin_inset Formula $g_{\alpha\gamma}(r_{\alpha\gamma})$
\end_inset

.
\end_layout

\begin_layout Standard
For real mixtures, it is often convenient to speak in terms of a solvent,
 V, of high concentration and a solute, U, of low concentration.
 A generic case of solvation is infinite dilution of the solute, i.e., 
\begin_inset Formula $\rho^{\text{U}}\rightarrow0$
\end_inset

.
 We can rewrite Equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:oz_gen"

\end_inset

, in the limit of infinite dilution, as a set of three equations:
\begin_inset Formula 
\begin{align}
h^{\text{VV}}(r_{12},\Omega_{1},\Omega_{2}) & =c^{\text{VV}}(r_{12},\Omega_{1},\Omega_{2})+\rho^{\text{V}}\int d\mathbf{r}_{3}\,d\Omega_{3}\,c^{\text{VV}}(r_{13},\Omega_{1},\Omega_{3})\,h^{\text{VV}}(r_{32},\Omega_{3},\Omega_{2}),\label{eq:oz_hvv}\\
h^{\text{UV}}(r_{12},\Omega_{1},\Omega_{2}) & =c^{\text{UV}}(r_{12},\Omega_{1},\Omega_{2})+\rho^{\text{V}}\int d\mathbf{r}_{3}\,d\Omega_{3}\,c^{\text{UV}}(r_{13},\Omega_{1},\Omega_{3})\,h^{\text{VV}}(r_{32},\Omega_{3},\Omega_{2}),\label{eq:oz_huv}\\
h^{\text{UU}}(r_{12},\Omega_{1},\Omega_{2}) & =c^{\text{UU}}(r_{12},\Omega_{1},\Omega_{2})+\rho^{\text{V}}\int d\mathbf{r}_{3}\,d\Omega_{3}\,c^{\text{UV}}(r_{13},\Omega_{1},\Omega_{3})\,h^{\text{VU}}(r_{32},\Omega_{3},\Omega_{2}).\label{eq:oz_huu}
\end{align}

\end_inset

Equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:oz_huv"

\end_inset

 is directly relevant for biomolecular simulations where we are often interested
 in the properties of a single, arbitrarily complex solute in the solution
 phase.
 Solutions to Equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:oz_huv"

\end_inset

 can be obtained using 3D-RISM.
 However, a solution to Equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:oz_hvv"

\end_inset

 for pure solvent is a necessary prerequisite and is readily obtained from
 1D-RISM.
\end_layout

\begin_layout Standard
To obtain a solution to the OZ equations it is necessary to have a second
 equation that relates 
\begin_inset Formula $h$
\end_inset

 and 
\begin_inset Formula $c$
\end_inset

 or uniquely defines one of these functions.
 The general closure relation is
\begin_inset CommandInset citation
LatexCommand citep
key "Hansen90"
literal "true"

\end_inset


\begin_inset Formula 
\begin{equation}
g(r_{12},\Omega_{1},\Omega_{2})=\exp\left[-\beta u(r_{12},\Omega_{1},\Omega_{2})+h(r_{12},\Omega_{1},\Omega_{2})-c(r_{12},\Omega_{1},\Omega_{2})+b(r_{12},\Omega_{1},\Omega_{2})\right]\label{eq:closure}
\end{equation}

\end_inset


\begin_inset Formula $u$
\end_inset

 is the potential energy function for the two particles and 
\begin_inset Formula $b$
\end_inset

 is known as the bridge function (a non-local functional, representable
 as infinite diagrammatic series in terms of 
\begin_inset Formula $h$
\end_inset

 
\begin_inset CommandInset citation
LatexCommand citep
key "Hansen90"
literal "true"

\end_inset

).
 It should be noted that 
\begin_inset Formula $u$
\end_inset

 is the only point at which the interaction potential enters the equations.
 Depending on the method used to solve the OZ equations, 
\begin_inset Formula $u$
\end_inset

 is generally an explicit potential.
 In principle, it should now be possible to solve our two equations.
 For example, we may wish to use SPC/E as a water model.
 Inputting the relevant aspects of the SPC/E model into 
\begin_inset Formula $u$
\end_inset

, 1D-RISM can be used to calculate the equilibrium properties of the SPC/E
 model.
 A different explicit water model will yield different properties.
\end_layout

\begin_layout Standard
A fundamental problem for all OZ-like integral equation theories is the
 bridge function
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
bridge function
\end_layout

\end_inset

, which contains multiple integrals that are readily solved only in special
 circumstances.
 In practice, an approximate closure relation must be used.
 While many closures have been developed, at this time only three are implemente
d in 3D-RISM: hypernetted-chain approximation
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
hypernetted-chain approximation
\end_layout

\end_inset

 (HNC
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
HNC
\end_layout

\end_inset

), Kovalenko-Hirata
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
Kovalenko-Hirata
\end_layout

\end_inset

 (KH
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
KH
\end_layout

\end_inset

) and the partial series expansion of order-
\begin_inset Formula $n$
\end_inset

 (
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
PSE-n 
\end_layout

\end_inset

PSE-
\begin_inset Formula $n$
\end_inset

).
\end_layout

\begin_layout Standard
For HNC, we set 
\begin_inset Formula $b=0$
\end_inset

, giving
\begin_inset CommandInset citation
LatexCommand citep
key "Hansen90"
literal "true"

\end_inset


\begin_inset Formula 
\begin{align}
g^{\text{\text{HNC}}}(r_{12},\Omega_{1},\Omega_{2}) & =\exp\left(-\beta u(r_{12},\Omega_{1},\Omega_{2})+h(r_{12},\Omega_{1},\Omega_{2})-c(r_{12},\Omega_{1},\Omega_{2})\right)\nonumber \\
 & =\exp\left(t^{*}(r_{12},\Omega_{1},\Omega_{2})\right)\label{eq:hnc}
\end{align}

\end_inset

where 
\begin_inset Formula $t^{*}$
\end_inset

 is the renormalize-indirect correlation function.
 HNC works well in many situations, including charged particles, but has
 difficulties when the size ratios of particles in the system are highly
 varied and may not always converge on a solution when one should exist.
 Also, as the bridge term is generally repulsive, HNC allows particles to
 approach too closely, overestimating non-Coulombic interactions
\begin_inset CommandInset citation
LatexCommand citep
key "Kovalenko03"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
KH is a combination of HNC and the mean spherical approximation (MSA), the
 former being applied to the spatial regions of solvent density depletion
 (
\begin_inset Formula $g<1$
\end_inset

), including the repulsive core, and the latter to those of solvent density
 enrichment (
\begin_inset Formula $g>1$
\end_inset

), such as association peaks
\begin_inset CommandInset citation
LatexCommand citep
key "Kovalenko99b,Kovalenko03"
literal "true"

\end_inset


\begin_inset Formula 
\begin{equation}
g^{\text{KH}}(r_{12},\Omega_{1},\Omega_{2})=\left\{ \begin{array}{ll}
\exp\Bigl(t^{*}(r_{12},\Omega_{1},\Omega_{2})\Bigr) & \text{for }g(r_{12},\Omega_{1},\Omega_{2})\leq1\\
1+t^{*}(r_{12},\Omega_{1},\Omega_{2}) & \text{for }g(r_{12},\Omega_{1},\Omega_{2})>1
\end{array}\right..\label{eq:kh}
\end{equation}

\end_inset

Like HNC, KH handles Coulombic systems well but overestimates non-Coulombic
 interactions.
 Unlike HNC, it does not have difficulties with highly asymmetric particle
 sizes and readily converges to stable solutions for almost all systems
 of practical interest.
 The reliability of the KH closure makes it particularly suitable for molecular
 mechanics calculations.
\end_layout

\begin_layout Standard
PSE-
\begin_inset Formula $n$
\end_inset

 offers the ability to interpolate between KH and HNC.
 Here, the exponential regions of solvent density enrichment are treated
 as a Taylor expansion, 
\begin_inset Formula 
\begin{equation}
g^{\text{PSE-n}}(r_{12},\Omega_{1},\Omega_{2})=\left\{ \begin{array}{ll}
\exp\Bigl(t^{*}(r_{12},\Omega_{1},\Omega_{2})\Bigr) & \text{for }g(r_{12},\Omega_{1},\Omega_{2})\leq1\\
\sum_{i=0}^{n}\nicefrac{\left(t^{*}(r_{12},\Omega_{1},\Omega_{2})\right)^{i}}{i!} & \text{for }g(r_{12},\Omega_{1},\Omega_{2})>1
\end{array}\right..\label{eq:pse-n}
\end{equation}

\end_inset

In the case of 
\begin_inset Formula $n=1$
\end_inset

, the KH closure is obtained, while in the limit of 
\begin_inset Formula $n\rightarrow\infty$
\end_inset

 HNC is recovered.
 This allows a balance between the numerical stability of KH and the often
 better accuracy of HNC.
\end_layout

\begin_layout Subsection
3D-RISM
\begin_inset CommandInset label
LatexCommand label
name "subsec:3D-RISM"

\end_inset


\end_layout

\begin_layout Standard
With the results from 1D-RISM, a 3D-RISM
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
3D-RISM
\end_layout

\end_inset

 calculation for a specific solute can be carried out.
 For 3D-RISM calculations, only the solvent orientational degrees of freedom
 are averaged over and Equation
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:oz_huv"

\end_inset

 becomes
\begin_inset CommandInset citation
LatexCommand citep
key "Kovalenko98,Kovalenko99b"
literal "true"

\end_inset


\begin_inset Formula 
\begin{equation}
h_{\gamma}^{\text{UV}}\left(\mathbf{r}\right)=\sum_{\alpha}\int d\mathbf{r}^{\prime}c_{\alpha}^{\text{UV}}\left(\mathbf{r}-\mathbf{r}^{\prime}\right)\chi_{\alpha\gamma}^{\text{VV}}(r^{\prime}),\label{eq:3d-rism}
\end{equation}

\end_inset

where 
\begin_inset Formula $\chi_{\alpha\gamma}^{\text{VV}}(r)$
\end_inset

 is the site-site susceptibility of the solvent, obtained from 1D-RISM and
 given by 
\begin_inset Formula 
\[
\chi_{\alpha\gamma}^{\text{VV}}(r)=\omega_{\alpha\gamma}^{\text{VV}}(r)+\rho_{\alpha}h_{\alpha\gamma}^{\text{VV}}(r).
\]

\end_inset


\end_layout

\begin_layout Standard
3D-RISM supports HNC, KH and PSE-
\begin_inset Formula $n$
\end_inset

 closures (see Sections 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:rism3d.snglpnt-usage"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:NAB-Basic-molecular-mechanics"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:mmpbsa-rism"

\end_inset

).
 As with the 1D-RISM closures, these are constructed by analogy from Eqs.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hnc"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:pse-n"

\end_inset

.
 For example, HNC becomes
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
g_{\gamma}^{\text{HNC,UV}}\left(\mathbf{r}\right)=\exp\Bigl(-\beta u_{\gamma}^{\text{UV}}\left(\mathbf{r}\right)+h_{\gamma}^{\text{UV}}\left(\mathbf{r}\right)-c_{\gamma}^{\text{UV}}\left(\mathbf{r}\right)\Bigr).\label{eq:3d-hnc}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
As with 1D-RISM, correlation functions are represented on (3D) grids, convolutio
n integrals are performed in reciprocal space and a self-consistent solution
 is iteratively converged upon using the MDIIS accelerated solver.
 There is one 3D grid for each solvent type for each correlation function.
 For example, for a solute in SPC/E water there will be both 
\begin_inset Formula $g_{\text{H}}^{\text{UV}}(\mathbf{r})$
\end_inset

 and 
\begin_inset Formula $g_{\text{O}}^{\text{UV}}(\mathbf{r})$
\end_inset

 grids.
 Each point on the 
\begin_inset Formula $g_{\text{H}}^{\text{UV}}(\mathbf{r})$
\end_inset

 will give the fractional density of water hydrogen a that location of real-spac
e.
\end_layout

\begin_layout Standard
To properly treat electrostatic forces in electrolyte solution with polar
 molecular solvent and ionic species, the electrostatic asymptotics of all
 the correlation functions (both the 3D and radial ones) are treated analyticall
y
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Kovalenko03,Kaminski10,Kovalenko00a"
literal "true"

\end_inset

.
 The non-periodic electrostatic asymptotics are separated out in the direct
 and reciprocal space and the remaining short-range terms of the correlation
 functions are discretized on a 3D grid in a non-periodic box large enough
 to ensure decay of the short-range terms at the box boundaries 
\begin_inset CommandInset citation
LatexCommand citep
key "Kaminski10"
literal "true"

\end_inset

.
 The convolution of the short-range terms in the integral equation 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:3d-rism"

\end_inset

 is calculated using 3D fast Fourier transform
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Frigo98,Frigo99"
literal "true"

\end_inset

.
 Accordingly, the electrostatic asymptotics terms in the thermodynamics
 integral 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:exchem-kh"

\end_inset

 below are handled analytically and reduced to one-dimensional integrals
 easy to compute
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Kaminski10"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
With a converged 3D-RISM solution for 
\begin_inset Formula $h^{\text{UV}}$
\end_inset

 and 
\begin_inset Formula $c^{\text{UV}}$
\end_inset

, it is straightforward to calculate solvation
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
solvation
\end_layout

\end_inset

 thermodynamics
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
thermodynamics
\end_layout

\end_inset

.
 From the perspective of molecular simulations, the most important thermodynamic
 values are the excess chemical potential
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
excess chemical potential
\end_layout

\end_inset

 of solvation (solvation free energy
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
solvation free energy
\end_layout

\end_inset

), 
\begin_inset Formula $\mu^{\text{ex}}$
\end_inset

 and the mean solvation force
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
mean solvation force
\end_layout

\end_inset

, 
\begin_inset Formula $\mathbf{f}_{i}^{\text{UV}}(\mathbf{R}_{i})$
\end_inset

, on each solute atom, 
\begin_inset Formula $i$
\end_inset

.
 
\begin_inset Formula $\mu^{\text{ex}}$
\end_inset

 can be obtained through analytical thermodynamic integration for HNC
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
HNC
\end_layout

\end_inset

, 
\begin_inset Formula 
\begin{equation}
\mu^{\text{ex,HNC}}=k_{\text{B}}T\sum_{\alpha}\rho_{\alpha}^{\text{V}}\int d\mathbf{r}\left[\frac{1}{2}\left(h_{\alpha}^{\text{UV}}(\mathbf{r})\right)^{2}-c_{\alpha}^{\text{UV}}(\mathbf{r})-\frac{1}{2}h_{\alpha}^{\text{UV}}(\mathbf{r})c_{\alpha}^{\text{UV}}(\mathbf{r})\right],\label{eq:exchem-hnc}
\end{equation}

\end_inset

KH
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
KH
\end_layout

\end_inset

 ,
\begin_inset Formula 
\begin{equation}
\mu^{\text{ex,KH}}=k_{\text{B}}T\sum_{\alpha}\rho_{\alpha}^{\text{V}}\int d\mathbf{r}\left[\frac{1}{2}\left(h_{\alpha}^{\text{UV}}(\mathbf{r})\right)^{2}\Theta\left(-h_{\alpha}^{\text{UV}}(\mathbf{r})\right)-c_{\alpha}^{\text{UV}}(\mathbf{r})-\frac{1}{2}h_{\alpha}^{\text{UV}}(\mathbf{r})c_{\alpha}^{\text{UV}}(\mathbf{r})\right],\label{eq:exchem-kh}
\end{equation}

\end_inset

and 
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
PSE-n 
\end_layout

\end_inset

PSE-
\begin_inset Formula $n$
\end_inset

,
\begin_inset Formula 
\begin{multline}
\mu^{\text{ex,PSE-}n}=k_{\text{B}}T\sum_{\alpha}\rho_{\alpha}^{\text{V}}\int d\mathbf{r}\left[\frac{1}{2}\left(h_{\alpha}^{\text{UV}}(\mathbf{r})\right)^{2}-c_{\alpha}^{\text{UV}}(\mathbf{r})-\frac{1}{2}h_{\alpha}^{\text{UV}}(\mathbf{r})c_{\alpha}^{\text{UV}}(\mathbf{r})\right.\\
\left.-\frac{\left(t^{*}\left(\mathbf{r}\right)\right)^{n+1}}{\left(n+1\right)!}\Theta\left(h_{\alpha}^{\text{UV}}(\mathbf{r})\right)\right],\label{eq:exchem-psen}
\end{multline}

\end_inset

where 
\begin_inset Formula $\Theta$
\end_inset

 is the Heaviside function.
 
\end_layout

\begin_layout Standard
Analogous versions of Eqns.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "eq:hnc"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:exchem-kh"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:exchem-psen"

\end_inset

 are used in 1D-RISM.
 While these are used for DRISM they are have been derived for XRISM.
 Furthermore, these equations have been derived a number of different ways
 with slightly different functional forms of the 
\begin_inset Formula $-\frac{1}{2}hc$
\end_inset

 term
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Singer1985,Pettitt1986,Kovalenko99b,Kast2003,Schmeer2010"
literal "true"

\end_inset

.
 These different functional forms are equivalent in XRISM but not in DRISM.
 The form introduced by Pettitt and Rossky
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Pettitt1986"
literal "true"

\end_inset

 is the most popular in the literature and the default selection in 
\family typewriter
rism1d
\family default
.
 It is possible to have 
\family typewriter
rism1d
\family default
 evaluate and output all three functional forms (see 
\begin_inset CommandInset ref
LatexCommand nameref
reference "subsec:rism1d_Output"

\end_inset

) but, for DRISM, none of these expressions are strictly correct.
\end_layout

\begin_layout Standard
The force equation
\begin_inset Formula 
\[
\mathbf{f}_{i}^{\text{UV}}(\mathbf{R}_{i})=-\frac{\partial\mu^{\text{ex}}}{\partial\mathbf{R}_{i}}=-\sum_{\alpha}\rho_{\alpha}\int d\mathbf{r}g_{\alpha}^{\text{UV}}(\mathbf{r})\frac{\partial u_{\alpha}^{\text{UV}}(\mathbf{r}-\mathbf{R}_{i})}{\partial\mathbf{R}_{i}}
\]

\end_inset

is valid for all closures with a path independent expression for the excess
 chemical potential, such as HNC, KH and PSE-
\begin_inset Formula $n$
\end_inset

 closures implemented in 3D-RISM
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Gusarov06,Miyata07,Luchko10,Kast08"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
In addition to closure specific expressions for the solvation free energy,
 other approximations also exist.
 The Gaussian fluctuation
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
Gaussian fluctuation
\end_layout

\end_inset

 (GF) approximation
\begin_inset CommandInset citation
LatexCommand citep
key "Chandler84,Ichiye88"
literal "true"

\end_inset

 is given as 
\begin_inset Formula 
\begin{equation}
\mu_{\text{}}^{\text{ex,GF}}=k_{\text{B}}T\sum_{\alpha}\rho_{\alpha}^{\text{V}}\int d\mathbf{r}\left[-c_{\alpha}^{\text{UV}}\left(\mathbf{r}\right)-\frac{1}{2}h_{\alpha}^{\text{UV}}\left(\mathbf{r}\right)c_{\alpha}^{\text{UV}}\left(\mathbf{r}\right)\right]\label{eq:rism-GF-functional}
\end{equation}

\end_inset

and has been shown to yield improved absolute solvation free energies for
 both polar and non-polar solutes
\begin_inset CommandInset citation
LatexCommand citep
key "Ichiye88,Lee93"
literal "true"

\end_inset

 but not necessarily for relative free energies
\begin_inset CommandInset citation
LatexCommand citep
key "Genheden10"
literal "true"

\end_inset

.
 It is not associated with a particular closure but is typically used in
 place of the expression for a given closure.
 
\end_layout

\begin_layout Standard
Eqs.
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:exchem-hnc"

\end_inset

-
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:exchem-psen"

\end_inset

 give the total solvation free energy, 
\begin_inset Formula $\Delta G_{\text{sol}}$
\end_inset

, but it is often useful to decompose this into electrostatic (solvent polarizat
ion), 
\begin_inset Formula $\Delta G_{\text{pol}}$
\end_inset

, and non-electrostatic (dispersion and cavity formation), 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
\lang english

\begin_inset Formula $\left(\Delta G_{\text{dis}}+\Delta G_{\text{cav}}\right)$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\noun default
\color inherit
\lang american
, terms.
 Conceptually, we can divide the path of the thermodynamic integration into
 two steps: first the solute without partial charges is inserted into the
 solvent (dispersion and cavity formation) and then partial charges are
 introduced, which polarize the solvent,
\begin_inset Formula 
\[
\mu^{\text{ex}}=\Delta G_{\text{sol}}=\Delta G_{\text{pol}}+\Delta G_{\text{dis}}+\Delta G_{\text{cav}}.
\]

\end_inset


\begin_inset Formula $\Delta G_{\text{sol}}$
\end_inset

 is produced by a 3D-RISM calculation on the charged solute.
 
\begin_inset Formula $\Delta G_{\text{pol}}$
\end_inset

 is then the difference of the two calculations.
 As a point of reference, generalized-Born and Poisson-Boltzmann methods
 calculate only 
\begin_inset Formula $\Delta G_{\text{pol}}$
\end_inset

 and, typically, use a calculation involving solvent accessible surface
 area to predict 
\begin_inset Formula $\Delta G_{\text{dis}}+\Delta G_{\text{cav}}$
\end_inset

.
\end_layout

\begin_layout Section
Practical Considerations
\end_layout

\begin_layout Subsection
Computational Requirements and Parallel Scaling
\end_layout

\begin_layout Standard
Calculating a 3D-RISM solution for a single solute conformation typically
 requires about 100 times more computer time than the same calculation with
 explicit solvent or PB.
 While there are other factors to consider, such as sampling confined solvent
 or overall efficiency of sampling in the whole statistical ensemble at
 once, this can be prohibitive for many applications.
 Memory is also an issue as the 3D correlation grids require anywhere from
 a few megabytes for the smallest solutes to gigabytes for large complexes.
 A lower bound and very good estimate for the total memory required is
\begin_inset Formula 
\begin{align*}
\text{Total memory}\geq8\,\text{bytes}\times & \left[N_{\text{box}}\vphantom{\underbrace{1}_{2}}\right.N^{\text{V}}\left(\underbrace{2N_{\text{MDIIS}}}_{c,\text{residual}}+\underbrace{1_{\vphantom{p}}}_{u}+\underbrace{N_{\text{decomp}}}_{\text{polar decomp}}\underbrace{N_{\text{propagate}}}_{\text{past solutions}}\right)\\
 & \phantom{\left[\vphantom{\underbrace{1}_{2}}\right.}\left.\left(N_{\text{box}}+2N_{y}N_{z}\right)\left\{ \underbrace{4}_{\text{asymptotics}}+\underbrace{1}_{\text{FFT scratch}}+\underbrace{2}_{g,h}N^{\text{V}}\right\} \vphantom{\underbrace{1}_{2}}\right]
\end{align*}

\end_inset

where 
\begin_inset Formula $N_{\text{box}}=N_{x}\times N_{y}\times N_{z}$
\end_inset

 is the total number of grid points, 
\begin_inset Formula $N^{\text{V}}$
\end_inset

 is the number of solvent atom species and 
\begin_inset Formula $N_{\text{MDIIS}}$
\end_inset

 is the number of MDIIS vectors used to accelerate convergence.
 
\begin_inset Formula $u^{\text{UV}}$
\end_inset

, 
\begin_inset Formula $c^{\text{UV}}$
\end_inset

 and the residual of 
\begin_inset Formula $c^{\text{UV}}$
\end_inset

 are stored in real-space only and require a full grid for each solvent.
 
\begin_inset Formula $c^{\text{UV}}$
\end_inset

 and its residual also require 
\begin_inset Formula $N_{\text{MDIIS}}$
\end_inset

 grids for the MDIIS routine (see the 
\family sans
mdiis_nvec
\family default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
nvec
\end_layout

\end_inset

 keyword) and 
\begin_inset Formula $N_{\text{propagate}}$
\end_inset

 grids to make use of solutions from previous solute configurations to improve
 the initial guess (see the 
\family sans
npropagate
\family default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
npropagate
\end_layout

\end_inset

 keyword).
 If a polar/non-polar decomposition is requested (see the 
\family sans
polardecomp
\family default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
polardecomp
\end_layout

\end_inset

 keyword) an additional set of grids for past solutions with no solute charges
 is kept (
\begin_inset Formula $N_{\text{decomp}}=2$
\end_inset

); by default this is turned off (
\begin_inset Formula $N_{\text{decomp}}=1$
\end_inset

).
 The full real space grid plus an additional 
\begin_inset Formula $2N_{y}N_{x}$
\end_inset

 grid points are needed (due to the FFT) for 
\begin_inset Formula $g$
\end_inset

 and 
\begin_inset Formula $h$
\end_inset

 for each solvent species and for the four grids required to compute the
 long range asymptotics.
 Memory, therefore, scales linearly with 
\begin_inset Formula $N_{\text{box}}$
\end_inset

 while computation time scales as 
\begin_inset Formula $O(N_{\text{box}}\log(N_{\text{box}}))$
\end_inset

 due to the requirements of calculating the 3D fast Fourier transform (3D-FFT).
 To overcome these requirements, two options are available beyond optimizations
 already in place, multiple time steps and parallelization.
 Multiple time step methods are available only in sander (
\begin_inset CommandInset ref
LatexCommand formatted
reference "chap:sander"

\end_inset

) and are applicable to molecular dynamics calculations only.
 Parallelization is available for all calculations but is limited by system
 size and computational resources.
\end_layout

\begin_layout Standard
Both 
\family typewriter
sander
\family default
 and 
\family typewriter
NAB
\family default
 have MPI implementations of 3D-RISM (see Section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Compiling-MPI-3D-RISM"

\end_inset

 for NAB compiling instructions) that distribute both memory requirements
 and computational load.
 As memory is distributed, the aggregate memory of many computers can be
 used to perform calculations on very large systems.
 Memory distribution is handled by the FFTW 3.3 library so decomposition
 is done along the z-axis.
 If a variable solvation box size is used, the only consideration is to
 avoid specifying a large, prime number of processes (
\begin_inset Formula $\ge7$
\end_inset

).
 For fixed box sizes, the number of grids points in each dimension must
 be divisible by two (a general requirement) and the number of grid points
 in the z-axis must be divisible by the number of processes.
 
\family typewriter
sander.MPI
\family default
 also has the additional consideration that the number of processes cannot
 be larger than the number of solute residues; 
\family typewriter
NAB
\family default
 does not suffer from this limitation.
\end_layout

\begin_layout Subsection
Output
\end_layout

\begin_layout Standard
\begin_inset Formula $g^{\text{UV}}$
\end_inset

, 
\begin_inset Formula $h^{\text{UV}}$
\end_inset

 and 
\begin_inset Formula $c^{\text{UV}}$
\end_inset

 files can be output for 3D-RISM calculations and are useful for visualization
 and calculation of thermodynamic quantities.
 As all file formats save only one density per file (see 
\begin_inset CommandInset href
LatexCommand href
name "https://ambermd.org/FileFormats.php"
target "https://ambermd.org/FileFormats.php"
literal "false"

\end_inset

), there is one file for each solvent atom type for each requested frame.
 For the default MRC format, each file is 
\begin_inset Formula $\left(256+N_{\text{box}}\times4\right)$
\end_inset


\begin_inset space ~
\end_inset

bytes, which can quickly fill disk space.
 Note that these file format use single precision floating point numbers.
\end_layout

\begin_layout Subsection
Numerical Accuracy
\begin_inset CommandInset label
LatexCommand label
name "subsec:RISM-Numerical-Accuracy"

\end_inset


\end_layout

\begin_layout Standard
Numerical accuracy depends on the residual tolerance specified for the numerical
 solution at runtime and the solvation box physical size and grid spacing.
 In most cases, you will need to test these parameters to ensure you have
 the accuracy required.
 As a rough guide, the numerical error in the solvation free energy is related
 to the tolerance by
\begin_inset Formula 
\begin{equation}
\epsilon_{\Delta G_{\text{solv}}}\approx10\times\text{tolerance}.\label{eq:rism_obs_err_tol}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Molecular dynamics 
\begin_inset CommandInset citation
LatexCommand citep
key "Luchko10"
literal "true"

\end_inset

, minimization and trajectory post-processing 
\begin_inset CommandInset citation
LatexCommand citep
key "Genheden10"
literal "true"

\end_inset

 have different requirements for the maximum residual tolerance.
 Molecular dynamics does well with a tolerance of 
\begin_inset Formula $10^{-5}$
\end_inset

 and 
\family typewriter
npropagate=5
\family default
.
 Minimization requires tolerances of 
\begin_inset Formula $10^{-11}$
\end_inset

 or lower and is typically limited to 
\begin_inset Formula $\mathtt{drms}\ge10^{-4}$
\end_inset

.
 Trajectory post-processing for MM/RISM should use enough digits to obtain
 the necessary accuracy when differences in solvation free energy are computed.
 For example, if a error 
\begin_inset Formula $<\unit[0.2]{kcal/mol}$
\end_inset

 is required for 
\begin_inset Formula $\Delta\Delta G{}_{\text{solv}}$
\end_inset

, then 
\begin_inset Formula $\Delta G_{\text{solv}}$
\end_inset

 should be computed with an absolute error of 
\begin_inset Formula $\unit[0.1]{kcal/mol}$
\end_inset

.
 The relative error required to achieve this depends on the magnitude of
 
\begin_inset Formula $\Delta G_{\text{solv}}$
\end_inset

.
\end_layout

\begin_layout Standard
Almost all applications should use a grid spacing of 0.3 to 0.5
\begin_inset space ~
\end_inset

Å or smaller.
 A larger grid spacing quickly leads to severe errors in thermodynamic quantitie
s.
 Smaller grid spacing may be necessary for some applications (e.g., mapping
 potentials of mean force).
 
\end_layout

\begin_layout Subsection
Solution Convergence
\begin_inset CommandInset label
LatexCommand label
name "subsec:rism-Solution-Convergence"

\end_inset


\end_layout

\begin_layout Standard
The default parameters for 3D-RISM are selected to provide the best performance
 for the majority of systems.
 In cases where a convergence is not achieved, the strategies below may
 be useful.
 
\end_layout

\begin_layout Subsubsection
Closure Bootstrap
\end_layout

\begin_layout Standard
When a PSE-
\begin_inset Formula $n$
\end_inset

 or HNC closure is desired, the most effective method to overcome convergence
 issues is to use a low order closure
\begin_inset Index idx
status open

\begin_layout Plain Layout
closure
\end_layout

\end_inset

 solution as a starting guess.
 The KH closure should be the starting point as it is numerically robust
 and, typically, converges easily in the vast majority of case.
 After this, higher orders of PSE-
\begin_inset Formula $n$
\end_inset

 can be used until the desired closure is reached.
 The procedure for 1D-RISM and 3D-RISM differs slightly in practice.
\end_layout

\begin_layout Paragraph
3D-RISM
\end_layout

\begin_layout Standard
All 3D-RISM interfaces have closure bootstrapping builtin via the 
\emph on
closure
\begin_inset Index idx
status open

\begin_layout Plain Layout
closure
\end_layout

\end_inset


\emph default
 and 
\emph on
tolerance
\begin_inset Index idx
status open

\begin_layout Plain Layout
tolerance
\end_layout

\end_inset


\emph default
 keywords.
 Closures should be specified as an ordered list with last closure being
 the highest order closure.
 The solutions of the intermediate closures can have a high tolerance.
 The default tolerance for intermediate closures is 1 and there is no observed
 benefit to tolerances less than 1e-2.
 See details in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:rism3d.snglpnt-usage"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:rism3d_sander_Keywords"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:NAB-Basic-molecular-mechanics"

\end_inset

.
\end_layout

\begin_layout Subsubsection
MDIIS Settings
\end_layout

\begin_layout Standard
MDIIS
\begin_inset Index idx
status open

\begin_layout Plain Layout
MDIIS
\end_layout

\end_inset

 default setting are appropriate for most cases.
 Should your residual diverge or the solver get stuck on a particular value,
 you can try modest adjustments.
\end_layout

\begin_layout Paragraph
Decrease 
\emph on
mdiis_del
\emph default

\begin_inset Index idx
status open

\begin_layout Plain Layout
mdiis_del
\end_layout

\end_inset


\end_layout

\begin_layout Standard

\emph on
mdiis_del
\emph default
 controls the step size of MDIIS.
 A smaller step size can help convergence but if this is set too small it
 can cause convergence problems.
 For 
\family typewriter
rism1d
\family default
, this should be no lower than 0.1 or 0.2.
 For 3D-RISM, it should be 0.5 at the lowest.
\end_layout

\begin_layout Paragraph
Increase 
\emph on
mdiis_nvec
\emph default

\begin_inset Index idx
status open

\begin_layout Plain Layout
mdiis_nvec
\end_layout

\end_inset


\end_layout

\begin_layout Standard
This is the number of trial solutions that are saved for predicting a new
 solution.
 The optimal number for rapid convergence is typically 10 for 3D-RISM and
 20 for 1D-RISM.
 However, for 3D-RISM, the default choice of 5 requires much less memory
 and is computationally faster even though more iterations are required.
 Increasing the 
\emph on
mdiis_nvec
\emph default
 may help for 3D-RISM but is unlikely to help for 1D-RISM.
\end_layout

\begin_layout Paragraph
Increase 
\emph on
mdiis_restart
\emph default

\begin_inset Index idx
status open

\begin_layout Plain Layout
mdiis_restart
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Occasionally, the MDIIS routine goes in the wrong direction and the residual
 increases significantly.
 If it increases more than 
\emph on
mdiis_restart
\emph default
 then the MDIIS routine selects the solution with the lowest residual and
 purges the other trial solutions.
 The default value of 10 can be too aggressive and cause the solver to cycle.
 Increasing the value to 100 or 1000 sometimes allows the solver to recover
 from a misstep.
 
\end_layout

\begin_layout Subsubsection
Parameter Annealing
\end_layout

\begin_layout Standard
Chargeless, hot gases are the easiest systems to converge.
 For 1D-RISM, this can be used to bootstrap a solution in a similar manner
 to closure bootstrapping.
 By slowly turning on charges, lowering the temperature or increasing the
 density, a converged solution may be reached.
 This only works for 1D-RISM because it requires restarting from a previous
 solution.
 As with closure bootstrapping, files should be carefully renamed during
 the procedure.
 There is no general protocol but the parameter increment should be reduced
 as the target value is approached.
 E.g., turning on charges in a linear fashion usually isn't helpful.
\end_layout

\begin_layout Subsubsection
Forcefield selection
\end_layout

\begin_layout Standard
The forcefield may affect convergence due to the number of solvent sites
 involved or the particular parameters of the forcefield.
\end_layout

\begin_layout Paragraph
Number of Sites
\end_layout

\begin_layout Standard
Molecules with more sites are more difficult to converge.
 Six or more sites is already difficult to converge and more that 10 may
 not be possible under any circumstances.
 One solution is to use a united atom or coarse grained forcefields to reduce
 the number of sites.
\end_layout

\begin_layout Paragraph
Alternate Parameterization
\end_layout

\begin_layout Standard
Some parameter sets simply yield a stiffer set of equations to solve.
 Choosing an alternate parameter set may allow convergence with only small
 differences in the numerical results.
 For example, the cSPC/E water model with SPC/E Joung/Cheatham ions is easier
 to converge at higher ion concentrations in 1D-RISM than cTIP3P water with
 TIP3P Joung/Cheatham ions.
 Both models give nearly identical results in RISM at lower concentrations
 but NaCl in cTIP3P water will not converge above 0.5 M for the PSE-3 closure
 despite using all of the above methods.
\end_layout

\begin_layout Section
3D-RISM in sander
\begin_inset CommandInset label
LatexCommand label
name "sec:RISM"

\end_inset


\end_layout

\begin_layout Standard
3D-RISM
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
3D-RISM
\end_layout

\end_inset

 functionality is available in 
\emph on
sander
\emph default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
sander
\end_layout

\end_inset

 and is built as part of the standard install procedure.
 MPI functionality for 3D-RISM in sander requires some additional information
 at compile time, described in Section
\begin_inset space ~
\end_inset


\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Compiling-MPI-3D-RISM"

\end_inset

.
 Some features specific to 
\emph on
sander
\emph default
 are discussed here.
\end_layout

\begin_layout Subsection
3D-RISM in 
\family typewriter
sander
\end_layout

\begin_layout Standard
Full 3D-RISM functionality is available in 
\family sans
sander
\family default
 as part of the standard install procedure.
 However, some methods available in 
\family typewriter
sander
\family default
 are not compatible with 3D-RISM, such as QM/MM simulations.
 At this time, only standard molecular dynamics, minimization and trajectory
 post-processing with non-polarizable force fields are supported.
 With the exception of multiple time step features, 3D-RISM keywords in
 
\family sans
sander
\family default
 are identical to those in NAB, 
\family sans
rism3d.snglpnt
\family default
 and 
\family sans
MMPBSA.py
\family default
.
 
\end_layout

\begin_layout Standard
3D-RISM specific command line options for 
\family sans
sander
\family default
 are
\end_layout

\begin_layout LyX-Code
sander [standard options] -xvv xvvfile -guv guvroot -huv huvroot 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout LyX-Code
-cuv cuvroot -uuv uuvroot -asymp asympfile 
\end_layout

\begin_layout LyX-Code
-quv quvroot -chgdist chgdistroot 
\end_layout

\begin_layout LyX-Code
-exchem exchemroot -solvene solveneroot -entropy entropyroot -potUV potUVroot
\end_layout

\end_deeper
\begin_layout Description
xvvfile
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
xvv
\end_layout

\end_inset

 
\emph on
input
\emph default
 description of bulk solvent properties, required for 3D-RISM calculations.
 Produced by 
\family typewriter
rism1d
\family default
.
\end_layout

\begin_layout Description
guvroot
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
guv
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for solute-solvent 3D pair distribution function, 
\begin_inset Formula $G^{\text{UV}}(\mathbf{R})$
\end_inset

.
 This will produce one file for each solvent atom type for each frame requested.
\end_layout

\begin_layout Description
huvroot
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
huv
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for solute-solvent 3D total correlation function, 
\begin_inset Formula $H^{\text{UV}}(\mathbf{R})$
\end_inset

.
 This will produce one file for each solvent atom type for each frame requested.
\end_layout

\begin_layout Description
cuvroot
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
cuv
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for solute-solvent 3D total correlation function, 
\begin_inset Formula $C^{\text{UV}}(\mathbf{R})$
\end_inset

.
 This will produce one file for each solvent atom type for each frame requested.
\end_layout

\begin_layout Description
uuvroot
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
cuv
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for solute-solvent 3D potential energy function, 
\begin_inset Formula $U^{\text{UV}}(\mathbf{R})$
\end_inset

, in units of 
\begin_inset Formula $kT$
\end_inset

.
 This will produce one file for each solvent atom type for each frame requested.
\end_layout

\begin_layout Description
asympfile
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
long-range asymptotics
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for solute-solvent 3D long-range real-space asymptotics for 
\begin_inset Formula $C$
\end_inset

 and 
\begin_inset Formula $H$
\end_inset

.
 This will produce one file for each of 
\begin_inset Formula $C$
\end_inset

 and 
\begin_inset Formula $H$
\end_inset

 for each frame requested and does not include the solvent site charge.
 Multiply the distribution by the solvent site charge to obtain the long-range
 asymptotics for that site.
\end_layout

\begin_layout Description
quvroot
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
charge density
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for solute-solvent 3D charge density distribution [
\emph on
e/
\emph default
Å].
 This will produce one file that combines contributions from all solvent
 atom types for each frame requested.
\end_layout

\begin_layout Description
chgdistroot
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
charge distribution
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for solute-solvent 3D charge distribution [
\emph on
e
\emph default
].
 This will produce one file that combines contributions from all solvent
 atom types for each frame requested.
\end_layout

\begin_layout Description
exchemroot
\begin_inset Index idx
status open

\begin_layout Plain Layout
exchem
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for 3D excess chemical potential distribution files.
\end_layout

\begin_layout Description
solveneroot
\begin_inset Index idx
status open

\begin_layout Plain Layout
solvene
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for 3D solvation energy distribution files.
\end_layout

\begin_layout Description
entropyroot
\begin_inset Index idx
status open

\begin_layout Plain Layout
entropy
\end_layout

\end_inset

 
\emph on
output 
\emph default
root name for 3D solvation entropy distribution files.
\end_layout

\begin_layout Description
potUVroot
\begin_inset Index idx
status open

\begin_layout Plain Layout
potUVroot
\end_layout

\end_inset

 
\emph on
output
\emph default
 root name for 3D solute-solvent potential energy distribution files.
\end_layout

\begin_layout Standard
Generated output files can be large and numerous.
 For each type of correlation, a separate file is produced for each solvent
 atom type.
 The frequency that files are produced is controlled by the 
\family typewriter
ntwrism
\family default
 parameter.
 Every time step that output is produced, a new set of files is written
 with the time step number in the file name.
 For example, a molecular dynamics calculation using an SPC/E water model
 with 
\family typewriter
ntwrism=2
\family default
 and 
\family typewriter
-guv guv
\family default
 on the command line will produce two files on time step ten: 
\family typewriter
guv.O.10.mrc
\family default
 and 
\family typewriter
guv.H1.10.mrc
\family default
.
\end_layout

\begin_layout Subsubsection
Keywords
\begin_inset CommandInset label
LatexCommand label
name "subsec:rism3d_sander_Keywords"

\end_inset


\end_layout

\begin_layout Standard
With the exception of 
\family sans
irism
\family default
, which is found in the 
\family sans
&cntrl
\family default
 name list, all 3D-RISM options are specified in the 
\family sans
&rism
\family default
 name list.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
irism
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series bold
irism
\end_layout

\end_inset


\series default
 [0] Use 3D-RISM.
 Found in 
\family typewriter
&cntrl
\family default
 name list.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

0 Off.
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

1 On.
\end_layout

\end_deeper
\begin_layout Paragraph
Closure Approximation
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
closure
\series default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
closure
\end_layout

\end_inset

 [KH] Comma separate list of closure approximations.
 If more than one closure is provided, the 3D-RISM solver will use the closures
 in order to obtain a solution for the last closure in the list when no
 previous solutions are available.
 The solution for the last closure in the list is used for all output.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

KH Kovalenko-Hirata (KH).
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

HNC Hyper-netted chain equation (HNC).
\end_layout

\begin_layout Description
=PSE
\emph on
n
\emph default
 Partial series expansion of order-
\begin_inset Formula $n$
\end_inset

 (PSE-
\begin_inset Formula $n$
\end_inset

), where 
\begin_inset Quotes eld
\end_inset


\emph on
n
\emph default

\begin_inset Quotes erd
\end_inset

 is a positive integer.
\end_layout

\end_deeper
\begin_layout Paragraph
Solvation Free Energy Corrections
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
gfCorrection
\begin_inset Index idx
status open

\begin_layout Plain Layout
gfCorrection
\end_layout

\end_inset

 [0] Compute the Gaussian fluctuation excess chemical potential functional
 (see §
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:3D-RISM"

\end_inset

).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Off.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 On.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
pcpluscorrection
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
PC+/3D-RISM
\end_layout

\end_inset

 [0] Compute the PC+/3D-RISM excess chemical potential functional (see §
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:rism:Solvation-Free-Energy-Corrections"

\end_inset

).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Off.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 On.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
uccoeff
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
uccoeff
\end_layout

\end_inset

 [0,0,0,0] Compute the UC excess chemical potential functional with the
 provided coefficients (see §
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:rism:Solvation-Free-Energy-Corrections"

\end_inset

).
 
\emph on
a
\emph default
 and 
\emph on
b
\emph default
 are the coefficients for the original UC functional, though using the closure
 excess chemical potential functional.
 
\emph on
a1
\emph default
 and 
\emph on
b1
\emph default
 are optional and provide temperature dependence to the correction (UCT
 in 
\begin_inset CommandInset citation
LatexCommand citep
key "Johnson16"
literal "true"

\end_inset

).
\end_layout

\begin_layout Subparagraph
Fixed Box Size
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ng3
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series medium
ng3
\end_layout

\end_inset

 
\series default
[] Sets the number of grid points for a fixed size solvation box.
 This is only used if 
\family sans
buffer
\family default

\begin_inset Formula $<0$
\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
nx,ny,nz Points for 
\begin_inset Formula $x$
\end_inset

, 
\begin_inset Formula $y$
\end_inset

 and 
\begin_inset Formula $z$
\end_inset

 dimensions.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
solvbox
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series medium
solvbox
\end_layout

\end_inset

 
\series default
[] Sets the size in Å of the fixed size solvation box.
 This is only used if 
\family sans
buffer
\family default

\begin_inset Formula $<0$
\end_inset

.
 See §
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:RISM-Numerical-Accuracy"

\end_inset

 for details on how this affects numerical accuracy and how this interacts
 with 
\family typewriter
ljTolerance
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ljTolerance
\end_layout

\end_inset

, and 
\family typewriter
tolerance
\family default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
tolerance
\end_layout

\end_inset

.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
lx,ly,lz Box length in 
\begin_inset Formula $x$
\end_inset

, 
\begin_inset Formula $y$
\end_inset

 and 
\begin_inset Formula $z$
\end_inset

 dimensions.
\end_layout

\end_deeper
\begin_layout Paragraph
Solution Convergence
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
tolerance
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series medium
tolerance
\end_layout

\end_inset

 
\series default
[1e-5] A list of maximum residual values for solution convergence.
 When used in combination with a list of closures it is possible to define
 different tolerances for each of the closures.
 This can be useful for difficult to converge calculations (see 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:rism_convergence"

\end_inset

 for details).
 For the sake of efficiency, it is best to use as high a tolerance as possible
 for all but the last closure.
 For minimization a tolerance of 1e-11 or lower is recommended.
 See §
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:RISM-Numerical-Accuracy"

\end_inset

 for details on how this affects numerical accuracy and how this interacts
 with 
\family typewriter
ljTolerance
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
ljTolerance
\end_layout

\end_inset

, 
\family typewriter
buffer
\family default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
buffer
\end_layout

\end_inset

, and 
\family typewriter
solvbox
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
solvbox
\end_layout

\end_inset


\family default
.
 Three formats of list are possible.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
one
\begin_inset space ~
\end_inset

tolerance All closures but the last use a tolerance of 1.
 The last tolerance in the list is used by the last closure.
 In practice this, is the most efficient.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
two
\begin_inset space ~
\end_inset

tolerances All closures but the last use the first tolerance in the list.
 The last tolerance in the list is used by the last closure.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $n$
\end_inset


\begin_inset space ~
\end_inset

tolerances Tolerances from the list are assigned to the closure list in
 order.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
ljTolerance
\family typewriter

\begin_inset Index idx
status open

\begin_layout Plain Layout
ljTolerance
\end_layout

\end_inset


\family default
 [-1] Determines the Lennard-Jones cutoff distance based on the desired
 accuracy of the calculation.
 See §
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:RISM-Numerical-Accuracy"

\end_inset

 for details on how this affects numerical accuracy and how this interacts
 with 
\family typewriter
tolerance
\family default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
tolerance
\end_layout

\end_inset

, 
\family typewriter
buffer
\family default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
buffer
\end_layout

\end_inset

, and 
\family typewriter
solvbox
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
solvbox
\end_layout

\end_inset


\family default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
asympKSpaceTolerance
\family typewriter

\begin_inset Index idx
status open

\begin_layout Plain Layout
asympKSpaceTolerance
\end_layout

\end_inset


\family default
\emph on
 
\emph default
[-1] Determines the reciprocal space long range asymptotics cutoff distance
 based on the desired accuracy of the calculation.
 See §
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:RISM-Numerical-Accuracy"

\end_inset

 for details on how this affects numerical accuracy.
 Possible values are
\end_layout

\begin_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $<0$
\end_inset

 
\family typewriter
asympKSpaceTolerance=tolerance/10,
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
0 no cutoff, and
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $>0$
\end_inset

 given value determines the maximum error in the reciprocal-space long range
 asymptotics calculations.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
mdiis_del
\begin_inset Index idx
status open

\begin_layout Plain Layout
mdiis_del
\end_layout

\end_inset

 [0.7] 
\begin_inset Quotes eld
\end_inset

Step size
\begin_inset Quotes erd
\end_inset

 in MDIIS.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
mdiis_nvec
\begin_inset Index idx
status open

\begin_layout Plain Layout

\series medium
mdiis_nvec
\end_layout

\end_inset

 
\series default
[5] Number of vectors used by the MDIIS method.
 Higher values for this parameter can greatly increase memory requirements
 but may also accelerate convergence.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mdiis_restart
\begin_inset Index idx
status open

\begin_layout Plain Layout
mdiis_restart
\end_layout

\end_inset

 [10] If the current residual is 
\family typewriter
mdiis_restart
\family default
 times larger than the smallest residual in memory, then the MDIIS procedure
 is restarted using the lowest residual solution stored in memory.
 Increasing this number can sometimes help convergence.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mdiis_method
\begin_inset Index idx
status open

\begin_layout Plain Layout
mdiis_method
\end_layout

\end_inset

 [2] Specify implementation of the MDIIS routine.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

0 Original.
 For small systems (e.g.
 
\begin_inset Formula $<64^{3}$
\end_inset

 grid points) this implementation may be faster than the BLAS optimized
 version.
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

1 BLAS optimized.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 BLAS and memory optimized.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
maxstep
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
maxstep
\end_layout

\end_inset

 [10000] Maximum number of iterations allowed to converge on a solution.
\family typewriter
nrespa
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
npropagate
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
npropagate
\end_layout

\end_inset

 [5] Number of previous solutions propagated forward to create an initial
 guess for this solute atom configuration.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

0 Do not use any previous solutions
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

1..5 Values greater than 0 but less than 4 or 5 will use less system memory
 but may introduce artifacts to the solution (e.g., energy drift).
\end_layout

\end_deeper
\begin_layout Paragraph
Minimization and Molecular Dynamics
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
zerofrc
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series medium
zerofrc
\end_layout

\end_inset

 
\series default
[1] Redistribute solvent forces across the solute such that the net solvation
 force on the solute is zero.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

0 Unmodified forces.
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

1 Zero net force.
\end_layout

\end_deeper
\begin_layout Paragraph
Trajectory Post-Processing
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
apply_rism_force
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series medium
apply
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

rism
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

force
\end_layout

\end_inset

 
\series default
[1] Calculate and use solvation forces from 3D-RISM.
 Not calculating these forces can save computation time and is useful for
 trajectory post-processing.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

0 Do not calculate forces.
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

1 Calculate forces.
\end_layout

\end_deeper
\begin_layout Paragraph
Output
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
ntwrism
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\series medium
ntwrism
\end_layout

\end_inset

 
\series default
[0] Indicates that solvent density grid should be written to file every
 
\family typewriter
ntwrism
\family default
 iterations.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

0 No files written.
\end_layout

\begin_layout Description
>=
\begin_inset space \space{}
\end_inset

1 Output every 
\family typewriter
ntwrism
\family default
 time steps.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
molReconstruction
\begin_inset Index idx
status open

\begin_layout Plain Layout
molReconstruction
\end_layout

\end_inset

 [0] For any thermodynamic distributions requested, also out the molecular
 reconstruction (see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Molecular-Reconstruction"

\end_inset

).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
volfmt
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
volfmt
\end_layout

\end_inset

 [`mrc'] Format of volumetric data files.
 May be 
\family sans
mrc
\family default
, 
\family sans
ccp4
\family default
, 
\family sans
dx
\family default
 or 
\family sans
xyzv
\family default
 (see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:RISM-File-Formats"

\end_inset


\begin_inset Note Note
status open

\begin_layout Plain Layout
\begin_inset CommandInset href
LatexCommand href
name "https://ambermd.org/FileFormats.php"
target "https://ambermd.org/FileFormats.php"
literal "false"

\end_inset


\end_layout

\end_inset

).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
verbose
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
verbose
\end_layout

\end_inset

 [0] Indicates level of diagnostic detail about the calculation written
 to the log file.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space \space{}
\end_inset

0 No output.
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

1 Print the number of iterations used to converge.
\end_layout

\begin_layout Description
=
\begin_inset space \space{}
\end_inset

2 Print details for each iteration and information about what FCE is doing
 every 
\family typewriter
progress
\family default
 iterations.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
write_thermo
\series default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
write_thermo
\end_layout

\end_inset

 [1] Print solvation thermodynamics in addition to standard 
\family sans
\shape italic
\emph on
sander
\family default
\shape default
\emph default
 output.
 The format is the same as that found in 
\shape italic
\emph on
NAB
\shape default
\emph default
 and 
\family sans
\shape italic
\emph on
rism3d.snglpnt
\family default
\shape default
\emph default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
polarDecomp
\series default

\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
polarDecomp
\end_layout

\end_inset

 [0] Decomposes solvation free energy into polar and non-polar components.
 Note that this typically requires 80% more computation time.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 No polar/non-polar decomposition.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Polar/non-polar decomposition.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
progress
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
progress
\end_layout

\end_inset

 [1] Display progress of the 3D-RISM solution every 
\family typewriter
kshow
\family default
 iterations.
 0 indicates this information will not be displayed.
 Must be used with 
\begin_inset Formula $\mathtt{verbose}>1$
\end_inset

.
\end_layout

\begin_layout Subsubsection

\family typewriter
Example
\end_layout

\begin_layout Paragraph
Molecular Dynamics (
\family typewriter
imin=0
\family default
)
\end_layout

\begin_layout LyX-Code
molecular dynamics with 3D-RISM and impulse MTS
\end_layout

\begin_layout LyX-Code
&cntrl
\end_layout

\begin_layout LyX-Code
    ntx=1, ntpr=100, ntwx=1000,ntwr=10000,
\end_layout

\begin_layout LyX-Code
    nstlim=10000,dt=0.001,                !No shake or r-RESPA
\end_layout

\begin_layout LyX-Code
    ntt=3, temp0=300, gamma_ln=20,        !Langevin dynamics
\end_layout

\begin_layout LyX-Code
    ntb=0,                                !Non-periodic
\end_layout

\begin_layout LyX-Code
    cut=999.,                             !Calculate all 
\end_layout

\begin_layout LyX-Code
                                          !solute-solute
\end_layout

\begin_layout LyX-Code
                                          !interactions
\end_layout

\begin_layout LyX-Code
    irism=1,
\end_layout

\begin_layout LyX-Code
/ 
\end_layout

\begin_layout LyX-Code
&rism
\end_layout

\begin_layout LyX-Code
    rismnrespa=5,                         !r-RESPA MTS 
\end_layout

\begin_layout LyX-Code
    fcenbasis=10,fcestride=2,fcecrd=2     !FCE MTS
\end_layout

\begin_layout LyX-Code
/ 
\end_layout

\begin_layout Paragraph
Minimization (
\family typewriter
imin=1
\family default
)
\end_layout

\begin_layout LyX-Code
Default XMIN minimization with 3D-RISM
\end_layout

\begin_layout LyX-Code
&cntrl
\end_layout

\begin_layout LyX-Code
    imin=1, maxcyc=200,
\end_layout

\begin_layout LyX-Code
    drms=1e-3,          !RMS force.
 Can be as low as 1e-4
\end_layout

\begin_layout LyX-Code
    ntmin=3,            !XMIN
\end_layout

\begin_layout LyX-Code
    ntpr=5,
\end_layout

\begin_layout LyX-Code
    ntb=0,              !Non-periodic
\end_layout

\begin_layout LyX-Code
    cut=999.,           !Calculate all 
\end_layout

\begin_layout LyX-Code
                        !solute-solute interactions
\end_layout

\begin_layout LyX-Code
    irism=1
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout LyX-Code
&rism
\end_layout

\begin_layout LyX-Code
    tolerance=1e-11,    !Low tolerance
\end_layout

\begin_layout LyX-Code
    solvcut=9999,       !No cut-off for 
\end_layout

\begin_layout LyX-Code
                        !solute-solvent interactions
\end_layout

\begin_layout LyX-Code
    centering=2         !Solvation box centering 
\end_layout

\begin_layout LyX-Code
                        !using center-of-geometry
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Paragraph
Trajectory Post-Processing (
\family typewriter
imin=5
\family default
)
\end_layout

\begin_layout LyX-Code
Trajectory post-processing with 3D-RISM
\end_layout

\begin_layout LyX-Code
&cntrl
\end_layout

\begin_layout LyX-Code
    ntx=1, ntpr=1, ntwx=1,
\end_layout

\begin_layout LyX-Code
    imin=5,maxcyc=1,       !Single-point energy calculation
\end_layout

\begin_layout LyX-Code
                           !on each frame
\end_layout

\begin_layout LyX-Code
    ntb=0,                 !Non-periodic
\end_layout

\begin_layout LyX-Code
    cut=9999.,             !Calculate all 
\end_layout

\begin_layout LyX-Code
                           !solute-solute interactions
\end_layout

\begin_layout LyX-Code
    irism=1
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout LyX-Code
&rism
\end_layout

\begin_layout LyX-Code
    tolerance=1e-4,        !Saves some time compared to 1e-5
\end_layout

\begin_layout LyX-Code
    apply_rism_force=0,    !Saves some time.
 Forces are not used.
\end_layout

\begin_layout LyX-Code
    npropagate=1           !Saves some time and 4*8*Nbox bytes
\end_layout

\begin_layout LyX-Code
                           !of memory compared to npropagate=5.
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Chapter
\begin_inset CommandInset label
LatexCommand label
name "cha:sqm"

\end_inset

sqm: Semi-empirical quantum chemistry
\end_layout

\begin_layout Standard

\family sans
AmberTools
\family default
 contains its own quantum chemistry program, called 
\emph on
sqm
\emph default
.
 This is code extracted from the QM/MM portions of 
\emph on
sander
\emph default
, but is limited to 
\begin_inset Quotes eld
\end_inset

pure QM
\begin_inset Quotes erd
\end_inset

 calculations.
 A principal current use is as a replacement for MOPAC for deriving AM1-bcc
 charges, but the code is much more general than that.
 Presently, it is limited to single point calculations and energy minimizations
 (geometry optimizations) for closed-shell systems.
 It supports a wide variety of semi-empirical Hamiltonians, including many
 recent ones.
 An external electric field generated by a set of point charges can be included
 for single point calculations.
 Our plan is to add capabilities to subsequent versions.
 The major contributors are as follows:
\end_layout

\begin_layout Itemize
The original semi-empirical support was written by Ross Walker, Mike Crowley,
 and Dave Case,
\begin_inset CommandInset citation
LatexCommand cite
key "Walker08"
literal "true"

\end_inset

 based on public-domain MOPAC codes of J.J.P.
 Stewart.
\end_layout

\begin_layout Itemize
DFTB2 (SCC-DFTB) support was written by Gustavo Seabra, Ross Walker and
 Adrian Roitberg,
\begin_inset CommandInset citation
LatexCommand cite
key "Seabra07"
literal "true"

\end_inset

 and is based on earlier work of Marcus Elstner.
\begin_inset CommandInset citation
LatexCommand cite
key "Elstner98,Kruger05"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
Support for diagonal third-order corrections to SCC-DFTB was written by
 Gustavo Seabra and Josh Mcclellan.
\end_layout

\begin_layout Itemize
DFTB3 was added by Andreas Goetz.
\end_layout

\begin_layout Itemize
Various SCF convergence schemes were added by Tim Giese and Darrin York.
\end_layout

\begin_layout Itemize
The PM6 Hamiltonian was added by Andreas Goetz and dispersion and hydrogen
 bond corrections were added by Andreas Goetz and Kyoyeon Park.
 
\end_layout

\begin_layout Itemize
The extension for MNDO type Hamiltonians to support d orbitals was written
 by Tai-Sung Lee, Darrin York and Andreas Goetz.
\end_layout

\begin_layout Itemize
The charge-dependent exchange-dispersion corrections of vdW interactions
\begin_inset CommandInset citation
LatexCommand cite
key "Giese07"
literal "true"

\end_inset

 was contributed by Tai-Sung Lee, Tim Giese, and Darrin York.
\end_layout

\begin_layout Itemize
Support for reading user-defined parameters for NDDO methods was added by
 Tai-Sung Lee and Darrin York.
\end_layout

\begin_layout Standard
The DFTB/DFTB2 code was originally based on the DFT/DYLAX code by Marcus
 Elstner 
\shape italic
et al.
\shape default
, but has since been extensively re-written and optimized.
 The DFTB3 implementation is an extension of this code.
\end_layout

\begin_layout Section
Available Hamiltonians
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
sloppy 
\end_layout

\end_inset

 Available MNDO-type semi-empirical Hamiltonians are PM3,
\begin_inset CommandInset citation
LatexCommand cite
key "Stewart89"
literal "true"

\end_inset

 AM1,
\begin_inset CommandInset citation
LatexCommand cite
key "Dewar85"
literal "true"

\end_inset

 RM1,
\begin_inset CommandInset citation
LatexCommand cite
key "Rocha06"
literal "true"

\end_inset

 MNDO,
\begin_inset CommandInset citation
LatexCommand cite
key "Dewar77"
literal "true"

\end_inset

 PDDG/PM3,
\begin_inset CommandInset citation
LatexCommand cite
key "Repasky02"
literal "true"

\end_inset

 PDDG/MNDO,
\begin_inset CommandInset citation
LatexCommand cite
key "Repasky02"
literal "true"

\end_inset

 PM3CARB1,
\begin_inset CommandInset citation
LatexCommand cite
key "McNamara04"
literal "true"

\end_inset

, PM3-MAIS
\begin_inset CommandInset citation
LatexCommand cite
key "BR00,ARB07"
literal "true"

\end_inset

, MNDO/d
\begin_inset CommandInset citation
LatexCommand citep
key "TV92,TV96,TV96a"
literal "true"

\end_inset

, AM1/d (Mg from AM1/d
\begin_inset CommandInset citation
LatexCommand cite
key "Imhof06"
literal "true"

\end_inset

 and H, O, and P from AM1/d-PhoT
\begin_inset CommandInset citation
LatexCommand cite
key "Nam07"
literal "true"

\end_inset

) and PM6
\begin_inset CommandInset citation
LatexCommand citep
key "Stewart07"
literal "true"

\end_inset

.
 
\end_layout

\begin_layout Standard
Also available is the density functional theory-based tight-binding (DFTB)
 Hamiltonian
\begin_inset CommandInset citation
LatexCommand cite
key "Seabra07,Porezag95,Seifert96"
literal "true"

\end_inset

 and its self-consistent-charge version with Taylor expansion up to second
 order (SCC-DFTB or DFTB2)
\begin_inset CommandInset citation
LatexCommand cite
key "Elstner98"
literal "true"

\end_inset

 and third-order (DFTB3)
\begin_inset CommandInset citation
LatexCommand citep
key "Gaus2011"
literal "true"

\end_inset

.
 If you use the mio-1-1 parameters for DFTB2, you can add an empirical correctio
n for dispersion effects
\begin_inset CommandInset citation
LatexCommand cite
key "Elstner01"
literal "true"

\end_inset

 and calculate CM3 charges
\begin_inset CommandInset citation
LatexCommand cite
key "Kalinowski04"
literal "true"

\end_inset

 (both only for elements H, C, N, O, S, P).
 Diagonal third-order corrections are available for DFTB2
\begin_inset CommandInset citation
LatexCommand cite
key "Yang07"
literal "true"

\end_inset

 with mio-1-1 parameters but it is recommended to perform full DFTB3 simulations
 instead.
 Neither dispersion corrections nor halogen corrections are implemented
 for DFTB3.
\end_layout

\begin_layout Standard
The elements supported by each QM method are:
\end_layout

\begin_layout Itemize
MNDO: H, Li, Be, B, C, N, O, F, Al, Si, P, S, Cl, Zn, Ge, Br, Cd, Sn, I,
 Hg, Pb
\end_layout

\begin_layout Itemize
MNDO/d: H, Li, Be, B, C, N, O, F, Na, Mg, Al, Si, P, S, Cl, Zn, Ge, Br,
 Sn, I, Hg, Pb
\end_layout

\begin_layout Itemize
AM1: H, C, N, O, F, Al, Si, P, S, Cl, Zn, Ge, Br, I, Hg
\end_layout

\begin_layout Itemize
AM1/d: H, C, N, O, F, Mg, Al, Si, P, S, Cl, Zn, Ge, Br, I, Hg
\end_layout

\begin_layout Itemize
PM3: H, Be, C, N, O, F, Mg, Al, Si, P, S, Cl, Zn, Ga, Ge, As, Se, Br, Cd,
 In, Sn, Sb, Te, I, Hg, Tl, Pb, Bi
\end_layout

\begin_layout Itemize
PDDG/PM3: H, C, N, O, F, Si, P, S, Cl, Br, I
\end_layout

\begin_layout Itemize
PDDG/MNDO: H, C, N, O, F, Cl, Br, I
\end_layout

\begin_layout Itemize
RM1: H, C, N, O, P, S, F, Cl, Br, I
\end_layout

\begin_layout Itemize
PM3CARB1: H, C, O
\end_layout

\begin_layout Itemize
PM3-MAIS: H, O, Cl
\end_layout

\begin_layout Itemize
PM6: H, He, Li, Be, B, C, N, O, F, Ne, Na, Mg, Al, Si, P, S, Cl, Ar, K,
 Ca, Sc, Ti, V, Cr, Mn, Fe, Co, Ni, Cu, Zn, Ga, Ge, As, Se, Br, Kr, Rb,
 Sr, Y, Zr, Nb, Mo, Tc, Ru, Rh, Pd, Ag, Cd, In, Sn, Sb, Te, I, Xe, Cs, Ba,
 La, Lu, Hf, Ta, W, Re, Os, Ir, Pt, Au, Hg, Tl, Pb, Bi
\end_layout

\begin_layout Itemize
DFTB/DFTB2/DFTB3: (Any atoms for which parameters are available from 
\emph on
www.dftb.org
\emph default
)
\end_layout

\begin_layout Standard
The PM6 implementation has not been extensively tested for all available
 elements.
 Please check your results carefully, possibly by comparison to other codes
 that implement PM6, if transition metal elements are present.
 SCF convergence may be more difficult to achieve for transition metal elements
 with partially filled valence shells.
 
\end_layout

\begin_layout Standard
If the PM6 Hamiltonian is used in a QM/MM simulation with 
\emph on
sander
\emph default
 using electrostatic embedding (see 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:QMMM"

\end_inset

) or if an electric field of external point charges is used, then the electrosta
tic interactions between QM and MM atoms are modeled using the MNDO type
 core repulsion function for interactions between QM and MM atoms.
 Parameters for the exponents 
\begin_inset Formula $\alpha$
\end_inset

 of the QM atoms are taken from PM3 (a default value of five is used for
 the exponents 
\begin_inset Formula $\alpha$
\end_inset

 of the MM atoms as is the case for MNDO, AM1 and PM3).
 Since PM3 does not have parameters for all elements that are supported
 by PM6, the missing exponents were defined in an ad hoc manner (see the
 source code in $AMBERHOME/AmberToosl/src/sqm/qm2_parameters.F90, variable
 alp_pm6).
 The magnitude of the coefficients 
\begin_inset Formula $\alpha$
\end_inset

 is probably not critical for the accuracy of QM/MM calculations but this
 should be tested on a case by case basis.
 This does not affect QM calculations with 
\emph on
sqm
\emph default
.
\end_layout

\begin_layout Subsection
DFTB parameter files
\end_layout

\begin_layout Standard
In order to use DFTB2 or DFTB3 (
\shape italic
qm_theory=DFTB
\shape default
2 or 
\emph on
DFTB3
\emph default
) a set of integral parameter files is required.
 The mio-1-1 parameter files for DFTB2 and 3ob-3-1 parameter files are distribut
ed with Amber under a Creative Commons Attribution-ShareAlike 4.0 International
 License, see http://creativecommons.org/licenses/by-sa/4.0/.
 The parameters were obtained from the website 
\emph on
www.dftb.
\emph default
org
\emph on
 
\emph default
on February 22, 2017.
 You may want to check if there are any updates to the parameters.
 If you perform DFTB simulations, in addition to Amber please cite the publicati
ons describing the QM/MM and DFTB implementations as well as following reference
s for the DFTB parameters:
\end_layout

\begin_layout Standard
When using DFTB2 with mio-1-1 and following elements:
\end_layout

\begin_layout Itemize
O, N, C, H: M.
 Elstner, D.
 Porezag, G.
 Jungnickel, J.
 Elsner, M.
 Haugk, Th.
 Frauenheim, S.
 Suhai, G.
 Seifert, 
\emph on
Phys.
 Rev.
 B
\emph default
 
\series bold
58
\series default
 (1998) 7260.
\end_layout

\begin_layout Itemize
S: T.
 A.
 Niehaus, M.
 Elstner, Th.
 Fruanheim, S.
 Suhai, 
\emph on
J.
 Molec.
 Struct.
 (THEOCHEM)
\emph default
 
\series bold
541
\series default
 (2001) 185.
\end_layout

\begin_layout Itemize
P: M.
 Gaus, Q.
 Cui, M.
 Elstner, 
\emph on
J.
 Chem.
 Theory Comput.

\emph default
 
\series bold
7
\series default
 (2011) 931-948.
\end_layout

\begin_layout Standard
When using DFTB3 with 3ob-3-1 and following elements:
\end_layout

\begin_layout Itemize
O, N, C, H: M.
 Gaus, A.
 Goez, M.
 Elstner, 
\emph on
J.
 Chem.
 Theory Comput.
 
\series bold
\emph default
9
\series default
 (2013) 338-354.
\end_layout

\begin_layout Itemize
P, S: M.
 Gaus, X.
 Lu, M.
 Elstner, Q.
 Cui, 
\emph on
J.
 Chem.
 Theory Comput.
 
\series bold
\emph default
10 
\series default
(2014) 1518-1537.
\end_layout

\begin_layout Itemize
Mg, Zn: X.
 Lu, M.
 Gaus, M.
 Elstner, Q.
 Cui, 
\emph on
J.
 Phys.
 Chem.
 B
\emph default
 
\series bold
119 
\series default
(2015) 1062-1082.
\end_layout

\begin_layout Itemize
Na, F, K, Ca, Cl, Br, I: M.
 Kubillus, T.
 Kubar, M.
 Gaus, J.
 Rezac, M.
 Esltner, 
\emph on
J.
 Chem.
 Theory Comput.
 
\series bold
\emph default
11 
\series default
(2015) 332-342.
\end_layout

\begin_layout Standard
Additional parameter files can be obtained from the website 
\emph on
www.dftb.org
\emph default
.
 By default it is assumed that DFTB2 uses the mio-1-1 parameter set and
 DFTB3 the 3ob-3-1 parameter set and that the corresponding files with extension
 
\emph on
.skf
\emph default
 reside in the directories 
\shape italic
$AMBERHOME/dat/slk
\shape default
o/
\emph on
mio-1-1
\emph default
 and 
\shape italic
$AMBERHOME/dat/slk
\shape default
o/
\emph on
3ob-3-1
\emph default
.
 If you want to use other parameter sets and/or put the parameter files
 in other directories then you have to specify the location in the input
 file (keyword 
\emph on
dftb_slko_path, 
\emph default
see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:qmmm-Namelist"

\end_inset

 for details).
\end_layout

\begin_layout Standard
Following parameter files for use with DFTB2 and the mio-1-1 parameter set
 are also distributed with AmberTools: Dispersion parameters for H, C, N,
 O, P and S are available in the file 
\shape italic
$AMBERHOME/dat/slko/mio-1-1/DISPERSION.INP_ONCHSP
\shape default
, CM3 parameters for the same atoms are in the file 
\shape italic
$AMBERHOME/dat/slko/mio-1-1/CM3_PARAMETERS.DAT
\shape default
 file, and two parametrizations for diagonal third-order SCC-DFTB terms
 (SCC-DFTB-PA and SCC-DFTB-PR) are in the files 
\emph on
DFTB_3RD_ORDER_PA.DAT
\emph default
 and 
\emph on
DFTB_3RD_ORDER_PR.DAT
\emph default
, both located in the same directory.
\end_layout

\begin_layout Section
Dispersion and hydrogen bond correction
\end_layout

\begin_layout Standard
An empirical dispersion and hydrogen bonding correction is implemented for
 the MNDO type Hamiltonians AM1 and PM6
\begin_inset CommandInset citation
LatexCommand citep
key "Korth10"
literal "true"

\end_inset

.
 The empirical dispersion correction follows the formalism for DFT-D
\begin_inset CommandInset citation
LatexCommand citep
key "JCHS07"
literal "true"

\end_inset

 and consists of a physically sound 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$r^{-6}$
\end_layout

\end_inset

 term that is damped at short distances to avoid the short-range repulsion
 which can be written as 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 E_{
\backslash
mathrm dis}=-s_6
\backslash
sum_{ij}f_{
\backslash
mathrm damp}(r_{ij},R_{ij}^0)C_{6,ij}r_{ij}^{-6},
\end_layout

\begin_layout Plain Layout


\backslash
end{equation}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$r_{ij}$
\end_layout

\end_inset

 is the distance between two atoms 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$i$
\end_layout

\end_inset

 and 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$j$
\end_layout

\end_inset

, 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$R_{ij}^0$
\end_layout

\end_inset

 is the equilibrium van der Waals (vdW) separation derived from the atomic
 vdW radii, 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$C_{6,ij}$
\end_layout

\end_inset

 the dispersion coefficient, and 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$s_6$
\end_layout

\end_inset

 a general scaling factor.
 The damping function is given as
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 f_{
\backslash
mathrm damp}(r_{ij},R_{ij}^0)=
\backslash
left[     1+
\backslash
exp
\backslash
left(-
\backslash
alpha
\backslash
frac{r_{ij}}{s_RR_{ij}^0}-1
\backslash
right)
\backslash
right]^{-1}.
 
\backslash
end{equation} 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Bondi vdW radii
\begin_inset CommandInset citation
LatexCommand citep
key "Bondi64"
literal "true"

\end_inset

 are used and for a pair of unlike atoms we have
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 R_{ij}^0=
\backslash
frac{{R_{ii}^0}^3+{R_{jj}^0}^3}{{R_{ii}^0}^2+{R_{jj}^0}^2}.
 
\backslash
end{equation}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
For the 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$C_6$
\end_layout

\end_inset

 coefficients the following equation is used, 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 C_{6,ij}=2
\backslash
frac{(C_{6,ii}^2C_{6,jj}^2N_{{
\backslash
mathrm eff},i}N_{{
\backslash
mathrm eff},j})^{1/3}} {(C_{6,ii}N_{{
\backslash
mathrm eff},j}^2)^{1/3}+(C_{6,jj}N_{{
\backslash
mathrm eff},i}^2)^{1/3}},
\end_layout

\begin_layout Plain Layout


\backslash
end{equation}
\end_layout

\end_inset

 where the Slater-Kirkwood effective number of electrons 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$N_{{
\backslash
mathrm eff},i}$
\end_layout

\end_inset

 and the 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$C_6$
\end_layout

\end_inset

 coefficients can easily be found in the literature
\begin_inset CommandInset citation
LatexCommand citep
key "JCHS07"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
An empirical hydrogen bonding correction
\begin_inset CommandInset citation
LatexCommand citep
key "Korth10"
literal "true"

\end_inset

 that is transferable among different semiempirical Hamiltonians and has
 been parametrized for use with the dispersion correction described above
 is also available.
 This correction does not make the assumption of a specific acceptor/hydrogen/do
nor binding situation.
 Instead it considers the hydrogen bond as a charge-independent atom- atom
 term between two atoms capable of serving as an acceptor or donor (for
 example, O, N) and weights this by a function that accounts for the steric
 arrangement of the two atoms and the favorable positioning of a hydrogen
 atom inbetween.
 A damping function corrects for long- and short-range behavior, 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 E_{
\backslash
mathrm H-bond}=
\backslash
frac{C_{AB}}{r^2_{AB}}f_{
\backslash
mathrm geom}f_{
\backslash
mathrm damp},
\end_layout

\begin_layout Plain Layout


\backslash
end{equation} 
\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 
\backslash
label{e:fgeom}   f_{
\backslash
mathrm geom}=
\backslash
cos(
\backslash
theta_A)^2
\backslash
cos(
\backslash
phi_A)^2
\backslash
cos(
\backslash
psi_A)^2   
\backslash
cos(
\backslash
phi_B)^2
\backslash
cos(
\backslash
phi_B)^2
\backslash
cos(
\backslash
psi_B)^2f_{
\backslash
mathrm bond},
\end_layout

\begin_layout Plain Layout


\backslash
end{equation}
\end_layout

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 f_{
\backslash
mathrm bond}=1-
\backslash
frac{1}{1+
\backslash
exp[-60(r_{
\backslash
mathrm XH}/1.2-1)]},
\end_layout

\begin_layout Plain Layout


\backslash
end{equation}
\end_layout

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 f_{
\backslash
mathrm damp}=
\backslash
left(
\backslash
frac{1}{1+
\backslash
exp[-100(r_{AB}/2.4-1)]}
\backslash
right)   
\backslash
left(1-
\backslash
frac{1}{1+
\backslash
exp[-10(r_{
\backslash
mathrm AB}/7.0-1)]}
\backslash
right),
\end_layout

\begin_layout Plain Layout


\backslash
end{equation}
\end_layout

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

 C_{
\backslash
mathrm AB}=
\backslash
frac{C_{
\backslash
mathrm A}+C_{
\backslash
mathrm B}}{2}.
\end_layout

\begin_layout Plain Layout


\backslash
end{equation} 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Here, 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$C_{
\backslash
mathrm A}$
\end_layout

\end_inset

 and 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$C_{
\backslash
mathrm B}$
\end_layout

\end_inset

 are the atomic hydrogen bonding correction parameters and the (torsion)
 angles in the function 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$f_{
\backslash
mathrm geom}$
\end_layout

\end_inset

 are defined similarly to an earlier hydrogen bond correction
\begin_inset CommandInset citation
LatexCommand citep
key "KPRH10"
literal "true"

\end_inset

.
 
\end_layout

\begin_layout Standard
The hydrogen bond correction can be used both for single point energy calculatio
ns or geometry optimizations with SQM and for molecular dynamics simulations
 with SANDER.
 However, we do not recommend the use for molecular dynamics at present
 since cutoffs needed to be implemented for the calculation of 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$f_{
\backslash
mathrm geom}$
\end_layout

\end_inset

 of equation 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
eqref{e:fgeom}
\end_layout

\end_inset

.
 This and some other conditional evaluations give rise to discontinuities
 in the potential energy surface and thus make this method unattractive
 for MD simulations.
\end_layout

\begin_layout Section

\series bold
Usage
\begin_inset CommandInset label
LatexCommand label
name "sec:qmmm-Namelist"

\end_inset


\end_layout

\begin_layout Standard
The 
\emph on
sqm
\emph default
 program uses the following simple command line:
\end_layout

\begin_layout LyX-Code
sqm [-O] -i <input-file> -o <output-file>
\end_layout

\begin_layout Standard

\emph on
mdin
\emph default
 is the default input-file name, and 
\emph on
mdout
\emph default
 is the default output-file name.As in other Amber programs, the 
\begin_inset Quotes eld
\end_inset

-O
\begin_inset Quotes erd
\end_inset

 flag allows the program to over-write the output file.
\end_layout

\begin_layout Standard
An example input file for running a simple minimization is shown here:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Run semi-empirical minimization 
\end_layout

\begin_layout Plain Layout

 &qmmm  
\end_layout

\begin_layout Plain Layout

  qm_theory='AM1',   qmcharge=0, 
\end_layout

\begin_layout Plain Layout

 /
\end_layout

\begin_layout Plain Layout

    6    CG       -1.9590        0.1020        0.7950
\end_layout

\begin_layout Plain Layout

    6   CD1       -1.2490        0.6020       -0.3030
\end_layout

\begin_layout Plain Layout

    6   CD2       -2.0710        0.8650        1.9630
\end_layout

\begin_layout Plain Layout

    6   CE1       -0.6460        1.8630       -0.2340
\end_layout

\begin_layout Plain Layout

    6    C6       -1.4720        2.1290        2.0310
\end_layout

\begin_layout Plain Layout

    6    CZ       -0.7590        2.6270        0.9340
\end_layout

\begin_layout Plain Layout

    1   HE2       -1.5580        2.7190        2.9310
\end_layout

\begin_layout Plain Layout

   16   S15       -2.7820        0.3650        3.0600
\end_layout

\begin_layout Plain Layout

    1   H19       -3.5410        0.9790        3.2740
\end_layout

\begin_layout Plain Layout

    1   H29       -0.7870       -0.0430       -0.9380
\end_layout

\begin_layout Plain Layout

    1   H30        0.3730        2.0450       -0.7840
\end_layout

\begin_layout Plain Layout

    1   H31       -0.0920        3.5780        0.7810
\end_layout

\begin_layout Plain Layout

    1   H32       -2.3790       -0.9160        0.9010
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The 
\emph on
&qmmm
\emph default
 namelist contains variables that allow you to control the options used.
 Following that is one line per atom, giving the atomic number, atom name,
 and Cartesian coordinates (free format).
 The variables in the 
\emph on
&qmmm
\emph default
 namelist are these:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qm_theory
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

theory
\end_layout

\end_inset

 Level of theory to use for the QM region of the simulation (Hamiltonian).
 Default is to use the semi-empirical Hamiltonian PM3.
 Options are AM1, RM1, MNDO, PM3-PDDG, MNDO-PDDG, PM3-CARB1, MNDO/d (same
 as MNDOD), AM1/d (same as AM1D), PM6, DFTB2 (same as DFTB), and DFTB3.
 The dispersion correction can be switched on for AM1 and PM6 by choosing
 AM1-D* and PM6-D, respectively.
 The dispersion and hydrogen bond correction will be applied for AM1-DH+
 and PM6-DH+.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dftb_slko_path
\begin_inset Index idx
status open

\begin_layout Plain Layout
dftb_slko_path
\end_layout

\end_inset

 Path to the DFTB Slater-Koster parameter files.
 Defaults to '$AMBERHOME/dat/slko/mio-1-1/' for DFTB2 and '$AMBERHOME/dat/slko/3
ob-3-1/' for DFTB3.
 You can specify a different directory here, which is assumed to be a subdirecto
ry of '$AMBERHOME/dat/slko/' unless you specify an absolute path.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dftb_disper
\begin_inset Index idx
status open

\begin_layout Plain Layout
dftb_disper
\end_layout

\end_inset

 Flag turning on (1) or off (0) the use of a dispersion correction to the
 DFTB2 energy (only for mio-1-1 parameters).
 Requires 
\shape italic
qm_theory=DFTB2.

\shape default
 It is assumed that you have the file DISPERSION.INP_ONCHSP in your $AMBERHOME/da
t/slko/mio-1-1 directory.
 This file must be downloaded from the website www.dftb.org, as described
 in the beginning of this chapter.
 Only available for elements H, C, O, N, P, S.
 (Default = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dftb_3rd_order
\begin_inset Index idx
status open

\begin_layout Plain Layout
dftb_3rd_order
\end_layout

\end_inset

 Third order diagonal corrections to DFTB2 with mio-1-1 parameters.
 Default='' (the empty string which means no third order correction).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

'PA' Use the SCC-DFTB-PA parametrization, which was developed for proton
 affinities.
 The parameters will be read from the 
\emph on
$AMBERHOME/dat/slko/DFTB_3RD_ORDER_PA.DAT
\emph default
 file.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

'PR' Use the SCC-DFTB-PR parametrization, which was developed for phosphate
 hydrolysis reactions.
 The parameters will be read from the 
\emph on
$AMBERHOME/dat/slko/DFTB_3RD_ORDER_PR.DAT
\emph default
 file.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

'READ' Parameters will be read from the 
\emph on
mdin
\emph default
 file, in a separate 
\begin_inset Quotes eld
\end_inset

dftb_3rd_order
\begin_inset Quotes erd
\end_inset

 namelist, which must have the same format as the files above.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

'
\emph on
filename
\emph default
' Parameters will be read from the file specified by 
\emph on
filename
\emph default
, in the 
\begin_inset Quotes eld
\end_inset

dftb_3rd_order
\begin_inset Quotes erd
\end_inset

 namelist, which must have the same format as the files above.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
dftb_chg
\begin_inset Index idx
status open

\begin_layout Plain Layout
dftb_chg
\end_layout

\end_inset

 Flag to choose the type of charges to report when doing a DFTB calculation.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (default) - Print Mulliken charges.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Print CM3 charges.
 Only available for DFTB2 with mio-1-1 parameters for elements H, C, N,
 O, S and P.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
dftb_telec
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dftb_telec
\end_layout

\end_inset

 Electronic temperature, in K, used to accelerate SCC convergence in DFTB
 calculations.
 The electronic temperature affects the Fermi distribution promoting some
 HOMO/LUMO mixing, which can accelerate the convergence in difficult cases.
 In most cases, a low 
\shape italic
telec
\shape default
 (around 100K) is enough.
 Should be used only when necessary, and the results checked carefully.
 Default: 0.0K 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dftb_maxiter
\begin_inset Index idx
status open

\begin_layout Plain Layout
dftb_maxiter
\end_layout

\end_inset

 Maximum number of SCC iterations before resetting Broyden in DFTB calculations.
 (default: 70 )
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qmcharge
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmcharge
\end_layout

\end_inset

 Charge on the QM system in electron units (must be an integer).
 (Default = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
spin
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
spin
\end_layout

\end_inset

 Multiplicity of the QM system.
 Currently only singlet calculations are possible and so the default value
 of 1 is the only available option.
 Note that this option is ignored by DFTB/SCC-DFTB, which allows only ground
 state calculations.
 In this case, the spin state will be calculated from the number of electrons
 and orbital occupancy.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qmqmdx
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmqmdx
\end_layout

\end_inset

 Flag for whether to use analytical or numerical derivatives of the semiempirica
l electron repulsion integrals.
 The default (and recommended) option is to use ANALYTICAL QM-QM derivatives.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

1 (default) - Use analytical derivatives for QM-QM forces.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Use numerical derivatives for QM-QM forces.
 Note: the numerical derivative code has not been optimised as aggressively
 as the analytical code and as such is significantly slower.
 Numerical derivatives are intended mainly for testing purposes.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
verbosity
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
verbosity
\end_layout

\end_inset

 Controls the verbosity of QM/MM related output.
 
\shape italic
Warning:
\shape default
 Values of 2 or higher will produce a 
\shape italic
lot
\shape default
 of output.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (default) - only minimal information is printed - Initial QM geometry
 and link atom positions as well as the SCF energy at every ntpr steps.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Print SCF energy at every step to many more significant figures than usual.
 Also print the number of SCF cycles needed on each step.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 As 1 and also print info about memory reallocations, number of pairs per
 QM atom, QM core - QM core energy, QM core - MM atom energy, and total
 energy.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 As 2 and also print SCF convergence information at every step.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 As 3 and also print forces on the QM atoms due to the SCF calculation
 and the coordinates of the link atoms at every step.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 As 4 and also print all of the info in kJ/mol as well as kcal/mol.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
tight_p_conv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
tight
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

p
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

conv
\end_layout

\end_inset

 Controls the tightness of the convergence criteria on the density matrix
 in the SCF.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=0 (default) - loose convergence on the density matrix (or Mulliken charges,
 in case of a SCC-DFTB calculation).
 SCF will converge if the energy is converged to within scfconv and the
 largest change in the density matrix is within 0.05*sqrt(scfconv).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Tight convergence on density(or Mulliken charges, in case of a SCC-DFTB
 calculation).
 Use same convergence (scfconv) for both energy and density (charges) in
 SCF.
 Note: in the SCC-DFTB case, this option can lead to instabilities.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
scfconv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
scfconv
\end_layout

\end_inset

 Controls the convergence criteria for the SCF calculation, in kcal/mol.
 In order to conserve energy in a dynamics simulation with no thermostat
 it is often necessary to use a convergence criterion of 1.0d-9 or tighter.
 Note, the tighter the convergence the longer the calculation will take.
 Values tighter than 1.0d-11 are not recommended as these can lead to oscillation
s in the SCF, due to limitations in machine precision, that can lead to
 convergence failures.
 Default is 1.0d-8 kcal/mol.
 Minimum usable value is 1.0d-14.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
pseudo_diag
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
pseudo
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

diag
\end_layout

\end_inset

 Controls the use of 'fast' pseudo diagonalisations in the SCF routine.
 By default the code will attempt to do pseudo diagonalisations whenever
 possible.
 However, if you experience convergence problems then turning this option
 off may help.
 Not available for DFTB/SCC-DFTB.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Always do full diagonalisation.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Do pseudo diagonalisations when possible (default).
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
pseudo_diag_criteria
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
pseudo
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

diag
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

criteria
\end_layout

\end_inset

 Float controlling criteria used to determine if a pseudo diagonalisation
 can be done.
 If the difference in the largest density matrix element between two SCF
 iterations is less than this criteria then a pseudo diagonalisation can
 be done.
 This is really a tuning parameter designed for expert use only.
 Most users should have no cause to adjust this parameter.
 (Not applicable to DFTB/SCC-DFTB calculations.) Default = 0.05 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
diag_routine
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
diag
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

routine
\end_layout

\end_inset

 Controls which diagonalization routine will be used during the SCF procedure.
 This is an advanced option to fine-tune performance which has negligible
 effect on energies (and generally little effect on geometries in the case
 of SQM energy minimizations).
 The speed of each diagonalizer is a function of the number and type of
 QM atoms as well as the LAPACK library that the program was linked to.
 As such there is not always an obvious choice to obtain the best performance.
 The simplest option is to set diag_routine = 0 in which case the program
 will test each diagonalizer in turn, including the pseudo diagonalizer,
 and select the one that gives optimum performance.
 As of AmberTools 15 diag_routine = 0 is the default for both SQM and QMMM
 in Sander.
 Not available for DFTB/SCC-DFTB.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Automatically select the fastest routine (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Use internal diagonalization routine.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Use lapack dspev.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 Use lapack dspevd.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 Use lapack dspevx.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 Use lapack dsyev.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

6 Use lapack dsyevd.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

7 Use lapack dsyevr.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
printcharges
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
printcharges
\end_layout

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Don't print any info about QM atom charges to the output file (default)
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Print Mulliken QM atom charges to output file every 
\shape italic
ntpr
\shape default
 steps.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
print_eigenvalues
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
print_eigenvalues
\end_layout

\end_inset

 Controls printing of MO eigenvalues.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Do not print MO eigenvalues
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Print MO eigenvalues at the end of a single point calculation or geometry
 optimization (default)
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Print MO eigenvalues at the end of every SCF cycle (only NDDO methods,
 not DFTB)
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 Print MO eigenvalues during each step of the SCF cycle (only NDDO methods,
 not DFTB)
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
qxd
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qxd
\end_layout

\end_inset

 Flag to turn on (=.true.) or off (=.false., default) the charge-dependent exchange-
dispersion corrections of vdW interactions
\begin_inset CommandInset citation
LatexCommand cite
key "Giese07"
literal "true"

\end_inset

.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
parameter_file
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
parameterfle
\end_layout

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
= 'PARAM.FILE' Read user-defined parameters from the file 'PARAM.FILE'.
 The first three space-separated entries (case insensitive) of each line
 will be interpreted as a user-modified parameter in the sequence of 
\shape italic
parameter name, element name,
\shape default
 and 
\shape italic
value
\shape default
.
 For example, a line contains 
\begin_inset Quotes eld
\end_inset

USS Cl -111.6139480D0 
\begin_inset Quotes eld
\end_inset

 will cause the USS parameter of the Cl element changed to -111.6139480.
 A line beginning with 
\begin_inset Quotes eld
\end_inset

END
\begin_inset Quotes erd
\end_inset

 will stop the reading.
 This function currently only works for MNDO, AM1, PM3, MNDO/d, and AM1/d.
 Also, when new nuclear core-core parameters (FN, in PM3, AM1, and AM1/d)
 are re-defined, the number of FNN parameter sets (NUM_FN) also needs to
 be defined.
 For example, if FN
\shape italic
n
\shape default
3 (
\shape italic
n
\shape default
 = 1, 2, or 3) is defined, then NUM_FN needs to be set to 3 or 4.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
peptide_corr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
peptide
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

corr
\end_layout

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Don't apply MM correction to peptide linkages.
 (default) 
\end_layout

\begin_layout Description
= 1 Apply a MM correction to peptide linkages.
 This correction is of the form 
\begin_inset Formula $E_{scf}=E_{scf}+h_{type}(i_{type})\sin^{2}\phi$
\end_inset

, where 
\begin_inset Formula $\phi$
\end_inset

 is the dihedral angle of the H-N-C-O linkage and 
\shape italic

\begin_inset Formula $h_{type}$
\end_inset


\shape default
 is a constant dependent on the Hamiltonian used.
 (Recommended, except for DFTB/SCC-DFTB.) 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
itrmax
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
itrmax
\end_layout

\end_inset

 Integer specifying the maximum number of SCF iterations to perform before
 assuming that convergence has failed.
 Default is 1000.
 Typically higher values will not do much good since if the SCF hasn't converged
 after 1000 steps it is unlikely to.
 If the convergence criteria have not been met after itrmax steps the SCF
 will stop and the minimisation will proceed with the gradient at itrmax.
 Hence if you have a system which does not converge well you can set itrmax
 smaller so less time is wasted before assuming the system won't converge.
 In this way you may be able to get out of a bad geometry quite quickly.
 Once in a better geometry SCF convergence should improve.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
maxcyc
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
maxcyc
\end_layout

\end_inset

 Maximum number of minimization cycles to allow, using the 
\emph on
xmin
\emph default
 minimizer (see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:lmod"

\end_inset

) with the TNCG method.
 Default is 9999.
 Single point calculations can be done with 
\emph on
maxcyc
\emph default
 = 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Print the progress of the minimization every 
\emph on
ntpr
\emph default
 steps; default is 10.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
grms_tol
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
grms
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

tol
\end_layout

\end_inset

 Terminate minimization when the gradient falls below this value; default
 is 0.02
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ndiis_attempts
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ndiis
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

attempts
\end_layout

\end_inset

 Controls the number of iterations that DIIS (direct inversion of the iterative
 subspace) extrapolations will be attempted.
 Not available for DFTB/SCC-DFTB.
 The SCF does not even begin to exhaust its attempts at using DIIS extrapolation
s until the end of iteration 100.
 Therefore, for example, if ndiis_attempts=50, then DIIS extrapolations
 would be performed at end of iterations 100 to 150.
 The purpose of not performing DIIS extrapolations before iteration 100
 is because the existing code base performs quite well for most molecules;
 however, if convergence is not met after 100 iterations, then it is presumed
 that further iterations will not yield SCF convergence without doing something
 different, i.e., DIIS.
 Thus, the implementation of DIIS in SQM is a mechanism to try and force
 SCF convergence for molecules that are otherwise difficult to converge.
 Default 0.
 Maximum 1000.
 Minimum 0.
 Note that DIIS will automatically turn itself on for 100 attempts at the
 end of iteration 800 even if you did not explicitly set ndiis_attempts
 to a nonzero value.
 This is done as a final effort to achieve convergence.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ndiis_matrices
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ndiis
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

matrices
\end_layout

\end_inset

 Controls the number of matrices used in the DIIS extrapolation.
 Including only one matrix is the same as not performing an extrapolation.
 Including an excessive number of matrices may require a large amount of
 memory.
 Not available for DFTB/SCC-DFTB.
 Default 6.
 Minimum 1.
 Maximum 20.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
vshift
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
vshift
\end_layout

\end_inset

 Controls level shifting (only NDDO methods, not DFTB).
 Virtual orbitals can be shifted up by vshift (in eV) to improve SCF convergence
 in cases with small HOMO/LUMO gap.
 Default 0.0 (no level shift).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
errconv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
errconv
\end_layout

\end_inset

 SCF tolerance on the maximum absolute value of the error matrix, i.e., the
 commutator of the Fock matrix with the density matrix.
 The value has units of hartree.
 The default value of errconv is sufficiently large to effectively remove
 this tolerance from the SCF convergence criteria.
 Not available for DFTB/SCC-DFTB.
 Default 1.d-1.
 Minimum 1.d-16.
 Maximum 1.d0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qmmm_int
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmmm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

int
\end_layout

\end_inset

 When running QM calculations in the sqm program, an electric field of external
 point charges can be added.
 In this way, the electrostatic effect outside of the QM region can be modeled,
 making the calculation a simplified QM/MM calculation without QM/MM vdW's
 contribution.
 Like QM/MM calculations (see 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:QMMM"

\end_inset

), the method to couple QM and MM electrostatic interactions for external
 charges and semiempirical Hamiltonians can be specified via the 
\emph on
qmmm_int
\emph default
 namelist variable.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
The current implementation limits use of external charges to only single
 point energy calculations.
 To run such a calculation, an additional field, which begins with #EXCHARGES
 and ends with #END, is required to specify the external point charges in
 the input.
 Each external point charge must include atomic number, atom name, X, Y,
 Z coordinates and the charge in units of the electron charge.
 An example input looks like: 
\end_layout

\end_deeper
\begin_layout LyX-Code
single point energy calculation (adenine), with external charges (thymine)
\end_layout

\begin_layout LyX-Code
&qmmm  
\end_layout

\begin_layout LyX-Code
 qm_theory = 'PM3',
\end_layout

\begin_layout LyX-Code
 qmcharge = 0,
\end_layout

\begin_layout LyX-Code
 maxcyc = 0,
\end_layout

\begin_layout LyX-Code
 qmmm_int = 1,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout LyX-Code
7  N   1.0716177  -0.0765366   1.9391390
\end_layout

\begin_layout LyX-Code
1  H   0.0586915  -0.0423765   2.0039181
\end_layout

\begin_layout LyX-Code
1  H   1.6443796  -0.0347395   2.7619159
\end_layout

\begin_layout LyX-Code
6  C   1.6739638  -0.0357766   0.7424316
\end_layout

\begin_layout LyX-Code
7  N   0.9350155  -0.0279801  -0.3788916
\end_layout

\begin_layout LyX-Code
6  C   1.5490760   0.0012569  -1.5808009
\end_layout

\begin_layout LyX-Code
1  H   0.8794435   0.0050260  -2.4315709
\end_layout

\begin_layout LyX-Code
7  N   2.8531510   0.0258031  -1.8409596
\end_layout

\begin_layout LyX-Code
6  C   3.5646109   0.0195446  -0.7059872
\end_layout

\begin_layout LyX-Code
6  C   3.0747955  -0.0094480   0.5994562
\end_layout

\begin_layout LyX-Code
7  N   4.0885824  -0.0054429   1.5289786
\end_layout

\begin_layout LyX-Code
6  C   5.1829921   0.0253971   0.7872176
\end_layout

\begin_layout LyX-Code
1  H   6.1882591   0.0375542   1.1738824
\end_layout

\begin_layout LyX-Code
7  N   4.9294871   0.0412404  -0.5567274
\end_layout

\begin_layout LyX-Code
1  H   5.6035368   0.0648755  -1.3036811
\end_layout

\begin_layout LyX-Code
#EXCHARGESwill be 
\end_layout

\begin_layout LyX-Code
6  C  -4.7106131   0.0413373   2.1738637  -0.03140
\end_layout

\begin_layout LyX-Code
1  H  -4.4267056   0.9186178   2.7530256   0.06002
\end_layout

\begin_layout LyX-Code
1  H  -4.4439282  -0.8302573   2.7695655   0.05964
\end_layout

\begin_layout LyX-Code
1  H  -5.7883971   0.0505530   2.0247280   0.03694
\end_layout

\begin_layout LyX-Code
6  C  -3.9917387   0.0219348   0.8663338  -0.25383
\end_layout

\begin_layout LyX-Code
6  C  -4.6136833   0.0169051  -0.3336520   0.03789
\end_layout

\begin_layout LyX-Code
1  H  -5.6909220   0.0269347  -0.4227183   0.16330
\end_layout

\begin_layout LyX-Code
7  N  -3.9211729  -0.0009646  -1.5163659  -0.47122
\end_layout

\begin_layout LyX-Code
1  H  -4.4017172  -0.0036078  -2.4004924   0.35466
\end_layout

\begin_layout LyX-Code
6  C  -2.5395897  -0.0149474  -1.5962357   0.80253
\end_layout

\begin_layout LyX-Code
8  O  -1.9416783  -0.0291878  -2.6573783  -0.63850
\end_layout

\begin_layout LyX-Code
7  N  -1.9256484  -0.0110593  -0.3638948  -0.58423
\end_layout

\begin_layout LyX-Code
1  H  -0.8838255  -0.0216168  -0.3784269   0.35404
\end_layout

\begin_layout LyX-Code
6  C  -2.5361367   0.0074651   0.8766724   0.71625
\end_layout

\begin_layout LyX-Code
8  O  -1.8674730   0.0112093   1.9120833  -0.60609
\end_layout

\begin_layout LyX-Code
#END
\end_layout

\begin_layout Standard
\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Chapter

\series bold
QM/MM calculations
\series default
\lang english

\begin_inset CommandInset label
LatexCommand label
name "sec:QMMM"

\end_inset


\end_layout

\begin_layout Standard

\emph on
Sander
\emph default
 supports the option of describing part of the system quantum mechanically
 in an approach known as a hybrid (or coupled potential) QM/MM simulation.
 There are three basic ways in which QM/MM simulations are enabled in 
\emph on
sander
\emph default
:
\end_layout

\begin_layout Enumerate
Semi-empirical neglect of diatomic overlap (NDDO)-type and density functional
 tight binding (DFTB) Hamiltonians are supported natively by 
\emph on
sander 
\emph default
via the sqm software library
\emph on
.
 
\emph default
The basic documentation (e.g.
 what Hamiltonians are implemented, description of the input parameters)
 can be found in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "cha:sqm"

\end_inset

.
 In section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QMMM:semiempirical"
plural "false"
caps "false"
noprefix "false"

\end_inset

below we limit our description to those features that are unique to the
 QM/MM interface implemented in 
\emph on
sander
\emph default
.
 
\end_layout

\begin_layout Enumerate
More advanced Hamiltonians based on 
\emph on
ab initio
\emph default
 wave function theory (WFT) and density functional theory (DFT) are supported
 via an interface to external QM software packages the use of which is described
 in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QMMMEXTERN"

\end_inset

.
\end_layout

\begin_layout Enumerate
Seamless 
\emph on
ab initio
\emph default
 QM/MM simulations with Hartree-Fock (HF) and density functional theory
 (DFT) methods are possible via the GPU enabled QM code QUICK, which is
 distributed with AmberTools.
 QUICK can be used either as QM program external to 
\emph on
sander
\emph default
 or via the QUICK library linked to 
\emph on
sander
\emph default
 (recommended).
 Details about QUICK are in chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "cha:quick"
plural "false"
caps "false"
noprefix "false"

\end_inset

 and QM/MM simulations via 
\emph on
sander 
\emph default
and QUICK are described in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QMMM-Quick"
plural "false"
caps "false"
noprefix "false"

\end_inset

 below.
\end_layout

\begin_layout Standard
The built-in semi-empirical QM/MM support was written by Ross Walker and
 Mike Crowley, 
\begin_inset CommandInset citation
LatexCommand cite
key "Walker08"
literal "true"

\end_inset

 based originally on public-domain MOPAC codes of J.J.P.
 Stewart.
 The QM/MM generalized Born implementation uses the model described by Pellegrin
i and Field
\begin_inset CommandInset citation
LatexCommand cite
key "Pellegrini02"
literal "true"

\end_inset

 while regular QM/MM Ewald support is based on the work of Nam 
\shape italic
et al.
\shape default

\begin_inset CommandInset citation
LatexCommand cite
key "Nam05"
literal "true"

\end_inset

 with QM/MM PME support based on the work of Walker 
\shape italic
et al.
\shape default

\begin_inset CommandInset citation
LatexCommand cite
key "Walker08"
literal "true"

\end_inset

.
 SCC-DFTB support was written by Gustavo Seabra, Ross Walker and Adrian
 Roitberg,
\begin_inset CommandInset citation
LatexCommand cite
key "Seabra07"
literal "true"

\end_inset

 and is based on earlier work of Marcus Elstner.
\begin_inset CommandInset citation
LatexCommand cite
key "Elstner98,Kruger05"
literal "true"

\end_inset

 The extension for DFTB3 was written by Andreas Goetz.
 The interface to external QM packages 
\begin_inset CommandInset citation
LatexCommand citep
key "GCW13"
literal "false"

\end_inset

was originally developed by Andreas Goetz but many others have contributed
 in the meantime.
 Vinicius Cruzeiro has coupled Amber to QUICK 
\begin_inset CommandInset citation
LatexCommand citep
key "Cruzeiro2021"
literal "false"

\end_inset

via the API that was developed by Madu Manathunga.
\end_layout

\begin_layout Section

\series bold
Built-in semiempirical NDDO methods and SCC-DFTB
\begin_inset CommandInset label
LatexCommand label
name "sec:QMMM:semiempirical"

\end_inset


\end_layout

\begin_layout Standard
When running a QM/MM simulation in 
\emph on
sander
\emph default
 the system is partitioned into two regions, a QM region consisting of the
 atoms defined by either the 
\shape italic
qmmask
\shape default
 or 
\shape italic
iqmatoms
\shape default
 keyword, and a MM region consisting of all the atoms that are not part
 of the QM region.
 For a typical protein simulation in explicit solvent the number of MM atoms
 will be much greater than the number of QM atoms.
 Either region can contain zero atoms, giving either a pure QM simulation
 or a standard classical simulation.
 For periodic simulations, the quantum region must be 
\shape italic
compact
\shape default
, so that the extent (or diameter) of the QM region (in any direction) plus
 twice the QM/MM cutoff must be less than the box size.
 Hence, you can define an "active site" to be the QM region, but in most
 cases could not ask that all cysteine residues (for example) be quantum
 objects.
 The restrictions are looser for non-periodic (gas-phase or generalized
 Born) simulations, but the codes are written and tested for the case of
 a single, compact quantum region.
\end_layout

\begin_layout Standard
The partitioned system is characterized by an effective Hamiltonian which
 operates on the system's wavefunction 
\begin_inset Formula $\Psi$
\end_inset

, which is dependent on the position of the MM and QM nuclei, to yield the
 system energy 
\begin_inset Formula $E_{eff}$
\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
H_{eff}\Psi(x_{e},x_{QM},x_{MM})=E{}_{eff}(x_{QM},x_{MM})\Psi(x_{e},x_{QM},x_{MM})\label{eq:qmmm1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The effective Hamiltonian consists of three components - one for the QM
 region, one for the MM region and a term that describes the interaction
 of the QM and MM regions, implying that likewise the energy of the system
 can be divided into three components.
 If the total energy of the system is re-written as the expectation value
 of 
\begin_inset Formula $H_{eff}$
\end_inset

 then the MM term can be removed from the integral since it is independent
 of the position of the electrons:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
E_{eff}=\left\langle \Psi|H_{QM}+H_{QM/MM}|\Psi\right\rangle +E_{MM}\label{eq:qmmm2}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
In the QM/MM implementation in 
\shape italic
sander
\shape default
, 
\begin_inset Formula $E_{MM}$
\end_inset

 is calculated classically from the MM atom positions using the Amber or
 CHARMM force field equation and parameters, whereas 
\begin_inset Formula $H_{QM}$
\end_inset

 is evaluated using the chosen QM method.
\end_layout

\begin_layout Standard
The interaction term 
\begin_inset Formula $H_{QM/MM}$
\end_inset

 is more complicated.
 By default, 
\emph on
sander
\emph default
 uses an electrostatic embedding scheme (also referred to as additive scheme)
 in which the interaction of the MM point charges with the electrons of
 the QM system as well as the interaction between the MM point charges and
 the QM nuclei (atomic cores for semi-empirical methods) is explicitly taken
 into account.
 In other words, the MM region polarizes the QM electron density.
 For the case where there are no covalent bonds between the atoms of the
 QM and MM regions the interaction Hamiltonian is thus the sum of an electrostat
ic term and a Lennard-Jones (VDW) term and can be written as
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
H_{QM/MM}=\sum_{q}\sum_{m}\left[Q_{m}h_{electron}(x_{e},x_{MM})-Q_{m}Z_{q}h_{core}(x_{QM},x_{MM})+\left(\frac{A}{r_{qm}^{12}}-\frac{B}{r_{qm}^{6}}\right)\right]\label{eq:qmmm3}
\end{equation}

\end_inset

where the subscripts 
\begin_inset Formula $e$
\end_inset

, 
\begin_inset Formula $m$
\end_inset

 and 
\begin_inset Formula $q$
\end_inset

 refer to the electrons, the MM nuclei and the QM nuclei respectively.
 Here 
\begin_inset Formula $Q_{m}$
\end_inset

 is the charge on MM atom 
\begin_inset Formula $m$
\end_inset

, 
\begin_inset Formula $Z_{q}$
\end_inset

 is the core charge (nucleus minus core electrons) on QM atom 
\begin_inset Formula $q$
\end_inset

, 
\begin_inset Formula $r_{qm}$
\end_inset

 is the distance between atoms 
\begin_inset Formula $q$
\end_inset

 and 
\begin_inset Formula $m$
\end_inset

, and A and B are Lennard-Jones interaction parameters.
 For systems that have covalent bonds between the QM and MM regions, the
 situation is more complicated, as discussed later.
\end_layout

\begin_layout Standard
A more approximate form of the interaction term 
\begin_inset Formula $H_{QM/MM}$
\end_inset

 is referred to as mechanical embedding (or subtractive QM/MM scheme).
 In this case the interactions between the QM and the MM region are obtained
 within the same classical approximation that is used for the MM region,
 that is
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
H_{QM/MM}=\sum_{q}\sum_{m}\left[\frac{Q_{m}Q_{q}}{r_{qm}}+\left(\frac{A}{r_{qm}^{12}}-\frac{B}{r_{qm}^{6}}\right)\right]
\end{equation}

\end_inset

where 
\begin_inset Formula $Q_{q}$
\end_inset

 is the classical MM point charge assigned to an atom in the QM region.
 Mechanical embedding is useful to impose steric constraints on the embedded
 QM system, however, the electron density is not polarized by the MM environment.
 An additional complication of this approach is that the point charges that
 are assigned to the atoms in the QM region have to represent the electrostatic
 potential of the QM region during the whole course of a QM/MM simulation.
\end_layout

\begin_layout Standard
If one evaluates the expectation values in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qmmm2"

\end_inset

 over a single determinant built from molecular orbitals
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\phi_{i}=\sum_{j}c_{ij}\chi_{j}\label{eq:qmmm4}
\end{equation}

\end_inset

where the 
\begin_inset Formula $c_{ij}$
\end_inset

 are molecular orbital coefficients and the 
\begin_inset Formula $\chi_{j}$
\end_inset

 are atomic basis functions, the total energy depends upon the 
\begin_inset Formula $c_{ij}$
\end_inset

 and on the positions 
\begin_inset Formula $x_{MM}$
\end_inset

 and 
\begin_inset Formula $x_{QM}$
\end_inset

 of the atoms.
 The energy is obtained by setting 
\begin_inset Formula $\partial E_{eff}/\partial c_{ij}$
\end_inset

 to zero which leads to a self-consistent (SCF) procedure to determine the
 
\begin_inset Formula $c_{ij}$
\end_inset

, (with a modified Fock matrix that contains the electric field arising
 from the MM charges in the case of electrostatic embedding).
 Once the energy is known, the forces on the atoms can be obtained by taking
 the derivative of the energy expression with respect to the positions of
 the QM and MM atoms.
\end_layout

\begin_layout Standard
The main subtlety that arises in the case of electrostatic embedding is
 that, for a periodic system, there are formally an infinite number of QM/MM
 interactions; even for a non-periodic system, the (finite) number of such
 interactions may be prohibitively large.
 These problems are addressed in a manner analogous to that used for pure
 MM systems: a PME approach is used for periodic systems, and a (large)
 cutoff may be invoked for non-periodic systems.
 Some details are discussed below.
\end_layout

\begin_layout Subsection

\series bold
The QM/MM interface and link atoms
\end_layout

\begin_layout Standard
The sections above dealt with situations where there are no covalent bonds
 between the QM and MM regions.
 In many protein simulations, however, it is necessary to have the QM/MM
 boundary cut covalent bonds, and a number of additional approximations
 have to be made.
 There are a variety of approaches to this problem, including hybrid orbitals,
 capping potentials, and explicit link atoms.
 The last option is the method available in 
\shape italic
sander
\shape default
.
\end_layout

\begin_layout Standard
There are a number of ways to implement a link atom approach that deal with
 the way the link atom is positioned, the way the forces on the link atom
 are propagated, and the way non-bonding interactions around the link atom
 are treated.
 Each time an energy or gradient calculation is to be done, the link atom
 coordinates are re-generated from the current coordinates of the QM and
 MM atoms making up the QM-MM covalent pair.
 The link atom is placed along the bond vector joining the QM and MM atom,
 at a distance 
\begin_inset Formula $d_{L-QM}$
\end_inset

 from the QM atom.
 By default 
\begin_inset Formula $d_{L-QM}$
\end_inset

 is set to the equilibrium distance of a methyl C-H atom pair (1.09 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

) but this can be set in the input file.
 The default link atom type is hydrogen, but this can also be specified
 as an input.
\end_layout

\begin_layout Standard
Since the link atom position is a function of the coordinates of the "real"
 atoms, it does not introduce any new degrees of freedom into the system.
 The chain rule is used to re-write forces on the link atom itself in terms
 of forces on the two real atoms that define its position.
 This is analogous to the way in which "extra points" or "lone-pairs" are
 handled in MM force fields.
\end_layout

\begin_layout Standard
The remaining details of how the QM-MM boundary is treated are as follows:
 for the interactions surrounding the link atom, the MM bond term between
 the QM and MM atoms is calculated classically using the classical force
 field parameters, as are any angle or dihedral terms that include at least
 one MM atom.
 The Lennard-Jones interactions between QM-MM atom pairs are calculated
 in the same way as described in the section above with exclusion of 1-2
 and 1-3 interactions and scaling of 1-4 interactions.
 What remains is to specify the electrostatic interactions between QM and
 MM atoms around the region of the link atom.
\end_layout

\begin_layout Standard
A number of different schemes have been proposed for handling link-atom
 electrostatics.
 Many of these have been tested or calibrated on (small) gas-phase systems,
 but such testing can neglect some considerations that are very important
 for more extended, condensed-phase simulations.
 In choosing our scheme, we wanted to ensure that the total charge of the
 system is rigorously conserved (at the correct value) during an MD simulation.
 Further, we strove to have the Mulliken charge on the link atom (and the
 polarity of its bond to the nearest QM atom) adopt reasonable values and
 to exhibit only small fluctuations during MD simulations.
 Link atoms interact with the MM field in exactly the same way as regular
 QM atoms.
 That is they interact with the electrostatic field due to all the MM atoms
 that are within the cutoff, with the exception of the MM link pair atoms
 (MM atoms that are bound directly to QM atoms).
 VDW interactions are not calculated for link atoms.
 These are calculated between all real QM atoms and all MM atoms, including
 the MM link pair atoms.
 For Generalized Born simulations the effective Born radii for the link
 atoms are calculated using the intrinsic radii for the MM link pair atoms
 that they are replacing.
\end_layout

\begin_layout Standard
In the case of electrostatic embedding the atoms that make up the QM region
 (including the MM link pair atom) have their charges from the prmtop file
 essentially replaced with Mulliken charges.
 Hence it is important to consider the issue of charge conservation.
 The QM region (including the link atoms) by definition must have an integer
 charge.
 This is defined by the &qmmm namelist variable 
\shape italic
qmcharge
\shape default
.
 If the MM atoms (including the MM link pair atoms) that make up the QM
 region have prmtop charges that sum to the value of 
\shape italic
qmcharge
\shape default
 then there is no problem.
 If not, there are two options for dealing with this charge, defined by
 the namelist variable 
\shape italic
adjust_q
\shape default
.
 A value of 1 will distribute the difference in charge equally between the
 nearest 
\shape italic
nlink
\shape default
 MM atoms to the MM link pair atoms.
 A value of 2 will distribute this charge equally over all of the MM atoms
 in the simulation (excluding MM link pair atoms).
\end_layout

\begin_layout Subsection
A reformulated QM/MM interface for PM3
\end_layout

\begin_layout Standard
In the current version of Amber, a reformulated QM-MM core-charge potential
 (denoted as PM3/MM*) has been implemented.
 This reformulated potential scales the interaction between a QM core and
 a MM charge for the purpose of better description of the geometry and energy
 at the QM-MM interface:
\begin_inset CommandInset citation
LatexCommand citep
key "Wang09"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
E_{QM/MM}^{core}=Z_{a}q_{m}\left(s_{a}s_{a},s_{m}s_{m}\right)\left[1+\frac{\left|q_{m}\right|}{q_{m}}\cdot\left(-e^{-f_{1}^{a}\cdot R_{am}}+e^{-f_{2}^{a}\cdot R_{am}}\right)\right]\label{eq:qmmm5}
\end{equation}

\end_inset

where 
\begin_inset Formula $Z_{a}$
\end_inset

 is the effective core charge of QM atom 
\begin_inset Formula $a$
\end_inset

, 
\begin_inset Formula $q_{m}$
\end_inset

 is the partial charge on MM atom 
\begin_inset Formula $m$
\end_inset

, 
\begin_inset Formula $s_{a}$
\end_inset

 is an 
\begin_inset Formula $s$
\end_inset

 orbital on the QM atom, 
\begin_inset Formula $s_{m}$
\end_inset

 is a notional 
\begin_inset Formula $s$
\end_inset

 orbital on the MM atom, 
\begin_inset Formula $R_{am}$
\end_inset

 is the QM-MM interatomic distance, and 
\begin_inset Formula $f_{1}^{a}$
\end_inset

 and 
\begin_inset Formula $f_{2}^{a}$
\end_inset

 are exponential scale factors which depend on the QM atom only.
 Optimal values for 
\begin_inset Formula $f_{1}^{a}$
\end_inset

 and 
\begin_inset Formula $f_{2}^{a}$
\end_inset

 were determined based on the PM3 Hamiltonian, and are available for H,
 C, N and O atoms (so the QM region is limited to these four atoms; but
 the MM region is not restricted).
 Application of this reformulated potential shows improved prediction of
 geometry and interaction energy at the QM-MM interface for hydrogen bonded
 small molecule complexes typical of biomolecular interactions, without
 significantly impacting the modeling of other interaction types, such as
 dispersion dominant complexes.
\begin_inset CommandInset citation
LatexCommand citep
key "Wang09"
literal "true"

\end_inset

 In a QM/MM calculation, giving 
\shape italic
qmmm_int=3
\shape default
 along with 
\shape italic
qm_theory=PM3
\shape default
 will invoke this potential.
\end_layout

\begin_layout Standard
Based on PM3/MM*, further developments to the semi-empirical QM/MM coupling
 method have been introduced – PM3/MMX2 (
\emph on
qmmm_int
\emph default
=4 and 
\emph on
qm_theory
\emph default
=PM3) – which shares the same QM core-MM charge equation with the PM3/MM*
 model.
 In addition, a QM parameter, 
\begin_inset Formula $\rho_{mm}$
\end_inset

, is introduced to each type of QM atoms in order to "fine-tune" the QM
 electron-MM charge interaction (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mmx2a"

\end_inset

).
 Although 
\begin_inset Formula $\rho_{mm}$
\end_inset

 is a parameter for QM atom, the subscript 
\emph on
mm
\emph default
 emphasizes that it is a MM-related property (eqn 3.xx).
 Parameters are currently available for H, C, N, O and S QM atoms (manuscript
 in preparation).
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
E_{QM/MM}^{electron}=-q_{m}(\mu_{a}\nu_{a},s_{m}s_{m})=\sum_{\ell_{a}}\sum_{\ell_{m}}\left[M_{l_{a}k}^{a}M_{l_{m}k}^{m}\right]\label{eq:mmx2a}
\end{equation}

\end_inset

where 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\left[M_{l_{a}k}^{a}M_{l_{m}k}^{m}\right]=\frac{e^{2}}{2^{l_{a}+l_{m}}}\sum_{i=1}^{2^{l_{a}}}\sum_{j=1}^{l}\left[r_{ij}^{2}+\left(\rho_{l_{a}+}^{a}\rho_{mm}^{a}\right)^{2}\right]^{-1/2}\label{eq:mmx2b}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection

\series bold
Generalized Born implicit solvent
\end_layout

\begin_layout Standard
The implementation of Generalized Born (GB) for QM/MM calculations is based
 on the method described by Pellegrini and Field.
\begin_inset CommandInset citation
LatexCommand cite
key "Pellegrini02"
literal "true"

\end_inset

 Here, the total energy is taken to be 
\begin_inset Formula $E_{eff}$
\end_inset

 from Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qmmm2"

\end_inset

 plus 
\begin_inset Formula $E_{gb}$
\end_inset

 from Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:gb1"

\end_inset

.
 In 
\begin_inset Formula $E_{gb}$
\end_inset

, charges on the QM atoms are taken to be the Mulliken charges determined
 from the quantum calculation; hence these charges depend upon the molecular
 orbital coefficients 
\begin_inset Formula $c_{ij}$
\end_inset

 as well as the positions of the atoms.
\end_layout

\begin_layout Standard
As with conventional QM/MM simulations, one then solves for the 
\begin_inset Formula $c_{ij}$
\end_inset

 by setting 
\begin_inset Formula $\partial E_{eff}/\partial c_{ij}=0$
\end_inset

.
 This leads to a set of SCF equations with a Fock matrix modified not only
 by the presence of MM atoms (as in "ordinary" QM/MM simulations), but also
 modified by the presence of the GB polarization terms.
 Once self-consistency is achieved, the resulting Mulliken charges can be
 used in the ordinary way to compute the GB contribution to the total energy
 and forces on the atoms.
\end_layout

\begin_layout Subsection

\series bold
Ewald and PME
\end_layout

\begin_layout Standard
The support for long range electrostatics in QM/MM calculations using electrosta
tic embedding is based on a modification of the Nam, Gao and York Ewald
 method for QM/MM calculations.
\begin_inset CommandInset citation
LatexCommand cite
key "Nam05"
literal "true"

\end_inset

 This approach works in a similar fashion to GB in that Mulliken charges
 are used to represent long range interactions.
 Within the cutoff, interactions between QM and MM atoms are calculated
 using a full multipole treatment.
 Outside of the cutoff the interaction is based on pairwise point charge
 interactions.
 For semiempirical NDDO-type methods this leads to a slight discontinuity
 at the QM/MM cutoff boundary and thus a small energy drift during QM/MM
 MD simulations in the NVE ensemble.
 This energy drift can be avoided by using a switching function at the cutoff
 (see below).
\end_layout

\begin_layout Standard
The implementation in Ref 
\begin_inset CommandInset citation
LatexCommand cite
key "Nam05"
literal "true"

\end_inset

 uses an Ewald sum for both QM/QM and QM/MM electrostatic interactions.
 This can be expensive for large MM regions, and thus 
\shape italic
sander
\shape default
 uses a modification of this method by Walker and Crowley
\begin_inset CommandInset citation
LatexCommand cite
key "Walker08"
literal "true"

\end_inset

 that uses a PME model (rather than an Ewald sum) for QM/MM interactions.
 This is controlled by the 
\shape italic
qm_pme
\shape default
 variable discussed below.
\end_layout

\begin_layout Standard
When running QM/MM Ewald or PME simulations in 
\emph on
sander
\emph default
, if QM multipoles are involved in QM-MM interactions (NDDO methods), a
 discontinuity in the QM-MM electrostatic potential occurs at the cutoff
 distance due to the sudden change in the potential function (the difference
 between Eqs.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:eqmmma"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:eqmmmb"

\end_inset

) , thus resulting in energy conservation problems in the simulation.
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
E_{QM/MM}^{r<cutoff}=-q_{m}(\mu_{a}\nu_{a},s_{m}s_{m})+Z_{a}q_{m}(s_{a}s_{a},s_{m}s_{m})(1+scale)\label{eq:eqmmma}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
E_{QM/MM}^{r>cutoff}=\frac{q_{m}(Z_{a}-\sum c_{\mu\mu})}{r}\label{eq:eqmmmb}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
This problem can be avoided by applying a switching function to smoothly
 connect the two different potentials.
 The QM/MM electrostatic potential using a switching function can thus be
 written as:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
E_{QM/MM}=E_{QM/MM}^{r<cutoff}s(r)+E_{QM/MM}^{r>cutoff}(1-s(r))
\]

\end_inset


\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
sloppy
\end_layout

\end_inset

 The switching function can be turned on or off via the 
\emph on
&qmmm
\emph default
 namelist variable 
\emph on
qmmm_switch, 
\emph default
for details see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:qmmm-nml"

\end_inset

 below.
\end_layout

\begin_layout Subsection

\series bold
Hints for running successful QM/MM calculations
\end_layout

\begin_layout Subsubsection*

\shape italic
Required Parameters and Prmtop Creation
\end_layout

\begin_layout Standard
QM/MM calculations without link atoms require mass, charges, van der Waals
 and GB radii in the 
\shape italic
prmtop
\shape default
 file.
 All bonds, angles, and dihedrals parameters involving QM atoms are neglected.
 In the case of electrostatic embedding the charges are also neglected.
 (Note that when SHAKE is applied to the QM reg, the bonds are constrained
 to the ideal MM values, even when these are part of a QM region; hence,
 for this case, it is important to have correct bond parameters in the QM
 region.) The simplest general prescription for setting things up is to use
 
\shape italic
antechamber
\shape default
 and 
\shape italic
LEaP
\shape default
 to create a reference force field, since "placeholders" are required in
 the 
\shape italic
prmtop
\shape default
 file even for things that will be neglected.
 This also allows you to run comparison simulations between pure MM and
 QM/MM simulations, which can be helpful if problems are encountered in
 the QM/MM calculations.
\end_layout

\begin_layout Standard
The use of 
\shape italic
antechamber
\shape default
 to construct a pure MM reference system is even more useful when there
 are link atoms, since here MM parameters for bonds, angles and dihedrals
 that cross the QM/MM boundary are also needed.
\end_layout

\begin_layout Subsubsection*

\shape italic
Choosing the QM region
\end_layout

\begin_layout Standard
There are no good universal rules here.
 Generally, one might want to have as large a QM region as possible, but
 having more than 80-100 atoms in the QM region will lead to simulations
 that are very expensive.
 One should also remember that for many features of conformational analysis,
 a good MM force field may be better than a semiempirical or DFTB quantum
 description.
 In choosing the QM/MM boundary, it is better to cut non-polar bonds (such
 as C-C single bonds) than to cut unsaturated or polar bonds.
 Link atoms are not placed between bonds to hydrogen.
 Thus cutting across a C-H bond will NOT give you a link atom across that
 bond.
 (This is not currently tested for in the code and so it is up to the user
 to avoid such a situation.) Furthermore, link atoms are restricted to one
 per MM link pair atom.
 This is tested for during the detection of link atoms and an error is generated
 if this requirement is violated.
 This would seem to be a sensible policy otherwise you could have two link
 atoms too close together.
 See the comments in 
\shape italic
qm_link_atoms.f
\shape default
 for a more in-depth discussion of this limitation.
\end_layout

\begin_layout Subsubsection*

\shape italic
Choice of electrostatic cutoff
\end_layout

\begin_layout Standard
The implementation of the non-bonded cut off in QM/MM simulations is slightly
 different than in regular MM simulations.
 The cut off between MM-MM atoms is still handled in a pairwise fashion.
 However, for QM atoms any MM atom that is within 
\shape italic
qmcut
\shape default
 of ANY QM atom is included in the interaction list for all QM atoms.
 This means that the value of 
\shape italic
qmcut
\shape default
 essentially specifies a shell around the QM region rather than a spherical
 shell around each individual QM atom.
 Ideally the cut off should be large enough that the energy as a function
 of the cutoff has converged.
 For non-periodic, generalized Born simulations, a cutoff of 15 to 20 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
AA
\backslash

\end_layout

\end_inset

 seems sufficient in some tests.
 (Remember that long-range electrostatic interactions are reduced by a factor
 of 80 from their gas-phase counterparts, and by more if a nonzero salt
 concentration is used.) For periodic simulations, the cutoff only serves
 to divide the interactions between "direct" and "reciprocal" parts; as
 with pure MM calculations, a cutoff of 8 or 9 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
AA
\backslash

\end_layout

\end_inset

 is sufficient here.
\end_layout

\begin_layout Subsubsection*

\shape italic
Parallel simulations
\end_layout

\begin_layout Standard
The built-in QM/MM implementation currently supports execution in parallel
 via the message passing interface (MPI), however, the implementation is
 not fully parallel.
 At present all parts of the QM simulation are parallel except the density
 matrix build and the matrix diagonalisation.
 For small QM systems these two operations do not take a large percentage
 of time and so acceptable scaling can be seen to around 8 CPU cores (depending
 on type of CPU and/or interconnect speed between compute nodes).
 For large QM systems the matrix diagonalisation time will dominate and
 so the scaling will not be as good.
 In this case it may be beneficial to choose a LAPACK diagonalization routine
 in combination with a threaded library such as the Intel Math Kernel Library
 (MKL).
 For details on how to choose the diagonalization routine see 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:qmmm-Namelist"

\end_inset

.
 The number of threads to be used for the diagonalization is set via an
 environment variable of the operating system (typically OMP_NUM_THREADS).
\end_layout

\begin_layout Subsection

\series bold
General QM/MM &qmmm Namelist Variables
\begin_inset CommandInset label
LatexCommand label
name "subsec:qmmm-nml"

\end_inset


\end_layout

\begin_layout Standard
An example input file for running a simple QM/MM MD simulation is shown
 here:
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

 imin=0, nstlim=10000,          ! Perform MD for 10,000 steps
\end_layout

\begin_layout Plain Layout

 dt=0.002,                      ! 2 fs time step
\end_layout

\begin_layout Plain Layout

 ntt=1, tempi=0.1, temp0=300.0, ! Berendsen temperature control
\end_layout

\begin_layout Plain Layout

 ntb=1,                         ! Constant volume periodic boundaries
\end_layout

\begin_layout Plain Layout

 ntf=2, ntc=2,                  ! Shake hydrogen atoms
\end_layout

\begin_layout Plain Layout

 cut=8.0,                       ! 8 angstrom classical non-bond cut off
\end_layout

\begin_layout Plain Layout

 ifqnt=1                        ! Switch on QM/MM coupled potential
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&qmmm
\end_layout

\begin_layout Plain Layout

 qmmask=':753',   ! Residue 753 should be treated using QM
\end_layout

\begin_layout Plain Layout

 qmcharge=-2,     ! Charge on QM region is -2
\end_layout

\begin_layout Plain Layout

 qm_theory='PM3', ! Use the PM3 semi-empirical Hamiltonian
\end_layout

\begin_layout Plain Layout

 qmcut=8.0        ! Use 8 angstrom cut off for QM region
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The 
\emph on
&qmmm
\emph default
 namelist contains variables that allow you to control the options used
 for a QM/MM simulation.
 This namelist must be present when running QM/MM simulations and at the
 very least must contain either the 
\emph on
iqmatoms
\emph default
 or 
\emph on
qmmask
\emph default
 variable which define the region to be treated quantum mechanically.
 If 
\emph on
ifqnt
\emph default
 is set to zero then the contents of this namelist are ignored.
\end_layout

\begin_layout Standard
For the QM region definition specify one of either 
\emph on
iqmatoms
\emph default
 or 
\emph on
qmmask
\emph default
.
 Link atoms will be added automatically along bonds (as defined in the prmtop
 file) that cross the QM/MM boundary.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iqmatoms
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
iqmatoms
\end_layout

\end_inset

 comma-separated integer list containing the atom numbers (from the prmtop
 file) of the atoms to be treated quantum mechanically.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qmmask
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmmask
\end_layout

\end_inset

 Mask specifying the quantum atoms.
 E.g.
 :1-2, = residues 1 and 2.
 See mask documentation for more info.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qmcut
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmcut
\end_layout

\end_inset

 Specifies the size of the electrostatic cutoff in Angstroms for QM/MM electrost
atic interactions.
 By default this is the same as the value of cut chosen for the classical
 region, and the default generally does not need to be changed.
 Any classical atom that is within qmcut of 
\shape italic
any
\shape default
 QM atom is included in the pair list.
 For PME calculations, this parameter just affects the division of forces
 between direct and reciprocal space.
 
\shape italic
Note:
\shape default
 this option only effects the electrostatic interactions between the QM
 and MM regions.
 Within the QM region all QM atoms see all other QM atoms regardless of
 their separation.
 QM-MM van der Waals interactions are handled classically, using the cutoff
 value specified by 
\shape italic
cut
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qm_ewald
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

ewald
\end_layout

\end_inset

 This option specifies how long range electrostatics for the QM region should
 be treated.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Use a real-space cutoff for QM-QM and QM-MM long range interactions.
 In this situation QM atoms do not see their images and QM-MM interactions
 are truncated at the cutoff.
 This is the default for non-periodic simulations.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 (default) Use PME or an Ewald sum to calculate long range QM-QM and QM-MM
 electrostatic interactions.
 This is the default when running QM/MM with periodic boundaries and PME.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 This option is similar to option 1 but instead of varying the charges
 on the QM images as the central QM region changes the QM image charges
 are fixed at the Mulliken charges obtained from the previous MD step.
 This approach offers a speed improvement over 
\shape italic
qm_ewald=1
\shape default
, since the SCF typically converges in fewer steps, with only a minor loss
 of accuracy in the long range electrostatics.
 This option has not been extensively tested, although it becomes increasingly
 accurate as the box size gets larger.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
kmaxqx
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
kmaxqx
\end_layout

\end_inset

,y,z Specifies the maximum number of kspace vectors to use in the x, y and
 z dimensions respectively when doing an Ewald sum for QM-MM and QM-QM interacti
ons.
 Higher values give greater accuracy in the long range electrostatics but
 at the expense of calculation speed.
 The default value of 8 should be optimal for most systems.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ksqmaxq
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ksqmaxq
\end_layout

\end_inset

 Specifies the maximum number of K squared values for the spherical cut
 off in reciprocal space when doing a QM-MM Ewald sum.
 The default value of 100 should be optimal for most systems.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qm_pme
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

pme
\end_layout

\end_inset

 Specifies whether a PME approach or regular Ewald approach should be used
 for calculating the long range QM-QM and QM-MM electrostatic interactions.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Use a regular Ewald approach for calculating QM-MM and QM-QM long range
 electrostatics.
 Note this option is often much slower than a pme approach and typically
 requires very large amounts of memory.
 It is recommended only for testing purposes.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 (default) Use a QM compatible PME approach to calculate the long range
 QM-MM electrostatic energies and forces and the long range QM-QM forces.
 The long range QM-QM energies are calculated using a regular Ewald approach.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
qmmm_switch
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmmm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

switch
\end_layout

\end_inset

 Specifies whether a switching function shall be used at the cutoff for
 long range electrostatics (applies only to NDDO methods).
 The lower and higher boundaries of the switching function are user definable,
 see 
\emph on
r_switch_lo
\emph default
 and 
\emph on
r_switch_hi
\emph default
.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (default).
 Do not use a switching function.
 This leads to slight discontinuities in the potential at the cut off and
 thus an energy drift in NVE simulations.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Use a switching function.
 See also variables 
\emph on
r_switch_hi
\emph default
 and 
\emph on
r_switch_lo
\emph default
.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
r_switch_hi
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
r
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

switch
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

hi
\end_layout

\end_inset

 Specifies the upper boundary of the switching function in Å (see 
\emph on
qmmm_switch
\emph default
).
 Defaults to 
\emph on
qmcut.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
r_switch_lo
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
r
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

switch
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

lo
\end_layout

\end_inset

 Specifies lower boundary of the switching function in Å (see 
\emph on
qmmm_switch
\emph default
).
 Defaults to 
\emph on
r_switch_hi
\emph default
 - 2.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qmgb
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmgb
\end_layout

\end_inset

 Specifies how the QM region should be treated with generalized Born.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

2 (default) As described above, the electrostatic and "polarization" fields
 from the MM charges and the exterior dielectric (respectively) are included
 in the Fock matrix for the QM Hamiltonian.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 This is intended as a debugging option and should only be used for single
 point calculations.
 With this option the GB energy is calculated using the Mulliken charges
 as with option 2 above but the fock matrix is NOT modified by the GB field.
 This allows one to calculate what the GB energy would be for a given structure
 using the gas phase quantum charges.
 When combined with a simulation using 
\shape italic
qmgb=2
\shape default
, this allows the strain energy from solvation to be calculated.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
qm_theory
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

theory
\end_layout

\end_inset

 Level of theory to use for the QM region of the simulation.
 (Hamiltonian).
 Default is to use the semi-empirical hamiltonian PM3.
 See the 
\emph on

\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:qmmm-Namelist"

\end_inset


\emph default
 for details.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
qmmm_int
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmmm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

int
\end_layout

\end_inset

 Controls the way in which QM/MM interactions are handled in the direct
 space QMMM sum.
 This controls only the electrostatic interactions.
 VDW interactions are always calculated classically using the standard 6-12
 potential.
 Note: with the exception of qmmm_int=0 DFTB calculations (qm_theory=DFTB)
 always use a simple mulliken charge - resp charge interaction and the value
 of qmmm_int has no influence.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 This turns off all electrostatic interaction between QM and MM atoms in
 the direct space sum.
 Note QM-MM VDW interactions will still be calculated classically.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 (default) QM-MM interactions in direct space are calculated in the same
 way for all of the various semi-empirical hamiltonians.
 The interaction is calculated in an analogous way to the the core-core
 interaction between QM atoms.
 The MM resp charges are included in the one electron hamiltonian so that
 QMcore-MMResp and QMelectron-MMResp interactions are calculated.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 This is the same as for 1 above except that when AM1, PM3 or Hamiltonians
 derived from these are in use the extra Gaussian terms that are introduced
 in these methods to improve the core-core repulsion term in QM-QM interactions
 are also included for the QM-MM interactions.
 This is the equivalent to the QM-MM interaction method used in CHARMM and
 DYNAMO.
 It tends to slightly reduce the repulsion between QM and MM atoms at small
 distances.
 For distances above approximately 3.5 angstroms it makes almost no difference.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 Using this along with 
\shape italic
qm_theory=PM3
\shape default
 invokes a reformulated QM core-MM charge potential at the QM-MM interface
 (Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:qmmm5"

\end_inset

).
 Current parametrization limits the QM region to H, C, N and O atoms only;
 MM region is not restricted.
\begin_inset CommandInset citation
LatexCommand citep
key "Wang09"
literal "true"

\end_inset


\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 Currently not in use.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

5 Mechanical embedding: The electrostatic interaction between QM and MM
 atoms is treated on the same level as within the MM region using the classical
 force field point charges also for the QM atoms.
 The electronic Hamiltonian does not contain the field generated by the
 MM region point charges and thus the electron density is not polarized
 by the MM environment.
 Does not work with GB.
 Not extensively tested in presence of link atoms.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
qmshake
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmshake
\end_layout

\end_inset

 Controls whether SHAKE is applied to QM atoms.
 Using SHAKE on the QM region will allow you to use larger time steps such
 as 2 fs with NTC=2.
 If, however, you expect bonds involving hydrogen to be broken during a
 simulation you should not SHAKE for the QM region.
 WARNING: the SHAKE routine uses the equilibrium bond lengths as specified
 in the prmtop file to reset the atom positions.
 Thus while bond force constants and equilibrium distances are not used
 in the energy calculation for QM atoms the equilibrium bond length is still
 required if QM SHAKE is on.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Do not shake QM H atoms.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Shake QM H atoms if SHAKE is turned on (NTC
\begin_inset Formula $>$
\end_inset

1) (default).
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
printdipole
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
printdipole
\end_layout

\end_inset

 Controls whether the dipole moment shall be printed every 
\emph on
ntpr
\emph default
 steps.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Do not print the dipole moment (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Print the dipole moment of the QM region.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Print the total dipole moment of the QM and MM region.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
writepdb
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
writepdb
\end_layout

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Do not write a PDB file of the selected QM region.
 (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Write a PDB file of the QM region.
 This option is designed to act as an aid to the user to allow easy checking
 of what atoms were included in the QM region.
 When this option is set a crude PDB file of the atoms in the QM region
 will be written on the very first step to the file 
\shape italic
qmmm_region.pdb
\shape default
.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
vsolv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
vsolv
\end_layout

\end_inset

 Controls whether solvent molecules shall be included into the QM region
 (requires settings in the 
\emph on
&vsolv 
\emph default
namelist; see also section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:adqmmm"

\end_inset

 on adaptive solvent QM/MM simulations, in particular the namelist information
 in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:adqmmm:namelist"

\end_inset

).
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Do not include solvent molecules into the QM region (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Include solvent molecules via simple solvent switching (requires 
\emph on
&vsolv
\emph default
 namelist).
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Adaptive solvent QM/MM with fixed number of solvent molecules in A and
 T regions (requires 
\emph on
&vsolv
\emph default
 and 
\emph on
&adqmmm
\emph default
 namelists).
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

3 Adaptive solvent QM/MM with fixed size of A and T regions (requires 
\emph on
&vsolv
\emph default
 and 
\emph on
&adqmmm
\emph default
 namelists).
\end_layout

\end_deeper
\begin_layout Standard
In addition to the above parameters, the following variables may be set,
 as described in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:qmmm-Namelist"

\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
sloppy 
\end_layout

\end_inset

qm_theory
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qm
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

theory
\end_layout

\end_inset

, dftb_disper
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dtfb
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

disper
\end_layout

\end_inset

, dftb_3rd_order
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dftb
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

3rd
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

order
\end_layout

\end_inset

 , dftb_chg
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dftb
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

chg
\end_layout

\end_inset

 , dftb_telec
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dftb
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

telec
\end_layout

\end_inset

 , dftb_maxiter
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dftb
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

maxiter
\end_layout

\end_inset

 , qmcharge
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmcharge
\end_layout

\end_inset

, spin
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
spin
\end_layout

\end_inset

, qmqmdx
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qmqmdx
\end_layout

\end_inset

, verbosity
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
verbosity
\end_layout

\end_inset

, tight_p_conv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
tight
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

p
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

conv
\end_layout

\end_inset

, scfconv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
scfconv
\end_layout

\end_inset

, pseudo_diag
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
pseudo
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

diag
\end_layout

\end_inset

, pseudo_diag_criteria
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
pseudo
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

diag
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

criteria
\end_layout

\end_inset

, diag_routine
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
diag
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

routine
\end_layout

\end_inset

, printcharges
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
printcharges
\end_layout

\end_inset

, qxd
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
qxd
\end_layout

\end_inset

, parameter_file
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
parameter
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

file
\end_layout

\end_inset

, peptide_corr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
peptide
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

corr
\end_layout

\end_inset

, and itrmax
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
itrmax
\end_layout

\end_inset

.
\end_layout

\begin_layout Subsection

\series bold
Link Atom Specific QM/MM &qmmm Namelist Variables
\begin_inset CommandInset label
LatexCommand label
name "subsec:qmmm_link_atoms"

\end_inset


\end_layout

\begin_layout Standard
The following options go in the 
\emph on
&qmmm
\emph default
 namelist and control the link atom behaviour.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lnk_dis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
lnk
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

dis
\end_layout

\end_inset

 Distance in 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
AA
\backslash

\end_layout

\end_inset

 from the QM atom to its link atom.
 Currently all link atoms must be placed at the same distance.
 A negative value of lnk_dis specifies that the link atom should be placed
 directly on top of the MM link pair atom.
 In this case the distance of the link atom from the QM region changes as
 a function of time and the actual value of lnk_dis is ignored.
 Additionally this means that not all link atoms will be placed at the same
 distance.
 Negative values of lnk_dis will work with regular link atoms, such as hydrogen,
 but are really intended for use with pseudo atom / capping approaches.
 Default = 1.09
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lnk_method
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
lnk
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

method
\end_layout

\end_inset

 This defines how classical valence terms that cross the QM/MM boundary
 are dealt with.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=1 (Default) in this case any bond, angle or dihedral that involves at least
 one MM atom, including the MM link pair atom is included.
 This means the following (where QM = QM atom, MM = MM atom, MML = MM link
 pair atom.):
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
Bonds = MM-MM, MM-MML, MML-QM
\end_layout

\begin_layout Description
Angles = MM-MM-MM, MM-MM-MML, MM-MML-QM, MML-QM-QM
\end_layout

\begin_layout Description
Dihedrals = MM-MM-MM-MM, MM-MM-MM-MML, MM-MM-MM-MML-QM, MM-MML-QM-QM, MML-QM-QM-
QM
\end_layout

\end_deeper
\begin_layout Description
=2 Only include valence terms that include a full MM atom, that is, count
 the MM link pair atom as effectively being a QM atom.
 This option is designed to be used in conjunction with a pseudo atom /
 capping type approach where the link atom is parameterized specifically
 to behave like a uni-valent version of the MM atom it replaces.
 This option gives the following interactions:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
Bonds = MM-MM, MM-MML
\end_layout

\begin_layout Description
Angles = MM-MM-MM, MM-MM-MML, MM-MML-QM
\end_layout

\begin_layout Description
Dihedrals = MM-MM-MM-MM, MM-MM-MM-MML, MM-MM-MML-QM, MM-MML-QM-QM
\end_layout

\end_deeper
\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
lnk_atomic_no
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
lnk
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

atomic
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

no
\end_layout

\end_inset

 The atomic number of the link atoms.
 This selects what element the link atoms are to be.
 Default = 1 (Hydrogen).
 Note this must be an integer and an atomic number supported by the chosen
 QM theory.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
adjust_q
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
adjust
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

q
\end_layout

\end_inset

 This controls how charge is conserved during a QMMM calculation involving
 link atoms.
 When the QM region is defined the QM atoms and any MM atoms involved in
 link bonds have their RESP charges zeroed.
 If the sum of these RESP charges does not exactly match the value of 
\shape italic
qmcharge
\shape default
 then the total charge of the system will not be correct.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 No adjustment of the charge is done.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 The charge correction is applied to the nearest 
\shape italic
nlink
\shape default
 MM atoms to MM atoms that form link pairs.
 Typically this will be any MM atom that is bonded to a MM link pair atom
 (a MM atom that is part of a QM-MM bond).
 This results in the total charge of QM+QMlink+MM equaling the original
 total system charge from the prmtop file.
 Requires natom-nquant-nlink 
\begin_inset Formula $>$
\end_inset

= nlink and nlink
\begin_inset Formula $>$
\end_inset

0.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 (default) - This option is similar to option 1 but instead the correction
 is divided among all MM atoms (except for those adjacent to link atoms).
 As with option 1 this ensures that the total charge of the QM/MM system
 is the same as that in the 
\shape italic
prmtop
\shape default
 file.
 Requires natom-nquant-nlink 
\begin_inset Formula $>$
\end_inset

= nlink.
\end_layout

\end_deeper
\begin_layout Subsection
Charge-dependent exchange-dispersion corrections of vdW interactions
\end_layout

\begin_layout Standard
The 
\emph on
sqm
\emph default
 program provides a new charge-dependent energy model consisting of van
 der Waals (vdW) and polarization interactions between the quantum mechanical
 (QM) and molecular mechanical (MM) regions in a combined QM/MM calculation.
 vdW interactions are commonly treated using empirical Lennard-Jones (L-J)
 potentials, whose parameters are often chosen based on the QM atom type
 (e.g., based on hybridization or specific covalent bonding environment).
 This strategy for determination of QM/MM nonbonding interactions becomes
 tedious to parametrize and lacks robust transferability.
 Problems occur in the study of chemical reactions where the "atom type"
 is a complex function of the reaction coordinate.
 This is particularly problematic for reactions, where atoms or localized
 functional groups undergo changes in charge state and hybridization.
 
\end_layout

\begin_layout Standard
In 
\emph on
sqm
\emph default
, this charge-dependent energy model was implemented based on a scaled overlap
 model for repulsive exchange and attractive dispersion interactions that
 is a function of atomic charge.
 The model is chemically significant since it properly correlates atomic
 size, softness, polarizability, and dispersion terms with minimal one-body
 parameters that are functions of the atomic charge
\begin_inset CommandInset citation
LatexCommand cite
key "Giese07"
literal "true"

\end_inset

.
 
\end_layout

\begin_layout Standard
This 
\begin_inset Quotes eld
\end_inset

Charge-dependent exchange-dispersion corrections of vdW interactions
\begin_inset Quotes erd
\end_inset

 can be invoked by the 
\begin_inset Quotes eld
\end_inset

qxd=.true.
\begin_inset Quotes erd
\end_inset

 switch in the 
\emph on
&qmmm
\emph default
 namelist.
 Note that this model currently does not have any effect on pure quantum
 calculations through 
\emph on
sqm
\emph default
, the qxd correction is only added to QM/MM interactions in 
\emph on
sander
\emph default
.
 The default values of qxd parameters are set to reproduce the regular L-J
 interactions of typical atom types (HC for H, C* for C, N for N, OW for
 O, and parameters for F and Cl are optimized
\begin_inset CommandInset citation
LatexCommand cite
key "Giese07"
literal "true"

\end_inset

) when the charge dependence parameters are zero.
 There are eight qxd parameters (symbols used in the reference
\begin_inset CommandInset citation
LatexCommand cite
key "Giese07"
literal "true"

\end_inset

 are indicated in the parentheses): qxd_s (
\begin_inset Formula $s$
\end_inset

), qxd_z0 (
\begin_inset Formula $\zeta(0)$
\end_inset

), qxd_zq (
\begin_inset Formula $\zeta_{q}$
\end_inset

), qxd_d0 (
\begin_inset Formula $\alpha_{1}$
\end_inset

), qxd_dq (
\begin_inset Formula $3\times B$
\end_inset

), qxd_q0 (
\begin_inset Formula $\alpha_{2}$
\end_inset

), qxd_qq (
\begin_inset Formula $3\times B$
\end_inset

), and qxd_neff (
\begin_inset Formula $N_{eff}(0)$
\end_inset

).
 All parameters can be modified through external user-defined parameter
 files (see the usage of 'parameter_file' in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:qmmm-Namelist"

\end_inset

).
\end_layout

\begin_layout Section
Interface for 
\emph on
ab initio
\emph default
 and DFT methods
\begin_inset CommandInset label
LatexCommand label
name "sec:QMMMEXTERN"

\end_inset


\end_layout

\begin_layout Standard
In addition to the built-in semi-empirical methods 
\emph on
sander
\emph default
 also supports QM/MM simulations with 
\emph on
ab initio
\emph default
 wave function theory (WFT) and density functional theory (DFT) potentials
 via an interface to external QM software packages
\begin_inset CommandInset citation
LatexCommand citep
key "GCW13"
literal "true"

\end_inset

.
 The implementation makes use of the existing QM/MM infrastructure that
 has been developed earlier for the semi-empirical methods.
 Thus, much of AMBER's previous QM/MM functionality such as the user-friendly
 link atom approach are available and the implementation remains simple
 and transparent to use without any significant additional steps in the
 simulation setup as compared to semi-empirical QM/MM simulations.
 At present the interface supports several well-known and widely used QM
 software packages.
 Mechanical embedding is available for
\end_layout

\begin_layout Itemize
ADF (Amsterdam Density Functional) 
\begin_inset CommandInset citation
LatexCommand citep
key "teVelde01,ADF2011"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
GAMESS-US 
\begin_inset CommandInset citation
LatexCommand citep
key "SBB+93,GS05"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
NWChem 
\begin_inset CommandInset citation
LatexCommand citep
key "VBG+10"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
Mechanical and electrostatic embedding is available for
\end_layout

\begin_layout Itemize
Gaussian 
\begin_inset CommandInset citation
LatexCommand citep
key "g09"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
Orca 
\begin_inset CommandInset citation
LatexCommand citep
key "ORCA2.8.0"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
Q-Chem
\begin_inset CommandInset citation
LatexCommand citep
key "SMJ+06"
literal "true"

\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "SMJ+06"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
TeraChem 
\begin_inset CommandInset citation
LatexCommand citep
key "UM09"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
QUICK 
\begin_inset CommandInset citation
LatexCommand citep
key "quick,Manathunga2020,Manathunga2021"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
MRCC 
\begin_inset CommandInset citation
LatexCommand citep
key "mrcc,Rolik2013"
literal "true"

\end_inset


\end_layout

\begin_layout Itemize
Fireball 
\begin_inset CommandInset citation
LatexCommand citep
key "Lewis2011"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
While ADF, Gaussian, Q-Chem and TeraChem are commercial programs, GAMESS-US,
 NWChem, Orca, QUICK, MRCC and Fireball are available at no cost for academic
 research.
 QUICK is available as standalone QM package but also distributed with AmberTool
s (see chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "cha:quick"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
 The QUICK library can be linked against 
\emph on
sander
\emph default
 and we recommend using this API based version over the file based interface
 (FBI), for details see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QMMM-Quick"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 Fireball, which implements
\emph on
 
\emph default
a density functional theory-based tight binding approach, requires compilation
 of 
\emph on
sander
\emph default
 with special flags, see the section on Fireball below for details.

\emph on
 
\emph default
The interface has been written in a modular fashion and is easily extensible
 to support other QM software packages.
 It is our intention to keep adding support for other software packages.
 If you are interested in interfacing a specific program, please do not
 hesitate to contact us.
\end_layout

\begin_layout Standard
The interface was developed by Andreas Goetz (SDSC, UCSD) with help of Matthew
 Clark (SDSC) and support by Ross Walker (SDSC, UCSD).
 Thanks are due to Christine Isborn and Todd Martinez (Stanford University)
 for modifications to the TeraChem code to support this interface, to Mark
 Williamson (University of Cambridge) for an initial version of the module
 that supports NWChem, Bence Hégely for contributing code that supports
 MRCC, and Jesús Mendieta and José Ortega Mateo for contributing code that
 supports Fireball.
 If you make use of this interface, please cite the following work:
\end_layout

\begin_layout Itemize
A.
 W.
 Götz, M.
 A.
 Clark, R.
 C.
 Walker, 
\emph on
An extensible interface for QM/MM molecular dynamics simulations with AMBER
\emph default
, J.
 Comput.
 Chem.
 
\series bold
35
\series default
, 95-108 (2014), DOI: 10.1002/jcc.23444
\end_layout

\begin_layout Standard
If you are using the interface with the TeraChem code, please cite in addition
 the following work:
\end_layout

\begin_layout Itemize
C.
 M.
 Isborn, A.
 W.
 Götz, M.
 A.
 Clark, R.
 C.
 Walker, T.
 J.
 Martínez, 
\shape italic
Electronic Absorption Spectra from MM and ab initio QM/MM Molecular Dynamics:
 Environmental Effects on the Absorption Spectrum of Photoactive Yellow
 Protein
\shape default
, J.
 Chem.
 Theory Comput.
 
\series bold
8
\series default
, 5092-5106 (2012), DOI: 10.1021/ct3006826
\end_layout

\begin_layout Standard
If you are using the interface with the MRCC code, please cite in addition
 the following work:
\end_layout

\begin_layout Itemize
B.
 Hégely, F.
 Bogár, G.
 G.
 Ferenczy, M.
 Kállay, 
\emph on
A QM/MM program for calculations with frozen localized orbitals based on
 the Huzinaga equation
\emph default
, Theoret.
 Chem.
 Acc.
 
\series bold
134
\series default
, 132 (2015), DOI: 10.1007/978-3-662-49825-5_16
\end_layout

\begin_layout Standard
If you are using the interface with the Fireball code, please cite in addition
 the following work:
\end_layout

\begin_layout Itemize
J.
 I.
 Mendieta-Moreno, R.
 C.
 Walker, J.
 P.
 Lewis, P.
 Gómez-Puertas, J.
 Mendieta, J.
 Ortega, 
\emph on
FIREBALL/AMBER: An efficient local-orbital DFT QM/MM method for biomolecular
 systems
\emph default
, J.
 Chem.
 Theory Comput.
 10, 2185-2193 (2014), DOI: 10.1021/ct500033w
\end_layout

\begin_layout Standard
Access to QM methods not available within Amber is also possible via the
 Amber interface to the PUPIL simulation framework.
 For details, see 
\begin_inset CommandInset citation
LatexCommand citealp
before "refs."
key "Torras07,Torras08"
literal "true"

\end_inset

.
 In what follows we will describe the new interface that is native to 
\emph on
sander
\emph default
.
\end_layout

\begin_layout Subsection
Theory
\end_layout

\begin_layout Standard
As described in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QMMM:semiempirical"

\end_inset

, the Hamiltonian of a system that is partitioned into a QM region that
 is treated with WFT and a classical region that is treated with MM consists
 of three components and the energy associated with this Hamiltonian is
 obtained as the corresponding expectation value
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout


\backslash
label{e:EQMMMtotal}
\end_layout

\begin_layout Plain Layout

E=
\backslash
langle
\backslash
Psi|
\backslash
mathcal{H}_{
\backslash
mathrm QM}+
\backslash
mathcal{H}_{
\backslash
mathrm QM/MM}|
\backslash
Psi
\backslash
rangle+E_{
\backslash
mathrm MM}.
\end_layout

\begin_layout Plain Layout


\backslash
end{equation} 
\end_layout

\end_inset

A QM/MM calculation therefore requires not only to choose the WFT used in
 the QM region and the MM model used for the MM region, but in addition
 also the form of the QM/MM Hamiltonian which describes the interaction
 between the quantum and the classical region.
 The most simple approach is to neglect any electronic coupling between
 the QM and the MM system and include only the classical non-bonded van
 der Waals (vdW) and electrostatic interactions between the QM and the MM
 atoms.
 This is useful to impose steric constraints on the embedded QM system and
 commonly referred to as mechanical embedding.
 In most cases, however, it is better to allow for an explicit polarization
 of the QM system due to the presence of the point charges on the MM atoms.
 This is referred to as electronic embedding and the resulting interaction
 energy becomes
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout


\backslash
label{e:EQMMM}
\end_layout

\begin_layout Plain Layout


\backslash
begin{split}
\end_layout

\begin_layout Plain Layout

 E_{
\backslash
mathrm QM/MM}^{
\backslash
mathrm electronic}=&
\end_layout

\begin_layout Plain Layout

 
\backslash
sum_{A
\backslash
in{
\backslash
mathrm MM}}
\backslash
int
\backslash
rho(
\backslash
mathbf{r})
\backslash
frac{Q_A}{|
\backslash
mathbf{r}-
\backslash
mathbf{R}_A|}
\backslash
,d
\backslash
mathbf{r}
\end_layout

\begin_layout Plain Layout

 +
\backslash
sum_{A
\backslash
in{
\backslash
mathrm QM},B
\backslash
in{
\backslash
mathrm MM}}
\backslash
frac{Z_AQ_B}{R_{AB}}
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

 &+
\backslash
sum_{A
\backslash
in{
\backslash
mathrm QM},B
\backslash
in{
\backslash
mathrm MM}}   
\backslash
varepsilon_{AB}
\backslash
left[     
\end_layout

\begin_layout Plain Layout

   
\backslash
left(
\backslash
frac{
\backslash
sigma_{AB}}{R_{AB}}
\backslash
right)^{12}
\end_layout

\begin_layout Plain Layout

   -
\backslash
left(
\backslash
frac{
\backslash
sigma_{AB}}{R_{AB}}
\backslash
right)^6
\end_layout

\begin_layout Plain Layout

 
\backslash
right].
\end_layout

\begin_layout Plain Layout


\backslash
end{split}
\end_layout

\begin_layout Plain Layout


\backslash
end{equation} 
\end_layout

\end_inset

This QM/MM energy expression also holds for DFT and the terms represent,
 in order, the electrostatic interaction between the QM electron density
 and the MM point charges, the electrostatic interation between the QM point
 charge nuclei and the MM point charges, and the van der Waals repulsion
 between the QM and MM atoms.
 
\end_layout

\begin_layout Standard
The forces acting on an atom 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$A$
\end_layout

\end_inset

 in a QM/MM calculation are given in terms of derivatives of the total energy
 expression 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
eqref{e:EQMMMtotal}
\end_layout

\end_inset

 with respect to the Cartesian coordinates of the atom,
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout

  
\backslash
mathbf{F}_A=-
\backslash
nabla_A E_{
\backslash
mathrm QM}-
\backslash
nabla_A E_{
\backslash
mathrm QM/MM}-
\backslash
nabla_A E_{
\backslash
mathrm MM},
\end_layout

\begin_layout Plain Layout


\backslash
end{equation} 
\end_layout

\end_inset

where 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$
\backslash
nabla_A=
\backslash
partial/
\backslash
partial
\backslash
mathbf{R}_A=(
\backslash
partial/
\backslash
partial R_A^x,
\backslash
partial/
\backslash
partial R_A^y,
\backslash
partial/
\backslash
partial R_A^z)$
\end_layout

\end_inset

.
 If a QM and an MM program are coupled for QM/MM calculations, the QM program
 will calculate the QM forces 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$-
\backslash
nabla_A E_{
\backslash
mathrm QM}$
\end_layout

\end_inset

 acting on QM atoms and the MM program the MM forces 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$-
\backslash
nabla_A E_{
\backslash
mathrm MM}$
\end_layout

\end_inset

 acting on the MM atoms.
 All that remains, is to calculate the forces acting on QM and MM atoms
 due to the QM/MM interaction energy, 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$-
\backslash
nabla_{A} E_{
\backslash
mathrm QM/MM}$
\end_layout

\end_inset

.
 For mechanical embedding this will be entirely handled by the MM program.
 For electronic embedding the forces are given as
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout


\backslash
label{e:QMMMgradQM}
\end_layout

\begin_layout Plain Layout


\backslash
begin{split}
\end_layout

\begin_layout Plain Layout

 
\backslash
nabla_AE_{
\backslash
mathrm QM/MM}^{
\backslash
mathrm electronic}
\end_layout

\begin_layout Plain Layout

 &=Z_A
\backslash
sum_{B
\backslash
in{
\backslash
mathrm MM}}
\backslash
frac{Q_B(
\backslash
mathbf{R}_A-
\backslash
mathbf{R}_B)}{R_{AB}^3}
\end_layout

\begin_layout Plain Layout

 +
\backslash
sum_{B
\backslash
in{
\backslash
mathrm MM}}
\backslash
int
\backslash
frac{
\backslash
partial
\backslash
rho(
\backslash
mathbf{r})}{
\backslash
partial
\backslash
mathbf{R}_A}     
\end_layout

\begin_layout Plain Layout

   
\backslash
frac{Q_B}{|
\backslash
mathbf{r}-
\backslash
mathbf{R}_B|}
\backslash
,d
\backslash
mathbf{r}
\end_layout

\begin_layout Plain Layout

  +
\backslash
sum_{B
\backslash
in{
\backslash
mathrm MM}}
\backslash
nabla_AV^{
\backslash
mathrm LJ}_{AB}
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

 &=-Z_A
\backslash
mathbf{E}_{
\backslash
mathrm MM}(
\backslash
mathbf{R}_A)
\end_layout

\begin_layout Plain Layout

  -
\backslash
int
\backslash
rho(
\backslash
mathbf{r})
\backslash
mathbf{E}_{
\backslash
mathrm MM}(
\backslash
mathbf{r})
\backslash
,d
\backslash
mathbf{r}
\end_layout

\begin_layout Plain Layout

  +
\backslash
sum_{B
\backslash
in{
\backslash
mathrm MM}}
\backslash
nabla_AV^{
\backslash
mathrm LJ}_{AB}
\end_layout

\begin_layout Plain Layout


\backslash
end{split}
\end_layout

\begin_layout Plain Layout


\backslash
end{equation}
\end_layout

\end_inset

for the derivatives with respect to the positions of the QM atoms 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$A$
\end_layout

\end_inset

 where 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$
\backslash
mathbf{E}_{
\backslash
mathrm MM}$
\end_layout

\end_inset

 is the electric field generated by the MM point charges and and 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$V^{
\backslash
mathrm LJ}_{AB}$
\end_layout

\end_inset

 is the Lennard-Jones potential from 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
eqref{e:EQMMM}
\end_layout

\end_inset

 and
\end_layout

\begin_layout Standard
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
begin{equation}
\end_layout

\begin_layout Plain Layout


\backslash
label{e:QMMMgradMM}
\end_layout

\begin_layout Plain Layout


\backslash
begin{split}
\end_layout

\begin_layout Plain Layout

 
\backslash
nabla_B E_{
\backslash
mathrm QM/MM}^{
\backslash
mathrm electronic}
\end_layout

\begin_layout Plain Layout

 &=Q_B
\backslash
sum_{A
\backslash
in{
\backslash
mathrm QM}}
\backslash
frac{Z_A(
\backslash
mathbf{R}_B-
\backslash
mathbf{R}_A)}{R_{AB}^3}     
\end_layout

\begin_layout Plain Layout

 +
\backslash
int
\backslash
rho(
\backslash
mathbf{r})
\end_layout

\begin_layout Plain Layout

   
\backslash
frac{Q_B(
\backslash
mathbf{R}_B-
\backslash
mathbf{r})}{|
\backslash
mathbf{r}-
\backslash
mathbf{R}_B|^3}
\backslash
,d
\backslash
mathbf{r}
\end_layout

\begin_layout Plain Layout

 +
\backslash
nabla_BE_{
\backslash
mathrm QM/MM}^{
\backslash
mathrm mechanic}
\backslash

\backslash

\end_layout

\begin_layout Plain Layout

 &=-Q_B
\backslash
mathbf{E}_{
\backslash
mathrm QM}(
\backslash
mathbf{R}_B)
\end_layout

\begin_layout Plain Layout

 +
\backslash
sum_{A
\backslash
in{
\backslash
mathrm QM}}
\backslash
nabla_BV^{
\backslash
mathrm LJ}_{AB}
\end_layout

\begin_layout Plain Layout


\backslash
end{split}
\end_layout

\begin_layout Plain Layout


\backslash
end{equation} 
\end_layout

\end_inset

for the derivatives with respect to the positions of the MM atoms 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$B$
\end_layout

\end_inset

 where 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$
\backslash
mathbf{E}_{
\backslash
mathrm QM}$
\end_layout

\end_inset

 is the electric field due to the QM charge distribution.
 The contributions to the gradient due to the point charge interactions
 and due to the interaction between the MM point charges and the QM electrons
 is evaluated by the QM program.
 Some QM programs do not calculate the forces acting on the MM atoms (point
 charges) due to the presence of the QM system but in general are able to
 return the electric field 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$
\backslash
mathbf{E}_{
\backslash
mathrm QM}$
\end_layout

\end_inset

 at arbitrary points in space which is then used to obtain these forces.
 The van der Waals repulsion (Lennard-Jones interaction) between QM and
 MM atoms is treated by AMBER in the same way as for semiempirical NDDO-type
 and DFTB methods.
\end_layout

\begin_layout Subsection
General Remarks
\end_layout

\begin_layout Standard
When using the AMBER interface to external QM software packages for performing
 WFT or DFT based QM or QM/MM MD simulations, it is absolutely critical
 to be aware of the capabilities and limitations of the QM method to be
 employed.
 In particular, QM based MD can be more tricky than MM based MD in the sense
 that it is more likely that the QM program can fail for example due to
 SCF convergence problems.
 This can be the case if the geometry of the QM region is far from its ground
 state equilibrium, for example because a simulation is started from a bad
 geometry or performed at high temperature.
 
\end_layout

\begin_layout Standard
We have gone to large efforts and analyzed a large set of test simulations
 to provide the best default parameters for the supported QM programs such
 that forces are computed with sufficient accuracy to guarantee energy coservati
on for constant energy MD simulations.
 Of particular importance are SCF convergence and associated integral neglect
 thresholds and the size of the grid used for the numerical quadrature of
 the exchange-correlation (XC) potential and energy for DFT calculations.
 However, other than providing appropriate input parameters, AMBER does
 not have any control over the external program and it is at the user's
 discretion to employ sensible input parameters for the QM program and to
 prepare the system such that the simulations are started at a reasonable
 starting structure.
 
\end_layout

\begin_layout Standard
In any case we highly recommend to write restart files frequently so that
 a simulation can be restarted without loss of much computational time in
 the case that a simulation should crash.
 The interface also stores the last in- and output files of the external
 QM program during each MD step.
 Should there be any problems with the QM program, it is therefore possible
 to analyze the reasons and take appropriate countermeasures.
 
\end_layout

\begin_layout Standard
The interface requires data to be exchanged between 
\emph on
sander
\emph default
 and the QM program.
 The default operation of the interface is based on file exchange and system
 calls and, during each step of a geometry optimization or an MD simulation,
 writes an input file for the external program, starts a single point gradient
 calculation with the external program, and reads the energy and forces
 from the external program's output file (binary ADF checkpoint or formatted
 GAMESS, Gaussian, ORCA, Q-Chem, MRCC or TeraChem output files).
 Data communication via MPI is also implemented and currently supported
 by TeraChem.
 An exception is Fireball, which is interfaced as a linked library against
 
\emph on
sander
\emph default
 (see below).
\end_layout

\begin_layout Subsection
Limitations
\end_layout

\begin_layout Standard
In principle, all types of simulations that are possible with sander are
 supported.
 There are, however, some restrictions for simulations that require 
\emph on
sander
\emph default
 to run in parallel, in particular path integral molecular dynamics (PIMD)
 and replica exchange molecular dynamics (REMD), see the discussion of Paralleli
zation below.
 The interface to external QM programs also lacks some features regarding
 solvent models in comparison to the semiempirical MNDO and DFTB QM/MM implement
ation that is available in AMBER, the most critical ones are listed here.
 
\end_layout

\begin_layout Paragraph
Generalized Born
\end_layout

\begin_layout Standard
Generalized Born (GB) implicit solvent models are not supported if external
 QM programs are used for the QM region.
\end_layout

\begin_layout Paragraph
Particle Mesh Ewald (PME) and Periodic Boundary Conditions
\end_layout

\begin_layout Standard
The PME approach for treating long-range electrostatic QM/MM and QM/QM interacti
ons in periodic systems is currently not supported.
 It is possible to use periodic boundary conditions but a cutoff is used
 for the point charges to be included in the QM Hamiltonian (determined
 by 
\emph on
&qmmm
\emph default
 namelist variable 
\emph on
qmcut
\emph default
) thus truncating the long-range QM/MM electrostatic interactions in 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout


\backslash
eqref{e:EQMMM}
\end_layout

\end_inset

.
 This leads to discontinuities in the potential energy surface and poor
 energy conservation for MD runs in the NVE ensemble.
 The user may consider running non-periodic simulations with a cutoff that
 is larger than the system size thus effectively including all interactions.
 
\end_layout

\begin_layout Subsection
Performance Considerations
\end_layout

\begin_layout Standard
The computational cost of DFT is comparable to Hartree–Fock (HF) theory
 which is the simplest WFT method that serves as zeroth order approximation
 for more elaborate correlated WFT methods such as Møller–Plesset perturbation
 theory, configuration interaction theory and coupled cluster theory.
 The calculations can be accelerated by using density fitting approaches,
 sometimes called resolution-of-identity (RI) approximation, which in the
 case of DFT with exchange-correlation (XC) functionals that do not require
 admixture of exact HF-exchange, leads to speedups of roughly one order
 of magnitude without compromising the accuracy of the results.
 Nevertheless, the computational cost of DFT is in general two to three
 orders of magnitude higher than that of semiempirical QM models.
 We recommend to carefully test the performance of the QM program to choose
 an optimal number of processor counts for parallelized QM calculations.
 Typical simulation performance for typical QM system sizes of tens of atoms
 will be on the order of a few picoseconds per day, depending on the underlying
 QM model chosen.
 
\end_layout

\begin_layout Subsection
Parallelization
\end_layout

\begin_layout Standard
The MPI parallel executable 
\emph on
sander.MPI
\emph default
 can be used to run QM/MM MD simulations with external QM software in which
 the MM portion of the calculation is parallelized.
 However, the computational cost of the MM part is usually small compared
 to the cost of the QM part.
 In order to execute the QM part of the calculation in parallel, the external
 QM program has to be instructed to do so, as described in the sections
 below.
\end_layout

\begin_layout Standard
In the case of PIMD or REMD simulations that require a separate energy and
 force evaluation for each group at each time step, the parallelized executable
\emph on
 sander.MPI
\emph default
 has to be used.
 Multiple processes can be launched per group to parallelize the MM calculations.
 Care has to be taken to choose the right number of parallel threads in
 the external QM program.
 For example, on a machine with 32 cores, a simulation with 16 beads or
 replicas can run the external QM program with 2 threads in parallel to
 make maximum use of the available processing cores.
 If the available processors are spread over multiple nodes, special care
 has to be taken to ensure that the different instances of the external
 QM program are launched on the correct nodes.
\end_layout

\begin_layout Standard
It is possible to execute 
\emph on
sander.MPI 
\emph default
in parallel via MPI while also running MPI or OpenMP parallel versions of
 the external QM program.
 Depending on the MPI implementation, this can, however, fail.
 In our experience, MPICH and MVAPICH work well while OpenMPI does not work.
\end_layout

\begin_layout Subsection
Usage
\end_layout

\begin_layout Standard
\align block
All that is required to use the interface is a working installation of AMBER
 and one or more of the supported QM programs.
 In order to use the external program from within 
\emph on
sander
\emph default
, the 
\emph on
&cntrl
\emph default
 namelist variable 
\emph on
ifqnt = 1
\emph default
 must be set to enable QM calculations and the 
\emph on
&qmmm
\emph default
 namelist variable 
\emph on
qm_theory = 'EXTERN'
\emph default
 must be set to enable the external interface.
 The 
\emph on
&qmmm
\emph default
 namelist variable 
\emph on
qmmask
\emph default
 or 
\emph on
iqmatoms 
\emph default
is used for selecting the QM region just as for QM/MM calculations with
 the semiempirical NDDO-type and DFTB approaches that are natively available
 in AMBER.
 Charge and spin multiplicity for the QM region need to be defined via the
 variables 
\shape italic
qmcharge
\shape default
 and 
\shape italic
spin
\shape default
, respectively, in the 
\shape italic
&qmmm
\shape default
 namelist.
 For a QM MD simulation, the sander input file therefore needs to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

! example input for QM simulation with external QM program
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

  ...
\end_layout

\begin_layout Plain Layout

  ifqnt = 1,             ! switch on QM/MM
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&qmmm
\end_layout

\begin_layout Plain Layout

  qmmask = '@*',         ! select QM atoms (here: make all QM)
\end_layout

\begin_layout Plain Layout

  qmcharge = 0,          ! charge on QM region (default = 0)
\end_layout

\begin_layout Plain Layout

  spin = 1,              ! spin multiplicity of QM region (default = 1)
\end_layout

\begin_layout Plain Layout

  qm_theory = 'EXTERN',  ! use external QM program
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
For QM/MM simulations with electronic embedding (this is the default) we
 recommend to include all MM point charges as external electric field in
 the QM Hamiltonian to avoid problems with energy conservation.
 For non-periodic simulations this can be achieved by setting the 
\emph on
&qmmm
\emph default
 namelist variable 
\emph on
qmcut
\emph default
 to a value larger than the system size.
 
\end_layout

\begin_layout Standard
In addition either the 
\emph on
&adf
\emph default
, 
\emph on
&gms
\emph default
, 
\emph on
&nw
\emph default
, 
\emph on
&gau
\emph default
, 
\emph on
&orc
\emph default
, 
\emph on
&qc, &mrcc
\emph default
 or 
\emph on
&tc
\emph default
 namelist must be present to use either ADF, GAMESS, NWChem, Gaussian, ORCA,
 Q-Chem, MRCC or TeraChem, respectively, and to assign parameters for the
 external QM program.
 Please refer to the ADF, GAMESS, NWChem, Gaussian, ORCA, Q-Chem, MRCC or
 TeraChem user manual for details on settings for the 
\emph on
ab initio
\emph default
 or DFT calculations.
 A list of namelist variables and their default setting is given below.
 The defaults have been chosen such that energy conserving MD simulations
 in the NVE ensemble are possible.
 NWChem has not been extensively tested.
\end_layout

\begin_layout Standard
Properties that are calculated along the trajectory are printed to property
 files with names 
\family typewriter
adf_job.ext
\family default
, 
\family typewriter
gms_job.ext
\family default
, 
\family typewriter
gau_job.ext
\family default
, 
\family typewriter
orc_job.ext
\family default
, 
\family typewriter
qc_job.ext
\family default
 and 
\family typewriter
tc_job.ext
\family default
, where 
\family typewriter
ext
\family default
 is either 
\family typewriter
dip
\family default
 for dipole moment (x, y, z component and absolute value) or 
\family typewriter
chg
\family default
 for atomic charges, where supported.
 These property files are only written if requested and will be deleted
 at the beginning of a run, so back them up in case a trajectory needs to
 be restarted.
 
\end_layout

\begin_layout Standard
All calculations with a spin multiplicity larger than one will automatically
 be performed in the framework of an unrestricted formalism (as opposend
 to restricted open shell), that is with unrestricted HF (UHF), unrestricted
 DFT (UDFT) and MP2 with a UHF reference wave function (UMP2).
 
\end_layout

\begin_layout Standard
In addition to controlling the external programs via the
\emph on
 sander
\emph default
 input file, you may supply a template input file for the external program
 in order to provide input that is not supported via the program specific
 namelists.
 To enable this option, you must set 
\family typewriter
use_template = 1
\family default
 in the program specific namelist.
 The format, name, and input requirements for the template file vary with
 the external program as detailed in the corresponding program's documentation
 below.
 If you are using your own template, please make sure that the parameters
 of the QM method (like SCF convergence threshold and XC quadrature grid
 size) yield sufficiently accurate forces.
 Please note that program settings supplied via the program specific namelist
 are ignored if a template input file is used.
\end_layout

\begin_layout Subsubsection
AMBER/ADF
\end_layout

\begin_layout Standard
To use ADF with the external interface, ADF must be properly installed on
 the working machine.
 In particular, the executable 
\family typewriter
adf
\family default
 must be in the search path.
 By default the Becke integration grid with quality 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 and the ZLM fit method with quality 
\begin_inset Quotes eld
\end_inset

good
\begin_inset Quotes erd
\end_inset

 is employed.
 If you prefer to use the old pair fit method (or are using an older ADF
 version that does not support the ZLM fit), we recommend to use 
\begin_inset Quotes eld
\end_inset

ZORA/QZ4P
\begin_inset Quotes erd
\end_inset

 basis set for the density fit for sufficiently accurate forces.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
At present only mechanical embedding is supported.
\end_layout

\begin_layout Paragraph

\emph on
&adf
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Basis set type to be used in the DFT calculation.
 Valid standard basis set types are: SZ, DZ, DZP, TZP, TZ2P, TZ2P+ and ZORA/QZ4P.
 (Default: basis = 'DZP') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
core
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
core
\end_layout

\end_inset

 Type of frozen core to use.
 Allowed values are: None, Small, Medium, Large.
 (Default: core = 'None') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
zlmfit
\begin_inset Index idx
status open

\begin_layout Plain Layout
zlmfit
\end_layout

\end_inset

 Quality of density fit with the ZLM fit method.
 (Default: zlmfit = 'good')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
fit_type
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
fit_type
\end_layout

\end_inset

 Fit basis set type to be used for density fitting with the old pair fit
 method.
 Valid values are identical to the available basis sets (SZ, DZ etc) in
 which case the fit basis corresponding to the AO Basis will be used.
 By default the ZLM fit method will be used (Default: fit_type = '')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
xc
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
xc
\end_layout

\end_inset

 Exchange-correlation functional to be used.
 Popular choices are 'LDA VWN', 'GGA BLYP', 'GGA PBE', 'HYBRID B3LYP' and
 'HYBRID PBE0'.
 Consult the ADF manual for all available options.
 (Default: xc = 'GGA BLYP')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scf_iter
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
scf_iter
\end_layout

\end_inset

 Maximum number of SCF cycles allowed.
 (Default: scf_iter = 50) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scf_conv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
scf_conv
\end_layout

\end_inset

 Threshold upon which to stop the SCF procedure.
 The tested error is the commutator of the Fock matrix and the density matrix.
 Convergence is considered to be achieved if the maximum element of the
 commutator (which is zero for an optimized wave function) is smaller than
 scf_conv.
 (Default: scf_conv = 1.0d-06)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
beckegrid
\begin_inset Index idx
status open

\begin_layout Plain Layout
beckegrid
\end_layout

\end_inset

 Quality of Becke integration grid.
 Allowed values are: Normal, Good, VeryGood.
 (Default: core = 'Good') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
integration
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
integration
\end_layout

\end_inset

 Numerical integration accuracy for integration with olde teVelde-Baerends
 integration grid (Voronoi cells).
 By default the Becke grid will be used.
 The old integration grid can be used by specifying a number larger than
 0, we recommend at least 5.0.
 (Default: integration = -1.0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
num_threads
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
num_threads
\end_layout

\end_inset

 Number of threads (and thus CPU cores) for ADF to use.
 Note that this is not required if you are running in a queuing system as
 ADF will automatically use the full number of reserved cores.
 (Default: num_threads = 0 [this causes ADF to use all available cores on
 a machine]) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_dftb
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
use_dftb
\end_layout

\end_inset

 Specifies whether DFTB shall be used with ADF's DFTB program dftb.
 If use_dftb = 1 then DFTB will be used and only variables charge and scf_conv
 will be considered.
 (Default: use_dftb = 0 [do not use DFTB, regular DFT calculation]) - works
 only with older DFTB versions (prior to 2011).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
exactdensity
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
exactdensity
\end_layout

\end_inset

 The exact (as opposed to fitted) electron density is used for the evaluation
 of the exchange-correlation potential if exactdensity = 1.
 (Default: exactdensity = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 Determine whether or not to use a user-provided template file for running
 external programs.
 (Default: use_template = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Controls frequency of printing for dipole moment to file 
\family typewriter
adf_job.dip
\family default
 (Defaults to &cntrl namelist variable ntpr)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dipole
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dipole
\end_layout

\end_inset

 Toggles writing of dipole moment to file 
\family typewriter
adf_job.dip
\family default
 (Default: dipole = 0)
\end_layout

\begin_layout Paragraph
Example
\end_layout

\begin_layout Standard
An input file for QM or (mechanical embedding) QM/MM MD with ADF using the
 PBE functional and the TZP basis set therefore would have to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&adf
\end_layout

\begin_layout Plain Layout

  xc = 'GGA PBE',
\end_layout

\begin_layout Plain Layout

  basis = 'TZP',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
This would execute a simulation in which the Beckgrid with quality quality
 good and the ZLM fit with quality good are used (see default values above).
\end_layout

\begin_layout Paragraph
Template input file
\end_layout

\begin_layout Standard
The template file for ADF should be named 
\family typewriter
adf_job.tpl
\family default
 and must contain the following keywords:
\end_layout

\begin_layout LyX-Code
BASIS ...
 END
\end_layout

\begin_layout LyX-Code
SAVE TAPE21
\end_layout

\begin_layout Standard
You should not include the following (block) keywords in the template file
 as these are taken care of by 
\emph on
sander
\emph default
:
\end_layout

\begin_layout LyX-Code
UNITS
\end_layout

\begin_layout LyX-Code
FRAGMENTS ...
 END
\end_layout

\begin_layout LyX-Code
RESTART
\end_layout

\begin_layout LyX-Code
GRADIENT
\end_layout

\begin_layout LyX-Code
ATOMS ...
 END
\end_layout

\begin_layout Subsubsection
AMBER/GAMESS-US
\end_layout

\begin_layout Standard
To use GAMESS with the external interface, GAMESS must be compiled on the
 target system.
 Make note of the version number you specify during the GAMESS compilation
 process (default is 00 which makes the GAMESS execution script 
\family typewriter
rungms
\family default
 look for the executable 
\family typewriter
gamess.00.x
\family default
).
 If you use a different version number you must specify it with the 
\emph on
gms_version
\emph default
 namelist variable.
 
\family typewriter
$GMS_PATH
\family default
 should be set to the path where the script 
\family typewriter
rungms
\family default
 is located (for example 
\family typewriter
/opt/gamess/
\family default
).
 We assume that the 
\family typewriter
rungms
\family default
 script copies the output 
\family typewriter
.dat
\family default
 files to the directory from which GAMESS is invoked.
 If this is not the case, please modify the script 
\family typewriter
rungms
\family default
 accordingly.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
Only mechanical embedding is supported with GAMESS.
 The available QM models are limited to HF, DFT and MP2 since only for these
 analytical gradients are available in GAMESS.
\end_layout

\begin_layout Paragraph

\emph on
&gms
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Basis set type to be used in the calculation.
 Presently supported are the Pople type basis sets STO-3G, 6-31G, 6-31G*,
 6-31G**, 6-31+G*, 6-31++G*, 6-311G, 6-311G* and 6-311G**.
 Also supported are the Karlsruhe valence triple zeta basis sets KTZV, KTZVP
 and KTZVPP (with none, one and two polarization functions, respectively)
 and the Dunning-type correlation consistent basis sets CCn (n = D, T, Q,
 5, 6; officially called cc-pVnZ) and ACCn (as CCn but augmented with a
 set of diffuse function, officially called aug-cc-pVnZ).
 (Default: basis = "6-31G*")
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
method
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
method
\end_layout

\end_inset

 QM method to be used.
 At present, we support 'HF' for Hartree–Fock, 'MP2' for second order Møller-Ple
sset perturbation theory and any of the supported DFT functionals.
 Popular choices for for DFT functionals include BP86, BLYP, PBE, B3LYP
 or PBE0.
 (Default: method = "BP86")
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nrad
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
nrad
\end_layout

\end_inset

 Number of radial points in the Euler-MacLaurin quadrature of the XC potential
 and energy density.
 (Default: nrad = 96)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nleb
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
nleb
\end_layout

\end_inset

 Number of angular points in the Lebedev grids for the numerical quadrature
 of the XC potential and energy density.
 (Default: nleb = 590 [The GAMESS default of 302 is not accurate enough
 to conserve energy]) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scf_conv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
scf_conv
\end_layout

\end_inset

 SCF convergence threshold.
 Convergence is reached when the absolute density change between two consecutive
 SCF cycles is less than scf_conv}.
 (Default: scf_conv = 1.0D-06)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
maxit
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
maxit
\end_layout

\end_inset

 Maximum number of SCF iterations.
 (Default: maxit = 50)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
gms_version
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
gms_version
\end_layout

\end_inset

 This is the version number specified when building GAMESS.
 (Default: gms_version = 00)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
num_threads
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
num_threads
\end_layout

\end_inset

 Number of threads (and thus CPU cores) for GAMESS to use.
 Note that GAMESS may require a special setup in the 
\family typewriter
rungms
\family default
 script to be able to run using multiple threads.
 Unless num_threads is explicitly specified, GAMESS will only use one thread
 (run on one core).
 (Default: num_threads = 1)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mwords
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
mwords
\end_layout

\end_inset

 The maximum replicated memory which your job can use, on every node.
 This is given in units of 1,000,000 words (as opposed to 1024*1024 words),
 where a word is defined as 64 bits.
 You may need to increase this value if GAMESS crashes due to not having
 enough memory allocated.
 (Default: mwords = 50)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 Determine whether or not to use a user-provided template file for running
 external programs.
 (Default: use_template = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Controls frequency of printing for dipole moment and atomic charges to
 files 
\family typewriter
gms_prop.ext
\family default
 (Defaults to &cntrl namelist variable ntpr)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
chelpg
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
chelpg
\end_layout

\end_inset

 CHELPG charges are calculated if chelpg = 1.
 These charges are written to the file 
\family typewriter
gms_prop.chg
\family default
 (Default: chelpg = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dipole
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dipole
\end_layout

\end_inset

 Toggles writing of dipole moment to file 
\family typewriter
gms_prop.dip
\family default
 (Default: dipole = 0)
\end_layout

\begin_layout Paragraph
Example
\end_layout

\begin_layout Standard
An input file for QM or (mechanical embedding) QM/MM MD with GAMESS using
 the PBE functional and the 6-31G** basis set that should run GAMESS on
 16 CPU cores therefore would have to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&gms
\end_layout

\begin_layout Plain Layout

  method = 'DFT',
\end_layout

\begin_layout Plain Layout

  dfttyp = 'PBE',
\end_layout

\begin_layout Plain Layout

  basis  = '6-31G**',
\end_layout

\begin_layout Plain Layout

  num_threads = 16,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout Paragraph
Template input file
\end_layout

\begin_layout Standard
The template file for GAMESS should be named 
\family typewriter
gms_job.tpl
\family default
 and the 
\family typewriter
$CONTRL
\family default
 card must contain the following keywords:
\end_layout

\begin_layout LyX-Code
RUNTYP=GRADIENT
\end_layout

\begin_layout LyX-Code
UNIT=ANGS
\end_layout

\begin_layout LyX-Code
COORD=UNIQUE
\end_layout

\begin_layout Standard
You should not include the 
\family typewriter
$DATA
\family default
 card in the template file as it is taken care of by 
\emph on
sander
\emph default
.
 
\end_layout

\begin_layout Subsubsection
AMBER/Gaussian
\end_layout

\begin_layout Standard
To use Gaussian with the interface, Gaussian 16, Gaussian 09, or Gaussian
 03 must be properly installed on the system and a g16, g09, or g03 executable
 must be in the path.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
A cutoff is applied to QM/MM interactions in QM/MM simulations using electrostat
ic embedding with and without PBCs.
 This leads to discontinuities in the potential energy surface and poor
 energy conservation.
 In the case of QM/MM simulations without PBCs, this cutoff (
\emph on
qmcut
\emph default
 variable in the 
\emph on
&qmmm
\emph default
 namelist) can be set to a number that is larger than the simulated system,
 thus effectively not applying a cutoff.
 This is recommended.
\end_layout

\begin_layout Paragraph

\emph on
&gau
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Basis set type to be used in the calculation.
 Any basis set that is natively supported by Gaussian can be used.
 Examples are the single zeta, split valence or triple zeta Pople type basis
 sets STO-3G, 3-21G, 6-31G and 6-311G.
 The split-valence or triple zeta basis sets can be augmented with diffuse
 functions on heavy atoms or additionally hydrogen by adding one or two
 plus signs, respectively, as in 6-31++G.
 Polarization functions on heavy atoms or additionally hydrogens are used
 by adding one or two stars, respectively, as in 6-31G**.
 (Default: basis = "6-31G*") 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
method
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
method
\end_layout

\end_inset

 Method to be used in the calculation.
 Can either be one of the WFT models for which Gaussian supports gradients,
 for example RHF or MP2, or some supported DFT functional.
 Popular choices are BLYP, PBE and B3LYP.
 (Default: method = "BLYP")
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scf_conv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
scf_conv
\end_layout

\end_inset

 Threshold upon which to stop the SCF procedure.
 The tested error is the commutator of the Fock matrix and the density matrix.
 Convergence is considered to be achieved if the maximum element of the
 commutator (which is zero for an optimized wave function) is smaller than
 scf_conv}.
 Set in the form of 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$10^{-N}$
\end_layout

\end_inset

.
 (Default: scf_conv = 8) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
num_threads
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
num_threads
\end_layout

\end_inset

 Number of threads (and thus CPU cores) for Gaussian to use.
 Unless num_threads is explicitly specified, Gaussian will only use one
 thread (run on one core).
 (Default: num_threads = 1)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
executable
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
executable
\end_layout

\end_inset

 Optional name of the Gaussian executable.
 (Default: If a string for this namelist variable is not specified then
 g16, g09, and g03 are tried in that order producing a fatal error if none
 are found.
 Note that if a string is specified then it is a fatal error if that executable
 is not found.)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 Determine whether or not to use a user-provided template file for running
 external programs.
 (Default: use_template = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Controls frequency of printing for dipole moment to file 
\family typewriter
gau_job.
\family default
dip (Defaults to &cntrl namelist variable ntpr)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dipole
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dipole
\end_layout

\end_inset

 Toggles writing of dipole moment to file 
\family typewriter
gau_job.
\family default
dip (Default: dipole = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mem
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
mem
\end_layout

\end_inset

 String that specifies how much memory Gaussian should be allowed to use.
 (Default: '256MB')
\end_layout

\begin_layout Paragraph
Example
\end_layout

\begin_layout Standard
An input file for QM or QM/MM MD with Gaussian using the BP86 functional
 and the 6-31G** basis set and running in parallel on 8 threads (using 1
 GB of memory) therefore would have to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&gau
\end_layout

\begin_layout Plain Layout

  method = 'BP86',
\end_layout

\begin_layout Plain Layout

  basis  = '6-31G**',
\end_layout

\begin_layout Plain Layout

  num_threads = 8,
\end_layout

\begin_layout Plain Layout

  mem='1GB',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset

  
\end_layout

\begin_layout Paragraph
Template input file
\end_layout

\begin_layout Standard
The template file for Gaussian should be named 
\family typewriter
gau_job.tpl
\family default
 and should only contain the route section of a Gaussian input file.
 The route section defines the method to be used and SCF convergence criteria.
 Charge and spin multiplicity are specified via the 
\shape italic
&qmmm
\shape default
 namelist.
 For example for a B3LYP calculation with 6-31G* basis set, the route section
 would be:
\end_layout

\begin_layout LyX-Code
#P B3LYP/6-31G* SCF=(Conver=8)
\end_layout

\begin_layout Standard
Do not include any information about coordinates or point charge treatment
 since this will all be handled by 
\emph on
sander
\emph default
.
 Also, do not include any 
\emph on
Link 0 Commands
\emph default
 (line starting with %) since these are handled by 
\emph on
sander
\emph default
.
 If you want to run Gaussian in parallel, specify the number of processors
 via the 
\emph on
num_threads
\emph default
 variable in the 
\emph on
&gau
\emph default
 namelist.
\end_layout

\begin_layout Subsubsection
AMBER/Orca
\end_layout

\begin_layout Standard
To use Orca with the interface, Orca must be properly installed on the system,
 the Orca executables need to reside in a directory that is in the search
 path.
 For convenience of use, namelist parameters in general correspond to Orca
 keywords, see the Orca manual for details.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
A cutoff is applied to QM/MM interactions in QM/MM simulations with and
 without PBCs.
 This leads to discontinuities in the potential energy surface and poor
 energy conservation.
 In the case of QM/MM simulations without PBCs, this cutoff (
\emph on
qmcut
\emph default
 variable in the 
\emph on
qmmm
\emph default
 namelist) can be set to a number that is larger than the simulated system,
 thus effectively not applying a cutoff.
 This is recommended.
\end_layout

\begin_layout Standard
Also note that ORCA only supports OpenMPI for parallel calculations.
 
\end_layout

\begin_layout Paragraph

\emph on
&orc
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Basis set type to be used in the calculation.
 Possible choices include svp, 6-31g, etc.
 See Orca manual for a complete list.
 (Default: basis = "SV(P)") 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
cbasis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
cbasis
\end_layout

\end_inset

 Auxiliary basis set for correlation fitting.
 See Orca manual for a complete list.
 (Default: basis = "NONE")
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
jbasis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
jbasis
\end_layout

\end_inset

 Auxiliary basis set for Coulomb fitting.
 See Orca manual for a complete list.
 (Default: basis = "NONE")
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
method
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
method
\end_layout

\end_inset

 Method to be used in the calculation.
 Popular choices include hf, pm3, blyp, and mp2.
 (Default: method = "blyp")
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
convkey
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
convkey
\end_layout

\end_inset

 General SCF convergence setting for simplified Orca input.
 Can take values 'TIGHTSCF', 'VERYTIGHTSCF', etc.
 (Default: convkey='VERYTIGHTSCF') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scfconv
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
scfconv
\end_layout

\end_inset

 SCF convergence threshold for the energy.
 (Default: scfconv = -1, that is, not in use since we use the general convergenc
e settings keyword 
\emph on
convkey
\emph default
.
 Otherwise this would lead to SCF energy convergence of 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$10^{-N}$
\end_layout

\end_inset

au, if set to N.) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
grid
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
grid
\end_layout

\end_inset

 Grid type used during the SCF for the XC quadrature in DFT.
 (Default: grid = 4, this corresponds to Intacc = 4.34 for the radial grid
 and an angular Lebedev grid with 302 points.
 Conservatively chosen together with finalgrid to conserve energy.)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
finalgrid
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
finalgrid
\end_layout

\end_inset

 Grid type used for the energy and gradient calculation after the SCF for
 the XC quadrature in DFT.
 (Default: finalgrid = 6, this corresponds to Intacc = 5.34 for the radial
 grid and an angular Lebedev grid with 590 points.
 Conservatively chosen together with 
\emph on
grid
\emph default
 to conserve energy.)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
maxiter
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
maxiter
\end_layout

\end_inset

 Maximum number of SCF iteractions.
 (Default maxiter = 100)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
maxcore
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
maxcore
\end_layout

\end_inset

 Global scratch memory (in MB) used by Orca.
 You may need to increase this when running larger jobs.
 See Orca manual for more information.
 (Default maxcore = 1024)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
num_threads
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
num_threads
\end_layout

\end_inset

 Number of threads (and thus CPU cores) for Orca to use.
 Note that Orca only supports OpenMPI.
 (Default: num_threads = 1)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 Determine whether or not to use a user-provided template file for running
 external programs.
 (Default: use_template = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Controls frequency of printing for the dipole moment to file 
\family typewriter
orc_job.dip
\family default
 (Defaults to &cntrl namelist variable ntpr)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dipole
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dipole
\end_layout

\end_inset

 Toggles writing of the dipole moment to file 
\family typewriter
orc_job.dip
\family default
 (Default: dipole = 0)
\end_layout

\begin_layout Paragraph
Example
\end_layout

\begin_layout Standard
An input file for QM or QM/MM MD with Orca using the BLYP functional, the
 SVP basis set therefore would have to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&orc
\end_layout

\begin_layout Plain Layout

  method = 'blyp',
\end_layout

\begin_layout Plain Layout

  basis  = 'svp',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Template input file
\end_layout

\begin_layout Standard
The template file for Orca should be named 
\family typewriter
orc_job.tpl
\family default
 and must at least contain keywords specifying the method and basis set
 to be used in the calculation, for example:
\end_layout

\begin_layout LyX-Code
# ORCA input file for BLYP/SVP simulation
\end_layout

\begin_layout LyX-Code
! BLYP SVP
\end_layout

\begin_layout Standard
You should not include the following keywords in the template file as these
 are taken care of by sander (like setting the runtype and adding coordinates):
 
\end_layout

\begin_layout LyX-Code
# NOT to be included in ORCA input file
\end_layout

\begin_layout LyX-Code
!engrad
\end_layout

\begin_layout LyX-Code
!energy  # (or any run type)
\end_layout

\begin_layout LyX-Code
%pointcharges
\end_layout

\begin_layout LyX-Code
*xyzfile # (or any coordinates) 
\end_layout

\begin_layout Subsubsection
AMBER/Q-Chem
\end_layout

\begin_layout Standard
To use Q-Chem with the interface, Q-Chem must be properly installed on the
 system.
 The q-chem executable needs to reside in a directory that is in the search
 path.
 For convenience of use, namelist parameters in general correspond to Q-chem
 keywords, see the Q-Chem manual for details.
 The interface has been tested with Q-Chem versions 4.0.0.1 and 4.1.1 for HF,
 DFT and MP2.
 Other methods have not been tested and could cause problems - please be
 careful and verify that forces/energies used by sander are correct in this
 case.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
A cutoff is applied to QM/MM interactions in QM/MM simulations with and
 without PBCs.
 This leads to discontinuities in the potential energy surface and poor
 energy conservation.
 In the case of QM/MM simulations without PBCs, this cutoff (
\emph on
qmcut
\emph default
 variable in the 
\emph on
qmmm
\emph default
 namelist) can be set to a number that is larger than the simulated system,
 thus effectively not applying a cutoff.
 This is recommended.
\end_layout

\begin_layout Paragraph

\emph on
&qc
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Basis set type to be used in the calculation.
 Possible choices include '6-31g**', 'cc-pVDZ' etc.
 See the Q-chem manual for a complete list.
 (Default: basis = '6-31G*' for DFT calculations and basis = 'cc-pVDZ' for
 MP2) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
auxbasis
\begin_inset Index idx
status open

\begin_layout Plain Layout
auxbasis
\end_layout

\end_inset

 Auxiliary basis set for density fitting / RI methods.
 See Q-Chem manual for a complete list.
 (Default: basis = 'rimp2-cc-pVDZ' for RI-MP2 calculations, otherwise none)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
method
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
method
\end_layout

\end_inset

 Method to be used in the calculation.
 Popular choices include 'BLYP' or other density functionals, 'MP2' and
 'RIMP2'.
 Alternatively, the keywords exchange and correlation can be employed.
 (Default: method = 'BLYP')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
exchange
\begin_inset Index idx
status open

\begin_layout Plain Layout
exchange
\end_layout

\end_inset

 Exchange method.
 Can be specified together with the correlation keyword in place of the
 combined method keyword.
 (Default: exchange = '') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
correlation
\begin_inset Index idx
status open

\begin_layout Plain Layout
correlation
\end_layout

\end_inset

 Correlation method.
 Can be specified together with the exchange keyword in place of the combined
 method keyword.
 (Default: correlation = '') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scf_conv
\begin_inset Index idx
status open

\begin_layout Plain Layout
scf_conv
\end_layout

\end_inset

 SCF convergence threshold.
 (Default: scfconv = 6) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
num_mpi_prcs
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
num_mpi_prcs
\end_layout

\end_inset

 Number of MPI processes for Q-Chem to use.
 The total number of CPUs to be used is num_mpi_prcs times num_threads.
 (Default: num_mpi_prcs = 1)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
num_threads
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
num_threads
\end_layout

\end_inset

 Number of threads for Q-Chem to use for each MPI process.
 Really this is number of threads.
 The total number of CPUs to be used is num_mpi_prcs times num_threads.
 (Default: num_threads = 1)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 Determine whether or not to use a user-provided template file for running
 external programs.
 (Default: use_template = 0) 
\end_layout

\begin_layout Standard
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Controls frequency of printing for the dipole moment to file 
\family typewriter
qc_job.dip
\family default
 (Defaults to &cntrl namelist variable ntpr)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dipole
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dipole
\end_layout

\end_inset

 Toggles writing of the dipole moment to file 
\family typewriter
qc_job.dip
\family default
.
 This is currently not supported.
 (Default: dipole = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
guess
\begin_inset Index idx
status open

\begin_layout Plain Layout
guess
\end_layout

\end_inset

 Toggles use of MOs from previous step as initial guess to accelerate SCF
 convergence.
 Any string different from 'read' will disable this.
 (Default: guess = 'read')
\end_layout

\begin_layout Paragraph
Example
\end_layout

\begin_layout Standard
An input file for QM or QM/MM MD with Q-Chem using MP2 with the cc-pVTZ
 basis set therefore would have to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&qc
\end_layout

\begin_layout Plain Layout

  method = 'mp2',
\end_layout

\begin_layout Plain Layout

  basis  = 'cc-pVTZ',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Template input file
\end_layout

\begin_layout Standard
The template file for Q-chem must be named 
\family typewriter
qc_job.tpl
\family default
 and must only contain keywords in the Q-Chem $rem input section that specify
 the QM method and basis set to be used in the calculation, for example:
\end_layout

\begin_layout LyX-Code
EXCHANGE becke
\end_layout

\begin_layout LyX-Code
CORRELATION lyp
\end_layout

\begin_layout LyX-Code
BASIS 6-311G**
\end_layout

\begin_layout LyX-Code
SCF_CONVERGENCE 7
\end_layout

\begin_layout Standard
The interface will take care of adding other keywords to the $rem section
 such as JOBTYPE and writing the $molecule input file sections.
\end_layout

\begin_layout Subsubsection
AMBER/MRCC
\end_layout

\begin_layout Standard
To use MRCC with the interface, the MRCC program suite must be properly
 installed on the system.
 The MRCC driver program dmrcc needs to reside in a directory that is in
 the search path.
 For convenience of use, namelist parameters in general correspond to MRCC
 keywords, see the MRCC manual for details.
 The interface has been tested with the MRCC release from July 15, 2016
 for HF and DFT.
 Other methods have not been tested but should also work - please be careful
 and verify that forces/energies used by sander are correct in this case.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
A cutoff is applied to QM/MM interactions in QM/MM simulations with and
 without PBCs.
 This leads to discontinuities in the potential energy surface and poor
 energy conservation.
 In the case of QM/MM simulations without PBCs, this cutoff (
\emph on
qmcut
\emph default
 variable in the 
\emph on
qmmm
\emph default
 namelist) can be set to a number that is larger than the simulated system,
 thus effectively not applying a cutoff.
 This is recommended.
\end_layout

\begin_layout Paragraph

\emph on
&mrcc
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Basis set type to be used in the calculation.
 Possible choices include '6-31g**', 'cc-pVDZ' etc.
 See the MRCC manual for a complete list.
 (Default: basis = '6-31G*') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
calc
\begin_inset Index idx
status open

\begin_layout Plain Layout
calc
\end_layout

\end_inset

 Type of calculation, e.g.
 'SCF', 'B3LYP', 'MP2', 'CCSD(T)', etc.
 (Default: calc = 'SCF')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dft
\begin_inset Index idx
status open

\begin_layout Plain Layout
dft
\end_layout

\end_inset

 Can be specified to request a DFT calculation and specify the DFT method.
 (Default: dft = 'off') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mem
\begin_inset Index idx
status open

\begin_layout Plain Layout
mem
\end_layout

\end_inset

 Memory that will be allocated for the calculation.
 (Default: mem = '256MB') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
verbosity
\begin_inset Index idx
status open

\begin_layout Plain Layout
verbosity
\end_layout

\end_inset

 Controls the verbosity of the MRCC output file.
 (Default: verbosity = 2) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Controls frequency of printing for the dipole moment to file 
\family typewriter
mrcc_job.dip
\family default
 (Defaults to &cntrl namelist variable ntpr)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
do_dipole
\begin_inset Index idx
status open

\begin_layout Plain Layout
do_dipole
\end_layout

\end_inset

 Toggles writing of the dipole moment to file 
\family typewriter
mrcc_job.dip
\family default
.
 (Default: dipole = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nprintlog
\begin_inset Index idx
status open

\begin_layout Plain Layout
nprintlog
\end_layout

\end_inset

 Frequency of storing MRCC output files during a minimization of molecular
 dynamics run.
 (Default: keep only last output file, nprintlog = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
debug
\begin_inset Index idx
status open

\begin_layout Plain Layout
debug
\end_layout

\end_inset

 Toggles debug mode, which prints subroutine calls and additional information
 about the AMBER/MRCC interface.
 (Default: no debugging, debug = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status open

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 Requests use of a template file to generate MRCC input files to utilize
 all the capabilities of that are not available through &mrcc namelist keywords.
 The template file is basically a truncated MINP file (the default input
 file for MRCC) which only includes the MRCC keywords.
 (Default: do not use a template input file, use_template = 0)
\end_layout

\begin_layout Standard
The following &mrcc namelist variables control multilayer calculations (i.e.
 QM/QM/MM or QM/QM/QM/MM embedding
\begin_inset CommandInset citation
LatexCommand citep
key "Hegely2016"
literal "true"

\end_inset

; the region highlighted in bold is controlled by the keyword).
 Only single point calculations are currently possible with such mulitlayer
 calculations.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
embed
\begin_inset Index idx
status open

\begin_layout Plain Layout
embed
\end_layout

\end_inset

 Specifies the method of the embedding QM region (2.
 layer) in a QM/
\series bold
QM
\series default
/MM (3 layer) calculation or specifies the method of the 3.
 layer in a QM/QM/
\series bold
QM
\series default
/MM (4 layer) calculation.
 Please read the MRCC manual for available options.
 (Default: embed = 'off')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
embedatoms
\begin_inset Index idx
status open

\begin_layout Plain Layout
embedatoms
\end_layout

\end_inset

 Specifies the active atoms of the embedded QM region (1.
 layer) in a 
\series bold
QM
\series default
/QM/MM (3 layer) calculation or specifies the active atoms of the 1.
 and 2.
 layer in a 
\series bold
QM
\series default
/
\series bold
QM
\series default
/QM/MM (4 layer) calculation.
 Comma separated list of integers (Default: embedatoms = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nmo_embed
\begin_inset Index idx
status open

\begin_layout Plain Layout
nmo_embed
\end_layout

\end_inset

 Specifies the number of active MOs of the embedded QM region (1.
 layer) in a 
\series bold
QM
\series default
/QM/MM (3 layer) calculation or specifies the number of active MOs of the
 1.
 and 2.
 layer in a 
\series bold
QM
\series default
/
\series bold
QM
\series default
/QM/MM (4 layer) calculation.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 The program automatically determines the MOs of the active region with
 the Boughton-Pulay (BP) algorithm.
 (default)
\end_layout

\begin_layout Description
>
\begin_inset space ~
\end_inset

0 Number of MOs that will be selected based on the Mulliken charges of the
 active atoms.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
corembed
\begin_inset Index idx
status open

\begin_layout Plain Layout
corembed
\end_layout

\end_inset

 Specifies the low-level correlation method of the embedding QM region (2.
 layer) in a QM/
\series bold
QM
\series default
/MM (3 layer) calculation or specifies the low-level correlation method
 of the 2.
 layer in a QM/
\series bold
QM
\series default
/QM/MM (4 layer) calculation.
 Please read the MRCC manual for available options.
 (Default: corembed = 'off')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
corembedatoms
\begin_inset Index idx
status open

\begin_layout Plain Layout
corembedatoms
\end_layout

\end_inset

 Specifies the active atoms of the embedded QM region (1.
 layer) in a 
\series bold
QM
\series default
/QM/MM (3 layer) calculation or specifies the active atoms of the 1.
 layer in a 
\series bold
QM
\series default
/QM/QM/MM (4 layer) calculation.
 Please note that the corembedatoms have to be a subset of the embedatoms
 if a 4 layer calculation is requested.
 Comma separated list of integers (Default: corembedatoms = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nmo_corembed
\begin_inset Index idx
status open

\begin_layout Plain Layout
nmo_corembed
\end_layout

\end_inset

 Specifies the number of active MOs of the embedded QM region (1.
 layer) in a 
\series bold
QM
\series default
/QM/MM (3 layer) calculation or specifies the number of active MOs of the
 1.
 layer in a 
\series bold
QM
\series default
/QM/QM/MM (4 layer) calculation.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 The program automatically determines the MOs of the active region with
 the Boughton-Pulay (BP) algorithm.
 (default)
\end_layout

\begin_layout Description
>
\begin_inset space ~
\end_inset

0 Number of MOs that will be selected based on the Mulliken charges of the
 active atoms.
\end_layout

\end_deeper
\begin_layout Paragraph
Examples
\end_layout

\begin_layout Standard
An input file for QM or QM/MM MD with MRCC using DFT with the BLYP functional
 and the cc-pVTZ basis set therefore would have to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&mrcc
\end_layout

\begin_layout Plain Layout

  calc = 'blyp',
\end_layout

\begin_layout Plain Layout

  basis  = 'cc-pVTZ',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
An example input for a multilayer QM/QM/MM calculation with LCCSD(T) for
 a subset of QM atoms 7 to 12 embedded into the remainder of the QM region
 described by PBE (i.e.
 LCCSD(T)/PBE/MM) would be 
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&mrcc
\end_layout

\begin_layout Plain Layout

  calc = 'LCCSD(T)',
\end_layout

\begin_layout Plain Layout

  basis  = 'cc-pVTZ',
\end_layout

\begin_layout Plain Layout

  embed = 'PBE',
\end_layout

\begin_layout Plain Layout

  embedatoms = 7,8,9,10,11,12
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
This assumes that atoms 7-12 are part of the QM region.
 A 4-layer QM/QM/QM/MM calculation with LCCSD(T) for atoms 7 to 12 embedded
 into LMP2 for atoms 13 to 16 and the remainder described by PBE (i.e.
 LCCSD(T)/LMP2/DFT/MM) would be requested with
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&mrcc
\end_layout

\begin_layout Plain Layout

  calc = 'LCCSD(T)',
\end_layout

\begin_layout Plain Layout

  basis  = 'cc-pVTZ',
\end_layout

\begin_layout Plain Layout

  embed = 'PBE',
\end_layout

\begin_layout Plain Layout

  embedatoms = 7,8,9,10,11,12,13,14,15,16,
\end_layout

\begin_layout Plain Layout

  corembed = 'LMP2',
\end_layout

\begin_layout Plain Layout

  corembedatoms = 7,8,9,10,11,12,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Template input file
\end_layout

\begin_layout Standard
The template file for MRCC must be named 
\family typewriter
mrcc_job.tpl
\family default
 and must only contain keywords that specify the QM method and basis set
 to be used in the calculation.
 Not to be included are following keywords: qmmm, qmreg, dens, pointcharges,
 geom, embed, corembed, scfiguess.
 The interface will take care of adding other keywords and writing the coordinat
e input file section.
\end_layout

\begin_layout Subsubsection
AMBER/TeraChem
\end_layout

\begin_layout Standard
To use TeraChem with the interface, TeraChem must be properly installed
 on the system.
 In particular, the 
\family typewriter
terachem
\family default
 executable needs to be in the search path.
 Namelist parameters correspond to TeraChem keywords, see the TeraChem manual
 for details.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
A cutoff is applied to QM/MM interactions in QM/MM simulations with and
 without PBCs.
 This leads to discontinuities in the potential energy surface and poor
 energy conservation.
 In the case of QM/MM simulations without PBCs, this cutoff (
\emph on
qmcut
\emph default
 variable in the 
\emph on
&qmmm
\emph default
 namelist) can be set to a number that is larger than the simulated system,
 thus effectively not applying a cutoff.
 This is recommended.
\end_layout

\begin_layout Paragraph

\emph on
&tc
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Basis set type to be used in the calculation.
 Possible choices presently (TeraChem version 1.4) are 'STO-3G', '3-21G',
 '6-31G' and '6-311G', '3-21++G' and '6-31++G' (Default: basis = '6-31G')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
method
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
method
\end_layout

\end_inset

 Method to be used in the calculation, can be either 'RHF' or some supported
 DFT functional.
 Popular choices are 'BLYP', 'PBE' and 'B3LYP'.
 (Default: method = 'BLYP')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dftd
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dftd
\end_layout

\end_inset

 Determines whether dispersion corrections are applied in the case of DFT
 calculations.
 (Default: dftd = 'no') 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
precision
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
precision
\end_layout

\end_inset

 Precision model setting (single vs double precision).
 (Default: precision = 'mixed')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dynamicgrid
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dynamicgrid
\end_layout

\end_inset

 Use coarse grid during early SCF iterations.
 (Default: dynamicgrid = 'yes')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
threall
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
threall
\end_layout

\end_inset

 Determines a variety of thresholds.
 (Default: threall = 1.0E-11)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
convthre
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
convthre
\end_layout

\end_inset

 SCF convergence threshold for the wavefunction.
 (Default: convthre = 3.0E-05, which leads to SCF energy convergence of approxima
tely 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$10^{-7}$
\end_layout

\end_inset

 au or 
\begin_inset ERT
status collapsed

\begin_layout Plain Layout

$10^{-4}$
\end_layout

\end_inset

 kcal/mol)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
maxit
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
maxit
\end_layout

\end_inset

 Maximum number of SCF iterations.
 (Default: maxit = 100)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dftgrid
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dftgrid
\end_layout

\end_inset

 DFT grid to be employed for the numerical XC quadrature in DFT calculations.
 (Default: dftgrid = 1)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ngpus
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ngpus
\end_layout

\end_inset

 Determines how many GPUs are to be used.
 (Default: ngpus = 0, which uses all available GPUs)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
gpuids
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
gpuids
\end_layout

\end_inset

 If 
\emph on
ngpus
\emph default
 has a value other than zero, this determines the IDs of the GPUs to be
 used for the calculation.
 (Default: gpuids = 0, 1, 2, etc.) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
executable
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
executable
\end_layout

\end_inset

 Name of the TeraChem executable.
 (Default: executable = terachem)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 Determine whether or not to use a user-provided template file for running
 external programs.
 (Default: use_template = 0) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntpr
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
ntpr
\end_layout

\end_inset

 Controls frequency of printing for dipole moment and atomic charges to
 files 
\family typewriter
tc_job.ext
\family default
.
 (Defaults to &cntrl namelist variable ntpr)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
charge_analysis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
charge_analysis
\end_layout

\end_inset

 Toggles writing of atomic charges to file 
\family typewriter
tc_job.chg
\family default
 (Options: 'none' or 'Mulliken'.
 Default: dipole = 'none')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dipole
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
dipole
\end_layout

\end_inset

 Toggles writing of dipole moment to file 
\family typewriter
tc_job.dip
\family default
 (Default: dipole = 0)
\end_layout

\begin_layout Paragraph
Example
\end_layout

\begin_layout Standard
An input file for QM or QM/MM MD with TeraChem using the PBE functional
 and the 6-31G* basis set therefore would have to contain
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&tc
\end_layout

\begin_layout Plain Layout

  method = 'PBE',
\end_layout

\begin_layout Plain Layout

  basis  = '6-31G*',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Template input file
\end_layout

\begin_layout Standard
The template file for Terachem should be named 
\family typewriter
tc_job.tpl
\family default
 and must at least contain the following keywords:
\end_layout

\begin_layout LyX-Code
basis
\end_layout

\begin_layout LyX-Code
method
\end_layout

\begin_layout Standard
Any content of the template file after a line containing the 
\family typewriter
end
\family default
 keyword will be ignored
\family typewriter
.
\end_layout

\begin_layout Standard
You should not include the following keywords in the template file as these
 are taken care of by 
\emph on
sander
\emph default
.
 Instead, specify these via the 
\shape italic
&qmmm
\shape default
 or 
\shape italic
&tc
\shape default
 namelist: 
\end_layout

\begin_layout LyX-Code
run
\end_layout

\begin_layout LyX-Code
charge
\end_layout

\begin_layout LyX-Code
spinmult
\end_layout

\begin_layout LyX-Code
coordinates
\end_layout

\begin_layout LyX-Code
pointcharges
\end_layout

\begin_layout LyX-Code
amber
\end_layout

\begin_layout LyX-Code
gpus
\end_layout

\begin_layout Subsubsection
AMBER/Fireball
\end_layout

\begin_layout Standard
To use Fireball with the QM/MM interface, a special version of 
\emph on
sander 
\emph default
must be compiled and linked against the Fireball library (libfireball.a).
 The Fireball library can be obtained from the fireball-qmd web site at
 
\begin_inset CommandInset href
LatexCommand href
name "https://fireball-qmd.github"
target "https://fireball-qmd.github"
literal "false"

\end_inset

.
 Compilation requires the Intel compilers and Intel MKL library.
 You can compile a version of 
\emph on
sander
\emph default
 that supports Fireball as follows (bash assumed):
\end_layout

\begin_layout Verbatim

export FIREBALLHOME=/path/to/fireball.a
\end_layout

\begin_layout Verbatim

export MKL_HOME=/path/to/Intel/MKL/library
\end_layout

\begin_layout Verbatim

cd $AMBERHOME
\end_layout

\begin_layout Verbatim

./configure -fireball intel
\end_layout

\begin_layout Verbatim

make install
\end_layout

\begin_layout Standard
It is possible to compile the MPI parallel version of 
\emph on
sander
\emph default
 in the same fashion.
 However, only the MM part of the calculation will execute in parallel.
\end_layout

\begin_layout Paragraph
Limitations
\end_layout

\begin_layout Standard
A cutoff is applied to QM/MM interactions in QM/MM simulations with and
 without PBCs.
 This leads to discontinuities in the potential energy surface and poor
 energy conservation.
 In the case of QM/MM simulations without PBCs, this cutoff (
\emph on
qmcut
\emph default
 variable in the 
\emph on
&qmmm
\emph default
 namelist) can be set to a number that is larger than the simulated system,
 thus effectively not applying a cutoff.
\end_layout

\begin_layout Paragraph
Basis set
\end_layout

\begin_layout Standard
Fireball requires a basis set, commonly provided in an 
\begin_inset Quotes eld
\end_inset

Fdata
\begin_inset Quotes erd
\end_inset

 directory.
 This directory contains all the interactions (different contributions to
 the electronic Hamiltonian matrix elements) for the different types of
 atoms (C, H, O, N, etc.) appearing in the QM region.
 In principle, the Fdata directory should be placed in the working directory.
 Alternatively, the path where the Fdata directory is located can be defined
 using the variable 
\emph on
basis
\emph default
 in the 
\emph on
&fb
\emph default
 namelist variables (see below).
\end_layout

\begin_layout Standard
This Fdata directory can be downloaded from the fireball-qmd web (
\begin_inset CommandInset href
LatexCommand href
name "https://fireball-qmd.github"
target "https://fireball-qmd.github"
literal "false"

\end_inset

).
 Advanced users can also calculate their own Fdata using the 
\emph on
create
\emph default
 set of programs that can be found in the fireball-qmd github repository.
\end_layout

\begin_layout Paragraph

\emph on
&fb
\emph default
 Namelist variables
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 Path to the Fdata directory.
 (Default: basis = './Fdata')
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
max_scf_iterations
\begin_inset Index idx
status open

\begin_layout Plain Layout
max_scf_iterations
\end_layout

\end_inset

 Maximum number of iterations in the loop for the calculation of the self-consis
tent charges.
 (Default: max_scf_iterations = 70)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
sigmatol
\begin_inset Index idx
status open

\begin_layout Plain Layout
sigmatol
\end_layout

\end_inset

 Threshold for selc-consistency in the electronic structure calculations.
 (Default: sigmatol = 1.0E-08)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
idftd3
\begin_inset Index idx
status open

\begin_layout Plain Layout
idftd3
\end_layout

\end_inset

 DFTD3 dispersion correction.
 (No correction: idftd3 = 0; Dispersion correction for BLYP: idftd3 = 1;
 Default: idftd3 = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iwrtcharges
\begin_inset Index idx
status open

\begin_layout Plain Layout
iwrtcharges
\end_layout

\end_inset

 Writes atomic charges in fireball output.
 (Default: iwrtcharges = 0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iwrteigen
\begin_inset Index idx
status open

\begin_layout Plain Layout
iwrteigen
\end_layout

\end_inset

 Writes energy levels in fireball output.
 (Default: iwrteigen = 0)
\end_layout

\begin_layout Standard
Fora complete list of all 
\emph on
&fb
\emph default
 Namelist variables, please visit 
\begin_inset CommandInset href
LatexCommand href
name "http://nanosurf.fzu.cz/wiki/doku.php?id=fireball"
target "http://nanosurf.fzu.cz/wiki/doku.php?id=fireball"
literal "false"

\end_inset


\end_layout

\begin_layout Paragraph
Example
\end_layout

\begin_layout Standard
An input file for QM or QM/MM MD using AMBER/FIREBALL with all the default
 values would just have to contain an empty 
\emph on
&fb
\emph default
 naemlist
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&fb
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
As another example, a simulation using DFTD3 dispersion corrections for
 BLYP that also writes out the atomic charges with Fdata in a central location
 of the user's home directory would need the following input:
\end_layout

\begin_layout LyX-Code
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&fb
\end_layout

\begin_layout Plain Layout

  basis = '/home/fireball/Fdata',
\end_layout

\begin_layout Plain Layout

  idftd3 = 1,
\end_layout

\begin_layout Plain Layout

  iwrtcharges = 1
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
To launch the simulation, simply run 
\emph on
sander 
\emph default
as follows:
\end_layout

\begin_layout Verbatim

sander -O -i mdin -o mdout -p prmtop -c inpcrd -x mdcrd -r rstrt > amberfireball.
out
\end_layout

\begin_layout Section
QM/MM simulations with QUICK
\lang english

\begin_inset CommandInset label
LatexCommand label
name "sec:QMMM-Quick"

\end_inset


\end_layout

\begin_layout Standard
The sander program has the capability to run QM/MM simulations with the
 quantum chemical code 
\emph on
QUICK
\emph default
 (QUantum Interaction Computational Kernel),
\begin_inset CommandInset citation
LatexCommand citep
key "quick,Miao2013,Miao2015,Manathunga2020,Manathunga2021"
literal "true"

\end_inset

 shipped along with AmberTools.
 If you use QM/MM simulations with 
\emph on
QUICK
\emph default
 in your work, please cite the following references:
\end_layout

\begin_layout Itemize
Manathunga, M.; Jin, C.; Cruzeiro, V.
 W.
 D.; Smith, J.; Keipert, K.; Pekurovsky, D.; Mu, D.; Miao, Y.; He, X.; Ayers, K;
 Brothers, E.; Götz, A.
 W.; Merz, K.
 M.
 QUICK-21.03.
 University of California San Diego, CA and Michigan State University, East
 Lansing, MI, 2021
\end_layout

\begin_layout Itemize
Cruzeiro, V.
 W.
 D.; Manathunga, M.; Merz, K.
 M.; Götz, A.
 W.; Open-Source Multi-GPU-Accelerated QM/MM Simulations with AMBER and QUICK.
 ChemRxiv; 2021.
 DOI: 10.26434/chemrxiv.13984028.v1.
\end_layout

\begin_layout Standard
If you perform DFT calculations please also cite:
\end_layout

\begin_layout Itemize
Manathunga, M.; Miao, Y.; Mu, D.; Götz, A.
 W.; Merz, K.
 M.
 Parallel Implementation of Density Functional Theory Methods in the Quantum
 Interaction Computational Kernel Program.
 
\emph on
J.
 Chem.
 Theory Comput.

\emph default
 
\series bold
16
\series default
, 4315–4326 (2020).
\end_layout

\begin_layout Standard
If you use the GPU accelerated version of QUICK please also cite:
\end_layout

\begin_layout Itemize
Manathunga, M.; Jin, C,; Cruzeiro, V.
 W.
 D.; Miao, Y.; Mu, D.; Arumugam, K.; Keipert, K.; Aktulga, H.
 M.; Merz, K.
 M., Jr.; Götz, A.
 W.
 (2021): Harnessing the Power of Multi-GPU Acceleration into the Quantum
 Interaction Computational Kernel Program.
 
\emph on
ChemRxiv
\emph default
.
 Preprint.
 https://doi.org/10.26434/chemrxiv.13769209.v1
\end_layout

\begin_layout Itemize
Mia, Y.; Merz, K.
 M., Jr.
 Acceleration of High Angular Momentum Electron Repulsion Integrals and
 Integral Derivatives on Graphics Processing Units.
 
\emph on
J.
 Chem.
 Theory Comput.
 
\series bold
\emph default
11
\series default
, 1449-1462 (2015).
\end_layout

\begin_layout Standard
The 
\emph on
QUICK
\emph default
 QM/MM features are available in two options: 1) a file-based interface
 (FBI), see also section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QMMMEXTERN"
plural "false"
caps "false"
noprefix "false"

\end_inset

 or 2) an application programming interface (API).
 As shown in reference 
\begin_inset CommandInset citation
LatexCommand citep
key "Cruzeiro2021"
literal "true"

\end_inset

, the API option provides faster calculations due to speedups with I/O operation
s and to setup the QM calculations.
 Therefore, we recommend users to use the API interface.
 The 
\emph on
QUICK
\emph default
 QM/MM features are optional, which implies that users must choose to compile
 Amber with QUICK support before they can use it.
 Please refer to section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QUICK:installation"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for installation instructions.
 Additionally, a list of 
\emph on
QUICK
\emph default
 features and limitations has been presented in section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QUICK:features-limitations"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
\end_layout

\begin_layout Standard

\series bold
Important note:
\series default
 both the FBI and API interfaces of 
\emph on
QUICK
\emph default
 support QM/MM simulations with both mechanical embedding and electrostatic
 embedding.
 At present the same limitations and caveats apply with respect to QM/MM
 cutoffs as for external QM codes (see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:QMMMEXTERN"
plural "false"
caps "false"
noprefix "false"

\end_inset

).
\end_layout

\begin_layout Subsection
Usage
\end_layout

\begin_layout Standard
As discussed in chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "cha:quick"
plural "false"
caps "false"
noprefix "false"

\end_inset

, SANDER can access different 
\emph on
QUICK
\emph default
 installation types for QM/MM simulations: serial, parallel, CUDA serial,
 and CUDA parallel.
 If using the file-based interface (FBI), the 
\emph on
sander
\emph default
 executable is capable calling any of the four different QUICK executables:
 
\emph on
quick
\emph default
, 
\emph on
quick.MPI
\emph default
, 
\emph on
quick.cuda
\emph default
, or 
\emph on
quick.cuda.MPI
\emph default
.
 If using the application programming interface (API), a different SANDER
 executable must be used for different 
\emph on
QUICK
\emph default
 types: the serial and MPI parallel versions of QUICK can be accessed from
 the 
\emph on
sander
\emph default
 and 
\emph on
sander.MPI
\emph default
 executables, respectively; furthermore, the serial GPU-accelerated and
 multi-GPU-accelerated versions of 
\emph on
QUICK
\emph default
 can be accessed from 
\emph on
sander.quick.cuda
\emph default
 and 
\emph on
sander.quick.cuda.MPI
\emph default
; these executables are identical to 
\emph on
sander
\emph default
 and 
\emph on
sander.MPI
\emph default
 in all SANDER functionalities, except they perform QM/MM calculations with
 
\emph on
QUICK
\emph default
 using the GPU-accelerated code through the API.
\end_layout

\begin_layout Standard
Examples for how to use both the API and FBI functionalities can be found
 at the test suites in the following locations within AMBER’s source: 
\emph on
$AMBERHOME/test/qmmm_Quick
\emph default
 and 
\emph on
$AMBERHOME/test/qmmm_EXTERN/*Quick
\emph default
 for, respectively, API and FBI.
\end_layout

\begin_layout Standard

\series bold
Important note:
\series default
 Before running any QM/MM simulations with 
\emph on
QUICK
\emph default
, users must make sure to source 
\shape italic
$AMBERHOME/amber.sh
\shape default
 (or 
\shape italic
$AMBERHOME/amber.csh
\shape default
, depending on your enviroment).
 This step ensures that the location of the necessary executables and libraries
 are set in the environmental variables of the operating system.
\end_layout

\begin_layout Subsubsection
File-based interface (FBI)
\end_layout

\begin_layout Standard
Below is an example of the modifications necessary in the SANDER input file
 to perform a mechanical embedding QM/MM simulation.
 In this example, the first two residues of the system are assigned to the
 QM region, and the simulation is executed at the B3LYP/def2-SVP level with
 
\emph on
quick.cuda.MPI
\emph default
 using 2 GPUs:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

 ...
\end_layout

\begin_layout Plain Layout

 ifqnt = 1,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&qmmm
\end_layout

\begin_layout Plain Layout

 qmmask = ':1-2',
\end_layout

\begin_layout Plain Layout

 qm_theory = 'extern',
\end_layout

\begin_layout Plain Layout

 qmmm_int = 5,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&quick
\end_layout

\begin_layout Plain Layout

 method   = 'B3LYP',
\end_layout

\begin_layout Plain Layout

 basis    = 'def2-svp',
\end_layout

\begin_layout Plain Layout

 executable = 'quick.cuda.MPI',
\end_layout

\begin_layout Plain Layout

 do_parallel = 'mpirun -np 2',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
where 
\emph on
ifqnt
\emph default
 set to 1 activates the QM/MM functionality, 
\emph on
qmmask
\emph default
 specifies the QM region, 
\emph on
qm_theory
\emph default
 set as ‘extern’ indicates that the FBI will be used, and 
\emph on
qmmm_int
\emph default
 set to 5 specifies the use of mechanical embedding.
 The executable flag can be set to any of the four QUICK executables, and
 the do_parallel flag must be specified only if using one of the MPI parallel
 versions of 
\emph on
QUICK
\emph default
.
 It is important to emphasize that some machines may require a command other
 than 
\emph on
mpirun
\emph default
, depending on the MPI library being used.
 In general the serial sander executable must be used because of limitations
 to the system calls from within MPI programs (i.e.
 you cannot use 
\emph on
sander.MPI
\emph default
 if you want to call an external MPI program).
 This means that the MM portion of the calculation will be executed in serial.
\end_layout

\begin_layout Subsubsection
Application programming interface (API)
\end_layout

\begin_layout Standard
In the example below, we present the modifications necessary in the SANDER
 input file to perform a QM/MM simulation with electrostatic embedding.
 Unlike for the FBI case, simulations using serial, parallel, serial GPU-acceler
ated, and multi-GPU-accelerated 
\emph on
QUICK
\emph default
 functionalities can all use the same input file.
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

 ...
\end_layout

\begin_layout Plain Layout

 ifqnt = 1,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&qmmm
\end_layout

\begin_layout Plain Layout

 qmmask = ':1-2',
\end_layout

\begin_layout Plain Layout

 qm_theory = 'quick',
\end_layout

\begin_layout Plain Layout

 qmmm_int = 1,
\end_layout

\begin_layout Plain Layout

 qm_ewald = 0,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&quick
\end_layout

\begin_layout Plain Layout

 method   = 'B3LYP',
\end_layout

\begin_layout Plain Layout

 basis    = 'def2-svp',
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
where 
\emph on
ifqnt
\emph default
 set to 1 activates the QM/MM functionality, 
\emph on
qmmask
\emph default
 specifies the QM region, 
\emph on
qm_theory
\emph default
 set as ‘quick’ makes use of API, 
\emph on
qmmm_int
\emph default
 set to 1 specifies the use of electrostatic embedding and 
\emph on
qm_ewald
\emph default
 set to 0 indicates that the QM/MM interactions should be truncated at a
 given cutoff (the 
\emph on
cut
\emph default
 variable is specified in the &cntrl namelist).
 This is currently requied in the same way as when external QM codes are
 used via the FBI because there is no straight forward way for an Ewald
 based treatment of long-range QM/MM electrostatics with 
\emph on
ab initio
\emph default
 QM methods.
\end_layout

\begin_layout Standard

\series bold
Note:
\series default
 when the simulation is executed with the API, an output file called 
\emph on
quick.out
\emph default
 (the prefix name for this file can be modified; see below) is generated
 containing the 
\emph on
QUICK
\emph default
 output information for all MD steps.
\end_layout

\begin_layout Subsubsection
&quick namelist variables
\end_layout

\begin_layout Standard
Below we show a list of all variables that can be specified in the &quick
 namelist.
 Please notice that some variables are specific to only the API or the FBI.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
method
\begin_inset Index idx
status open

\begin_layout Plain Layout
method
\end_layout

\end_inset

 
\series bold
= String
\series default
 Method to be used in the calculation, can be either ‘HF’ or some supported
 DFT functional.
 (Default: BLYP).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
basis
\begin_inset Index idx
status open

\begin_layout Plain Layout
basis
\end_layout

\end_inset

 
\series bold
= String
\series default
 Basis set type to be used in the calculation.
 (Default: 6-31G).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
executable
\begin_inset Index idx
status open

\begin_layout Plain Layout
executable
\end_layout

\end_inset

 
\series bold
= String
\series default
 
\series bold
\emph on
(FBI only)
\series default
 QUICK
\emph default
 executable to be used in the simulation with the FBI.
 Options are: 
\emph on
quick
\emph default
, 
\emph on
quick.MPI
\emph default
, 
\emph on
quick.cuda
\emph default
, or 
\emph on
quick.cuda.MPI
\emph default
 (Default: quick).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
do_parallel
\begin_inset Index idx
status open

\begin_layout Plain Layout
do_parallel
\end_layout

\end_inset

 
\series bold
= String
\series default
 
\series bold
\emph on
(FBI only)
\series default
 
\emph default
Portion of the command to be placed right before the executable specification
 for activating the parallelization.
 Example: ‘mpirun -np 2’.
 (Default: none).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scf_cyc
\begin_inset Index idx
status open

\begin_layout Plain Layout
scf_cyc
\end_layout

\end_inset

 
\series bold
= Integer
\series default
 Number of SCF cycles.
 (Default: 200).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
keywords
\begin_inset Index idx
status open

\begin_layout Plain Layout
keywords
\end_layout

\end_inset

 
\series bold
= String 
\emph on
(API only)
\series default
\emph default
 Instead of specifying the 
\emph on
QUICK
\emph default
 input variables separetely with the flags above, users can use this flag
 instead to specify the full keywords line that would go on the top of a
 
\emph on
QUICK
\emph default
 input file.
 Example in a simulation with electrostatic embedding: ‘B3LYP BASIS=cc-pVDZ
 CHARGE=0 MULT=1 GRADIENT EXTCHARGES’.
 (Default: none).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
outfprefix
\begin_inset Index idx
status open

\begin_layout Plain Layout
outfprefix
\end_layout

\end_inset

 
\series bold
= String 
\emph on
(API only)
\series default
\emph default
 Prefix to be used in the 
\emph on
QUICK
\emph default
 output file.
 The name choosen here will be followed by a ‘.out’ suffix.
 (Default: quick).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
debug
\begin_inset Index idx
status open

\begin_layout Plain Layout
debug
\end_layout

\end_inset

 Debugging information.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (Default) No debugging information is printed.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Debugging information is printed.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 Extra debugging information is printed if using the FBI.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
use_template
\begin_inset Index idx
status open

\begin_layout Plain Layout
use_template
\end_layout

\end_inset

 
\series bold
\emph on
(FBI only)
\series default
\emph default
 Use a template input file.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 (Default) No template file is used.
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 Template file is used.
\end_layout

\end_deeper
\begin_layout Chapter
Atom and Residue Selections
\begin_inset CommandInset label
LatexCommand label
name "MASKS"

\end_inset


\end_layout

\begin_layout Standard
There are three ways to select atoms and residues in AMBER-related routines:
 the 
\series bold
AMBER "mask"
\series default
 notation, used by most programs, the 
\series bold
NAB "atom expressions"
\series default
, which work only with NAB-compiled applications, and an older 
\begin_inset Quotes eld
\end_inset

GROUP
\begin_inset Quotes erd
\end_inset

 specification used in 
\emph on
sander
\emph default
 and 
\emph on
pmemd
\emph default
.
 Information about these is collected in this chapter.
\end_layout

\begin_layout Section
Amber Masks
\begin_inset CommandInset label
LatexCommand label
name "AMBERMASK"

\end_inset


\end_layout

\begin_layout Standard
A "mask" is a notation which selects atoms or residues for special treatment.
 A frequent usage is fixing or tethering selected atoms or residues during
 minimization or molecular dynamics.
\end_layout

\begin_layout Standard
The following lines are partially copied from the original AMBER documentation.
 For more details, refer to the entire section of that documentation describing
 the 
\emph on
ambmask
\emph default
 utility.
\end_layout

\begin_layout Standard
The "mask" selection expression is composed of "elementary selections".
 These start with "
\series bold
:
\series default
" to select by residues, or "
\series bold
@
\series default
" to select by atoms.
 Residues can be selected by numbers (given as numbers separated by commas,
 or as ranges separated by a dash) or by names (given as a list of residue
 names separated by commas).
 The same holds true for atom selections by atom numbers or atom names.
 In addition, atoms can be selected by AMBER atom type, in which case "@"
 must be immediately followed by "%".
 The notation ":*" means all residues and "@*" means all atoms.
 The following examples show the usage of this syntax.
\end_layout

\begin_layout Subsubsection*
Residue Number List Examples
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

:1-10      = "residues 1 to 10"
\end_layout

\begin_layout Plain Layout

:1,3,5     = "residues 1, 3, and 5"
\end_layout

\begin_layout Plain Layout

:1-3,5,7-9 = "residues 1 to 3 and residue 5 and residues 7 to 9"
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection*
Residue Name List Examples
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

:LYS          = "all lysine residues"
\end_layout

\begin_layout Plain Layout

:ARG,ALA,GLY  = "all arginine and alanine and glycine residues"
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection*
Atom Number List Examples
\end_layout

\begin_layout Standard
Note that these masks use the 
\series bold
actual sequential numbers of atoms
\series default
 in the file.
 This is tricky and a serious source of error.
 You must know these numbers correctly.
 Using the atom numbers of a PDB file written out by an AMBER tool is an
 appropriate way to avoid pitfalls.
 
\series bold
Do not use the original atom numbers from the raw PDB file you started with.
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

@12,17       = "atoms 12 and 17"
\end_layout

\begin_layout Plain Layout

@54-85       = "all atoms from 54 to 85"
\end_layout

\begin_layout Plain Layout

@12,54-85,90 = "atom 12 and all atoms from 54 to 85 and atom 90"
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection*
Atom Name List Examples
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

@CA         = all atoms with the name CA (i.e., all C-alpha atoms)
\end_layout

\begin_layout Plain Layout

@CA,C,O,N,H = all atoms with names CA or C or O or N or H
\end_layout

\begin_layout Plain Layout

                  (i.e., the entire protein backbone)
\end_layout

\end_inset


\end_layout

\begin_layout Subsubsection*
Atom Type List Examples
\end_layout

\begin_layout Standard
This last mask type is only used by specialists and mentioned here for completen
ess.
 It allows the selection of AMBER atom types and requires detailed knowledge
 of AMBER force fields.
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

@%CT         = all atoms with the force field type CT
\end_layout

\begin_layout Plain Layout

               (the standard sp3 aliphatic carbon)
\end_layout

\begin_layout Plain Layout

@%N*,N3      = all atoms with the force field type N* or N3
\end_layout

\begin_layout Plain Layout

               (N* is a special sp2 nitrogen, N3 is an sp3 nitrogen)
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Note that in the above example, 
\family typewriter
N*
\family default
 is actually an atom type.
 The * is 
\series bold
not
\series default
 a wild card meaning "all N-something types"!
\end_layout

\begin_layout Subsubsection*
Logical Combinations
\end_layout

\begin_layout Standard
The selections above can be combined by various logical operators, including
 selections like "all atoms within a certain distance from...".
 The use of such combinations goes beyond this introductory script.
 Interested users should refer to the next section for details.
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "sec:ambmask"

\end_inset


\series bold
ambmask
\end_layout

\begin_layout Description
NAME
\end_layout

\begin_layout Standard
ambmask - test group input FIND mask (or mask string given in the &cntrl
 section) and dump the resulting atom selection in a given format 
\end_layout

\begin_layout Description
SYNOPSIS 
\end_layout

\begin_layout LyX-Code
ambmask -p prmtop -c inpcrd -prnlev [0-3] -out [short
\begin_inset Formula $\vert$
\end_inset

 pdb
\begin_inset Formula $\vert$
\end_inset

 amber] -find [maskstr] 
\end_layout

\begin_layout Description
DESCRIPTION
\end_layout

\begin_layout Standard

\series bold
ambmask
\series default
 acts as a filter that inputs an Amber topology file and an Amber coordinate
 file and applies the "maskstr" selection string to select specific atoms
 or residues.
  (The "maskstr" selection string is similar syntactically to UCSF Chimera/Midas.
) Residues can be selected by their numbers or names.
 Atoms can be selected by numbers, names, or Amber (forcefield) type.
 Selections are case insensitive.
 The selected atoms are printed to 
\series bold
stdout
\series default
 (by default, in Amber-style PDB format).
 Atom and residue names and numbers are taken from the Amber topology.
 Beware that the selection string works on those names and not the ones
 from the original PDB file.
 If you are not sure how atoms or residues are named or numbered in the
 Amber topology, use 
\series bold
ambmask
\series default
 with a selection string ":*" (which is the default) to dump the whole PDB
 file with corresponding Amber atom/residue names and numbers.
\end_layout

\begin_layout Standard
The "maskstr" selection expression is composed of "elementary selections".
 These start with ":" to select by residues, or "@" to select by atoms.
 Residues can be selected by numbers (given as numbers separated by commas,
 or as ranges separated by a dash) or by names (given as a list of residue
 names separated by commas).
 The same holds true for atom selections by atom numbers or atom names.
 In addition, atoms can be selected by Amber atom type, in which case "@"
 must be immediately followed by "%".
 ":*" means all residues and "@*" means all atoms.
 The following examples show the usage of this syntax.
 Square brackets should not be used in actual expressions, they are only
 used below to denote individual selection string examples:
\end_layout

\begin_layout LyX-Code
:{residue numlist} [:1-10] [:1,3,5] [:1-3,5,7-9]
\end_layout

\begin_layout LyX-Code
:{residue namelist} [:LYS] [:ARG,ALA,GLY]
\end_layout

\begin_layout LyX-Code
@{atom numlist} [@12,17] [@54-85] [@12,54-85,90]
\end_layout

\begin_layout LyX-Code
@{atom namelist} [@CA] [@CA,C,O,N,H]
\end_layout

\begin_layout LyX-Code
@%{atom typelist} [@%CT] [@%N*,N3]
\end_layout

\begin_layout Standard
These "elementary selections" can be combined into more complex selections
 using binary operators "&" (and) and "
\begin_inset Formula $\vert$
\end_inset

" (or), unary operator "!" (negation), distance binary operators "
\begin_inset Formula $<$
\end_inset

:", "
\begin_inset Formula $>$
\end_inset

:", "
\begin_inset Formula $<$
\end_inset

@", "
\begin_inset Formula $>$
\end_inset

@", and parentheses.
 Spaces around operators are irrelevant.
 Parentheses have the highest priority, followed by distance operators ("
\begin_inset Formula $<$
\end_inset

:", "
\begin_inset Formula $>$
\end_inset

:", "
\begin_inset Formula $<$
\end_inset

@", "
\begin_inset Formula $>$
\end_inset

@"), "!" (negation), "&" (and) and "
\begin_inset Formula $\vert$
\end_inset

" (or) in order of descending priority.
 A wildcard "=" in an atom or residue name matches any name starting with
 a given character (or characters).
 For example, [:AS=] would match all aspartic acid residues (ASP), and asparagin
es (ASN); [@H=] would match all atom names starting with H (which are effectivel
y all hydrogens).
 It cannot be used to match the end part of names (such as [:=A]).
 Some examples of more complex selections follow:
\end_layout

\begin_layout LyX-Code
[@C= & !@CA,C]
\end_layout

\begin_layout Standard
..
 all carbons except backbone alpha and carbonyl carbon
\end_layout

\begin_layout LyX-Code
[(:1-3@CA 
\begin_inset Formula $\vert$
\end_inset

 :5-7@CB)]
\end_layout

\begin_layout Standard
..
 alpha carbons in residues 1-3 and beta carbons in residues 5-7
\end_layout

\begin_layout LyX-Code
[:CYS,ARG & !(:1-10 
\begin_inset Formula $\vert$
\end_inset

 @CA,CB)]
\end_layout

\begin_layout Standard
..
 all CYS and ARG atoms except those which are in residues 1-10 and which
 are CA or CB
\end_layout

\begin_layout LyX-Code
[:* & !@H=] or [!@H=]
\end_layout

\begin_layout Standard
..
 all heavy atoms (i.e.
 except hydrogens)
\end_layout

\begin_layout LyX-Code
[:5 
\begin_inset Formula $<$
\end_inset

@4.5]
\end_layout

\begin_layout Standard
..
 all atoms within 4.5A from residue 5 
\end_layout

\begin_layout LyX-Code
[(:1-55 
\begin_inset Formula $<$
\end_inset

:3.0) & :WAT]
\end_layout

\begin_layout Standard
..
 all water molecules within 3A from residues 1-55
\end_layout

\begin_layout Standard
Compound expressions of the following type are also allowed:
\end_layout

\begin_layout LyX-Code
:{residue numlist
\begin_inset Formula $\vert$
\end_inset

namelist}@{atom numlist
\begin_inset Formula $\vert$
\end_inset

namelist
\begin_inset Formula $\vert$
\end_inset

typelist}
\end_layout

\begin_layout LyX-Code
[:1-10@CA] is equivalent to [:1-10 & @CA]
\end_layout

\begin_layout LyX-Code
[:LYS@H=] is equivalent to [:LYS & @H=]
\end_layout

\begin_layout Description
OPTIONS
\end_layout

\begin_layout Standard
The program needs an Amber topology file and coordinates (restrt format).
 The filename specified with the -
\begin_inset Formula $p$
\end_inset

 option is Amber topology, while the filename given with the -
\begin_inset Formula $c$
\end_inset

 option is a coordinate file.
 If -
\begin_inset Formula $p$
\end_inset

 or -
\begin_inset Formula $c$
\end_inset

 options are not given, the program expects that files "prmtop" and/or "inpcrd"
 exist in the current directory, which will be taken as topology and coordinate
 files correspondingly.
 If no command line options are given, the program prints the usage statement.
\end_layout

\begin_layout Standard
The option 
\shape italic
-prnlev
\shape default
 specifies how much (debugging) information is printed to 
\series bold
stdout
\series default
.
 If it is 0, only selected atoms are printed.
 More verbose output (which might be useful for debugging purposes) is achieved
 with higher values: 1 prints original "maskstr" in its tokenized (with
 operands enclosed in square brackets) and postfix (or Reverse Polish Notation)
 forms; number of atoms and residues in the topology file and number of
 selected atoms are also printed to 
\series bold
stdout
\series default
.
 2 prints the resulting mask array, which is an array of integer values,
 with '1' representing a selected atom, and '0' an unselected one.
 Value of 3, in addition, prints mask arrays as they are pushed or popped
 from the stack (this is really only useful for tracing the problems occurring
 during stack operations).
 The 
\shape italic
-prnlev
\shape default
 values of 0 or 1 should suffice for most uses.
\end_layout

\begin_layout Standard
The option 
\shape italic
-out
\shape default
 specifies the format of printed atoms.
 "short" means a condensed output using residue (:) and atom (@) designators
 followed by residue ranges and atom names.
 "pdb" (default) prints atoms in Amber-style PDB format with the original
 "maskstr" printed as a REMARK at the top of the PDB file, and "amber" prints
 atom/residue ranges in the format suitable for copying into group input
 section of Amber input file.
\end_layout

\begin_layout Standard
The option 
\shape italic
-find
\shape default
 is followed by "maskstr" expression.
 This is a string where some characters have a special meaning and thus
 express what parts (atoms/residues) of the molecule will get selected.
 The syntax of this string is explained in the section above (DESCRIPTION).
 If this option is left out, it defaults to ":*", which selects all atoms
 in the given topology file.
 The length of "maskstr" is limited to 80 characters.
 If the "maskstr" contains spaces or special characters (which would be
 expanded by the shell), it should be protected by single or double quotes
 (depending on the shell).
 In addition, for C-shells even a quoted exclamation character may be expanded
 for history substitution.
 Thus, it is recommended that the operand of the negation operator always
 be enclosed in parentheses so that "!" is always followed by a "(" to produce
 "!(" which disables the special history interpretation.
 For example, [@C=
\begin_inset space ~
\end_inset

&
\begin_inset space ~
\end_inset

!(@CA,C)] selects all carbons except backbone alpha and carbonyl carbon;
 the parentheses are redundant but shell safe.
 The man page indicates further ways to disable history substitution.
 
\end_layout

\begin_layout Description
FILES
\end_layout

\begin_layout Standard
Assumes that 
\shape italic
prmtop
\shape default
 and 
\shape italic
inpcrd
\shape default
 files exists in the current directory if they are not specified with -
\begin_inset Formula $p$
\end_inset

 and -
\begin_inset Formula $c$
\end_inset

 options.
 Resulting (i.e.
 selected) atoms are written to 
\series bold
stdout
\series default
.
 
\end_layout

\begin_layout Description
BUGS
\end_layout

\begin_layout Standard
Because all atom names are left justified in Amber topology and the selections
 are case insensitive, there is no way to distinguish some atom names: alpha
 carbon CA and a calcium ion Ca are a notorious example of that.
\end_layout

\begin_layout Section

\series bold
GROUP Specification
\begin_inset CommandInset label
LatexCommand label
name "cha:GROUP-Specification"

\end_inset


\end_layout

\begin_layout Standard
This section describes the format used to define groups of atoms in various
 Amber programs.
 In 
\shape italic
sander
\shape default
, a group can be specified as a movable "belly" while the other atoms are
 fixed absolutely in space (aside from scaling caused by constant pressure
 simulation), and/or a group of movable atoms can independently restrained
 (held by a potential) at their positions.
 In 
\shape italic
anal
\shape default
, groups can be defined for energy analysis.
 In sander and pmemd, GROUP input comes at the end of the mdin input file,
 as discussed in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:mdin-info"

\end_inset

.
\end_layout

\begin_layout Standard
Except in the analysis module where different groups of atoms are considered
 with different group numbers for energy decomposition, in all other places
 the groups of atoms defined are considered as marked atoms to be included
 for certain types of calculations.
 In the case of constrained minimization or dynamics, the atoms to be constraine
d are read as groups with a different weight for each group.
\end_layout

\begin_layout Standard
Reading of groups is performed by the routine RGROUP, and you are advised
 to consult it if there is still some ambiguity in the documentation.
\end_layout

\begin_layout Standard

\series bold
Input description:
\end_layout

\begin_layout LyX-Code

\size small
- 1 - Title 
\shape italic
format(20a4)
\end_layout

\begin_layout LyX-Code

\size small
ITITL Group title for identification.
\end_layout

\begin_layout LyX-Code

\size small
Setting ITITL = 'END' ends group input.
\end_layout

\begin_layout LyX-Code

\size small
------------------------------------------------------------------------
\end_layout

\begin_layout LyX-Code

\size small
- 1A - Weight 
\shape italic
format(f)
\end_layout

\begin_layout LyX-Code

\size small
This line is only provided/read when using GROUP input to
\end_layout

\begin_layout LyX-Code

\size small
define restrained atoms.
\end_layout

\begin_layout LyX-Code

\size small
WT The harmonic force constants in kcal/mol-A**2 for the group
\end_layout

\begin_layout LyX-Code

\size small
of atoms for restraining to a reference position.
\end_layout

\begin_layout LyX-Code

\size small
------------------------------------------------------------------------
\end_layout

\begin_layout LyX-Code

\size small
- 1B - Control to define the group
\end_layout

\begin_layout LyX-Code

\size small
KTYPG , (IGRP(I) , JGRP(I) , I = 1,7) 
\shape italic
format(a,14i)
\end_layout

\begin_layout LyX-Code

\size small
KTYPG Type of atom selection performed.
 A molecule can be
\end_layout

\begin_layout LyX-Code

\size small
defined by using only 'ATOM' or 'RES', or part of the
\end_layout

\begin_layout LyX-Code

\size small
molecule can be defined by 'ATOM' and part by 'RES'.
\end_layout

\begin_layout LyX-Code

\size small
'ATOM' The group is defined in terms of atom numbers.
 The atom
\end_layout

\begin_layout LyX-Code

\size small
number list is given in igrp and jgrp.
\end_layout

\begin_layout LyX-Code

\size small
'RES' The group is defined in terms of residue numbers.
 The
\end_layout

\begin_layout LyX-Code

\size small
residue number list is given in igrp and jgrp.
\end_layout

\begin_layout LyX-Code

\size small
'FIND' This control is used to make additional conditions
\end_layout

\begin_layout LyX-Code

\size small
(apart from the 'ATOM' and 'RES' controls) which a given
\end_layout

\begin_layout LyX-Code

\size small
atom must satisfy to be included in the current group.
\end_layout

\begin_layout LyX-Code

\size small
The conditions are read in the next section (1C) and are
\end_layout

\begin_layout LyX-Code

\size small
terminated by a SEARCH card.
\end_layout

\begin_layout LyX-Code

\size small
Note that the conditions defined by FIND filter any set(s) of atoms
\end_layout

\begin_layout LyX-Code

\size small
defined by the following ATOM/RES instructions.
 For example,
\end_layout

\begin_layout LyX-Code

\size small
-- group input: select main chain atoms --
\end_layout

\begin_layout LyX-Code

\size small
FIND
\end_layout

\begin_layout LyX-Code

\size small
* * M *
\end_layout

\begin_layout LyX-Code

\size small
SEARCH
\end_layout

\begin_layout LyX-Code

\size small
RES 1 999
\end_layout

\begin_layout LyX-Code

\size small
END
\end_layout

\begin_layout LyX-Code

\size small
END
\end_layout

\begin_layout LyX-Code

\size small
'END' End input for the current group.
 Followed by either another
\end_layout

\begin_layout LyX-Code

\size small
group definition (starting again with line 1 above), or by a second
\end_layout

\begin_layout LyX-Code

\size small
'END' "card", which terminates all group input.
\end_layout

\begin_layout LyX-Code

\size small
IGRP(I) , JGRP(I)
\end_layout

\begin_layout LyX-Code

\size small
The atom or residue pointers.
 If ktypg .eq.
 'ATOM' all
\end_layout

\begin_layout LyX-Code

\size small
atoms numbered from igrp(i) to jgrp(i) will be put into
\end_layout

\begin_layout LyX-Code

\size small
the current group.
 If ktypg .eq.
 'RES' all atoms in the
\end_layout

\begin_layout LyX-Code

\size small
residues numbered from igrp(i) to jgrp(i) will be put
\end_layout

\begin_layout LyX-Code

\size small
into the current group.
 If igrp(i) = 0 the next control
\end_layout

\begin_layout LyX-Code

\size small
card is read.
\end_layout

\begin_layout LyX-Code

\size small
It is not necessary to fill groups according to the
\end_layout

\begin_layout LyX-Code

\size small
numerical order of the residues.
 In other words, Group 1
\end_layout

\begin_layout LyX-Code

\size small
could contain residues 40-95 of a protein, Group 2 could
\end_layout

\begin_layout LyX-Code

\size small
contain residues 1-40 and Group 3 could contain residues
\end_layout

\begin_layout LyX-Code

\size small
96-105.
\end_layout

\begin_layout LyX-Code

\size small
If ktypg .eq.
 'RES', then associating a minus sign with
\end_layout

\begin_layout LyX-Code

\size small
igrp(i) will cause all residues igrp(i) through jgrp(i)
\end_layout

\begin_layout LyX-Code

\size small
to be placed in separate groups.
\end_layout

\begin_layout LyX-Code

\size small
In the analysis modules, all atoms not explicitly defined
\end_layout

\begin_layout LyX-Code

\size small
as members of a group will be combined as a unit in the
\end_layout

\begin_layout LyX-Code

\size small
(n + 1) group, where the (n) group in the last defined
\end_layout

\begin_layout LyX-Code

\size small
group.
\end_layout

\begin_layout LyX-Code

\size small
------------------------------------------------------------------------
\end_layout

\begin_layout LyX-Code

\size small
- 1C - Section to read atom characteristics
\end_layout

\begin_layout LyX-Code

\size small
***** Read only if KTYPG = 'FIND' *****
\end_layout

\begin_layout LyX-Code

\size small
JGRAPH(I) , JSYMBL(I) , JTREE(I) , JRESNM(I) 
\shape italic
format(4a)
\end_layout

\begin_layout LyX-Code

\size small
A series of filter specifications are read.
 Each filter consists
\end_layout

\begin_layout LyX-Code

\size small
of four fields (JGRAPH,JSYMBL,JTREE,JRESNM), and each filter is placed
\end_layout

\begin_layout LyX-Code

\size small
on a separate line.
 Filter specification is terminated by a line with
\end_layout

\begin_layout LyX-Code

\size small
JGRAPH = 'SEARCH'.
 A maximum of 10 filters may be specified for a
\end_layout

\begin_layout LyX-Code

\size small
single 'FIND' command.
\end_layout

\begin_layout LyX-Code

\size small
The union of the filter specifications is applied to the atoms defined
\end_layout

\begin_layout LyX-Code

\size small
by the following ATOM/RES cards.
 I.e.
 if an atom satisfies any of the
\end_layout

\begin_layout LyX-Code

\size small
filters, it will be included in the current group.
 Otherwise, it is not
\end_layout

\begin_layout LyX-Code

\size small
included.
 For example, to select all non main chain atoms from residues
\end_layout

\begin_layout LyX-Code

\size small
1 through 999:
\end_layout

\begin_layout LyX-Code

\size small
-- group input: select non main chain atoms --
\end_layout

\begin_layout LyX-Code

\size small
FIND
\end_layout

\begin_layout LyX-Code

\size small
* * S *
\end_layout

\begin_layout LyX-Code

\size small
* * B *
\end_layout

\begin_layout LyX-Code

\size small
* * 3 *
\end_layout

\begin_layout LyX-Code

\size small
* * E *
\end_layout

\begin_layout LyX-Code

\size small
SEARCH
\end_layout

\begin_layout LyX-Code

\size small
RES 1 999
\end_layout

\begin_layout LyX-Code

\size small
END
\end_layout

\begin_layout LyX-Code

\size small
END
\end_layout

\begin_layout LyX-Code

\size small
'END' End input for the current group.
 Followed by either another
\end_layout

\begin_layout LyX-Code

\size small
The four fields for each filter line are:
\end_layout

\begin_layout LyX-Code

\size small
JGRAPH(I) The atom name of atom to be included.
 If this and the
\end_layout

\begin_layout LyX-Code

\size small
following three characteristics are satisfied the atom is
\end_layout

\begin_layout LyX-Code

\size small
included in the group.
 The wild card '*' may be used to
\end_layout

\begin_layout LyX-Code

\size small
to indicate that any atom name will satisfy the search.
\end_layout

\begin_layout LyX-Code

\size small
JSYMBL(I) Amber atom type of atom to be included.
 The wild card
\end_layout

\begin_layout LyX-Code

\size small
'*' may be used to indicate that any atom type will
\end_layout

\begin_layout LyX-Code

\size small
satisfy the search.
\end_layout

\begin_layout LyX-Code

\size small
JTREE(I) The tree name (M, S, B, 3, E) of the atom to be included.
\end_layout

\begin_layout LyX-Code

\size small
The wild card '*' may be used to indicate that any tree
\end_layout

\begin_layout LyX-Code

\size small
name will satisfy the search.
\end_layout

\begin_layout LyX-Code

\size small
JRESNM(I) The residue name to which the atom has to belong to be
\end_layout

\begin_layout LyX-Code

\size small
included in the group.
 The wild card '*' may be used to
\end_layout

\begin_layout LyX-Code

\size small
indicate that any residue name will satisfy the search.
\end_layout

\begin_layout LyX-Code

\size small
------------------------------------------------------------------------
\end_layout

\begin_layout Standard

\series bold
Examples:
\end_layout

\begin_layout Standard
The molecule 18-crown-6 will be used to illustrate the group options.
 This molecule is composed of six repeating (-CH2-O-CH2-) units.
 Let us suppose that one created three residues in the PREP unit: CRA, CRB,
 CRC.
 Each of these is a (-CH2-O-CH2-) moiety and they differ by their dihedral
 angles.
 In order to construct 18-crown-6, the residues CRA, CRB, CRC, CRB, CRC,
 CRB are linked together during the LINK module with the ring closure being
 between CRA(residue 1) and CRB(residue 6).
\end_layout

\begin_layout Standard

\series bold
Input 1:
\end_layout

\begin_layout LyX-Code
Title one
\end_layout

\begin_layout LyX-Code
RES 1 5
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
Title two
\end_layout

\begin_layout LyX-Code
RES 6
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout Standard

\series bold
Output 1:
\series default
 Group 1 will contain residues 1 through 5 (CRA, CRB, CRC, CRB, CRC) and
 Group 2 will contain residue 6 (CRB).
\end_layout

\begin_layout Standard

\series bold
Input 2:
\end_layout

\begin_layout LyX-Code
Title one
\end_layout

\begin_layout LyX-Code
RES 1 5
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
Title two
\end_layout

\begin_layout LyX-Code
ATOM 36 42
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout Standard

\series bold
Output 2:
\series default
 Group 1 will contain residues 1 through 5 (CRA, CRB, CRC, CRB, CRC) and
 Group 2 will contain atoms 36 through 42.
 Coincidentally, atoms 36 through 42 are also all the atoms in residue 6.
\end_layout

\begin_layout Standard

\series bold
Input 3:
\end_layout

\begin_layout LyX-Code
Title one
\end_layout

\begin_layout LyX-Code
RES -1 6
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout Standard

\series bold
Output 3:
\series default
 Six groups will be created; Group 1: CRA, Group 2: CRB,..., Group 6: CRB.
\end_layout

\begin_layout Standard

\series bold
Input 4:
\end_layout

\begin_layout LyX-Code
Title one
\end_layout

\begin_layout LyX-Code
FIND
\end_layout

\begin_layout LyX-Code
O2 OS M CRA
\end_layout

\begin_layout LyX-Code
SEARCH
\end_layout

\begin_layout LyX-Code
RES 1 6
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout Standard

\series bold
Output 4:
\series default
 Group 1 will contain those atoms with the atom name 'O2', atom type 'OS',
 tree name 'M' and residue name 'CRA'.
\end_layout

\begin_layout Standard

\series bold
Input 5:
\end_layout

\begin_layout LyX-Code
Title one
\end_layout

\begin_layout LyX-Code
FIND
\end_layout

\begin_layout LyX-Code
O2 OS * *
\end_layout

\begin_layout LyX-Code
SEARCH
\end_layout

\begin_layout LyX-Code
RES 1 6
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout Standard

\series bold
Output 5:
\series default
 Group 1 will contain those atoms with the atom name 'O2', atom type 'OS',
 any tree name and any residue name.
\end_layout

\begin_layout Standard

\series bold
Input 6:
\end_layout

\begin_layout LyX-Code
Title one
\end_layout

\begin_layout LyX-Code
RES 1 3 6 6
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout Standard

\series bold
Output 6:
\series default
 One group is created containing residues 1 to 3 and 6.
 Up to seven ranges of contiguous residues can be specified per group.
 (In this case there are two ranges).
\end_layout

\begin_layout Standard

\series bold
Input 7:
\end_layout

\begin_layout LyX-Code
First restraint group
\end_layout

\begin_layout LyX-Code
10.0
\end_layout

\begin_layout LyX-Code
FIND
\end_layout

\begin_layout LyX-Code
CA * * *
\end_layout

\begin_layout LyX-Code
SEARCH
\end_layout

\begin_layout LyX-Code
RES 1 17   25 36
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
Second restraint group, with a different restraint weight
\end_layout

\begin_layout LyX-Code
1.0
\end_layout

\begin_layout LyX-Code
FIND
\end_layout

\begin_layout LyX-Code
CA * * *
\end_layout

\begin_layout LyX-Code
SEARCH
\end_layout

\begin_layout LyX-Code
RES 61 127
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout LyX-Code
END
\end_layout

\begin_layout Standard

\series bold
Output 7:
\series default
 CA atoms in residues 1-17 and 25-36 will be restrained to their initial
 positions with a strong weight of 
\begin_inset Formula $10.0\mathrm{kcal}\cdot\mathrm{mol}^{-1}\cdot\mathrm{\AA}^{-2}$
\end_inset

; CA atoms in residues 61 to 127 will have a weaker restraint force constant.
\end_layout

\begin_layout Chapter
Sampling configuration space
\end_layout

\begin_layout Standard
The "middle" scheme [Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:middle-scheme"

\end_inset

] offers an efficient approach to accurately sample configuration space
 in standard molecular dynamics simulations.
 There are many instances when standard molecular dynamics simulations get
 
\begin_inset Quotes eld
\end_inset

stuck
\begin_inset Quotes erd
\end_inset

 near the starting configuration, and fail to adequately sample the available
 low-energy configurational space.
 This chapter describes a variety of techniques that can partially overcome
 such problems.
 The following chapter (on Free Energies) continues many of these ideas,
 adapting them to the calculation of alchemical or configurational free
 energy differences.
 There is no good distinction between these two chapters, because good sampling
 of the canonical distribution and estimation of free energies go hand-in-hand.
 But the present chapter covers methods that are 
\emph on
primarily
\emph default
 devoted to enhanced or accelerated sampling, whereas the following chapter
 considers methods that explicitly estimate free energy differences.
\end_layout

\begin_layout Section

\series bold
Self-Guided Langevin dynamics
\begin_inset CommandInset label
LatexCommand label
name "sec:Self-Guided-Langevin-dynamics"

\end_inset


\end_layout

\begin_layout Standard
Self-guided Langevin dynamics (SGLD) is designed to enhance conformational
 search efficiency in either a molecular dynamics (MD) simulation (when
 
\shape italic
gamma_ln=0
\shape default
) or a Langevin dynamics (LD) simulation (when 
\shape italic
gamma_ln
\begin_inset Formula $>$
\end_inset

0
\shape default
).
 This method accelerates low frequency motion to enhance conformational
 sampling.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Wu03,Wu12,Wu13a,Wu16,Wu20"
literal "true"

\end_inset

 
\end_layout

\begin_layout Standard

\series bold
Overview:
\series default
 The input parameter, 
\shape italic
tsgavg
\shape default
, defines the lower limit period of the low frequency motion.
 Typically, 
\shape italic
tsgavg
\shape default
=0.2 ps is sutiable to define bond stretching and bending motions as high
 frequency motion and is recommanded to enhance motions like phase separation,
 secondary structure folding, and ligand docking, while 
\shape italic
tsgavg
\shape default
=1.0 ps is suitable to include more local motions such as bond rotation and
 solvent relaxation and is recommended for protein domain motion, and protein-pr
otein docking.
 The input parameter, 
\shape italic
sgft
\shape default
 or 
\emph on
sgff
\emph default
, defines the strength of the guiding effect.
 
\shape italic
sgft
\shape default
 between 
\begin_inset Formula $-1$
\end_inset

 and +1 sets the momentum guiding effect, with 0 for regular LD or MD simulation
s.
 A larger 
\shape italic
sgft
\shape default
 will enhance low frequency motion to accelerate conformational search.
 
\shape italic
sgff 
\emph on
between 
\begin_inset Formula $-0.32$
\end_inset

 and +0.32
\shape default
\emph default
 defines a force guiding factor to target energy barriers.
 A negative value will flatten energy barriers.
 Normally, 
\shape italic
sgft
\shape default
 and 
\shape italic
sgff
\shape default
 have opposite effects on conformational distribution and there exist balanced
 values to conserve the canonical ensemble.
 SGLD accelerates slow events to an affordable time scale while minimizing
 the perturbation to the conformational distribution.
 The guiding force can be applied to a part of a simulation system between
 atom 
\shape italic
isgsta
\shape default
 and atom 
\shape italic
isgend
\shape default
.
\end_layout

\begin_layout Standard
The conformational distribution of SGLD can be reweighted to produce canonical
 ensemble averages
\begin_inset CommandInset citation
LatexCommand citep
key "Wu11a,Wu12,Wu20"
literal "true"

\end_inset

.
 The current implementation is mainly based on the most recent reformulation
 named the generallized self-guided molecular simulation method (SGMDg or
 SGLDg)
\begin_inset CommandInset citation
LatexCommand citep
key "Wu20"
literal "true"

\end_inset

.
 The previous method
\begin_inset CommandInset citation
LatexCommand citep
key "Wu11a,Wu11b"
literal "true"

\end_inset

, SGLDfp is no longer available.
 As an alternative to Langevin dynamics (LD), self-guided Langevin dynamics
 via generalized Langevin equation (SGLD-GLE) 
\begin_inset CommandInset citation
LatexCommand citep
key "Wu16"
literal "true"

\end_inset

 can exactly preserve canonical ensemble while avoiding the slow down by
 friction forces.
 SGLD-GLE method can be turned on by setting 
\shape italic
sgfg
\shape default
 between 
\begin_inset Formula $-1$
\end_inset

 and +1.
 SGLD-GLE can be used with SGLDg by setting 
\shape italic
sgft
\shape default
, 
\shape italic
sgff
\shape default
, and 
\shape italic
sgfg
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
isgld
\begin_inset Index idx
status open

\begin_layout Plain Layout
isgld
\end_layout

\end_inset

 SGLD algorithm index.
 Default 
\shape italic
isgld
\shape default
= 0, SGLD is diabled; 
\shape italic
isgld
\shape default
>0 will turn on SGLDg/SGMDg and/or SGLD-GLE method.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tsgavg
\begin_inset Index idx
status open

\begin_layout Plain Layout
tsgavg
\end_layout

\end_inset

 Local averaging time (
\shape italic
psec
\shape default
) for the guiding force calculation.
 Default 0.2 
\shape italic
psec
\shape default
.
 A larger value defines slower motion to be enhanced.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
sgft
\begin_inset Index idx
status open

\begin_layout Plain Layout
sgft
\end_layout

\end_inset

 Momentum guiding factor.
 Defines the strength of the guiding effect.
 Default 0.0.
 Suggested value is 1.0 when 
\shape italic
sgff=0.

\shape default
 Its value range is -1~1 with larger value leads to stronger low frequency
 motion.
 When 
\shape italic
sgft
\shape default
 is set <-1 or >1, it is reset to the balanced value of 
\shape italic
sgff
\shape default
 to preserve canonical ensemble.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
sgff
\begin_inset Index idx
status open

\begin_layout Plain Layout
sgff
\end_layout

\end_inset

 Force guiding factor.
 
\shape italic
sgff
\shape default
 is used to scale down low frequency energy surface by a factor, (1+
\shape italic
sgff
\shape default
).
 
\shape italic
sgff
\shape default
 is suggested to take values between -0.32 and 0.32, with default value of
 0.
  Suggested value is -0.3 when 
\shape italic
sgft=0.
 
\shape default
 When sgff is set <-1 or >1, it is reset to the balanced value of 
\shape italic
sgft
\shape default
 to preserv canonical ensemble.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
sgfg
\begin_inset Index idx
status open

\begin_layout Plain Layout
sgft
\end_layout

\end_inset

 momentum guiding factor for SGLD-GLE.
 Degault is 0.
 Its value range is -1~1 with larger value resulting in faster low frequency
 motion.
  Suggested value is 1 when
\shape italic
 sgft=0 and sgff=0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
isgsta
\begin_inset Index idx
status open

\begin_layout Plain Layout
isgsta
\end_layout

\end_inset

 The first atom index of SGLD region.
 Default is 1.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
isgend
\begin_inset Index idx
status open

\begin_layout Plain Layout
isgend
\end_layout

\end_inset

 The last atom index of SGLD region.
 Default is 
\shape italic
natom
\shape default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nsgsize
\begin_inset Index idx
status open

\begin_layout Plain Layout
nsgsize
\end_layout

\end_inset

 size of the bonded substructure for each atom used to calculate average
 guiding forces.
 1 for no bonded structure is considered; 2 for all atoms connected through
 bonds or angles ; 3 for all atoms connected through bonds, angles, and
 dihedral angles.
 Default is 1.
\end_layout

\begin_layout Standard
The output of SGMD/SGLD simulations contains the following properties related
 to the enhancement in conformational search and reweighting of conformational
 distribution:
\end_layout

\begin_layout Standard
METHOD: GAMM TEMPLF TEMPHF EPOTLF EPOTHF EPOTLLF SGWT
\end_layout

\begin_layout Standard
\paragraph_spacing onehalf
\noindent
These quantities are instantaneous values defined as below: 
\end_layout

\begin_layout Standard
METHOD: SGLD when 
\shape italic
gamma_ln
\begin_inset Formula $>$
\end_inset

0 
\shape default
or SGMD when 
\shape italic
gamma_ln=0
\end_layout

\begin_layout Standard
GAMM: Average atomic friction constant based on atom interactions.
 
\end_layout

\begin_layout Standard
TEMPLF: low frequency temperature 
\end_layout

\begin_layout Standard
TEMPHF: high frequency temperature.
 Apparent temperature=TEMPLF+TEMPHF
\end_layout

\begin_layout Standard
EPOTLF: low frequency potential energy 
\end_layout

\begin_layout Standard
EPOTHF: high frequency potential energy, EPOT=EPOTLF+EPOTHF
\end_layout

\begin_layout Standard
EPOTLLF: Average of low frequency potential energy.
 It is needed for reweighting.
 
\end_layout

\begin_layout Standard
SGWT: Weighting number.
 exp(SGWT) is the weighting factor of current frame.
 
\end_layout

\begin_layout Standard
\paragraph_spacing onehalf
\noindent
The weight of a conformation is calculated by 
\end_layout

\begin_layout LyX-Code
Weight=exp(SGWT) =exp(((p(sgft)-sgff)*(EPOTLF-EPOTLLF)/(KBOLTZ*Temp))
\end_layout

\begin_layout LyX-Code
where: sgft=(1+p(sgft))^2-1/(1+p(sgft))
\end_layout

\begin_layout Standard
or:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\mathbf{\mathit{w}}_{i}=\exp\left(\frac{\lambda_{FP}-\lambda_{F}}{kT}(E_{LF}-E_{LLF})\right)
\]

\end_inset


\end_layout

\begin_layout Standard
where p(sgft) or 
\begin_inset Formula $\lambda_{FP}$
\end_inset

 is called the balanced force guiding factor of 
\begin_inset Formula $\lambda_{P}$
\end_inset

.
 The relation between sgft, 
\begin_inset Formula $\lambda_{P}$
\end_inset

, and p(sgft), 
\begin_inset Formula $\lambda_{FP}$
\end_inset

, is: 
\begin_inset Formula $\lambda_{P}=(1+\lambda_{FP})^{2}-\frac{1}{1+\lambda_{FP}}$
\end_inset

.
 Similarly, 
\begin_inset Formula $\lambda_{PF}$
\end_inset

 is called the balanced momentum guiding factor of 
\begin_inset Formula $\lambda_{F}$
\end_inset

, where 
\begin_inset Formula $\lambda_{PF}=(1+\lambda_{F})^{2}-\frac{1}{1+\lambda_{F}}$
\end_inset

.
 When both 
\begin_inset Formula $\lambda_{P}$
\end_inset

 and 
\begin_inset Formula $\lambda_{F}$
\end_inset

 are used in a SGMDg/SGLDg simulation, it is recommanded that 
\begin_inset Formula $-1\leq\lambda_{p}-\lambda_{PF}\leq1$
\end_inset

.
\end_layout

\begin_layout Standard
\noindent
For convenience, two scripts, 
\shape italic
sgldinfo.sh
\shape default
 and 
\shape italic
sgldwt.sh
\shape default
, are provided in the AMBERHOME/bin directory to extract SGLD properties
 and weighting factors from sander output files.
 For example, one can run:
\end_layout

\begin_layout LyX-Code

\shape italic
\emph on
sgldinfo.sh mdout
\end_layout

\begin_layout Standard
\noindent
to examine the SGLD properties, and run:
\end_layout

\begin_layout LyX-Code

\shape italic
\emph on
sgldwt.sh mdout
\end_layout

\begin_layout Standard
\noindent
to print weighting factors at each print time frame, averages and reweighted
 averages of the SGMD/SGLD properties.
 Ensemble average properties can be calculated through reweighting:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
<P>=\frac{\sum_{i=N_{0}}^{N}\mathbf{\mathit{w}}_{i}P_{i}}{\sum_{i=N_{0}}^{N}\mathbf{\mathit{w}}_{i}}
\]

\end_inset


\end_layout

\begin_layout Standard
Below are example input files to run SGMD/SGLD simulations.
\end_layout

\begin_layout Standard
1.
 a SGLD simulation with sgft only:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Sample SGLD simulation for enhanced conformational search 
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

nstlim=1000, cut=99.0, igb=1, saltcon=0.1,
\end_layout

\begin_layout Plain Layout

ntpr=100, ntwr=100000, ntt=3, gamma_ln=10.0,
\end_layout

\begin_layout Plain Layout

ntx=5, irest=1,
\end_layout

\begin_layout Plain Layout

ntc=2, ntf=2, tol=0.000001,
\end_layout

\begin_layout Plain Layout

dt=0.002, ntb=0, tempi=300., temp0=300.,
\end_layout

\begin_layout Plain Layout

isgld=1,tsgavg=0.2,sgft=1.0,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
2.
 a SGLD simulation using bonded substructure(nsgsize=2) to estimate low
 frequency motion, which reduces noises due to bond stretching and bending.
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Sample SGLD simulation using bonded substructures 
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

nstlim=1000, cut=99.0, igb=1, saltcon=0.1,
\end_layout

\begin_layout Plain Layout

ntpr=100, ntwr=100000, ntt=3, gamma_ln=10.0,
\end_layout

\begin_layout Plain Layout

ntx=5, irest=1, 
\end_layout

\begin_layout Plain Layout

ntc=2, ntf=2, tol=0.000001,
\end_layout

\begin_layout Plain Layout

dt=0.002, ntb=0, tempi=300., temp0=300.,
\end_layout

\begin_layout Plain Layout

isgld=1,tsgavg=0.2,sgft=1.0, nsgsize=2,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
3.
 a SGLDg simulation using both 
\shape italic
sgft
\shape default
 and 
\shape italic
sgff
\shape default
 factors.
 When both guiding factors are used, it is recommand that 
\begin_inset Formula $-1\leq\lambda_{p}-(1+\lambda_{F})^{2}+\frac{1}{1+\lambda_{F}}\leq1$
\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Sample SGLDg simulation using both sgft and sgff 
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

nstlim=1000, cut=99.0, igb=1, saltcon=0.1,
\end_layout

\begin_layout Plain Layout

ntpr=100, ntwr=100000, ntt=3, gamma_ln=10.0,
\end_layout

\begin_layout Plain Layout

ntx=5, irest=1, 
\end_layout

\begin_layout Plain Layout

ntc=2, ntf=2, tol=0.000001,
\end_layout

\begin_layout Plain Layout

dt=0.002, ntb=0, tempi=300., temp0=300.,
\end_layout

\begin_layout Plain Layout

isgld=1,tsgavg=0.2,sgft=0.5,sgff=-0.1,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
4.
 a SGMDg simulation when gamma_ln=0:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Sample SGMDg simulation using both sgft and sgff 
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

nstlim=1000, cut=99.0, igb=1, saltcon=0.1,
\end_layout

\begin_layout Plain Layout

ntpr=100, ntwr=100000, ntt=1, tautp=1.0,
\end_layout

\begin_layout Plain Layout

ntx=5, irest=1, 
\end_layout

\begin_layout Plain Layout

ntc=2, ntf=2, tol=0.000001,
\end_layout

\begin_layout Plain Layout

dt=0.002, ntb=0, tempi=300., temp0=300.,
\end_layout

\begin_layout Plain Layout

isgld=1,tsgavg=0.2,sgft=0.5,sgff=-0.1,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
5.
 a SGLD-GLE simulation using sgfg to achieve enhanced conformational search
 while conserve canonical ensemble exactly:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Sample SGLD-GLE simulation to conserve canonical ensemble
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

nstlim=1000, cut=99.0, igb=1, saltcon=0.1,
\end_layout

\begin_layout Plain Layout

ntpr=100, ntwr=100000, ntt=3, gamma_ln=10.0,
\end_layout

\begin_layout Plain Layout

ntx=5, irest=1,
\end_layout

\begin_layout Plain Layout

ntc=2, ntf=2, tol=0.000001,
\end_layout

\begin_layout Plain Layout

dt=0.002, ntb=0, tempi=300., temp0=300.,
\end_layout

\begin_layout Plain Layout

isgld=1,tsgavg=0.2,sgfg=1.0,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section

\series bold
Targeted MD
\end_layout

\begin_layout Standard
The targeted MD option adds an additional term to the energy function based
 on the mass-weighted root mean square deviation of a set of atoms in the
 current structure compared to a reference structure.
 The reference structure is specified using the 
\shape italic
-ref
\shape default
 flag in the same manner as is used for Cartesian coordinate restraints
 (NTR=1).
 Targeted MD can be used with or without positional restraints.
 If positional restraints are not applied (ntr=0), 
\shape italic
sander
\shape default
 performs a best-fit of the reference structure to the simulation structure
 based on selection in 
\shape italic
tgtfitmask
\shape default
 and calculates the RMSD for the atoms selected by 
\shape italic
tgtrmsmask
\shape default
.
 The two masks can be identical or different.
 This way, fitting to one part of the structure but calculating the RMSD
 (and thus restraint force) for another part of the structure is possible.
 If targeted MD is used in conjunction with positional restraints (ntr=1),
 only 
\shape italic
tgtrmsmask
\shape default
 should be given in the control input because the molecule is 'fitted' implicitl
y by applying positional restraints to atoms specified in 
\shape italic
restraintmask
\shape default
.
 
\begin_inset Newline newline
\end_inset

 The energy term has the form:
\end_layout

\begin_layout LyX-Code
E = 0.5 * TGTMDFRC * NATTGTRMS * (RMSD-TGTRMSD)**2
\end_layout

\begin_layout Standard
The energy will be added to the RESTRAINT term.
 Note that the energy is weighted by the number of atoms that were specified
 in the 
\shape italic
tgtrmsmask
\shape default
 (NATTGTRMS).
 The RMSD is the root mean square deviation and is mass weighted.
 The force constant is defined using the 
\shape italic
tgtmdfrc
\shape default
 variable (see below).
 This option can be used with molecular dynamics or minimization.
 When targeted MD is used, 
\shape italic
sander
\shape default
 will print the current values for the actual and target RMSD to the energy
 summary in the output file.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
itgtmd
\begin_inset Index idx
status open

\begin_layout Plain Layout
itgtmd
\end_layout

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 no targeted MD (default) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 use targeted MD 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

2 use targeted MD to multiple targets (Multiply-targeted MD, or MTMD, see
 next section below)
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
tgtrmsd
\begin_inset Index idx
status open

\begin_layout Plain Layout
tgtrmsd
\end_layout

\end_inset

 Value of the target RMSD.
 The default value is 0.
 This value can be changed during the simulation by using the weight change
 option.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tgtmdfrc
\begin_inset Index idx
status open

\begin_layout Plain Layout
tgtmdfrc
\end_layout

\end_inset

 This is the force constant for targeted MD.
 The default value is 0, which will result in no penalty for structure deviation
s regardless of the RMSD value.
 Note that this value can be negative, which would force the coordinates
 AWAY from the reference structure.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tgtfitmask
\begin_inset Index idx
status open

\begin_layout Plain Layout
tgtfitmask
\end_layout

\end_inset

 Define the atoms that will be used for the rms superposition between the
 current structure and the reference structure.
 Syntax is in Chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:ambmask"

\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tgtrmsmask
\begin_inset Index idx
status open

\begin_layout Plain Layout
tgtrmsmask
\end_layout

\end_inset

 Define the atoms that will be used for the rms difference calculation (and
 hence the restraint force), as outlined above.
 Syntax is in Chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:ambmask"

\end_inset

.
\end_layout

\begin_layout Standard
One can imagine many uses for this option, but a few things should be kept
 in mind.
 In this implementation of targeted MD, there is currently only one reference
 coordinate set, so there is no way to force the coordinates to any specific
 structure other than the one reference.
 To move a structure toward a reference coordinate set, one might use an
 initial 
\shape italic
tgtrmsd
\shape default
 value corresponding to the actual RMSD between the input and reference
 (
\shape italic
inpcrd
\shape default
 and 
\shape italic
refc
\shape default
).
 Then the weight change option could be used to decrease this value to 0
 during the simulation.
 To move a structure away from the reference, one can increase 
\shape italic
tgtrmsd
\shape default
 to values larger than zero.
 The minimum for this energy term will then be at structures with an RMSD
 value that matches 
\shape italic
tgtrmsd
\shape default
.
 Keep in mind that many different structures may have similar RMSD values
 to the reference, and therefore one cannot be sure that increasing 
\shape italic
tgtrmsd
\shape default
 to a given value will result in a particular structure that has that RMSD
 value.
 In this case it is probably wiser to use the final structure, rather than
 the initial structure, as the reference coordinate set, and decrease 
\shape italic
tgtrmsd
\shape default
 during the simulation.
 To address this, multiply-targeted MD is now available in Amber (
\shape italic
sander only
\shape default
), and is described in the next section.
 As an additional note, a negative force constant 
\shape italic
tgtmdfrc
\shape default
 can be used, but this can cause problems since the energy will continue
 to decrease as the RMSD to the reference increases.
\end_layout

\begin_layout Standard
Also keep in mind that phase space for molecular systems can be quite complex,
 and this method does not guarantee that a low energy path between initial
 and target structures will be followed.
 It is possible for the simulation to become unstable if the restraint energies
 become too large if a low-energy path between a simulated structure and
 the reference is not accessible.
\end_layout

\begin_layout Standard
Note also that the input and reference coordinates are expected to match
 the 
\shape italic
prmtop
\shape default
 file and have atoms in the same sequence.
 No provision is made for symmetry; rotation of a methyl group by 120° would
 result in a nonzero RMSD value.
\end_layout

\begin_layout Section

\series bold
Multiply-Targeted MD (MTMD)
\end_layout

\begin_layout Standard
In Amber (
\shape italic
sander only
\shape default
), the user may perform targeted MD calculations using multiple reference
 structures.
 Each reference may have its own associated target RMSD value and force
 constant, each of which can evolve independently in time.
 Additionally, the masks for each defined target may differ, and targeting
 to any given reference structure can be activated for some or part of the
 simulation.
 The energy term for MTMD is simply the sum of the energies that would be
 calculated for the molecule calculated relative to each target given the
 target RMSD and force constant for that target.
 The energy will then be added to the RESTRAINT term.
\end_layout

\begin_layout Standard
To use MTMD, the MTMD input file is specified using the 
\shape italic
-mtmd
\shape default
 flag in the command line arguments for 
\shape italic
sander
\shape default
.
 The MTMD input file will contain one instance of the tgt namelist (
\begin_inset Quotes eld
\end_inset

&tgt
\begin_inset Quotes erd
\end_inset

) for each reference structure used.
 The user may specify any number of reference structures.
\end_layout

\begin_layout Subsection

\series bold
Variables in the
\series default
 &tgt 
\series bold
namelist:
\series default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
refin
\begin_inset Index idx
status open

\begin_layout Plain Layout
refin
\end_layout

\end_inset

 The file name of the reference structure used.
 The input and reference coordinates are expected to match the 
\shape italic
prmtop
\shape default
 file and have atoms in the same sequence.
 
\shape italic
Default for refin is '', no reference structure given.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdform 
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdform
\end_layout

\end_inset

 If MTMDFORM > 0, then the reference coordinate file is formatted.
 Otherwise, the reference coordinate file is an unformatted (binary) file.
 
\shape italic
Default for MTMDFORM is the value assigned to MTMDFORM in the most recent
 namelist where MTMDFORM was specified.
 If MTMDFORM has not been specified in any namelist, it defaults to 1.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdstep1,
\begin_inset space ~
\end_inset

mtmdstep2
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdstep1
\end_layout

\end_inset

 Targeted MD for this structure is run for steps/iterations MTMDSTEP1 through
 MTMDSTEP2.
 If MTMDSTEP2 = 0, then TMD will be run through the end of the run, and
 the values of the target RMSD and the force constant will not change with
 time.
 Note that the first step/iteration is considered step 0.
 
\shape italic
Defaults for MTMDSTEP1 and MTMDSTEP2 are the values assigned to them in
 the most recent namelist where MTMDSTEP1 and MTMDSTEP2 were specified.
 If MTMDSTEP1 and MTMDSTEP2 have not been specified in any namelist, they
 default to 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdvari
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdvari
\end_layout

\end_inset

 If MTMDVARI 
\begin_inset Formula $>$
\end_inset

 0, then the force constant and target RMSD will vary with step number.
 Otherwise, they are constant throughout the run.
 If MTMDVARI 
\begin_inset Formula $>$
\end_inset

0, then the values MTMDSTEP2, MTMDRMSD2, and MTMDFORCE2 must be specified
 (see below).
 
\shape italic
Default for
\shape default
 MTMDVARI 
\shape italic
is the value assigned to
\shape default
 MTMDVARI 
\shape italic
in the most recent namelist where
\shape default
 MTMDVARI 
\shape italic
was specified.
 If
\shape default
 MTMDVARI 
\shape italic
has not been specified in any namelist, it defaults to 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdrmsd,
\begin_inset space ~
\end_inset

mtmdrmsd2
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdrmsd
\end_layout

\end_inset

 The target RMSD for this reference.
 If MTMDVARI 
\begin_inset Formula $>$
\end_inset

0, then the value of MTMDRMSD will vary between MTMDSTEP1 and MTMDSTEP2,
 so that, e.g.
 MTMDRMSD(MTMDSTEP1) = MTMDRMSD and MTMDRMSD(MTMDSTEP2) = MTMDRMSD2.
 
\shape italic
Defaults for MTMDRMSD and MTMDRMSD2 are the values assigned to them in the
 most recent namelist where MTMDRMSD and MTMDRMSD2 were specified.
 If MTMDRMSD and MTMDRMSD2 have not been specified in any namelist, they
 default to 0.0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdforce,
\begin_inset space ~
\end_inset

mtmdforce2
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdforce
\end_layout

\end_inset

 The force constant for this reference.
 If MTMDVARI 
\begin_inset Formula $>$
\end_inset

0, then the value of MTMDFORCE will vary between MTMDSTEP1 and MTMDSTEP2,
 so that, e.g.
 MTMDFORCE(MTMDSTEP1) = MTMDFORCE and MTMDFORCE(MTMDSTEP2) = MTMDFORCE2.
 
\shape italic
Defaults for
\shape default
 MTMDFORCE 
\shape italic
and
\shape default
 MTMDFORCE2 
\shape italic
are the values assigned to them in the most recent namelist where
\shape default
 MTMDFORCE 
\shape italic
and
\shape default
 MTMDFORCE2 
\shape italic
were specified.
 If
\shape default
 MTMDFORCE 
\shape italic
and
\shape default
 MTMDFORCE2 
\shape italic
have not been specified in any namelist, they default to 0.0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdninc
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdninc
\end_layout

\end_inset

 If MTMDVARI 
\begin_inset Formula $>$
\end_inset

0 and MTMDNINC 
\begin_inset Formula $>$
\end_inset

 0, then the changes in the values of of MTMDRMSD and MTMDFORCE are applied
 as a step function, with NINC steps/iterations between each change in the
 target values.
 If MTMDNINC = 0, the change is effected continuously (at every step).
 
\shape italic
Default for MTMDNINC is the value assigned to MTMDNINC in the most recent
 namelist where MTMDNINC was specified.
 If MTMDNINC has not been specified in any namelist, it defaults to 0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdmult
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdmult
\end_layout

\end_inset

 If MTMDMULT=0, and the values of MTMDFORCE changes with step number, then
 the changes in the force constant will be linearly interpolated from MTMDFORCE
\begin_inset Formula $\to$
\end_inset

MTMDFORCE2 as the step number changes.
 If MTMDMULT=1 and the force constant is changing with step number, then
 the changes in the force constant will be effected by a series of multiplicativ
e scalings, using a single factor, R, for all scalings.
 
\begin_inset Formula $i.e.$
\end_inset


\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout LyX-Code
MTMDFORCE2 = R**INCREMENTS * MTMDFORCE 
\end_layout

\begin_layout Standard
INCREMENTS is the number of times the target value changes, which is determined
 by MTMDSTEP1, MTMDSTEP2, and MTMDNINC.
 
\shape italic
Default for MTMDMULT is the value assigned to MTMDMULT in the most recent
 namelist where MTMDMULT was specified.
 If MTMDMULT has not been specified in any namelist, it defaults to 0.

\shape default
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
mtmdmask
\begin_inset Index idx
status open

\begin_layout Plain Layout
mtmdmask
\end_layout

\end_inset

 Define the atoms that will be used for both the rms superposition between
 the current structure and the reference structure and the rms difference
 calculation (and hence the restraint force), as outlined above.
 Syntax is in Chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:ambmask"

\end_inset

.
\shape italic
Default for MTMDMASK is the value assigned to MTMDMASK in the most recent
 namelist where MTMDMASK was specified.
 If MTMDMASK has not been specified in any namelist, it defaults to '*',
 use all atoms in the fit and force calculations.

\shape default
 
\backslash

\end_layout

\begin_layout Standard
Namelist &tgt is read for each reference structure.
 Input ends when a namelist statement with refin = '' (or refin not specified)
 is found.
 Note that comments can precede or follow any namelist statement, allowing
 comments and reference definitions to be freely mixed.
\end_layout

\begin_layout Section

\series bold
Low-MODe (LMOD) methods
\end_layout

\begin_layout Standard
István Kolossváry's LMOD methods for minimization, conformational searching,
 and flexible docking
\begin_inset CommandInset citation
LatexCommand cite
key "Kolossvary96,Kolossvary99,Kolossvary01,Keseru01"
literal "true"

\end_inset

 are fully implemented in Amber.
 The centerpiece of LMOD is a conformational search algorithm based on eigenvect
or following of low frequency vibrational modes.
 It has been applied to a spectrum of computational chemistry domains including
 protein loop optimization and flexible active site docking.
 
\end_layout

\begin_layout Standard
In the Amber 2020 release, the LMOD optimization code has been updated with
 major improvements and new features including more accurate flexible docking,
 the option to visualize normal modes, utilization of random mixtures of
 low-frequency modes, and the option to work with a range of modes anywhere
 in the spectrum and not just the lowest frequency modes.
 The latter is particularly useful for docking where the modes relevant
 to binding a ligand molecule are usually not the lowest frequency modes.
  The interface of the new LMOD has not changed, everything works exactly
 the same way as in Amber18 and earlier versions, a few parameters simply
 have additional options as documented below.
 The new features are demonstrated with production quality examples.
\end_layout

\begin_layout Standard
Details of the LMOD procedure, and hints on getting good performance, are
 given Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:lmod"

\end_inset

, which should be consulted before trying the procedures in 
\emph on
sander
\emph default
.
 The only difference between the 
\emph on
sander
\emph default
 and 
\emph on
NAB
\emph default
 implementations is the input specification; the same LMOD code is linked
 into both.
 The sections below give input details for 
\emph on
sander
\emph default
.
\end_layout

\begin_layout Standard
There are
\series bold
 four 
\begin_inset Quotes eld
\end_inset

real-life
\begin_inset Quotes erd
\end_inset

 examples
\series default
 of performing LMOD searches and in 
\emph on
lmod_vib_anim
\series bold
\emph default
 three examples
\series default
 of updates in Amber20 including generating LMOD-vibration visualization.
 These are available at 
\emph on
https://ambermd.org/Manuals.php
\emph default
.
 Each directory in the tar file has a README file with more information.
\end_layout

\begin_layout Subsection

\series bold
\begin_inset CommandInset label
LatexCommand label
name "subsec:XMIN"

\end_inset

XMIN
\end_layout

\begin_layout Standard
The XMIN methods for minimization are traditional and manifold in the field
 of unconstrained optimization: PRCG is a Polak-Ribiere nonlinear Conjugate
 Gradient algorithm,
\begin_inset CommandInset citation
LatexCommand cite
key "Press89"
literal "true"

\end_inset

 LBFGS is a Limited-memory Broyden-Fletcher-Goldfarb-Shanno quasi-Newton
 algorithm,
\begin_inset CommandInset citation
LatexCommand cite
key "Liu89"
literal "true"

\end_inset

 and TNCG is a Truncated Newton linear Conjugate Gradient method with optional
 LBFGS preconditioning.
\begin_inset CommandInset citation
LatexCommand cite
key "Nocedal00"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
Some of the &cntrl namelist variables that control Amber's other minimization
 facilities also control XMIN.
 Consequently, non-experts can employ the default XMIN method merely by
 specifying ntmin = 3.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
maxcyc
\begin_inset Index idx
status open

\begin_layout Plain Layout
maxcyc
\end_layout

\end_inset

 The maximum number of cycles of minimization.
 Default is 1 to be consistent with Amber's other minimization facilities
 although it may be unrealistically short.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ntmin
\begin_inset Index idx
status open

\begin_layout Plain Layout
ntmin
\end_layout

\end_inset

 The flag for the method of minimization.
 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

3 The XMIN method is used.
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

4 The LMOD method is used.
 The LMOD procedure employs XMIN for energy relaxation and minimization.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
drms
\begin_inset Index idx
status open

\begin_layout Plain Layout
drms
\end_layout

\end_inset

 The convergence criterion for the energy gradient: minimization will halt
 when the root-mean-square of the Cartesian elements of the gradient is
 less than this.
 Default is 
\begin_inset Formula $10^{-4}\mathrm{kcal}\cdot\mathrm{mol}^{-1}\cdot\mathrm{\AA}^{-1}$
\end_inset

.
 This is consistent with Amber's other minimization facilities.
  In Amber18 and earlier this default may have been unrealistically strict.
  In Amber20 this criterion refers to the minimization of the input structure
 for which the normal modes are computed, and to avoid unnatural vibrational
 modes it should be set to even stricter values, e.g., 
\begin_inset Formula $10^{-8}$
\end_inset

.
  Compare with input parameter lmod_minimize_grms below.
\end_layout

\begin_layout Standard
Other options that control XMIN are in the scope of the &lmod namelist.
 These parameters enable expert control of XMIN.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lbfgs_memory_depth
\begin_inset Index idx
status open

\begin_layout Plain Layout
lbfgs
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

memory
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

depth
\end_layout

\end_inset

 The depth of the LBFGS memory for LBFGS minimization, or LBFGS preconditioning
 in TNCG minimization.
 Default is 3.
 Suggested alternate value is 5.
 The value 0 turns off LBFGS preconditioning in TNCG minimization.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
matrix_vector_product_method
\begin_inset Index idx
status open

\begin_layout Plain Layout
matrix
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

vector
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

product
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

method
\end_layout

\end_inset

 The finite difference Hv matrix-vector product method: "forward" = forward
 difference, "central" = central difference.
 Default is forward difference.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
xmin_method
\begin_inset Index idx
status open

\begin_layout Plain Layout
xmin
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

method
\end_layout

\end_inset

 The minimization method: "PRCG" = Polak-Ribiere Conjugate Gradient, "LBFGS"
 = Limited-memory Broyden-Fletcher-Goldfarb-Shanno, and "TNCG" = Optionally
 LBFGS-preconditioned Truncated Newton Conjugate Gradient.
 Default is LBFGS.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
xmin_verbosity
\begin_inset Index idx
status open

\begin_layout Plain Layout
xmin
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

verbosity
\end_layout

\end_inset

 The verbosity of the internal status output from the XMIN package: 0 =
 none, 1 = minimization details, and 2 = minimization and line search details
 plus CG details in TNCG.
 Currently, the XMIN status output may be disordered with respect to Amber's
 output.
 Default is 0, no output of the XMIN package internal status.
 Note that XMIN is also available in AmberTools, in the NAB package.
 An annotated example output corresponding to XMIN_VERBOSITY=2 can be found
 in the NAB documentation.
\end_layout

\begin_layout Subsection

\series bold
\begin_inset CommandInset label
LatexCommand label
name "subsec:LMOD"

\end_inset

LMOD
\end_layout

\begin_layout Standard
Some of the options that control LMOD have the same names as Amber's other
 minimization facilities.
 See the XMIN section immediately above.
 Other options that control LMOD are in the scope of the &lmod namelist.
 These parameters enable expert control of LMOD.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
arnoldi_dimension
\begin_inset Index idx
status open

\begin_layout Plain Layout
arnoldi
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

dimension
\end_layout

\end_inset

 The dimension of the ARPACK Arnoldi factorization.
 Zero specifies the whole space, that is, three times the number of atoms.
 Default is 0, the whole space.
 Basically, the ARPACK package used for the eigenvector calculations solves
 multiple "small" eigenvalue problems instead of a single "large" problem,
 which is the diagonalization of the three times the number of atoms by
 three times the number of atoms Hessian matrix.
 This parameter is the user specified dimension of the "small" problem.
 The allowed range is total_low_modes + 1 
\begin_inset Formula $<$
\end_inset

= arnoldi_dimension 
\begin_inset Formula $<$
\end_inset

= three times the number of atoms.
 The default means that the "small" problem and the "large" problem are
 identical.
 This is the preferred, i.e., fastest, calculation for small to medium size
 systems, because ARPACK is guaranteed to converge in a single iteration.
 The ARPACK calculation scales with three times the number of atoms times
 the arnoldi_dimension squared and, therefore, for larger molecules there
 is an optimal arnoldi_dimension much less than three times the number of
 atoms that converges much faster in multiple iterations (possibly thousands
 or tens of thousands of iterations).
 The key to good performance is to select an arnoldi_dimension such that
 all the ARPACK storage fits in memory.
 For proteins, arnoldi_dimension=1000 is generally a good value, but often
 a very small 50-100 Arnoldi dimension provides the fastest net computational
 cost with very many iterations.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
conflib_filename
\begin_inset Index idx
status open

\begin_layout Plain Layout
conflib
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

filename
\end_layout

\end_inset

 The user-given filename of the LMOD conformational library.
 The file format is Amber standard formatted trajectory output regardless
 of the value of &cntrl namelist variable ioutfm.
 The conformations are stored in energetic order (global minimum energy
 structure first), the number of conformations
\begin_inset Formula $<$
\end_inset

= conflib_size.
 The default filename is 
\shape italic
conflib
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
conflib_size
\begin_inset Index idx
status open

\begin_layout Plain Layout
conflib
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

size
\end_layout

\end_inset

 The number of conformations to store in conflib.
 Default is 3.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
energy_window
\begin_inset Index idx
status open

\begin_layout Plain Layout
energy
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

window
\end_layout

\end_inset

 The energy window for conformation storage; the energy of a stored structure
 will be in the interval [global_min, global_min + energy_window].
 Default is 0, only storage of the global minimum structure.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
explored_low_modes
\begin_inset Index idx
status open

\begin_layout Plain Layout
explored
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

low
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

modes
\end_layout

\end_inset

 The number of low frequency vibrational modes used per LMOD iteration.
 Default is 3.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
frequency_eigenvector_recalc
\begin_inset Index idx
status open

\begin_layout Plain Layout
frequency
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

eigenvector
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

recalc
\end_layout

\end_inset

 The frequency, measured in LMOD iterations, of the recalculation of eigenvector
s.
 Default is 3.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
frequency_ligand_rotrans
\begin_inset Index idx
status open

\begin_layout Plain Layout
frequency
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

ligand
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

rotrans
\end_layout

\end_inset

 The frequency, measured in LMOD iterations, of the application of rigid-body
 rotational and translational motions to the ligand(s).
 At each frequency_ligand_rotrans-th LMOD iteration number_ligand_rotrans
 rotations and translations are applied to the ligand(s).
 Default is 1, ligand(s) are rotated and translated at every LMOD iteration.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_job_title
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

job
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

title
\end_layout

\end_inset

 The user-given title for the job that goes in the first line of the conflib
 and lmod_trajectory files.
 The default job title is "job_title_goes_here".
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_minimize_grms
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

minimize
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

grms
\end_layout

\end_inset

 In Amber18 and earlier the gradient root-mean-square convergence criterion
 of structure minimization.
 In Amber 20 this was specified to be the criterion to minimize low-energy
 conformations; such conformations do not require as strict a convergence
 criterion as does the first minimization whose convergence is now controlled
 with input parameter drms, see above.
 Default is 0.1.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_relax_grms
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

relax
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

grms
\end_layout

\end_inset

 The gradient RMS convergence criterion of structure relaxation.
 Default is 1.0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_restart_frequency
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

restart
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

frequency
\end_layout

\end_inset

 The frequency, in LMOD iterations, of conflib updating and LMOD restarting
 with a randomly chosen structure from the pool.
 Default is 5.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_step_size_max
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

step
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

size
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

max
\end_layout

\end_inset

 The maximum length of a single LMOD ZIG move.
 Default is 5.0 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_step_size_min
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

step
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

size
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

min
\end_layout

\end_inset

 The minimum length of a single LMOD ZIG move.
 Default is 2.0 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_trajectory_filename
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

trajectory
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

filename
\end_layout

\end_inset

 The filename of the LMOD pseudo trajectory.
 The file format is standard Amber trajectory file.
 The conformations in this file show the progress of the LMOD search.
 The number of conformations = number_lmod_iterations + 1.
 The default filename is 
\shape italic
lmod_trajectory
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lmod_verbosity
\begin_inset Index idx
status open

\begin_layout Plain Layout
lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

verbosity
\end_layout

\end_inset

 The verbosity of the internal status output from the LMOD package: 0 =
 none, 1 = some details, 2 = more details, 3 = everything including ARPACK
 information, 4 = ARPACK only, 5 = visualize normal modes.
 Currently, the LMOD status output may be disordered with respect to Amber's
 output.
 Default is 0, no output of the LMOD package internal status.
 Note that LMOD is also available in AmberTools, in the NAB package.
 An annotated example output corresponding to LMOD_VERBOSITY=2 can be found
 in the NAB documentation.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
monte_carlo_method
\begin_inset Index idx
status open

\begin_layout Plain Layout
monte
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

carlo
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

method
\end_layout

\end_inset

 The Monte Carlo method: "Metropolis" = Metropolis Monte Carlo, "Total_Quench"
 = the LMOD trajectory always proceeds towards the lowest lying neighbor
 of a particular energy well found after exhaustive search along all of
 the low modes, and "Quick_Quench" = the LMOD trajectory proceeds towards
 the first neighbor found, which is lower in energy than the current point
 on the path, without exploring the remaining modes.
 Default is Metropolis Monte Carlo.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
number_free_rotrans_modes
\begin_inset Index idx
status open

\begin_layout Plain Layout
number
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

free
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

rotrans
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

modes
\end_layout

\end_inset

 In Amber18 and earlier this was solely the number of rotational and translation
al degrees of freedom (dof) which is related to the number of frozen or
 tethered atoms in the system: 0 atoms dof=6, 1 atom dof=3, 2 atoms dof=1,
 
\begin_inset Formula $>$
\end_inset

=3 atoms dof=0.
 In Amber20 the input domain was extended to any non-negative integer, and
 it represents the number of modes for LMOD to skip.
  In this way LMOD can now explore a range of modes instead of simply modes
 starting with the lowest frequency.
  Note that it is recommended to set this to 0 once in order to examine
 the ro-translational modes.
 Default is 6.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
number_ligand_rotrans
\begin_inset Index idx
status open

\begin_layout Plain Layout
number
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

ligand
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

rotrans
\end_layout

\end_inset

 The number of rigid-body rotational and translational motions applied to
 the ligand(s).
 Such applications occur at each frequency_ligand_rotrans-th LMOD iteration.
 Default is 0, no rigid-body motions applied to the ligand(s).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
number_ligands
\begin_inset Index idx
status open

\begin_layout Plain Layout
number
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

ligands
\end_layout

\end_inset

 The number of ligands for flexible docking.
 Default is 0, no ligand(s).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
number_lmod_iterations
\begin_inset Index idx
status open

\begin_layout Plain Layout
number
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

iterations
\end_layout

\end_inset

 The number of LMOD iterations.
 Default is 10.
 Note that setting number_lmod_iterations = 0 will result in a single energy
 minimization.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
number_lmod_moves
\begin_inset Index idx
status open

\begin_layout Plain Layout
number
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

lmod
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

moves
\end_layout

\end_inset

 The number of LMOD ZIG-ZAG moves.
 Zero means that the number of ZIG-ZAG moves is not pre-defined, instead
 LMOD will attempt to cross the barrier in as many ZIG-ZAG moves as it is
 necessary.
 The criterion of crossing an energy barrier is stated above in the "LMOD
 Procedure" background section.
 number_lmod_moves 
\begin_inset Formula $>$
\end_inset

 0 means that multiple barriers may be crossed and LMOD can carry the molecule
 to a large distance on the potential energy surface without severely distorting
 the geometry.
 Default is 0, LMOD will determine automatically where to stop the ZIG-ZAG
 sequence.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
random_seed
\begin_inset Index idx
status open

\begin_layout Plain Layout
random
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

seed
\end_layout

\end_inset

 The seed of the random number generator.
 Default is 314159.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
restart_pool_size
\begin_inset Index idx
status open

\begin_layout Plain Layout
restart
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

pool
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

size
\end_layout

\end_inset

 The size of the pool of lowest-energy structures to be used for restarting.
 Default is 3.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
rtemperature
\begin_inset Index idx
status open

\begin_layout Plain Layout
rtemperature
\end_layout

\end_inset

 The value of RT in Amber energy units.
 This is utilized in the Metropolis criterion.
 Default is 1.5.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
total_low_modes
\begin_inset Index idx
status open

\begin_layout Plain Layout
total
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

low
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

modes
\end_layout

\end_inset

 The total number of low frequency vibrational modes to be used.
 Default is the minimum of 10 and three times the number of atoms minus
 the number of rotational and translational degrees of freedom (number_free_rotr
ans_modes).
\end_layout

\begin_layout Standard
The following commands are part of the &lmod namelist.
 These commands control the way LMOD applies explicit translations and rotations
 to one or more ligands and take effect only if number_ligands 
\begin_inset Formula $>$
\end_inset

= 1.
 All commands are lists in square brackets, separated by commas such as
 [1, 33, 198], however, the list is read by Sander as a string and, therefore,
 it should be enclosed in single quotes.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ligstart_list,
\begin_inset space ~
\end_inset

ligend_list
\begin_inset Index idx
status open

\begin_layout Plain Layout
ligstart
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

list
\end_layout

\end_inset

 The serial number(s) of the first/last atom(s) of the ligand(s).
 Type integer.
 The number(s) should correspond to the numbering in the Amber input files
 prmtop and inpcrd/restart.
 For example, if there is only one ligand and it starts at atom 193, the
 command should be ligstart_list = '[193]'.
 If there are three ligands, the command should be, e.g., '[193, 244, 1435]'.
 The same format holds for all of the following commands.
 Note that the ligand(s) can be anywhere in the atom list, however, a single
 ligand must have continuous numbering between the corresponding ligstart_list
 and ligend_list values.
 For example, ligstar_list = '[193, 244, 1435]' and ligend_list = '[217,
 302, 1473]'.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ligcent_list
\begin_inset Index idx
status open

\begin_layout Plain Layout
ligcent
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

list
\end_layout

\end_inset

 The serial number(s) of the atom(s) of the ligand(s), which serves as the
 center of rotation.
 Type integer.
 The value zero means that the center of rotation will be the geometric
 center of gravity of the ligand.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
rotmin_list,
\begin_inset space ~
\end_inset

rotmax_list
\begin_inset Index idx
status open

\begin_layout Plain Layout
rotmin
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

list
\end_layout

\end_inset

 The range of random rotation of a particular ligand about the origin defined
 by the corresponding ligcent_list value is specified by the commands rotmin_lis
t and rotmax_list.
 The angle is given in +/- degrees.
 Type float.
 For example, in case of a single ligand and ligcent_list = '[0]', rotmin_list
 = '[30.0]' and rotmax_list = '[180.0]' means that random rotations by an
 angle +/- 30-180 degrees about the center of gravity of the ligand, will
 be applied.
 Similarly, with number_ligands = 2, ligcent_list= 120.0]' means that the
 first ligand will be rotated like in the single ligand example in this
 paragraph, but a second ligand will be rotated about its atom number 201,
 by an angle +/- 60-120 degrees.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
trmin_list,
\begin_inset space ~
\end_inset

trmax_list
\begin_inset Index idx
status open

\begin_layout Plain Layout
trmin
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

list
\end_layout

\end_inset

 The range of random translation(s) of ligand(s) is defined by the same
 way as rotation.
 For example, with number_ligand = 1, trmin_list = '[0.1]' and trmax_list
 = '[1.0]' means that a single ligand is translated in a random direction
 by a random distance between 0.1 and 1.0 Angstroms.
\end_layout

\begin_layout Chapter
Free energies
\end_layout

\begin_layout Section

\series bold
Thermodynamic integration
\series default
\lang english

\begin_inset CommandInset label
LatexCommand label
name "sec:TI"

\end_inset


\end_layout

\begin_layout Standard
In a free energy calculation, the system evolves according to a mixed potential
 (such as in Eqs.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:linearmix"

\end_inset

 or 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:klambdamix"

\end_inset

, below).
 The essence of free energy calculations is to record and analyze the fluctuatio
ns in the values of 
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

 (that is, what the energies 
\shape italic
would have been
\shape default
 with the endpoint potentials) as the simulation progresses.
 For thermodynamic integration (which is a very straightforward form of
 analysis) the required averages can be computed "on-the-fly" (as the simulation
 progresses), and printed at the end of a run.
 For more complex analyses (such as the Bennett acceptance ratio scheme),
 one needs to write the history of the values of 
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

 to a file, and later post-process this file to obtain the final free energy
 estimates.
\end_layout

\begin_layout Standard
There is not room here to discuss the theory of free energy simulations,
 and there are many excellent discussions elsewhere.
\begin_inset CommandInset citation
LatexCommand cite
key "Kollman93,Simonson01,Frenkel02"
literal "true"

\end_inset

 There are also plenty of recent examples to consult.
\begin_inset CommandInset citation
LatexCommand cite
key "Steinbrecher06,Steinbrecher08"
literal "true"

\end_inset

 Such calculations are demanding, both in terms of computer time, and in
 a level of sophistication to avoid pitfalls that can lead to poor convergence.
 Since there is no one "best way" to estimate free energies, 
\shape italic
sander
\shape default
 and 
\shape italic
pmemd
\shape default
 primarily provide the tools to collect the statistics that are needed.
 Assembling these into a final answer, and assessing the accuracy and significan
ce of the results, generally requires some calculations outside of what
 Amber provides, 
\shape italic
per se
\shape default
.
 The discussion here will assume a certain level of familiarity with the
 basis of free energy calculations.
\end_layout

\begin_layout Standard
Both 
\shape italic
sander
\shape default
 and 
\shape italic
pmemd
\shape default
 have the capability of doing simple thermodynamic free energy calculations,
 using either PME or generalized Born potentials.
 When 
\shape italic
icfe
\shape default
 is set to 1, information useful for doing thermodynamic integration estimates
 of free energy changes will be computed.
 The implementation is different between 
\shape italic
sander
\shape default
 and 
\shape italic
pmemd
\shape default
.
 For 
\shape italic
sander
\shape default
, you must use the 
\emph on
multisander
\emph default
 capability to create two groups, one corresponding to the starting state,
 and a second corresponding to the ending state (see 
\begin_inset CommandInset ref
LatexCommand formatted
reference "sec:multisander"

\end_inset

 for information); you will need a 
\shape italic
prmtop
\shape default
 file for each of these two endpoints.
 For 
\shape italic
pmemd
\shape default
, you use a single 
\shape italic
prmtop
\shape default
 file which contains both the starting and ending states.
 For both 
\shape italic
sander
\shape default
 and 
\shape italic
pmemd
\shape default
 a mixing parameter 
\begin_inset Formula $\lambda$
\end_inset

 is used to interpolate between the "unperturbed" and "perturbed" potential
 functions.
\end_layout

\begin_layout Subsection

\series bold
Thermodynamic integration using Sander
\end_layout

\begin_layout Standard
There are now two different ways to prepare a thermodynamic integration
 free energy calculation in Sander.
 The first is unchanged from previous versions of Amber: Here, the two prmtop
 files that you create must have the same number of atoms, and the atoms
 must appear 
\shape italic
in the same order
\shape default
 in the two files.
 This is because there is only one set of coordinates that are propagated
 in the molecular dynamics algorithm.
 If there are more atoms in the initial state than in the final, "dummy"
 atoms must be introduced into the final state to make up the difference.
 Although there is quite a bit of flexibility in choosing the initial and
 final states, it is important in general that the system be able to morph
 "smoothly" from the initial to the final state.
 Alternatively, you can set up your system to use the softcore potential
 algorithm described below.
 This will remove the requirement to prepare "dummy" atoms and allows the
 two 
\shape italic
prmtop
\shape default
 files to have different numbers of atoms.
\end_layout

\begin_layout Standard
The basics of the 
\emph on
multisander
\emph default
 functionality are given in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:multisander"

\end_inset

, but the mechanics are really quite simple.
 You start a free energy calculation as follows:
\end_layout

\begin_layout LyX-Code
mpirun -np 4 sander.MPI -ng 2 -groupfile 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset


\end_layout

\begin_layout Standard
Since there are 4 total cpu's in this example, each of the two groups will
 run in parallel with 2 cpu's each.
 The number of processors must be a multiple of two.
 The 
\shape italic
groups
\shape default
 file might look like this:
\end_layout

\begin_layout LyX-Code
-O -i mdin -p prmtop.0 -c eq1.x -o md1.o -r md1.x -inf mdinfo
\end_layout

\begin_layout LyX-Code
-O -i mdin -p prmtop.1 -c eq1.x -o md1b.o -r md1b.x -inf mdinfob
\end_layout

\begin_layout Standard
The input (
\shape italic
mdin
\shape default
) and starting coordinate files must be the same for the two groups.
 Furthermore, the two 
\shape italic
prmtop
\shape default
 files must have the same number number of atoms, in the same order (since
 one common set of coordinates will be used for both.) The simulation will
 use the masses found in the first 
\shape italic
prmtop
\shape default
 file; in classical statistical mechanics, the Boltzmann distribution in
 coordinates is independent of the masses so this should not represent any
 real restriction.
\end_layout

\begin_layout Standard
On output, the two restart files should be identical, and the two output
 files should differ only in trivial ways such as timings; there should
 be no differences in any energy-related quantities, except if energy decomposit
ion is turned on (
\emph on
idecomp
\emph default
 > 0); then only the output file of the first group contains the per residue
 contributions to 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

.
 For our example, this means that one could delete the 
\shape italic
md1b.o
\shape default
 and 
\shape italic
md1b.x
\shape default
 files, since the information they contain is also in 
\shape italic
md1.o
\shape default
 and 
\shape italic
md1.x
\shape default
.
 (It is a good practice, however, to check these file identities, to make
 sure that nothing has gone wrong.)
\end_layout

\begin_layout Subsection

\series bold
Basic inputs for thermodynamic integration
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
icfe
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
icfe
\end_layout

\end_inset

 The basic flag for free energy calculations.
 The default value of 0 skips such calculations.
 Setting this flag to 1 turns them on, using the mixing rules in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:linearmix"

\end_inset

, below.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
clambda
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
clambda
\end_layout

\end_inset

 The value of 
\begin_inset Formula $\lambda$
\end_inset

 for this run, as in Eqs.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:linearmix"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:klambdamix"

\end_inset

, below.
 Zero corresponds to the unperturbed Hamiltonian 
\begin_inset Formula $V_{0}$
\end_inset

.
 
\begin_inset Formula $\lambda$
\end_inset

=1 corresponds to the perturbed Hamiltonian 
\begin_inset Formula $V_{1}$
\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
klambda
\begin_inset Index idx
status open

\begin_layout Plain Layout
klambda
\end_layout

\end_inset

 The exponent in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:klambdamix"

\end_inset

, below.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tishake
\begin_inset Index idx
status open

\begin_layout Plain Layout
tishake
\end_layout

\end_inset

 Flag that determines how SHAKE is handled:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 Coordinates are synchronized after SHAKE, no constraints removed (default).
 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 SHAKE is removed between bonds containing one common and one unique atom.
 This was the default in previous versions of 
\shape italic
sander.

\shape default
 Note that disabling SHAKE requires the use of a 1 fs timestep.
 
\end_layout

\end_deeper
\begin_layout Subsubsection
Input flags specific to Sander
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
idecomp
\begin_inset Index idx
status open

\begin_layout Plain Layout
idecomp
\end_layout

\end_inset

 Flag that turns on/off decomposition of 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 on a per-residue level.
 The default value of 0 turns off energy decomposition.
 A value of 1 turns the decomposition on, and 1-4 nonbonded energies are
 added to internal energies (bond, angle, torsional).
 A value of 2 turns the decomposition on, and 1-4 nonbonded energies are
 added to EEL and VDW energies, respectively.
 The frequency by which values of 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 are included into the decomposition is determined by the NTPR flag.
 This ensures that the sum of all contributions equals the average of all
 total 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 values output every NTPR steps.
 All residues, including solvent molecules, have to be chosen by the RRES
 card to be considered for decomposition.
 The RES card determines which residue information is finally output.
 The output comes at the end of the 
\emph on
mdout
\emph default
 file.
 For each residue contributions of internal -, VdW-, and electrostatic energies
 to 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 are given as an average over all (NSTLIM/NTPR) steps.
 In a first section total per residue values are output followed below by
 further decomposed values from backbone and sidechain atoms.
\end_layout

\begin_layout Subsection

\series bold
Background theory of thermodynamic integration
\end_layout

\begin_layout Standard
The 
\emph on
sander and pmemd
\emph default
 programs do not compute free energies; it is up to the user to combine
 the output of several runs (at different values of 
\begin_inset Formula $\lambda$
\end_inset

) and to numerically estimate the integral:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\Delta A=A(\lambda=1)-A(\lambda=0)=\int_{0}^{1}\left\langle \partial V/\partial\lambda\right\rangle _{\lambda}d\lambda\label{eq:ti}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
If you understand how free energies work, this should not be at all difficult.
 However, since the actual values of 
\begin_inset Formula $\lambda$
\end_inset

that are needed, and the exact method of numerical integration, depend upon
 the problem and upon the precision desired, we have not tried to pre-code
 these into the program.
\end_layout

\begin_layout Standard
The simplest numerical integration is to evaluate the integrand at the midpoint:
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\Delta A\simeq\left\langle \partial V/\partial\lambda\right\rangle _{1/2}
\]

\end_inset


\end_layout

\begin_layout Standard
This might be a good first thing to do to get some picture of what is going
 on, but is only expected to be accurate for very smooth or small changes,
 such as changing just the charges on some atoms.
 Gaussian quadrature formulas of higher order are generally more useful:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\Delta A=\sum_{i}w_{i}\left\langle \partial V/\partial\lambda\right\rangle _{i}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Some weights and quadrature points are given in the accompanying table;
 other formulas are possible,
\begin_inset CommandInset citation
LatexCommand cite
key "Hummer96"
literal "true"

\end_inset

 but the Gaussian ones listed there are probably the most useful.
 The formulas are always symmetrical about 
\begin_inset Formula $\lambda$
\end_inset

= 0.5, so that 
\begin_inset Formula $\lambda$
\end_inset

 and 
\begin_inset Formula $(1-\lambda)$
\end_inset

 both have the same weight.
 For example, if you wanted to use 5-point quadrature, you would need to
 run five jobs, setting 
\begin_inset Formula $\lambda$
\end_inset

to 0.04691, 0.23076, 0.5, 0.76923, and 0.95308 in turn.
 (Each value of 
\begin_inset Formula $\lambda$
\end_inset

 should have an equilibration period as well as a sampling period; this
 can be achieved by setting the 
\shape italic
ntave
\shape default
 parameter.) You would then multiply the values of 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle _{i}$
\end_inset

 by the weights listed in the Table, and compute the sum.
\end_layout

\begin_layout Standard
When 
\shape italic
icfe=1
\shape default
 and 
\shape italic
klambda
\shape default
 has its default value of 1, the simulation uses the mixed potential function:
 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
V(\lambda)=(1-\lambda)V_{0}+\lambda V_{1}\label{eq:linearmix}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $V_{0}$
\end_inset

 is the potential with the original Hamiltonian, and 
\begin_inset Formula $V_{1}$
\end_inset

 is the potential with the perturbed Hamiltonian.
 The program also computes and prints 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 and its averages; note that in this case, 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle =V_{1}-V_{0}$
\end_inset

.
 This is referred to as linear mixing, and is often what you want unless
 you are making atoms appear or disappear.
 If some of the perturbed atoms are "dummy" atoms (with no van der Waals
 terms, so that you are making these atoms "disappear" in the perturbed
 state), the integrand in Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ti"

\end_inset

 diverges at 
\begin_inset Formula $\lambda$
\end_inset

= 1; this is a mild enough divergence that the overall integral remains
 finite, but it still requires special numerical integration techniques
 to obtain a good estimate of the integral.
\begin_inset CommandInset citation
LatexCommand cite
key "Simonson01"
literal "true"

\end_inset

 
\shape italic
Sander and pmemd
\shape default
 implement one simple way of handling this problem: if you set 
\shape italic
klambda
\shape default
 
\begin_inset Formula $>$
\end_inset

 1, the mixing rules are
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
V(\lambda)=(1-\lambda)^{k}V_{0}+[1-(1-\lambda)^{k}]V_{1}\label{eq:klambdamix}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $k$
\end_inset

 is given by 
\shape italic
klambda
\shape default
.
 Note that this reduces to Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:linearmix"

\end_inset

 when 
\begin_inset Formula $k$
\end_inset

 = 1, which is the default.
 If 
\begin_inset Formula $k\geq$
\end_inset

4, the integrand remains finite as 
\begin_inset Formula $\lambda\rightarrow1$
\end_inset

.
\begin_inset CommandInset citation
LatexCommand cite
key "Simonson01"
literal "true"

\end_inset

 We have found that setting 
\begin_inset Formula $k$
\end_inset

= 6 with disappearing groups as large as tryptophan works, but using the
 softcore option (
\shape italic
ifsc
\shape default

\begin_inset Formula $>$
\end_inset

0) instead is generally preferred.
\begin_inset CommandInset citation
LatexCommand cite
key "Steinbrecher07"
literal "true"

\end_inset

 Note that the behavior of 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 as a function of 
\begin_inset Formula $\lambda$
\end_inset

 is not monotonic when 
\shape italic
klambda
\shape default
 
\begin_inset Formula $>$
\end_inset

 1.
 You may need a fairly fine quadrature to get converged results for the
 integral, and you may want to sample more carefully in regions where 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 is changing rapidly.
\end_layout

\begin_layout Standard

\shape italic
Notes:
\end_layout

\begin_layout Enumerate
This is implemented in 
\shape italic
sander
\shape default
 by calling the force() routine independently for each 
\emph on
multisander
\emph default
 group and then combining the forces on each step.
 For a fixed number of processors this increases the cost of the calculation
 compared with the 
\shape italic
pmemd
\shape default
 code, which only calculates the differences between 
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

.
\end_layout

\begin_layout Enumerate
It is rather easy to make mistakes when running TI calculations.
 It is generally good to carry out a short run (say 50 steps) setting ntpr=1.
 Then check the following; if either test fails, be sure to fix the problem
 before proceeding.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
The restart files from 
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

 should be identical for 
\shape italic
sander
\shape default
 (for 
\shape italic
pmemd
\shape default
 there will only be a single restart file).
\end_layout

\begin_layout Enumerate
If you diff the output files for 
\shape italic
sander
\shape default
, there should only be simple differences (for 
\shape italic
pmemd
\shape default
 there will only be a single combined output file).
 All energies, temperatures, pressures, etc.
 should be the same in the two files.
 Simulations with 
\shape italic
sander
\shape default
 using the QM/MM facility may show differences in the SCF energies, but
 be sure that the total energies, and all the MM components, are the same.
\end_layout

\end_deeper
\begin_layout Enumerate
Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:klambdamix"

\end_inset

 is designed for having dummy atoms in the perturbed Hamiltonian, and "real"
 atoms in the regular Hamiltonian.
 You must ensure that this is the case when you set up the system in LEaP.
 (See the softcore section, below, for a more general way to handle disappearing
 atoms, which does not require dummy atoms at all.)
\end_layout

\begin_layout Enumerate
One common application of this model is to pKa calculations, where the charges
 are mutated from the protonated to the deprotonated form.
 Since H atoms bonded to oxygen already have zero van der Waals radii (in
 the Amber force fields and in TIP3P water), once their charge is removed
 (in the deprotonated form) they are really then like dummy atoms.
 For this special situation, there is no need to use 
\shape italic
klambda
\shape default
 
\begin_inset Formula $>$
\end_inset

 1: since the van der Waals terms are missing from both the perturbed and
 unperturbed states, the proton's position can never lead to the large contribut
ions to 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

 that can occur when one is changing from a zero van der Waals term to a
 finite one.
\end_layout

\begin_layout Enumerate
The implementation requires that the masses of all atoms be the same on
 all threads.
 To enforce this, the masses found for 
\begin_inset Formula $V_{0}$
\end_inset

 are used for 
\begin_inset Formula $V_{1}$
\end_inset

 as well.
 In classical statistical mechanics, the canonical distribution of configuration
s (and hence of potential energies) is unaffected by changes in the masses,
 so this should not pose a limitation.
 Since the masses for 
\begin_inset Formula $V_{1}$
\end_inset

 are ignored, they do not have to match those found for 
\begin_inset Formula $V_{0}$
\end_inset

.
\end_layout

\begin_layout Enumerate
Special care needs to be taken when using SHAKE for atoms whose force field
 parameters differ in the two end points.
 The same bonds must be SHAKEN in both cases, and the equilibrium bond lengths
 must also be the same.
 By default, the coordinates from 
\begin_inset Formula $V_{0}$
\end_inset

 are synchronized with those from 
\begin_inset Formula $V_{1}$
\end_inset

 after SHAKE.
 This will work for small perturbations, but if there is a significant change
 in bond length, it may be necessary to use the 
\shape italic
noshakemask
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout

\shape italic
\emph on
noshakemask
\end_layout

\end_inset


\shape default
 input to remove SHAKE from the regions that are being perturbed.
 If this is done, be sure to set 
\shape italic
tishake
\begin_inset Index idx
status open

\begin_layout Plain Layout

\shape italic
\emph on
tishake
\end_layout

\end_inset


\shape default
=1 and to use a 1 fs timestep.
 Special care needs to be taken when water molecules are part of the region
 that is changing.
 You need to make sure that the 
\begin_inset Quotes eld
\end_inset

number of 3-point waters
\begin_inset Quotes erd
\end_inset

 is the same in both 
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

.
 This may require setting 
\emph on
jfastw
\emph default
 and/or building the structure so that 
\emph on
sander or pmemd
\emph default
 do not think that the water molecules involved are actually rigid waters.
 Also, just setting 
\emph on
noshakemask
\emph default
 might not be enough, since this flag does not affect the 
\emph on
settle
\emph default
 routine that handles rigid waters.
\end_layout

\begin_layout Standard
\begin_inset Float table
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="23" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $n$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\lambda_{i}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1-\lambda_{i}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $w_{i}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.21132
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.78867
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.5
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.1127
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.88729
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.27777
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0.44444
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.04691
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.95308
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.11846
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.23076
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.76923
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.23931
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.28444
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
7
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.02544
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.97455
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.06474
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.12923
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.87076
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.13985
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.29707
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.70292
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.19091
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.20897
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
9
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.01592
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.98408
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.04064
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.08198
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.91802
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.09032
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.19331
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.80669
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.13031
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.33787
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.66213
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.15617
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.5
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.16512
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
12
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.00922
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.99078
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.02359
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.04794
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.95206
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.05347
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.11505
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.88495
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.08004
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.20634
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.79366
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.10158
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.31608
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.68392
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.11675
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.43738
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.56262
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\noun off
\color none
0.12457
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Abscissas and weights for Gaussian integration.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection

\series bold
Softcore Potentials in Thermodynamic Integration
\end_layout

\begin_layout Standard
Softcore potentials provide an additional way to perform thermodynamic integrati
on calculations in Amber.
 The system setup has been simplified so that appearing and disappearing
 atoms can be present at the same time and no dummy atoms need to be introduced.
 For 
\shape italic
sander
\shape default
, two prmtop files, corresponding to the start and end states (
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

) of the desired transformation need to be used.
 The common atoms that are present in both states need to appear in the
 same order in both prmtop files and must have identical starting positions.
 In addition to the common atoms, each process can have any number of unique
 soft core atoms, as specified by scmask.
 For 
\shape italic
pmemd
\shape default
, a single prmtop file is used, containing the unique atoms for both the
 start and end states.
 The soft core atoms are specified by scmask1 and scmask2 for 
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

 respectively.
\end_layout

\begin_layout Standard
A modified version of the vdW equation is used to smoothly switch off non-bonded
 interactions of these atoms with their common atom neighbors:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
V_{V_{0,}disappearing}=4\epsilon(1-\lambda)\left[\frac{1}{\left[\alpha\lambda+\left(\frac{r_{ij}}{\sigma}\right)^{6}\right]^{2}}-\frac{1}{\alpha\lambda+(\frac{r_{ij}}{\sigma})^{6}}\right]\label{eq:softcoreV0}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
V_{V_{1},appearing}=4\epsilon\lambda\left[\frac{1}{\left[\alpha(1-\lambda)+\left(\frac{r_{ij}}{\sigma}\right)^{6}\right]^{2}}-\frac{1}{\alpha(1-\lambda)+(\frac{r_{ij}}{\sigma})^{6}}\right]\label{eq:softcoreV1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
Please refer to Ref 
\begin_inset CommandInset citation
LatexCommand cite
key "Steinbrecher07"
literal "true"

\end_inset

 for a description of the implementation and performance testing when compared
 to the TI methods described above using 
\shape italic
sander
\shape default
.
 For similar information pertaining to pmemd please see Ref 
\begin_inset CommandInset citation
LatexCommand citep
key "Kaus13"
literal "true"

\end_inset

.
 Note that the term 
\begin_inset Quotes eld
\end_inset

disappearing
\begin_inset Quotes erd
\end_inset

 is used here, but it would probably be better to say that atoms present
 in 
\begin_inset Formula $V_{0}$
\end_inset

 but not in 
\begin_inset Formula $V_{1}$
\end_inset

 are 
\begin_inset Quotes eld
\end_inset

decoupled
\begin_inset Quotes erd
\end_inset

 from their environment: the interactions among the 
\begin_inset Quotes eld
\end_inset

disappearing
\begin_inset Quotes erd
\end_inset

 atoms are not changed, and do not contribute to 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

.
 If the disappearing atoms are a separate molecule (say a non-covalently-bound
 ligand), this can be viewed as a transfer to the gas-phase.
\end_layout

\begin_layout Standard
Note that a slightly different setup is required for using soft core potentials
 compared to older TI-implementations.
 Specifically, the difference is that to add or remove atoms without soft
 core potentials, they are transformed into interactionless dummy particles,
 so both end state prmtop files have the same number of atoms.
 When using soft core potentials instead, no dummy atoms are needed and
 the end states should be built without them.
 Therefore prmtop files for non soft core simulations may have to be adapted
 to be used with soft core potentials and vice versa.
\end_layout

\begin_layout Standard
All bonded interactions of the unique atoms are recorded separately in the
 output file (see below).
 Any bond, angle, dihedral or 1-4 term that involves at least one appearing
 or disappearing atom is not scaled by 
\begin_inset Formula $\lambda$
\end_inset

 and does not contribute to 
\begin_inset Formula $\left\langle \partial V/\partial\lambda\right\rangle $
\end_inset

.
 Therefore, output from both processes will not be identical when soft core
 potentials are used.
 Softcore transformations avoid the origin singularity effect and therefore
 linear mixing can (and should) always be used with them.
 Since the unique atoms become decoupled from their surroundings at high
 or low lambdas and energy exchange between them and surrounding solvent
 becomes inefficient, a Berendsen type thermostat should not be used for
 SC calculations.
 Unlike in previous versions, SHAKE constraints are not automatically removed
 from bonds between common and unique atoms.
 Instead, the coordinates corresponding to common atoms in 
\begin_inset Formula $V_{0}$
\end_inset

are synchronized with those of 
\begin_inset Formula $V_{1}$
\end_inset

.
 The original behavior can be restored using 
\shape italic
tishake
\begin_inset Index idx
status open

\begin_layout Plain Layout

\shape italic
\emph on
tishake
\end_layout

\end_inset


\shape default
.
 The icfe and klambda parameters should be set to 1 for a soft core run
 and the desired lambda value will be specified by clambda.
 When using softcore potentials with 
\shape italic
sander
\shape default
, 
\begin_inset Formula $\lambda$
\end_inset

 values should be picked so that 0.01 < clambda < 0.99.
 The 
\shape italic
pmemd
\shape default
 implementation allows lambda to be set to any value between 0.0 and 1.0,
 thus simulations at the endpoints are possible.
 
\end_layout

\begin_layout Standard
Additionally, the following parameters are available to control the TI calculati
on: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ifsc
\begin_inset Index idx
status open

\begin_layout Plain Layout
ifsc
\end_layout

\end_inset

 Flag for soft core potentials 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 SC potentials are not used (default) 
\end_layout

\begin_layout Description
=
\begin_inset space ~
\end_inset

1 SC potentials are used.
 Be sure to use prmtop files that are suitable for this, i.e.
 not-containing dummy atoms (see above)
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
scalpha
\begin_inset Index idx
status open

\begin_layout Plain Layout
alpha
\end_layout

\end_inset

 The 
\begin_inset Formula $\alpha$
\end_inset

 parameter in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:softcoreV0"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:softcoreV1"

\end_inset

, its default value is 0.5.
 Other values have not been extensively tested 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
logdvdl
\begin_inset Index idx
status open

\begin_layout Plain Layout
logdvdl
\end_layout

\end_inset

 If set to .ne.
 0, a summary of all 
\begin_inset Formula $\partial V/\partial\lambda$
\end_inset

 values calculated during every step of the run will be printed out at the
 end of the simulation for postprocessing.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dvdl_norest
\begin_inset Index idx
status open

\begin_layout Plain Layout
dvdl
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

norest
\end_layout

\end_inset

 This option is now deprecated.
 Restraints involving soft core atoms are now decoupled from the rest of
 the system.
 The energy is listed separately and does not contribute to 
\begin_inset Formula $\partial V/\partial\lambda$
\end_inset

.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dynlmb
\begin_inset Index idx
status open

\begin_layout Plain Layout
dynlmb
\end_layout

\end_inset

 If set to a value .gt.
 zero, clambda is increased by dynlmb every ntave steps.
 This can be used to perform simulations with dynamically changing lambdas.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
crgmask
\begin_inset Index idx
status open

\begin_layout Plain Layout
crgmask
\end_layout

\end_inset

 Specifies a number of atoms (in ambmask format) that will have their atomic
 partial charges set to zero.
 This is mainly for convenience because it removes the need to build additional
 prmtop files with uncharged atoms for TI calculations involving the removal
 of partial charges.
\end_layout

\begin_layout Subsubsection
Input flags specific to Sander
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scmask
\begin_inset Index idx
status open

\begin_layout Plain Layout
scmask
\end_layout

\end_inset

 Specifies the unique (soft core) atoms for this process in ambmask format.
 This, along with crgmask, is the only parameter that will frequently be
 different in the two mdin files for 
\begin_inset Formula $V_{0}$
\end_inset

 and 
\begin_inset Formula $V_{1}$
\end_inset

.
 It is valid to set scmask to an empty string.
 A summary of the atoms in scmask is printed at the end of mdout.
 
\end_layout

\begin_layout Subsubsection
One step transformations using soft core electrostatics
\end_layout

\begin_layout Standard
Alternatively to the two-step process of removing charges from atoms first
 and then changing the vdW parameters of chargeless atoms in a second TI
 calculation, 
\emph on
sander and pmemd
\emph default
 also have a soft core version of the Coulomb equation implemented for single
 step transformations under periodic boundary conditions.
 This is automatically applied to all atoms in scmask and their interactions
 with common atoms are given by:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
V_{V_{0},disappearing}=(1-\lambda)\frac{q_{i}q_{j}}{4\pi\epsilon_{o}\sqrt{\beta\lambda+r_{ij}^{2}}}\label{eq:softcore_ee}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
for disappearing atoms.
 Replace 
\begin_inset Formula $\lambda$
\end_inset

 by 
\begin_inset Formula $(1-\lambda)$
\end_inset

 and vice versa for the form for appearing atoms.
 This introduces a new parameter 
\begin_inset Formula $\beta$
\end_inset

 which controls the 'softness' of the potential.
 This is set in the input file via:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
scbeta The parameter 
\begin_inset Formula $\beta$
\end_inset

 in 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:softcore_ee"

\end_inset

.
 Default value is 
\begin_inset Formula $12\textrm{A}^{2}$
\end_inset

, other values have not been extensively tested.
\end_layout

\begin_layout Standard
With the use of soft core vdW and electrostatics interactions, arbitrary
 changes between systems are possible in single TI calculations.
 However, due to the unusual potential function forms introduced, it is
 not always clear that a single-step calculation will converge faster than
 one broken down into several steps.
 Ref.
 
\begin_inset CommandInset citation
LatexCommand citep
key "Steinbrecher11"
literal "true"

\end_inset

 contains detailed information on the performance of such single step TI
 calculations.
\end_layout

\begin_layout Subsection
Collecting potential energy differences for FEP calculations
\end_layout

\begin_layout Standard
In addition to the Thermodynamic Integration capabilities described above,
 
\emph on
sander
\emph default
 can also collect potential energy values during free energy simulation
 runs for postprocessing by e.g.
 the Bennett acceptance ratio scheme.
 This will make sander calculate at given points during the simulation the
 total potential energy of the system as it would be for different 
\begin_inset Formula $\lambda$
\end_inset

-values at this conformation.
 This functionality is controlled by:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ifmbar
\begin_inset Index idx
status open

\begin_layout Plain Layout
ifmbar
\end_layout

\end_inset

 If set to 1 (Default = 0), additional output is generated for later postprocess
ing.
\end_layout

\begin_layout Standard
mbar_states 
\begin_inset Index idx
status open

\begin_layout Plain Layout
mbar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

states
\end_layout

\end_inset

 number of lambda windows considered.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mbar_lambda 
\begin_inset Index idx
status open

\begin_layout Plain Layout
mbar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

lambda
\end_layout

\end_inset

 lambda windows simulated.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
For example, if you want to run mbar with 15 lambda windows at 0.00, 0.05,
 0.10, 0.15, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.85, 0.90, 0.95, 1.00, you would
 use the following options:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

ifmbar = 1,
\end_layout

\begin_layout Plain Layout

mbar_states = 15,
\end_layout

\begin_layout Plain Layout

mbar_lambda = 0.00, 0.05, 0.10, 0.15, 0.20, 0.30, 0.40, 0.50, 0.60, 0.70, 0.80, 0.85,
 0.90, 0.95, 1.00,
\end_layout

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
The options below have been deprecated.
 They are here for anyone using AMBER 16 or older, but will not work in
 AMBER 18.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
bar_intervall
\begin_inset Index idx
status open

\begin_layout Plain Layout
bar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

intervall
\end_layout

\end_inset

 Compute potential energies every bar_intervall steps (Default = 100)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
bar_l_min
\begin_inset Index idx
status open

\begin_layout Plain Layout
bar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

l
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

min
\end_layout

\end_inset

 Minimum 
\begin_inset Formula $\lambda$
\end_inset

-value (Default = 0.1)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
bar_l_max
\begin_inset Index idx
status open

\begin_layout Plain Layout
bar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

l
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

max
\end_layout

\end_inset

 Maximum 
\begin_inset Formula $\lambda$
\end_inset

-value (Default = 0.9)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
bar_l_incr
\begin_inset Index idx
status open

\begin_layout Plain Layout
bar
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

l
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

incr
\end_layout

\end_inset

 The increment to increase 
\begin_inset Formula $\lambda$
\end_inset

 by between the minimum and maximum (Default = 0.1)
\end_layout

\begin_layout Standard
Such energy collection will normally be part of a regular free energy calculatio
n (using icfe=1 and ifsc=1) involving simulations at various 
\begin_inset Formula $\lambda$
\end_inset

-values.
 Activating this functionality will not have any influence on the simulation
 trajectory which will evolve according to the preset 
\emph on
clambda
\emph default
 value, it is merely a bookkeeping scheme that removes the necessity of
 postprocessing output files later.
\end_layout

\begin_layout Section
Linear Interaction Energies
\end_layout

\begin_layout Standard

\emph on
sander
\emph default
 contains rudimentary facilities to compute binding free energies using
 the linear interaction energy model.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ilrt if set to 1, turns on the computation of LIE contributions (default=0)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lrt_interval Computer LIE contributions every lrt_interval MD steps (default=50)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
lrtmask The 'solute'.
 Interaction Energies between the atoms in lrtmask and the remainder of
 the system are computed.
\end_layout

\begin_layout Standard
The LIE facilities work by computing the system energies several times using
 different charge and vdW-parameter sets.
 This results in reduced performance if lrt_interval is set to less than
 approx.
 10.
 The LIE output at the end of the 
\emph on
mdout
\emph default
 file gives the electrostatic interaction energy between the solute and
 rest of the system 
\emph on
times 0.5
\emph default
, i.e.
 in accordance with the original formulation of LIE theory.
 The solute SASA and vdW-interaction energy with its surroundings is calculated
 unscaled.
\end_layout

\begin_layout Section
Adaptively Biased MD, Steered MD, Umbrella Sampling with REMD and String
 Method
\end_layout

\begin_layout Subsection
Overview
\end_layout

\begin_layout Standard
The following describes a suite of modules useful for the calculation of
 the free energy associated with a reaction coordinate 
\begin_inset Formula $\sigma(\mathbf{r}_{1},\dots,\mathbf{r}_{N})$
\end_inset

 (which is defined as a smooth function of the atomic positions 
\begin_inset Formula $\mathbf{r}_{1},\dots,\mathbf{r}_{N}$
\end_inset

): 
\begin_inset Formula 
\[
f(\xi)=-k_{B}T\ln\big<\delta\left[\xi-\sigma(\mathbf{r}_{1},\dots,\mathbf{r}_{N})\right]\big>,\;
\]

\end_inset

 (the angular brackets denote an ensemble average, 
\begin_inset Formula $k_{B}$
\end_inset

 is the Boltzmann constant and 
\begin_inset Formula $T$
\end_inset

 is the temperature) that is also frequently referred to as the 
\shape italic
potential of mean force
\shape default
.
\end_layout

\begin_layout Standard
Specifically, new frameworks are provided for equilibrium umbrella sampling
 and steered molecular dynamics that enhance the functionality delivered
 by earlier implementations (described earlier in this manual), along with
 a new 
\family typewriter
A
\family default
daptively 
\family typewriter
B
\family default
iased 
\family typewriter
M
\family default
olecular 
\family typewriter
D
\family default
ynamics (
\family typewriter
ABMD
\family default
) method 
\begin_inset CommandInset citation
LatexCommand cite
key "Babin2008"
literal "true"

\end_inset

 that belongs to the general category of umbrella sampling methods with
 a time-dependent potential.
 Such methods were first introduced by Huber, Torda and van Gunsteren (the
 Local Elevation Method
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "Huber_T_94"
literal "true"

\end_inset

) in the molecular dynamics (
\family typewriter
MD
\family default
) context, and by Wang and Landau in the context of Monte Carlo simulations
 
\begin_inset CommandInset citation
LatexCommand cite
key "Wang_F_01"
literal "true"

\end_inset

.
 More recent approaches include the metadynamics method 
\begin_inset CommandInset citation
LatexCommand cite
key "Laio_A_02,Iannuzzi_M_03"
literal "true"

\end_inset

.
 All these methods estimate the free energy of a reaction coordinate from
 an evolving ensemble of realizations, and use that estimate to bias the
 system dynamics to flatten an effective free energy surface.
 Collectively, these methods may all be considered to be umbrella sampling
 methods with an evolving potential.
 The algorithms discussed here were developed by the group of Prof.
 Celeste Sagui (sagui@ncsu.edu) and Prof.
 Christopher Roland (cmroland@ncsu.edu); the current version was implemented
 by Dr.
 Volodymyr Babin.
\end_layout

\begin_layout Standard
The 
\family typewriter
ABMD
\family default
 method grew out of attempts to speed up and streamline the metadynamics
 method for free energy calculations with a 
\shape italic
controllable
\shape default
 accuracy.
 It is characterized by a favorable scaling in time, and only a few (two)
 control parameters.
 It is formulated in terms of the following equations: 
\begin_inset Formula 
\[
m_{a}\frac{\mathrm{d}^{2}\mathbf{r}_{a}}{\mathrm{d}t^{2}}=\mathbf{F}_{a}+\frac{\partial}{\partial\mathbf{r}_{a}}U\big[t|\sigma\left(\mathbf{r}_{1},\dots,\mathbf{r}_{N}\right)\big],
\]

\end_inset

 
\begin_inset Formula 
\[
\frac{\partial U(t|\xi)}{\partial t}=\frac{k_{B}T}{\tau_{F}}G\big[\xi-\sigma\left(\mathbf{r}_{1},\dots,\mathbf{r}_{N}\right)\big],
\]

\end_inset

 where the first equation represents Newton's law that governs ordinary
 
\family typewriter
MD
\family default
 (temperature and pressure regulation terms are not shown) augmented with
 an additional force coming from the time dependent biasing potential 
\begin_inset Formula $U(t|\xi)$
\end_inset

 [
\begin_inset Formula $U(t=0|\xi)=0$
\end_inset

], whose time evolution is given by the second equation.
 
\begin_inset Formula $G(\xi)$
\end_inset

 is a positive definite and symmetric kernel, which may be thought of as
 a smoothed Dirac delta function.
 For large enough 
\begin_inset Formula $\tau_{F}$
\end_inset

 (the flooding timescale) and small kernel width, the biasing potential
 
\begin_inset Formula $U(t|\xi)$
\end_inset

 converges towards 
\begin_inset Formula $-f(\xi)$
\end_inset

 as 
\begin_inset Formula $t\to\infty$
\end_inset

.
\end_layout

\begin_layout Standard
Our numerical implementation of the 
\family typewriter
ABMD
\family default
 method involves the use of a bi-weight kernel along with the use of cubic
 B-splines (or products thereof) to discretize the biasing potential 
\begin_inset Formula $U(t|\xi)$
\end_inset

 w.r.t.
 
\begin_inset Formula $\xi$
\end_inset

, and an Euler-like scheme for time integration.
 
\family typewriter
ABMD
\family default
 admits two important extensions, which lead to a more uniform flattening
 of 
\begin_inset Formula $U(t|\xi)+f(\xi)$
\end_inset

 due to an improved sampling of the 
\begin_inset Quotes eld
\end_inset

evolving
\begin_inset Quotes erd
\end_inset

 canonical distribution.
 The first extension is identical in spirit to the 
\shape italic
multiple walkers metadynamics
\shape default

\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "Lelievre_T_2007,Raiteri_P_2006"
literal "true"

\end_inset

.
 It amounts to carrying out several different 
\family typewriter
MD
\family default
 simulations biased by the same 
\begin_inset Formula $U(t|\xi)$
\end_inset

, which evolves via: 
\begin_inset Formula 
\[
\frac{\partial U(t|\xi)}{\partial t}=\frac{k_{B}T}{\tau_{F}}\sum\limits _{\alpha}G\big[\xi-\sigma\left(\mathbf{r}_{1}^{\alpha},\dots,\mathbf{r}_{N}^{\alpha}\right)\big]\;,
\]

\end_inset

 where 
\begin_inset Formula $\alpha$
\end_inset

 labels different 
\family typewriter
MD
\family default
 trajectories.
 A second extension is to gather several different 
\family typewriter
MD
\family default
 trajectories, each bearing its own biasing potential and, if desired, its
 own distinct collective variable, into a generalized ensemble for 
\begin_inset Quotes eld
\end_inset

replica exchange
\begin_inset Quotes erd
\end_inset

 with modified 
\begin_inset Quotes eld
\end_inset

exchange
\begin_inset Quotes erd
\end_inset

 rules 
\begin_inset CommandInset citation
LatexCommand cite
key "Sugita_Y_2000,Bussi2006,Piana2007"
literal "true"

\end_inset

.
 Both extensions are advantageous and lead to a more uniform flattening
 of 
\begin_inset Formula $U(t|\xi)+f(\xi)$
\end_inset

.
\end_layout

\begin_layout Standard
In order to assess and improve the accuracy of the free energies, the 
\family typewriter
ABMD
\family default
 accumulations may need to be followed up with equilibrium umbrella sampling
 runs, which make use of the biasing potential 
\begin_inset Formula $U(t|\xi)$
\end_inset

 as is.
 Such a procedure is very much in the spirit of adaptive umbrella sampling.
 With these runs, one calculates the biased probability density: 
\begin_inset Formula 
\[
p^{B}(\xi)=\big<\delta\left[\xi-\sigma(\mathbf{r}_{1},\dots,\mathbf{r}_{N})\right]\big>_{B}.
\]

\end_inset

 The idea here is that if, as a result of an 
\family typewriter
ABMD
\family default
 run, 
\begin_inset Formula $f(\xi)+U(t|\xi)=0$
\end_inset

 exactly, then the biased probability density 
\begin_inset Formula $p^{B}(\xi)$
\end_inset

 would be flat (constant).
 In practice, this is typically not the case, but one can use 
\begin_inset Formula $p^{B}(\xi)$
\end_inset

 to 
\begin_inset Quotes eld
\end_inset

correct
\begin_inset Quotes erd
\end_inset

 the free energy via: 
\begin_inset Formula 
\[
f(\xi)=-U(\xi)-k_{B}T\ln p^{B}(\xi).
\]

\end_inset


\end_layout

\begin_layout Standard
With the ABMD procedure, one can obtain accurate free energy curves and
 equilibrium properties.
 We note that to obtain ABMD free energies requires a (minor) amount of
 post-processing by means of the nfe-umbrella-slice utility freely available
 in AmberTools as described in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:Post-processing-of-biasing"

\end_inset

.
 This methodology has been applied to a variety of biomolecular systems,
 including small peptides 
\begin_inset CommandInset citation
LatexCommand citep
key "Babin_V_06c,Babin2008,Babin_V_09"
literal "true"

\end_inset

, sugar puckering 
\begin_inset CommandInset citation
LatexCommand citep
key "Babin_V_10"
literal "true"

\end_inset

, polyproline systems 
\begin_inset CommandInset citation
LatexCommand citep
key "Moradi_M_09,Moradi_M_10,Moradi_M_13c"
literal "true"

\end_inset

, guest-host systems 
\begin_inset CommandInset citation
LatexCommand citep
key "Moradi_M_11,Moradi_M_11c"
literal "true"

\end_inset

, polyglutamine systems 
\begin_inset CommandInset citation
LatexCommand citep
key "Babin_V_11,Moradi_M_12"
literal "true"

\end_inset

, and DNA systems 
\begin_inset CommandInset citation
LatexCommand citep
key "Moradi_M_13,Pan_F_17,Pan_F_18a,Pan_F_18b,Pan_F_20a"
literal "true"

\end_inset

.
 In addition, SMD simulations (discussed below) have been used to examine
 transition pathways and mechanisms, to estimate free energy differences
 
\begin_inset CommandInset citation
LatexCommand citep
key "Moradi_M_10,Moradi_M_10b"
literal "true"

\end_inset

, and to calculate transition rates 
\begin_inset CommandInset citation
LatexCommand citep
key "Moradi_M_11d,Moradi_M_14a,Moradi_M_14b"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
While the above represents the basic ABMD implementation, AMBER20 introduced
 three additional algorithms – the Well-Tempered (WT) ABMD, a selection
 mechanism for multiple walker ABMD and Driven ABMD (D-ABMD)
\begin_inset CommandInset citation
LatexCommand citep
key "Moradi_M_13d"
literal "true"

\end_inset

 – all of which enhance the stability and convergence of an ABMD simulation.
 Also implemented is the Swarms-of-Trajectories String Method (STSM) 
\begin_inset CommandInset citation
LatexCommand citep
key "Pan_A_08"
literal "true"

\end_inset

, which gives a way of exploring the Minimum Free Energy Path (MFEP) on
 free energy lansdscape.
 Current version of these codes were inplemented by Dr.
 Mahmoud Moradi (moradi@uark.edu), Dr.
 Feng Pan (fpan3@ncsu.edu) and Ashkan Fakharzadeh (afakhar@ncsu.edu).
\end_layout

\begin_layout Standard

\series bold
The Well-Tempered ABMD:
\series default
 An alternative to the follow-up equilibrium simulations for increased ABMD
 accuracy is provided by the WT-ABMD, which is implemented in the spirit
 of the WT-metadynamics 
\begin_inset CommandInset citation
LatexCommand cite
key "Barducci_A_08"
literal "true"

\end_inset

.
 In the original ABMD implementation, the history dependent biasing potential
 is built up at a fixed rate: 
\begin_inset Formula 
\begin{equation}
U(\xi,t)=U^{0}(\xi)+\int_{0}^{t}dt^{\prime}\,\omega\,G(\xi-\xi^{t^{\prime}}),\label{eq:abmd}
\end{equation}

\end_inset

in which 
\begin_inset Formula $U(\xi,t)$
\end_inset

 is the biasing potential at time 
\begin_inset Formula $t$
\end_inset

, 
\begin_inset Formula $U^{0}$
\end_inset

 is an arbitrary function that typically represents the initial guess for
 the biasing potential (in the absence of a guess, this is assumed to be
 flat) and 
\begin_inset Formula $\omega=k_{B}T/\tau_{F}$
\end_inset

 is a constant, unbiased rate.
 As the simulation proceeds and reaches convergence, then 
\begin_inset Formula $\big<U(\xi,t\rightarrow\infty)\big>_{a}\approx U^{s}(\xi)+u(t)$
\end_inset

, in which 
\begin_inset Formula $\big<.\big>_{a}$
\end_inset

 is the ensemble-average over the adaptive trajectories, the stationary
 term is 
\begin_inset Formula $U^{s}\approx-F(\xi)$
\end_inset

, and 
\begin_inset Formula $u(t)$
\end_inset

 is an additive time-dependent constant 
\begin_inset CommandInset citation
LatexCommand cite
key "Barducci_A_08"
literal "true"

\end_inset

.
 Unfortunately, updating the biasing potential at the same rate throughout
 the simulation may lead to a poorly converged result, since the biasing
 potential ends up fluctuating around 
\begin_inset Formula $-F(\xi)$
\end_inset

 with an amplitude that depends on 
\begin_inset Formula $\omega$
\end_inset

.
\end_layout

\begin_layout Standard
One way to resolve this problem is to update the kernel at a non-uniform
 rate by means of a "well-tempered" 
\begin_inset Formula $\omega$
\end_inset

: 
\begin_inset Formula 
\begin{equation}
U(\xi,t)=U^{0}(\xi)+\int_{0}^{t}dt^{\prime}\,\omega(\xi^{t^{\prime}},t^{\prime})\,G(\xi-\xi^{t^{\prime}}),\label{eq:wtabmd}
\end{equation}

\end_inset

in which 
\begin_inset Formula $\omega(\xi,t)$
\end_inset

 is a time-dependent, non-uniform rate chosen to be 
\begin_inset Formula $\omega_{0}\,\mathrm{e}^{-\beta^{\prime}U(\xi,t)}$
\end_inset

 (
\begin_inset Formula $1/\beta^{\prime}=k_{B}T^{\prime}$
\end_inset

 where 
\begin_inset Formula $T^{\prime}$
\end_inset

 is a pseudo-temperature) that reduces to a constant 
\begin_inset Formula $\omega_{0}$
\end_inset

 in the 
\begin_inset Formula $\beta^{\prime}\rightarrow0$
\end_inset

 limit (
\shape italic
i.e.
\shape default
, resulting in conventional ABMD).
 With this choice, one can show that 
\begin_inset Formula $\big<U(\xi,t\rightarrow\infty)\big>_{a}\approx U^{s}(\xi)+u(t)$
\end_inset

, (
\begin_inset Formula $u(t)$
\end_inset

 is an additive constant) in which 
\begin_inset Formula $U^{s}(\xi)$
\end_inset

 and 
\begin_inset Formula $F(\xi)$
\end_inset

 are related via 
\begin_inset Formula $U^{s}(\xi)=-(1+\frac{\beta^{\prime}}{\beta})^{-1}F(\xi)$
\end_inset

 or 
\begin_inset Formula $F(\xi)=-(1+\frac{T}{T^{\prime}})U^{s}(\xi)$
\end_inset

.
 This way of updating the biasing potential leads to a considerably smoother
 convergence to the desired free energy and more stable ABMD simulations.
\end_layout

\begin_layout Standard

\series bold
Multiple walker selection algorithm:
\series default
 The ABMD multiple walker algorithm can be improved by allowing for periodic
 interactions between the different walkers and "resampling" on-the-fly.
 The rationale behind this is that not all walkers are equally effective
 in sampling the configuration space.
 A situation that is all too common is that different walkers end up being
 
\begin_inset Quotes eld
\end_inset

bunched up" or clustered together in some local metastable region, because
 of hidden barriers that are oriented along orthogonal degrees of freedom
 to the reaction coordinate.
 To improve this situation, one would like to facilitate walkers that are
 sampling the undersampled regions of phase space, and force the walkers
 in the oversampled regions to move away and explore regions not yet covered.
 Such an algorithm has previously been implemented via scripts in the NAMD
 code for the adaptive biasing force algorithm 
\begin_inset CommandInset citation
LatexCommand cite
key "Minoukadeh_K_10"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
A resampling or selection algorithms for interacting multiple walkers requires
 a continual monitoring of the walkers by means of a periodic evaluation
 of a fitness function and a resampling of the walkers according to their
 fitness efficiency
\begin_inset CommandInset citation
LatexCommand cite
key "Minoukadeh_K_10"
literal "true"

\end_inset

.
 Efficient walkers that are wandering in the undersampled regions are enhanced
 by being cloned, while inefficient walkers found in the oversampled regions
 of phase space are correspondingly killed.
 This procedure is then repeated periodically during the simulation, thereby
 accelerating convergence to a more uniform distribution of walkers and
 flattening of the free energy landscape.
\end_layout

\begin_layout Standard
Our specific interacting/resampling/selection multiple-walker algorithm
 is implemented as follows.
 Each walker 
\begin_inset Formula $n$
\end_inset

 is assigned a weight 
\begin_inset Formula $w_{n}$
\end_inset

, which is evaluated at the end of each resampling period of time 
\begin_inset Formula $\tau$
\end_inset

.
 At the 
\begin_inset Formula $i^{th}$
\end_inset

 resampling period, i.e., from time 
\begin_inset Formula $t_{(i-1)}=(i-1)\tau$
\end_inset

 to 
\begin_inset Formula $t_{i}=i\tau$
\end_inset

, walker 
\begin_inset Formula $n$
\end_inset

 moves through configuration space building up its own trajectory 
\begin_inset Formula $\left(r_{1}^{n},\dots,r_{N}^{n}\right)$
\end_inset

.
 The weights are then tested and updated every fixed time interval of length
 
\begin_inset Formula $\tau$
\end_inset

.
 Specifically, after the 
\begin_inset Formula $i^{th}$
\end_inset

 time interval, weights are estimated by: 
\begin_inset Formula 
\[
w_{n}=K^{-1}\exp\bigg(\int_{t_{i-1}}^{t_{i}}S(\xi_{n}^{t})dt\bigg),
\]

\end_inset

where 
\begin_inset Formula $\xi_{n}^{t}$
\end_inset

 represents the collective variable evaluated at time t for trajectory 
\begin_inset Formula $n$
\end_inset

, 
\begin_inset Formula $K=\sum_{n=1}^{N_{w}}w_{n}$
\end_inset

 is the normalization factor, and 
\begin_inset Formula 
\[
S(\xi)=C\nabla^{2}(\rho(\xi))/\rho(\xi),
\]

\end_inset

with 
\begin_inset Formula $\rho(\xi)$
\end_inset

 representing the density of microstates in the collective variable space
 and 
\begin_inset Formula $C$
\end_inset

 a constant.
 The quantity 
\begin_inset Formula $S(\xi)$
\end_inset

 will be positive typically if the walker is found in the undersampled regions,
 which have a convex density function.
 Similarly, a negative 
\begin_inset Formula $S(\xi)$
\end_inset

 value indicates that the system is in the concave region of the density
 function, which typically is oversampled.
 In the context of ABMD implementation, the biasing potential is approximately
 proportional to the histogram of the collective variable by construction,
 and represents a good estimate for 
\begin_inset Formula $\rho$
\end_inset

.
 The implementation is therefore straightforward; the integral above is
 estimated for each trajectory independently by summing over 
\begin_inset Formula $S(\xi_{n}^{t})$
\end_inset

 at every step from 
\begin_inset Formula $t=t_{i-1}$
\end_inset

 to 
\begin_inset Formula $t=t_{i}$
\end_inset

, in which 
\begin_inset Formula $\Delta t$
\end_inset

 is the MD 
\shape italic
timestep
\shape default
.
 At the end of each period the walkers send their unnormalized weight estimates
 to the "master processor" to normalize them.
 A stochastic resampling method is then used to clone/kill the replicas
 based on their weight factors 
\begin_inset CommandInset citation
LatexCommand cite
key "Minoukadeh_K_10"
literal "true"

\end_inset

.
 The number of copies present in the next period for walker 
\begin_inset Formula $n$
\end_inset

 is determined by the integer number: 
\begin_inset Formula 
\begin{eqnarray*}
W_{1} & = & \lfloor\eta_{1}+N_{w}w_{1}\rfloor,\\
W_{n} & = & \lfloor\eta_{n}+N_{w}\sum_{m=1}^{n}w_{m}\rfloor-\lfloor\eta_{n}+N_{w}\sum_{m=1}^{n-1}w_{m}\rfloor,\;\;\;\text{for}\;n>1.\\
\end{eqnarray*}

\end_inset

in which 
\begin_inset Formula $0<\eta_{n}<1$
\end_inset

 is drawn from a uniform distribution (using a random number generator).
 The atomic coordinates and velocities of the walkers with 
\begin_inset Formula $N_{n}>0$
\end_inset

 are "sent" to 
\begin_inset Formula $N_{n}$
\end_inset

 walkers.
 The resampling algorithm above guarantees 
\begin_inset Formula $\sum_{n}W_{n}=N_{w}$
\end_inset

.
\end_layout

\begin_layout Standard
In terms of an ABMD simulation, the selection algorithm is most beneficial
 during the initial and middle parts of the simulation when there are large
 variations in the biasing potential.
 In the latter parts, when the effective free energy is almost flat, the
 distribution of walkers should be roughly uniform.
 In that case, the selection mechanism is unnecessary and, if one wishes
 to continue the simulation, it is best to proceed with the non interacting
 multiple walker algorithm.
 It has been found that a convenient stopping mechanism may be based on
 the entropy of the weights.
 Defining 
\begin_inset Formula $H=\sum_{n}w_{n}log(w_{n})$
\end_inset

, the selection mechanism will be stopped if 
\begin_inset Formula $E_{w}=H-log(1/N_{w})$
\end_inset

 goes below -
\begin_inset Formula $\epsilon log(1/N_{w})$
\end_inset

.
 Here, 
\begin_inset Formula $log(1/N_{w})$
\end_inset

 represents the entropy of uniform weights, and the stopping parameter 
\begin_inset Formula $\epsilon$
\end_inset

 varies between 
\begin_inset Formula $0\leq\epsilon\leq1$
\end_inset

.
 When 
\begin_inset Formula $\epsilon=0$
\end_inset

, the algorithm never stops, while 
\begin_inset Formula $\epsilon=1$
\end_inset

 forces a stop irrespective of the values of the weights.
\end_layout

\begin_layout Standard
In addition to 
\begin_inset Formula $\epsilon$
\end_inset

, there are also two other user-defined variables in the selection algorithm,
 including the constant 
\shape italic
C
\shape default
 and the interval time 
\begin_inset Formula $\tau$
\end_inset

.
 While the physical interpretation of 
\begin_inset Formula $\tau$
\end_inset

 is straightforward, 
\shape italic
C
\shape default
 represents a pseudo diffusion constant.
 One may think of the selection algorithm as an induced diffusion in the
 reaction coordinate space; The larger the value of 
\shape italic
C
\shape default
, the faster the system will diffuse along the reaction coordinate space.
 Therefore 
\shape italic
C
\shape default
 determines the strength or aggressiveness of the resampling algorithm.
 The most efficient value for 
\shape italic
C
\shape default
 is dependent on the nature of the collective variable and the shape of
 its density 
\begin_inset Formula $\rho$
\end_inset

.
 Since the best choice of 
\shape italic
C
\shape default
 for a given problem is somewhat of an art, we refer the interested reader
 to the ABMD tutorials on the AMBER webpage for insight into choosing this
 variable.
 Finally, we also note that the multiple walker selection mechanism can
 be invoked as is or in conjunction with the WT-ABMD for enhanced stability
 and convergence.
\end_layout

\begin_layout Standard

\series bold
Driven ABMD: 
\series default
ABMD and SMD schemes are both powerful nonequilibrium sampling methods;
 however, each comes with its own practical limitations.
 For instance, SMD is often associated with a very slow convergence if used
 for free energy calculations.
 However it can be used to explore the transition paths, at least qualitatively;
 an advantage over ABMD, in which the system starting from one end of the
 configuration space (the reactant) may take a long time to visit the other
 end (the product).
 SMD and ABMD schemes, however can be integrated into a novel driven adaptive-bi
as 3 scheme, termed driven ABMD (D-ABMD) that takes advantage of both its
 driven and adaptive-bias components and is advantageous over both components
 in isolation.
 D-ABMD has an advantage over conventional (or well-tempered) ABMD in that
 it ensures the exploration of the transition pathway (from one end to the
 other) in the early stages of the simulation and gradually improves the
 estimate of the free energies almost uniformly along the reaction coordinate.
 D-ABMD has also an advantage over the conventional SMD in that the effective
 free energy surface gradually becomes smooth and flat such that the system
 can move along the reaction coordinate with progressively less amount of
 work.
 The D-ABMD method is similar to D-MetaD method, which was recently introduced
 in Ref.
\begin_inset CommandInset citation
LatexCommand citep
key "Moradi_M_13d"
literal "true"

\end_inset

 as an example of driven, adaptive-bias schemes.
 
\end_layout

\begin_layout Standard
In order to combine the two schemes described above, we have developed a
 driven adaptive-bias scheme that adds an adaptive 
\begin_inset Formula $U_{a}(\xi,t)$
\end_inset

 and a driving 
\begin_inset Formula $U_{d}(\xi,t)$
\end_inset

 potential to the Hamiltonian.
 We use an iterative approach in which an independent simulation is performed
 from time t = 0 to t = T in the 
\begin_inset Formula $n^{th}$
\end_inset

 iteration (n = 1, 2, .
 .
 .), biased by the potential 
\begin_inset Formula $U_{d}(\xi,t)+U_{a}^{n}(\xi,t)$
\end_inset

 in which 
\begin_inset Formula $U_{d}(\xi,t)=\frac{k}{2}(\xi-\eta(t))^{2}$
\end_inset

 for all n (
\begin_inset Formula $\eta(t)$
\end_inset

 is moving center of the SMD harmonic potential in the 
\begin_inset Formula $\xi$
\end_inset

 space), and:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
U_{a}^{n}(\xi,t)=U^{n-1}(\xi)+\int_{0}^{t}dt'\omega(\xi^{t'},t')K(\xi-\xi^{t'})e^{-\beta\omega^{t'}}
\]

\end_inset

in which 
\begin_inset Formula $\omega^{t}$
\end_inset

 is either defined as the accumulated work or the transferred work.
 The accumulated and transferred works are defined as 
\begin_inset Formula $\omega_{ac}^{t}=\intop_{0}^{t}dt'\,\frac{\partial}{\partial t'}U_{d}(\xi^{t'},t')$
\end_inset

 and 
\begin_inset Formula $\omega_{tr}^{t}=\omega_{ac}^{t}-U_{d}(\xi^{t},t)$
\end_inset

.
 Theoretically the 
\begin_inset Formula $e^{-\beta\omega_{tr}^{t'}}$
\end_inset

 factor or 
\begin_inset Quotes eld
\end_inset

constant weight” is more accurate but for practical reasons the 
\begin_inset Formula $e^{-\beta\omega_{ac}^{t'}}$
\end_inset

 factor or “pulling wight” is preferred.
 Particularly, in our algorithm, the constant weight 
\begin_inset Formula $e^{-\beta\omega_{tr}^{t'}}=e^{-\beta\omega_{ac}^{t'}}e^{\beta U_{d}(\xi^{t'},t')}$
\end_inset

 may become instable for large biasing potentials.
 To avoid the instability in either case a cutoff for 
\begin_inset Formula $\omega^{t}$
\end_inset

 is used (i.e., the algorithm will not be applied if 
\begin_inset Formula $\omega^{t}$
\end_inset

 is smaller than the cutoff).
 At the moment, Driven ABMD is only applicable to one-dimensional reaction
 coordinate.
\end_layout

\begin_layout Standard
If any of these modules prove to be useful, please consider quoting the
 following papers: V.
 Babin, C.
 Roland and C.
 Sagui, 
\shape italic
"Adaptively biased molecular dynamics for free energy calculations"
\shape default
, J.
 Chem.
 Phys.
 
\series bold
128
\series default
, 134101 (2008); V.
 Babin, V.
 Karpusenka, M.
 Moradi, C.
 Roland and C.
 Sagui, 
\shape italic
"Adaptively biased molecular dynamics: an umbrella sampling method with
 a time-dependent potential"
\shape default
, Int.
 J.
 Quant.
 Chem.
 
\series bold
109
\series default
, 3666 (2009).
\end_layout

\begin_layout Standard
From Amber16, we implement these modules from SANDER to PMEMD and the modules
 are GPU compatible.
 To keep the consistency in format, we do a series of changes and updates
 to the usage of these modules.
 One big change is that you must set 
\series bold
\shape italic
infe
\series default
\shape default
 = 1 in &cntrl to activate these modules.
 Also, the input format has been changed to namelist style and reaction
 coordinate variables will be read from separate files.
 For the details, please read 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:Implementation-in-PMEMD"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
infe
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
infe
\end_layout

\end_inset

 This variable controls the usage of the non-equilibrium free energy method.
 When 
\shape italic
infe=0
\shape default
, the ABMD and related methods are turned off; when 
\shape italic
infe=1
\shape default
, they are turned on and the blocks 
\family typewriter
&smd
\family default
, 
\family typewriter
&pmd
\family default
, 
\family typewriter
&abmd
\family default
, 
\family typewriter
&bbmd
\family default
 and 
\family typewriter
&stsm
\family default
 will be recognized.
 The default value is 0.
 Note that use of these algorithms may require a (minor) amount of post-processi
ng by means of the nfe-umbrella-slice utility freely available in AmberTools
 described in 
\begin_inset CommandInset ref
LatexCommand formatted
reference "subsec:Post-processing-of-biasing"

\end_inset

.
\end_layout

\begin_layout Subsection
Reaction Coordinates
\end_layout

\begin_layout Standard
A reaction coordinate is defined in the 
\family typewriter
colvar
\family default
 namelist in a separate file.
 (see Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:variable"

\end_inset

).
 This section must contain a 
\family typewriter
cv_type
\family default
 
\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_type
\end_layout

\end_inset

keyword along with a value of type 
\family typewriter
STRING
\family default
 and a list of integers 
\family typewriter
cv_i
\family default
 
\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_i
\end_layout

\end_inset

 (the number of integers is defined by 
\family typewriter
cv_ni
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_ni
\end_layout

\end_inset

).
 For some types of reaction coordinates the 
\family typewriter
colvar
\family default
 section must also contain a list of real numbers, 
\family typewriter
cv_r
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_r
\end_layout

\end_inset

, whose length is defined by 
\family typewriter
cv_nr
\family default

\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_nr
\end_layout

\end_inset

.
 
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = STRING
\end_layout

\begin_layout Plain Layout

   cv_ni = N, cv_nr = M
\end_layout

\begin_layout Plain Layout

   cv_i = i1, i2, ..., iN
\end_layout

\begin_layout Plain Layout

   cv_r = r1, r2, ..., rM
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:variable"

\end_inset

 Syntax of reaction coordinate definition: 
\family typewriter
cv_type
\family default
 is a 
\family typewriter
STRING
\family default
, 
\family typewriter
cv_i
\family default
 is a list of integer numbers and 
\family typewriter
cv_r
\family default
 is a list of real numbers.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The following reaction coordinates (specfied by 
\family typewriter
cv_type
\family default
) are currently implemented: 
\end_layout

\begin_layout Description
DISTANCE: distance (in Å) between two atoms whose indexes are read from
 the list 
\family typewriter
cv_i
\family default
.
\end_layout

\begin_layout Description
COM_DISTANCE: distance between the center of mass of two atom groups.
 The 
\family typewriter
cv_i
\family default
 list is interpreted as a list of indexes of participating atoms.
 Zeros separate the groups, the last zero is optional.
 eg: 
\family typewriter
cv_i = a1,...,aN,0,b1,...,bM,0
\family default
.
\end_layout

\begin_layout Description
DF_COM_DISTANCE: difference of distances between the center of mass of first
 two atom groups and second two atom groups.
 The 
\family typewriter
cv_i
\family default
 list is interpreted as a list of indexes of participating atoms.
 Zeros separate the groups, the last zero is optional.
 eg: 
\family typewriter
cv_i = a1,...,aN,0,b1,...bM,0,c1,...cL,0,d1,...,dK,0
\family default
, 
\family typewriter
DF_COM_DISTANCE
\family default
 is 
\family typewriter
COM_DISTANCE(a1,...,aN,0,b1,...,bM) - COM_DISTANCE(c1,...cL,0,d1,...,dK)
\family default
.
\end_layout

\begin_layout Description
LCOD: linear combination of distances (in Å) between pairs of atoms listed
 in 
\family typewriter
cv_i
\family default
 with the coefficients read from 
\family typewriter
cv_r
\family default
 list.
 For example, 
\family typewriter
i = 1,2,3,4
\family default
 and 
\family typewriter
r = 1.0,-1.0
\family default
 define the difference between 1-2 and 3-4 distances, 
\shape italic
i.e.

\shape default
 LCOD = r1*distance(1, 2) + r2*distance(3,4).
\end_layout

\begin_layout Description
ANGLE: angle (in radians) between the lines joining atoms with indexes 
\family typewriter
i1
\family default
 and 
\family typewriter
i2
\family default
 and atoms with indexes 
\family typewriter
i2
\family default
 and 
\family typewriter
i3
\family default
.
 
\end_layout

\begin_layout Description
COM_ANGLE: angle (in radians) formed by the center of mass of three atom
 groups.
 The 
\family typewriter
cv_i
\family default
 list is interpreted as a list of indexes of participating atoms.
 Zeros separate the groups, the last zero is optional.
 eg: 
\family typewriter
cv_i = a1,...,aN,0,b1,...bM,0,c1,...,cK,0
\family default
.
\end_layout

\begin_layout Description
TORSION: dihedral angle (in radians) formed by atoms with indexes 
\family typewriter
i1
\family default
, 
\family typewriter
i2
\family default
, 
\family typewriter
i3
\family default
 and 
\family typewriter
i4
\family default
.
 
\end_layout

\begin_layout Description
COM_TORSION: dihedral angle (in radians) formed by the center of mass of
 four atom groups.
 The 
\family typewriter
cv_i
\family default
 list is interpreted as a list of indexes of participating atoms.
 Zeros separate the groups, the last zero is optional.
 eg: 
\family typewriter
cv_i = a1,...,aN,0,b1,...bM,0,c1,...,CK,0,d1,...,dL,0
\family default
.
\end_layout

\begin_layout Description
COS_OF_DIHEDRAL: sum of cosines of dihedral angles formed by atoms with
 indexes in the list 
\family typewriter
cv_i
\family default
.
 The number of atoms must be a multiple of four.
\end_layout

\begin_layout Description
SIN_OF_DIHEDRAL: sum of sines of dihedral angles formed by atoms with indexes
 in the list 
\family typewriter
cv_i
\family default
.
 The number of atoms must be a multiple of four.
\end_layout

\begin_layout Description
PAIR_DIHEDRAL: sum of cosines of a list of angles each formed by summing
 two neighboring dihedral angles from a list formed by atoms with indices
 
\family typewriter
cv_i
\family default
.
 The number of atoms must be a multiple of four.
 For a list of dihedral angles such as {
\begin_inset Formula $\alpha_{1}$
\end_inset

, .
 .
 .
 ,
\begin_inset Formula $\alpha_{N}$
\end_inset

}, PAIR_DIHEDRAL is 
\begin_inset Formula ${\displaystyle \sum}_{i=1}^{N-1}cos(\alpha_{i}+\alpha_{i+1})$
\end_inset

 which ranges between 
\begin_inset Formula $-N+1$
\end_inset

 and 
\begin_inset Formula $N-1$
\end_inset

.
\end_layout

\begin_layout Description
PATTERN_DIHEDRAL: a particular pattern-recognizing function defined on a
 list of dihedral angles formed by atoms with indices 
\family typewriter
cv_i
\family default
.
 The number of atoms must be a multiple of four.
 The definition is particularly relevant for the dihedral angles with a
 binary-like behavior of being either around 0 or 180 (e.g., ω backbone dihedral
 angle).
 For a list of dihedral angles such as {
\begin_inset Formula $\alpha_{1}$
\end_inset

, .
 .
 .
 ,
\begin_inset Formula $\alpha_{N}$
\end_inset

 }, PATTERN_DIHEDRAL is 
\begin_inset Formula ${\displaystyle \sum}_{i=1}^{N}cos^{2}(\alpha_{i}/2)2^{i-1}$
\end_inset

 which ranges between 0 and 
\begin_inset Formula $2^{N}-1$
\end_inset

.
 
\end_layout

\begin_layout Description
R_OF_GYRATION: radius of gyration (in Å) of atoms with indexes given in
 the 
\family typewriter
cv_i
\family default
 list (mass weighted).
 
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'MULTI_RMSD'
\end_layout

\begin_layout Plain Layout

   cv_ni = 9, cv_nr = 21,
\end_layout

\begin_layout Plain Layout

   cv_i = 1, 2, 3, 4, 0, 3, 4, 5, 0 ! the last zero is optional  
\end_layout

\begin_layout Plain Layout

   cv_r = 1.0, 1.0, 1.0, ! group #1, atom 1
\end_layout

\begin_layout Plain Layout

        2.0, 2.0, 2.0, ! group #1, atom 2
\end_layout

\begin_layout Plain Layout

        3.0, 3.0, 3.0, ! group #1, atom 3
\end_layout

\begin_layout Plain Layout

        4.0, 4.0, 4.0, ! group #1, atom 4
\end_layout

\begin_layout Plain Layout

       23.0, 23.0, 23.0, ! group #2, atom 3
\end_layout

\begin_layout Plain Layout

          4.0, 4.0, 4.0, ! group #2, atom 4
\end_layout

\begin_layout Plain Layout

          5.0, 5.0, 5.0 ! group #2, atom 5
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:RMSD"

\end_inset

 An example of 
\family typewriter
MULTI_RMSD
\family default
 variable definition.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Description
MULTI_RMSD: 
\family typewriter
RMS
\family default
 (in Å, mass weighted) of 
\family typewriter
RMSD
\family default
s of several groups of atoms w.r.t.
 reference positions provided in the 
\family typewriter
cv_r
\family default
 list.
 The 
\family typewriter
cv_i
\family default
 list is interpreted as a list of indexes of participating atoms.
 Zeros separate the groups.
 An atom may enter several groups simultaneously.
 The 
\family typewriter
cv_r
\family default
 array is expected to contain the reference positions (without zero sentinels).
 The implementation uses the method (and the code) introduced in Ref.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Coutsias2004"
literal "true"

\end_inset

.
 An example of variable of this type is presented in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:RMSD"

\end_inset

.
 Two groups are defined here: one comprises the atoms with indexes 1, 2,
 3, 4 (line 3 in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:RMSD"

\end_inset

, numbers prior to the first zero) and another one of atoms with indexes
 3, 4, 5.
 The code will first compute the (mass weighted) 
\family typewriter
RMSD
\family default
 (
\begin_inset Formula $R_{1}$
\end_inset

) of atoms belonging to the first group w.r.t.
 reference coordinates provided in the 
\family typewriter
cv_r
\family default
 array (first 
\begin_inset Formula $12=4\times3$
\end_inset

 real numbers of it; lines 4, 5, 6, 7 in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:RMSD"

\end_inset

).
 Next, the (mass weighted) 
\family typewriter
RMSD
\family default
 (
\begin_inset Formula $R_{2}$
\end_inset

) of atoms of the second group w.r.t.
 the corresponding reference coordinates (last 
\begin_inset Formula $9=3\times3$
\end_inset

 elements of the 
\family typewriter
cv_r
\family default
 array in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:RMSD"

\end_inset

) will be computed.
 Finally, the code will compute the value of the variable as follows: 
\begin_inset Formula 
\[
\mathrm{value}=\sqrt{\frac{M_{1}}{M_{1}+M_{2}}R_{1}^{2}+\frac{M_{2}}{M_{1}+M_{2}}R_{2}^{2}}\,,
\]

\end_inset

 where 
\begin_inset Formula $M_{1}$
\end_inset

 and 
\begin_inset Formula $M_{2}$
\end_inset

 are the total masses of atoms in the corresponding groups.
 
\end_layout

\begin_layout Description
N_OF_BONDS: 
\begin_inset Formula 
\[
\mathrm{value}=\sum\limits _{p}\frac{1-\left(r_{p}\Big/r_{0}\right)^{6\hphantom{1}}}{1-\left(r_{p}\Big/r_{0}\right)^{12}}\,,
\]

\end_inset

 where the sum runs over pairs of atoms 
\begin_inset Formula $p$
\end_inset

, 
\begin_inset Formula $r_{p}$
\end_inset

 denotes distance between the atoms of pair 
\begin_inset Formula $p$
\end_inset

 and 
\begin_inset Formula $r_{0}$
\end_inset

 is a parameter measured in Å.
 The 
\family typewriter
cv_r
\family default
 array must contain exactly one element that is interpreted as 
\begin_inset Formula $r_{0}$
\end_inset

.
 The 
\family typewriter
cv_i
\family default
 array is expected to contain pairs of indexes of participating atoms.
 For example, if 1 and 2 are the indexes of Oxygen atoms and 3, 4, 5 are
 the indexes of Hydrogen atoms and one intents to count all possible O-H
 bonds, the 
\family typewriter
cv_i
\family default
 list must be (1, 3, 1, 4, 1, 5, 2, 3, 2, 4, 2, 5), that is, it must explicitly
 list all the pairs to be counted.
 
\end_layout

\begin_layout Description
HANDEDNESS: 
\begin_inset Formula 
\[
\mathrm{value}=\sum_{a}\frac{\mathbf{u}_{a,3}\cdot\left[\mathbf{u}_{a,1}\times\mathbf{u}_{a,2}\right]}{\left|\mathbf{u}_{a,1}\right|\left|\mathbf{u}_{a,2}\right|\left|\mathbf{u}_{a,3}\right|}\,,
\]

\end_inset

 where 
\begin_inset Formula 
\begin{eqnarray*}
\mathbf{u}_{a,1} & = & \mathbf{r}_{a+1}-\mathbf{r}_{a}\\
\mathbf{u}_{a,2} & = & \mathbf{r}_{a+3}-\mathbf{r}_{a+2}\\
\mathbf{u}_{a,3} & = & (1-w)(\mathbf{r}_{a+2}-\mathbf{r}_{a+1})+w(\mathbf{r}_{a+3}-\mathbf{r}_{a})\,,
\end{eqnarray*}

\end_inset

 and 
\begin_inset Formula $\mathbf{r}_{a}$
\end_inset

 denote the positions of participating atoms.
 The 
\family typewriter
cv_i
\family default
 array is supposed to contain indexes of the atoms and the 
\family typewriter
cv_r
\family default
 array may provide the value of 
\begin_inset Formula $w$
\end_inset

 (
\begin_inset Formula $0\leq w\leq1$
\end_inset

, the default is zero).
 
\end_layout

\begin_layout Description
N_OF_STRUCTURES: 
\begin_inset Formula 
\[
\mathrm{value}=\sum\limits _{g}\frac{1-\left(R_{g}\Big/R_{0,g}\right)^{6\hphantom{1}}}{1-\left(R_{g}\Big/R_{0,g}\right)^{12}}\,,
\]

\end_inset

 where the sum runs over groups of atoms, 
\begin_inset Formula $R_{g}$
\end_inset

 denotes the 
\family typewriter
RMSD
\family default
 of the group 
\begin_inset Formula $g$
\end_inset

 w.r.t.
 some reference coordinates and 
\begin_inset Formula $R_{0,g}$
\end_inset

 are positive parameters measured in Å.
 The 
\family typewriter
cv_i
\family default
 array is expected to contain indexes of participating atoms with zeros
 separating different groups.
 The elements of the 
\family typewriter
cv_r
\family default
 array are interpreted as the reference coordinates of the first group followed
 by their corresponding 
\begin_inset Formula $R_{0}$
\end_inset

; then followed by the reference coordinates of the atoms of the second
 group, followed by the second 
\begin_inset Formula $R_{0}$
\end_inset

, and so forth.
 To make the presentation clearer, let us consider the example presented
 in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:N-OF-STRUCTURES"

\end_inset

.
 The atomic groups and reference coordinates are the same as the ones shown
 in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:RMSD"

\end_inset

.
 Lines 7 and 11 in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:N-OF-STRUCTURES"

\end_inset

 contain additional entries that set the values of the threshold distances
 
\begin_inset Formula $R_{0,1}$
\end_inset

 and 
\begin_inset Formula $R_{0,2}$
\end_inset

.
 To compute the variable, the code first computes the mass weighted 
\family typewriter
RMSD
\family default
 values 
\begin_inset Formula $R_{1}$
\end_inset

 and 
\begin_inset Formula $R_{2}$
\end_inset

 for both groups –much like in the 
\family typewriter
MULTI_RMSD
\family default
 case– and then combines those in a manner similar to that used in the 
\family typewriter
N_OF_BONDS
\family default
 variable.
 
\begin_inset Float figure
placement tb
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'N_OF_STRUCTURES'
\end_layout

\begin_layout Plain Layout

   cv_ni = 9, cv_nr = 23,
\end_layout

\begin_layout Plain Layout

   cv_i = 1, 2, 3, 4, 0, 3, 4, 5, 0 ! the last zero is optional
\end_layout

\begin_layout Plain Layout

   cv_r = 1.0, 1.0, 1.0, ! group #1, atom 1
\end_layout

\begin_layout Plain Layout

        2.0, 2.0, 2.0, ! group #1, atom 2
\end_layout

\begin_layout Plain Layout

        3.0, 3.0, 3.0, ! group #1, atom 3
\end_layout

\begin_layout Plain Layout

        4.0, 4.0, 4.0, ! group #1, atom 4
\end_layout

\begin_layout Plain Layout

        1.0,           ! R0 for group #1
\end_layout

\begin_layout Plain Layout

     23.0, 23.0, 23.0, ! group #2, atom 3
\end_layout

\begin_layout Plain Layout

        4.0, 4.0, 4.0, ! group #2, atom 4
\end_layout

\begin_layout Plain Layout

        5.0, 5.0, 5.0, ! group #2, atom 5
\end_layout

\begin_layout Plain Layout

        2.0           ! R0 for group #2
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:N-OF-STRUCTURES"

\end_inset

 An example of 
\family typewriter
N_OF_STRUCTURES
\family default
 variable.
 
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
\begin_inset Formula 
\[
\mathrm{value}=\frac{1-\left(R_{1}\Big/R_{0,1}\right)^{6\hphantom{1}}}{1-\left(R_{1}\Big/R_{0,1}\right)^{12}}+\frac{1-\left(R_{2}\Big/R_{0,2}\right)^{6\hphantom{1}}}{1-\left(R_{2}\Big/R_{0,2}\right)^{12}}\,.
\]

\end_inset

 In other words, the variable 
\begin_inset Quotes eld
\end_inset

counts
\begin_inset Quotes erd
\end_inset

 the number of structures that match (stay close in 
\family typewriter
RMSD
\family default
 sense) with the reference structures.
 
\end_layout

\end_deeper
\begin_layout Description
QUATERNIONS: Describing large-scale atomistic conformational changes in
 biomolecular systems requires one to deal with orientational changes of
 atomistic domains with large numbers of atoms.
 While there are several ways of defining a collective variable that quantifies
 an orientation based conformational change, the orientation quaternion
 technique
\begin_inset CommandInset citation
LatexCommand cite
key "Coutsias, Fiorin, Moradi_M_15a, Moradi_M_15b"
literal "true"

\end_inset

 has proven successful as a well-behaved, flexible method for defining system-sp
ecific CVs, specifically aimed at inducing interdomain orientational changes
 or restraining the orientation of certain domains.
 The CVs in the orientation quaternion class, are all derived from an `optimal
 rotation' between a set of reference coordinates 
\begin_inset Formula $\mathbf{X}_{k}$
\end_inset

 (
\begin_inset Formula $1\leq k\leq N$
\end_inset

; where 
\begin_inset Formula $N$
\end_inset

 is the number of atoms involved) and the set of target coordinates 
\begin_inset Formula $\mathbf{Y}_{k}$
\end_inset

.
 A `quaternion' is introduced as a four-component vector that can be expressed
 as 
\begin_inset Formula $q_{0}+q_{1}\hat{i}+q_{2}\hat{j}+q_{3}\hat{k}$
\end_inset

 where 
\begin_inset Formula $q_{0}$
\end_inset

 and 
\begin_inset Formula $q_{1}\hat{i}+q_{2}\hat{j}+q_{3}\hat{k}$
\end_inset

 are called scalar and vector parts respectively.
 The optimal rotation can be parametrized
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
Assuming both sets have been already shifted to bring their barycenters
 to the origin (optimum translation).
\end_layout

\end_inset

 by a unit quaternion, 
\begin_inset Formula $\hat{q}=(q_{0},q_{1},q_{2},q_{3})$
\end_inset

, that minimize 
\begin_inset Formula $<||\hat{q}\mathbf{X}_{k}\hat{q}^{*}-\mathbf{Y}_{k}||^{2}>$
\end_inset

 in which 
\begin_inset Formula $<.>$
\end_inset

 denotes an average over 
\begin_inset Formula $k$
\end_inset

,
\begin_inset Formula $q^{*}$
\end_inset

 is the conjugate of 
\begin_inset Formula $q$
\end_inset

 and 
\begin_inset Formula $||q||^{2}=q^{*}q$
\end_inset

 (see Ref.
\begin_inset CommandInset citation
LatexCommand cite
key "Coutsias"
literal "true"

\end_inset

 for more details).
 The optimal rotation unit quaternion (or orientation quaternion)
\begin_inset Formula $\hat{q}$
\end_inset

 can be written as 
\begin_inset Formula $\big(cos(\theta/2),sin(\theta/2)\hat{u}\big)$
\end_inset

, where 
\begin_inset Formula $\theta$
\end_inset

 is the optimal rotation angle and 
\begin_inset Formula $\hat{u}$
\end_inset

 is a unit vector associated with the optimal axis of rotation.
 To deal with large atomistic conformational changes, a set of quaternion-based
 CVs has implemented in AMBER20.
 For the details of usage, send emails to Ashkan Fakharzadeh (afakhar@ncsu.edu),
 Dr.
 Feng Pan (fpan3@ncsu.edu),  and Prof.
 Mahmoud Moradi (moradi@uark.edu).
 The specific quaternion-based CVs implemented are: ORIENTATION_ANGLE, ORIENTATI
ON_PROJ, TILT, SPINANGLE, QUATERNION0, QUATERNION1, QUATERNION2, and QUATERNION3.
\end_layout

\begin_layout Description

\series bold
Orientation (QUATERNION0,...,QUATERNION3):
\series default
 These define the orientation of several atoms with respect to a set of
 reference coordinates in terms of a unit quaternion vector 
\begin_inset Formula $\hat{q}=(q_{0},q_{1},q_{2},q_{3})$
\end_inset

 according to the method introduced in Ref.
\begin_inset CommandInset citation
LatexCommand cite
key "Coutsias, Fiorin"
literal "true"

\end_inset

.
 These variables return the best-fit rotation, also used in best-fit RMSD
 calculation procedures, to superimpose the coordinates 
\begin_inset Formula $\mathbf{X}$
\end_inset

 onto a set of reference coordinates 
\begin_inset Formula $\mathbf{X}_{0}$
\end_inset

.
 The unit quaternion 
\begin_inset Formula $\hat{q}=(q_{0},q_{1},q_{2},q_{3})$
\end_inset

 can be written as 
\begin_inset Formula $\big(cos(\theta/2),sin(\theta/2)\hat{u}\big)$
\end_inset

, where 
\begin_inset Formula $\theta$
\end_inset

 is the rotation angle and 
\begin_inset Formula $\hat{u}$
\end_inset

 is a unit vector associated with the axis of rotation; for example, a rotation
 of 
\begin_inset Formula $90^{\circ}$
\end_inset

 around the z axis 
\begin_inset Formula $(0,0,1)$
\end_inset

 is expressed as
\begin_inset Formula $(cos(90^{\circ}/2),0.0,0.0,sin(90^{\circ}/2))=(\sqrt{2}/2,0,0,\sqrt{2}/2)$
\end_inset

.
 The components of the unit quaternion 
\begin_inset Formula $(q_{0},q_{1},q_{2},q_{3})$
\end_inset

 were implemented separately as QUATERNION0, QUATERNION1, QUATERNION2, and
 QUATERNION3 CVs.
 To find the orientation, all four CVs QUATERNION0,...,QUATERNION3 are being
 used.
 To calculate the quaternion CVs one needs to specify a list of participating
 atoms and also their reference coordinates.
 The reference coordinates may be passed to AMBER either via direct specificatio
n inside the CV call, or by passing the name of a reference coordinates
 file.
 It is recommended that if the set of participating atoms is small (say
 no larger than 15), then these are specified directly inside the CV call.
 Otherwise, the passing of information via filename is recommended since
 these lists may contain hundreds if not thousands of atoms.
 Relevant parameters pertaining to the input of this information are: 
\begin_inset Formula $cv\_ni$
\end_inset

 represents the number of participating atoms; 
\begin_inset Formula $cv\_i$
\end_inset

 represents the list of the indices of all participating atoms; 
\begin_inset Formula $cv\_r$
\end_inset

 represents the reference coordinates (when passed directly) and 
\begin_inset Formula $refcrd\_file$
\end_inset

 is the filename for the reference coordinates when they are to be read
 from file.
 The file 
\begin_inset Formula $refcrd\_file$
\end_inset

 should be an AMBER coordinates/restart file containing coordinates, velocities,
 etc.
 of all atoms.
 The list participating atoms, 
\begin_inset Formula $cv\_i$
\end_inset

, and their reference coordinates (
\begin_inset Formula $cv\_r$
\end_inset

 and or 
\begin_inset Formula $refcrd\_file$
\end_inset

 ) must be the same for all QUATERNION0,...,QUATERNION3.
 The CVs are linked together using an attribute
\emph on
`q_index'
\emph default
.
 The
\emph on
`q_index'
\emph default
 accepts an integer between 
\begin_inset Formula $1,...,100$
\end_inset

, where its default value is one.
 The Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:orientation"
plural "false"
caps "false"
noprefix "false"

\end_inset

 is an example of Quaternion CVs syntax.
 
\begin_inset Float figure
placement tb
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION0'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! number of participating atoms
\end_layout

\begin_layout Plain Layout

   cv_ni = ni
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! index of participating atoms
\end_layout

\begin_layout Plain Layout

   cv_i = a1, a2,..., aN
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! AMBER coordinate/restart file to read reference coordinates
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'refcrd_file'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! number of references which must be 3*ni; Should not be set if
\end_layout

\begin_layout Plain Layout

   ! refcrd_file is being used
\end_layout

\begin_layout Plain Layout

   cv_nr = nr
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! reference coordinates of participating atoms; Should not be set if
\end_layout

\begin_layout Plain Layout

   ! refcrd_file is being used
\end_layout

\begin_layout Plain Layout

   cv_r = a1x, a1y, a1z, a2x, a2y, a2z, a3x, a3y, a3z, ...
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! an arbitrary integer between 1 to 100
\end_layout

\begin_layout Plain Layout

   q_index = n
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:orientation"

\end_inset

 Syntax of Quaternion reaction coordinates.
\end_layout

\end_inset


\end_layout

\end_inset

 An example this type of CVs is presented in the Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:quaternion"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 Two set of orientations are defined here: each set consists of QUATERNION0,..,
 QUATERNION3.
 The first set comprises 
\begin_inset Formula $18$
\end_inset

 atoms with indexes 
\begin_inset Formula $11,41,48,74,104,\dots$
\end_inset

 and another one of 
\begin_inset Formula $24$
\end_inset

 atoms with indexes 
\begin_inset Formula $12,16,46,55,75,\dots$
\end_inset

.
 A file, `inpcrd' is used as an AMBER coordinate/restart file to read reference
 coordinates.
 There is no need to set 
\emph on
`q_index'
\emph default
 for the first four quaternions since the default value is one, but it is
 set to be 
\begin_inset Formula $2$
\end_inset

 for all quaternion CVs in the second set to link and normalize them.
 The returned value of each QUATERNION0,...,QUATERNION3 CVs is the corresponding
 component of the unit orientation vector 
\begin_inset Formula $\hat{q}=(q_{0},q_{1},q_{2},q_{3})$
\end_inset

.
\begin_inset Float figure
placement tb
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION0'
\end_layout

\begin_layout Plain Layout

   cv_ni = 18,
\end_layout

\begin_layout Plain Layout

   cv_i = 11 , 41 , 48 , 74 , 104 , 111 , 137 , 167 , 174 , 199 , 229 ,
 236, 262 , 
\end_layout

\begin_layout Plain Layout

          292 , 299 , 325 , 355 , 362 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION1'
\end_layout

\begin_layout Plain Layout

   cv_ni = 18,
\end_layout

\begin_layout Plain Layout

   cv_i = 11 , 41 , 48 , 74 , 104 , 111 , 137 , 167 , 174 , 199 , 229 ,
 236, 262 ,
\end_layout

\begin_layout Plain Layout

          292 , 299 , 325 , 355 , 362 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION2'
\end_layout

\begin_layout Plain Layout

   cv_ni = 18,
\end_layout

\begin_layout Plain Layout

   cv_i = 11 , 41 , 48 , 74 , 104 , 111 , 137 , 167 , 174 , 199 , 229 ,
 236, 262 ,
\end_layout

\begin_layout Plain Layout

          292 , 299 , 325 , 355 , 362 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION3'
\end_layout

\begin_layout Plain Layout

   cv_ni = 18,
\end_layout

\begin_layout Plain Layout

   cv_i = 11 , 41 , 48 , 74 , 104 , 111 , 137 , 167 , 174 , 199 , 229 ,
 236, 262 ,
\end_layout

\begin_layout Plain Layout

          292 , 299 , 325 , 355 , 362 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION0'
\end_layout

\begin_layout Plain Layout

   cv_ni = 24,
\end_layout

\begin_layout Plain Layout

   cv_i = 12 , 16 , 46 , 55 , 75 , 79 , 109 , 118 , 138 , 142 , 172 , 181
 , 200 ,
\end_layout

\begin_layout Plain Layout

          204 , 234 , 243 , 263 , 267 , 297 , 306 , 326 , 330 , 360 , 369
 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd',
\end_layout

\begin_layout Plain Layout

   q_index = 2
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION1'
\end_layout

\begin_layout Plain Layout

   cv_ni = 24,
\end_layout

\begin_layout Plain Layout

   cv_i = 12 , 16 , 46 , 55 , 75 , 79 , 109 , 118 , 138 , 142 , 172 , 181
 , 200 ,
\end_layout

\begin_layout Plain Layout

          204 , 234 , 243 , 263 , 267 , 297 , 306 , 326 , 330 , 360 , 369
 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd',
\end_layout

\begin_layout Plain Layout

   q_index = 2
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION2'
\end_layout

\begin_layout Plain Layout

   cv_ni = 24,
\end_layout

\begin_layout Plain Layout

   cv_i = 12 , 16 , 46 , 55 , 75 , 79 , 109 , 118 , 138 , 142 , 172 , 181
 , 200 ,
\end_layout

\begin_layout Plain Layout

          204 , 234 , 243 , 263 , 267 , 297 , 306 , 326 , 330 , 360 , 369
 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd',
\end_layout

\begin_layout Plain Layout

   q_index = 2
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'QUATERNION3'
\end_layout

\begin_layout Plain Layout

   cv_ni = 24,
\end_layout

\begin_layout Plain Layout

   cv_i = 12 , 16 , 46 , 55 , 75 , 79 , 109 , 118 , 138 , 142 , 172 , 181
 , 200 ,
\end_layout

\begin_layout Plain Layout

          204 , 234 , 243 , 263 , 267 , 297 , 306 , 326 , 330 , 360 , 369
 ,
\end_layout

\begin_layout Plain Layout

   refcrd_file = 'inpcrd',
\end_layout

\begin_layout Plain Layout

   q_index = 2
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:quaternion"

\end_inset

 An example of 
\family typewriter
Orientation
\family default
 variable.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Description

\series bold
ORIENTATION_ANGLE:
\series default
 The angle of rotation 
\begin_inset Formula $\theta=2cos^{-1}(q_{0})$
\end_inset

 between the current and the reference positions.
 This angle is between 
\begin_inset Formula $0^{\circ}$
\end_inset

 to 
\begin_inset Formula $180^{\circ}$
\end_inset

.
 The 
\begin_inset Formula $cv\_i$
\end_inset

 list is interpreted as a list of indexes of participating atoms.
\begin_inset Formula 
\[
\textit{orientation angle: }\theta=2cos^{-1}(q_{0})
\]

\end_inset


\end_layout

\begin_layout Description

\series bold
ORIENTATION_PROJ:
\series default
 The cosine of the angle of rotation 
\begin_inset Formula $\theta$
\end_inset

 between the current and the reference positions.
 While ORIENTATION_ANGLE diverges near 
\begin_inset Formula $\theta=0$
\end_inset

, because of 
\begin_inset Formula $\nabla_{X}\theta$
\end_inset

, ORIENTATION_PROJ might be used instead to apply forces.
 The range of ORIENTATION_PROJ is 
\begin_inset Formula $[-1,1]$
\end_inset

.
 The 
\begin_inset Formula $cv\_i$
\end_inset

 array is supposed to contain indexes of the atoms.
\begin_inset Formula 
\[
\textit{orientation proj: }2q_{0}^{2}-1
\]

\end_inset


\end_layout

\begin_layout Description

\series bold
SPINANGLE:
\series default
 Angle of rotation 
\begin_inset Formula $\phi$
\end_inset

 around a given unit axis 
\begin_inset Formula $\mathbf{\hat{e}}$
\end_inset

.
 The axis 
\begin_inset Formula $\mathbf{\hat{e}}$
\end_inset

 is being used to decompose a complete orientation rotation in two sub-rotations
, spin 
\begin_inset Formula $\phi$
\end_inset

 and tilt 
\begin_inset Formula $\omega$
\end_inset

.
 An advantage of this decomposition is 
\begin_inset Formula $\phi$
\end_inset

 and 
\begin_inset Formula $\omega$
\end_inset

 have the same values, regardless of which one is applied first (in comparison
 to Euler angles methods).
 The participating atoms with indexes are given in the 
\begin_inset Formula $cv\_i$
\end_inset

.
 The
\emph on
`axis'
\emph default
 must provide three components of the axis
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
The axis is from the origin
\begin_inset Formula $(0.0,0.0,0.0)$
\end_inset

 to that point.
\end_layout

\end_inset


\begin_inset Formula $\mathbf{\hat{e}}$
\end_inset

 in 
\begin_inset Formula $A^{\circ}$
\end_inset

.
 The default axis of rotation is 
\begin_inset Formula $(0.0,0.0,1.0)$
\end_inset

.
 The range of SPINANGLE is between
\begin_inset Formula $[-180:180]$
\end_inset

 degrees.
 The reference coordinates are specified either via 
\begin_inset Formula $cv\_r$
\end_inset

 or 
\begin_inset Formula $refcrd\_file$
\end_inset

.
 
\begin_inset Formula 
\[
\textit{spin angle: }\phi=2tan^{-1}(\mathbf{q.e}/q_{0})
\]

\end_inset

where 
\begin_inset Formula $\mathbf{q}$
\end_inset

 is the vector part of quaternion, namely 
\begin_inset Formula $(q_{1},q_{2},q_{3})$
\end_inset

.
 An example of SPINANGLE cv is presented in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:spinangle"
plural "false"
caps "false"
noprefix "false"

\end_inset

.
 The same atoms as example one are used, but the axis of rotation is set
 to be `x-axis'.
 The reference coordinates are given by 
\begin_inset Formula $cv\_nr$
\end_inset

, 
\begin_inset Formula $cv\_r$
\end_inset

 options.
\begin_inset Float figure
placement tb
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

   cv_type = 'SPINANGLE'
\end_layout

\begin_layout Plain Layout

   cv_ni = 18, cv_nr = 54,
\end_layout

\begin_layout Plain Layout

   cv_i = 11 , 41 , 48 , 74 , 104 , 111 , 137 , 167 , 174 , 199 , 229 ,
\end_layout

\begin_layout Plain Layout

          236, 262 , 292 , 299 , 325 , 355 , 362 ,
\end_layout

\begin_layout Plain Layout

   cv_r = 0.96 , -4.47 , -0.31 , 3.48 , -3.00 , 3.06 , 0.88 , 0.01 ,
\end_layout

\begin_layout Plain Layout

          3.36 ,4.55 , -0.51 , 6.46 , 3.93 , 2.38 , 9.81 , 0.26 ,
\end_layout

\begin_layout Plain Layout

          0.84 , 10.12 , 1.90 , 4.16 , 13.21 , -1.06 , 4.47 , 16.58 ,
\end_layout

\begin_layout Plain Layout

         -0.71 , 0.52 , 16.88 , -0.96 , -4.47 , 17.21 , -3.48 ,
\end_layout

\begin_layout Plain Layout

         -3.00 , 13.84 , -0.88 , 0.01 , 13.54 , -4.55 , -0.51 , 10.44 , 
\end_layout

\begin_layout Plain Layout

         -3.93 , 2.38 , 7.09 , -0.26 , 0.84, 6.78 , -1.90 , 4.16 ,
\end_layout

\begin_layout Plain Layout

          3.69 , 1.06 , 4.47 , 0.32 , 0.71 , 0.52 , 0.02 ,
\end_layout

\begin_layout Plain Layout

   axis = 1.0, 0.0, 0.0
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:spinangle"

\end_inset

 An example of 
\family typewriter
SPINANGLE
\family default
 variable.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Description

\series bold
TILT:
\series default
 Cosine of the rotation orthogonal to an unit given axis.
 The tilt angle 
\begin_inset Formula $\omega$
\end_inset

, shows a rotation away from the direction 
\begin_inset Formula $\mathbf{\hat{e}}$
\end_inset

.
 The tilt combined with the `spin' sub-rotation provides the complete orientatio
n rotation of a group of atoms.
 Similar to ORIENTATION_PROJ, to avoid the discontinuity around 
\begin_inset Formula $0^{\circ}$
\end_inset

 and 
\begin_inset Formula $180^{\circ}$
\end_inset

, the cosine of the tilt is implemented instead of the tilt angle itself,
 so that derivatives are continuous almost everywhere.
 The 
\begin_inset Formula $cv\_i$
\end_inset

 and 
\emph on
`axis'
\emph default
 are the participating atoms with indexes and the given axis, respectively.
 The reference coordinates are specified either via 
\begin_inset Formula $cv\_r$
\end_inset

 or 
\begin_inset Formula $refcrd\_file$
\end_inset

.
 The value of TILT is between 
\begin_inset Formula $-1$
\end_inset

 to 
\begin_inset Formula $1$
\end_inset

, where the value 
\begin_inset Formula $1$
\end_inset

 represents an orientation fully parallel to 
\begin_inset Formula $\mathbf{\hat{e}}$
\end_inset

 (
\begin_inset Formula $\omega=0^{\circ}$
\end_inset

), and the value 
\begin_inset Formula $-1$
\end_inset

 represents an anti-parallel orientation.
 
\begin_inset Formula 
\[
\textit{tilt: }t=cos(\omega)=2\big(\frac{q_{0}}{cos(\frac{{tan^{-1}\mathbf{q.e}}}{q_{0}})}\big)^{2}-1
\]

\end_inset


\end_layout

\begin_layout Subsection
Steered Molecular Dynamics
\end_layout

\begin_layout Standard
The 
\begin_inset Index idx
status open

\begin_layout Plain Layout
nfe_smd
\end_layout

\end_inset


\family typewriter
&smd
\family default
 namelist, if present in the 
\family typewriter
MDIN
\family default
 file, activates the steered 
\family typewriter
MD
\family default
 code (the method itself is extensively described in the literature: see
 for example Ref.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Park2003"
literal "true"

\end_inset

 and references therein).
 The prefix NFE appears in several switches to do with steered MD: this
 stands for 
\begin_inset Quotes eld
\end_inset

Non-equilibrium Free Energy
\begin_inset Quotes erd
\end_inset

.
 
\end_layout

\begin_layout Standard
The following is recognized within the 
\family typewriter
&smd
\family default
 namelist: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
output_file
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
output_file
\end_layout

\end_inset

 sets the output file name.
 Default is '
\family typewriter
nfe-smd.txt
\family default
'.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
output_freq
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
output_freq
\end_layout

\end_inset

 sets the output frequency (in 
\family typewriter
MD
\family default
 steps).
 Default is 50.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
cv_file
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_file
\end_layout

\end_inset

 sets the collective variable file name.
 Default is '
\family typewriter
nfe-smd-cv
\family default
'.
\end_layout

\begin_layout Standard
There must be at least one reaction coordinate defined (that is, there must
 be at least one 
\family typewriter
&colvar
\family default
 namelist in the 
\family typewriter
cv_file
\family default
).
 The steered 
\family typewriter
MD
\family default
 code requires that additional entries be present in the 
\family typewriter
&colvar
\family default
 namelist: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
path
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
path
\end_layout

\end_inset

 the steering path whose elements must be real numbers.
 The 
\family typewriter
path
\family default
 must include at least two elements.
 The upper limit on the number of entries is 20000.
 The elements define Catmull-Rom spline used for steering.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
npath
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
npath
\end_layout

\end_inset

 sets the number of elements in 
\family typewriter
path
\family default
.
 Default is 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
path_mode
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
path_mode
\end_layout

\end_inset

 The way steering paths are constructed.
 There are two modes available.
 In 
\family typewriter
SPLINE
\family default
 mode (default) the path is approximated by a spline that passes through
 the given points; in 
\family typewriter
LINES
\family default
 mode the path is represented by the line segments joining the control points.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
harm
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
harm
\end_layout

\end_inset

 specifies the harmonic constant.
 If a single number is provided, e.g., 
\family typewriter
harm = 10.0
\family default
, then it is constant throughout the run.
 If two or more numbers are provided, e.g., 
\family typewriter
harm = 10.0, 20.0
\family default
, then the harmonic constant follows a Catmull-Rom spline built upon the
 provided values.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
nharm
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
nharm
\end_layout

\end_inset

 sets the number of elements in 
\family typewriter
harm
\family default
.
 Default is 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
harm_mode
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
harm_mode
\end_layout

\end_inset

 The way harmonical paths are constructed, similar with 
\family typewriter
path_mode
\family default
.
\end_layout

\begin_layout Standard
An example of 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for steered 
\family typewriter
MD
\family default
 is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:smd"

\end_inset

.
 The reaction coordinate is defined in 
\family typewriter
cv.in
\family default
.
 The spring constant is set constant throughout the run and the steering
 path is configured from 5.0 to 3.0.
 The values of the reaction coordinate, harmonic constant and the work performed
 on the system are requested to be dumped to the 
\family typewriter
smd.txt
\family default
 file every 50 MD steps.
 
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

title line
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

..., infe = 1
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

&smd
\end_layout

\begin_layout Plain Layout

   output_file = 'smd.txt'
\end_layout

\begin_layout Plain Layout

   output_freq = 50
\end_layout

\begin_layout Plain Layout

   cv_file = 'cv.in'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

cv_file
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

  cv_type = 'DISTANCE'
\end_layout

\begin_layout Plain Layout

  cv_ni = 2
\end_layout

\begin_layout Plain Layout

  cv_i = 5, 9
\end_layout

\begin_layout Plain Layout

  npath = 2, path = 5.0, 3.0, path_mode = 'LINES',
\end_layout

\begin_layout Plain Layout

  nharm = 1, harm = 10.0
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
 
\begin_inset CommandInset label
LatexCommand label
name "code:smd"

\end_inset

 An example 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for steered 
\family typewriter
MD
\family default
.
 Only the relevant part is shown.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Umbrella sampling
\end_layout

\begin_layout Standard
To activate the umbrella sampling code, the 
\begin_inset Index idx
status open

\begin_layout Plain Layout
nfe_pmd
\end_layout

\end_inset


\family typewriter
&pmd
\family default
 namlist must be present in the 
\family typewriter
MDIN
\family default
 file.
\family typewriter
&pmd
\family default
 is currently available to both SANDER and PMEMD, and also can be fully
 applied in GPU accelerated PMEMD.
 
\family typewriter
The output_file
\family default
, 
\family typewriter
output_freq
\family default
 and 
\family typewriter
cv_file
\family default
 entries are recognized just as in the steered 
\family typewriter
MD
\family default
 case presented earlier.
 The 
\family typewriter
cv_file
\family default
 must contain at least one 
\family typewriter
&colvar
\family default
 namelist section.
 For umbrella sampling, the 
\family typewriter
&colvar
\family default
 section(s) must contain two additional entries: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
anchor_position
\series default
:
\begin_inset Index idx
status open

\begin_layout Plain Layout
anchor_postion
\end_layout

\end_inset

 this consists of four real numbers (
\begin_inset Formula $r1,r2,r3,r4$
\end_inset

) that determine the rectangle of the umbrella (harmonic) potential.
 The default value is that all of the 
\begin_inset Formula $r's$
\end_inset

 is set to zero.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
anchor_strength
\series default
:
\begin_inset Index idx
status open

\begin_layout Plain Layout
anchor_strength
\end_layout

\end_inset

 two non-negative real numbers (
\begin_inset Formula $k1,k2$
\end_inset

) that set the harmonic constant for the umbrella (harmonic) potential.
 The default value is zero.
\end_layout

\begin_layout Standard
The umbrella (harmonic) potential 
\begin_inset Formula $U$
\end_inset

 is determined by (supposing 
\begin_inset Formula $R$
\end_inset

 is the value of reaction coordinate)
\end_layout

\begin_layout Itemize
\begin_inset Formula $U=k1*(r1-r2)*R\ \ \ \ \ \ (R\leqslant r1)$
\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $U=0.5*k1*(R-r2)^{2}\ \ \ \ (r1<R\leqslant r2)$
\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $U=0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (r2<R\leqslant r3)$
\end_inset

 
\end_layout

\begin_layout Itemize
\begin_inset Formula $U=0.5*k2*(R-r3)^{2}\ \ \ \ (r3<R\leqslant r4)$
\end_inset

 
\end_layout

\begin_layout Itemize
\begin_inset Formula $U=k2*(r4-r3)*R\ \ \ \ \ \ (R>r4)$
\end_inset

 
\end_layout

\begin_layout Standard
A plot of the umbrella potential is shown below
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename nfe_pmd.eps
	width 50text%

\end_inset


\end_layout

\begin_layout Description
eg1: if 
\begin_inset Formula $r2=r3$
\end_inset

, 
\begin_inset Formula $r1\ll r2$
\end_inset

 and 
\begin_inset Formula $r4\gg r3$
\end_inset

, then the generated 
\begin_inset Formula $U$
\end_inset

 is simply the traditional harmonic potential.
 
\end_layout

\begin_layout Description
eg2: if 
\begin_inset Formula $r1$
\end_inset

 is slightly less than 
\begin_inset Formula $r2$
\end_inset

 and 
\begin_inset Formula $r4$
\end_inset

 is slightly larger than 
\begin_inset Formula $r3$
\end_inset

, also with very large 
\begin_inset Formula $k1$
\end_inset

, 
\begin_inset Formula $k2$
\end_inset

, the reaction coordinate is restrained in the range (
\begin_inset Formula $r2,\,r3$
\end_inset

) with no potential added.
\end_layout

\begin_layout Standard
An example of an 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for an umbrella sampling simulation is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:pmd1"

\end_inset

.
 The first reaction coordinate here is the angle formed by the lines joining
 the 5th with 9th and 9th with 15th atoms.
 It is to be harmonically restrained near 1.0 
\begin_inset Formula $rad$
\end_inset

 (
\family typewriter
anchor_position
\family default
 entry) using the spring of strength 10.0 
\begin_inset Formula $kcal/mol/rad^{2}$
\end_inset

 (
\family typewriter
anchor_strength
\family default
 entry).
 The second reaction coordinate requested in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:pmd1"

\end_inset

 is a dihedral angle (
\family typewriter
type = 'TORSION'
\family default
) formed by the 1st, 2nd, 3rd and 4th atoms (the 
\family typewriter
cv_i
\family default
 array).
 It is to be restrained near zero with strength 23.8 
\begin_inset Formula $kcal/mol/rad^{2}$
\end_inset

.
 The values of the reaction coordinate(s) are to be dumped every 50 
\family typewriter
MD
\family default
 steps to the 
\family typewriter
pmd.txt
\family default
 file.
 Another example of restraining reaction coordinate in a specific range
 is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:pmd2"

\end_inset

.
 The reaction coordinates here are φ and ψ angles of dialanine.
 φ is restrained between -2.0 
\begin_inset Formula $rad$
\end_inset

 and 2.0 
\begin_inset Formula $rad$
\end_inset

, ψ is restrained between -1.8 
\begin_inset Formula $rad$
\end_inset

 and 1.8 
\begin_inset Formula $rad$
\end_inset

.
\end_layout

\begin_layout Standard
The 
\family typewriter
NFE
\family default
 implementation of umbrella sampling works correctly with the Amber standard
 replica-exchange MD described earlier in this manual (compatible with different
 types of REMD for different values of 
\family typewriter
-rem
\family default
 flag in both SANDER and PMEMD).
 For example, the typical umbrella sampling with Hamiltonian Replica Exchange
 can be performed by setting 
\family typewriter
-rem
\family default
 to 3.
 In this case, both 
\family typewriter
anchor_position
\family default
 and 
\family typewriter
anchor_strength
\family default
 may be different for different temperatures.
 Even the number and type of reaction coordinate(s) could vary for different
 replicas.
 The output files (set by the 
\family typewriter
output_file
\family default
 keyword on a per-replica basis) are 
\family typewriter
MDIN
\family default
-bound, consistent with 
\family typewriter
-rem
\family default
.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

title line
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

..., infe = 1
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

&pmd
\end_layout

\begin_layout Plain Layout

   output_file = 'pmd.txt'
\end_layout

\begin_layout Plain Layout

   output_freq = 50
\end_layout

\begin_layout Plain Layout

   cv_file = 'cv.in'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

cv_file
\end_layout

\begin_layout Plain Layout

&colvar ! first
\end_layout

\begin_layout Plain Layout

   cv_type = 'ANGLE'
\end_layout

\begin_layout Plain Layout

   cv_ni = 3, cv_i = 5, 9, 15
\end_layout

\begin_layout Plain Layout

   anchor_position = -10.0,1.0,1.0,10.0
\end_layout

\begin_layout Plain Layout

   anchor_strength = 10.0,10.0
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar ! second
\end_layout

\begin_layout Plain Layout

   cv_type = 'TORSION'
\end_layout

\begin_layout Plain Layout

   cv_ni = 4, cv_i = 1, 2, 3, 4
\end_layout

\begin_layout Plain Layout

   anchor_position = -10.0,0.0,0.0,10.0
\end_layout

\begin_layout Plain Layout

   anchor_strength = 23.8,23.8
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:pmd1"

\end_inset

 An example 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for umbrella sampling (only relevant part is presented in full).
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

cv_file
\end_layout

\begin_layout Plain Layout

&colvar ! phi
\end_layout

\begin_layout Plain Layout

   cv_type = 'TORSION'
\end_layout

\begin_layout Plain Layout

   cv_ni = 4, cv_i = 5, 7, 9, 15
\end_layout

\begin_layout Plain Layout

   anchor_position = -2.05,-2.0,2.0,2.05
\end_layout

\begin_layout Plain Layout

   anchor_strength = 500.0,500.0
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar ! psi
\end_layout

\begin_layout Plain Layout

   cv_type = 'TORSION'
\end_layout

\begin_layout Plain Layout

   cv_ni = 4, cv_i = 7, 9, 15, 17
\end_layout

\begin_layout Plain Layout

   anchor_position = -1.85,-1.8,1.8,1.85
\end_layout

\begin_layout Plain Layout

   anchor_strength = 500.0,500.0
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:pmd2"

\end_inset

 An example 
\family typewriter
CV.IN
\family default
 file to restrain the φ and ψ of dialanine.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Adaptively Biased Molecular Dynamics
\end_layout

\begin_layout Standard
The implementation has a very simple and intuitive interface: the code is
 activated if either an 
\begin_inset Index idx
status open

\begin_layout Plain Layout
nfe_abmd
\end_layout

\end_inset


\family typewriter
&abmd
\family default
 (both SANDER and PMEMD) or an 
\family typewriter
&bbmd
\family default
 (both SANDER and PMEMD) namelist is present in the 
\family typewriter
MDIN
\family default
 file (the difference between those 
\begin_inset Quotes eld
\end_inset

flavors
\begin_inset Quotes erd
\end_inset

 is purely technical and will become clear later).
 Unlike in the 
\family typewriter
&smd
\family default
 and 
\family typewriter
&pmd
\family default
 cases, the dimensionality of a reaction coordinate (the number of 
\family typewriter
&colvar
\family default
 namelists in the 
\family typewriter
cv_file
\family default
) cannot exceed five (though three is already hardly useful due to statistical
 reasons).
\end_layout

\begin_layout Standard
As previously noted, in order to activate the ABMD and related algorithm,
 the variable 
\series bold
\shape italic
infe
\series default
\shape default
 in &cntrl must be set to unity (
\shape italic
i.e.

\shape default
 
\series bold
\shape italic
infe = 
\series default
\shape default
1; default value 
\series bold
\shape italic
infe
\series default
\shape default
 = 0).
\end_layout

\begin_layout Standard
In addition to the 
\family typewriter
cv_file
\family default
 entry, the following entries are recognized within the 
\family typewriter
&abmd
\family default
 (or 
\family typewriter
&bbmd
\family default
) namelist:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
mode
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
mode
\end_layout

\end_inset

 sets the execution mode.
 There are three modes available: 
\family typewriter
'ANALYSIS' | 'UMBRELLA' | 'FLOODING'
\family default
.
 In 
\family typewriter
ANALYSIS
\family default
 mode the dynamics is not altered.
 The only effect of this mode is that the value(s) of the reaction coordinate(s)
 is(are) dumped every 
\family typewriter
monitor_freq
\family default
 to 
\family typewriter
monitor_file
\family default
.
 In 
\family typewriter
UMBRELLA
\family default
 mode, biasing potential from the 
\family typewriter
umbrella_file
\family default
 is used to bias the simulation (
\begin_inset Formula $\tau_{F}=\infty$
\end_inset

, biasing potential does not change).
 In 
\family typewriter
FLOODING
\family default
 mode the adaptive biasing is enabled.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
monitor_file
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
monitor_file
\end_layout

\end_inset

 sets the name of the file to which value(s) of reaction coordinate(s) (along
 with the magnitude of biasing potential in 
\family typewriter
FLOODING
\family default
 mode) are dumped.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
monitor_freq
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
monitor_freq
\end_layout

\end_inset

 the frequency of the output to the 
\family typewriter
monitor_file
\family default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
timescale
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
timescale
\end_layout

\end_inset

 
\begin_inset Formula $\tau_{F}$
\end_inset

, the flooding timescale in picoseconds (only required in 
\family typewriter
FLOODING
\family default
 mode).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
umbrella_file
\series default
 biasing potential file name (the file must exist for the 
\family typewriter
UMBRELLA
\family default
 mode).
 
\end_layout

\begin_layout Standard
In 
\family typewriter
FLOODING
\family default
 mode, the following two entries are optional: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
snapshots_basename
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
snapshots_basename
\end_layout

\end_inset

 sets the name of the file to which the biasing potential is dumped during
 the simulation for snapshot.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
snapshots_freq
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
snapshots_freq
\end_layout

\end_inset

 the frequency of dumping snapshot biasing potential (in MD steps).
 If 
\family typewriter
snapshots_freq
\family default
 is not specified, the snapshot biasing potential will not be dumped.
\end_layout

\begin_layout Standard
and the 
\family typewriter
&colvar
\family default
 namelist for 
\family typewriter
&abmd
\family default
 method must also contain the following entries: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
cv_min
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_min
\end_layout

\end_inset

 smallest desired value of the reaction coordinate (required, unless the
 reaction coordinate is limited from below).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
cv_max
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
cv_max
\end_layout

\end_inset

 largest desired value of the reaction coordinate (required, unless the
 reaction coordinate is limited from above).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
resolution
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
resolution
\end_layout

\end_inset

 the 
\begin_inset Quotes eld
\end_inset

spatial
\begin_inset Quotes erd
\end_inset

 resolution for the reaction coordinate.
\end_layout

\begin_layout Standard
To access the biasing potential files created in the course of 
\family typewriter
FLOODING
\family default
 simulations, the 
\family typewriter
nfe-umbrella-slice
\family default
 utility is provided (it prints a short description of itself if invoked
 with 
\family typewriter
--help
\family default
 option).
\end_layout

\begin_layout Standard
The multiple-walker selection algorithm can improve the simulation by resampling
 between different walkers.
 The well-tempered ABMD can lead to a smoother convergence to the desired
 free energy.
 These two algorithm are implemented to SANDER and PMEMD from Amber16 onwards.
\end_layout

\begin_layout Standard
The multiple-walker selection algorithm currently works with 
\family typewriter
&abmd
\family default
 only.
 The algorithm should be used only within the multiple-walker scheme (
\shape italic
i.e.
\shape default
, when command-line 
\series bold
-rem
\series default
 flag is set to zero).
 The following entries are recognized regarding with the selection algorithm
 (selection algorithm can work with 
\family typewriter
FLOODING 
\family default
and
\family typewriter
 UMBRELLA
\family default
 mode): 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
selection_freq
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
selection_freq
\end_layout

\end_inset

 positive integer number that sets the frequency of the resampling algorithm
 (in MD steps).
 If 
\family typewriter
selection_freq
\family default
 is not specified, the selection algorithm will not be used.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
selection_constant
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
selection_constant
\end_layout

\end_inset

 positive real number that sets the parameter 
\shape italic
C
\shape default
.
 if 
\family typewriter
selection_freq
\family default
 is specified, specifying 
\family typewriter
selection_constant
\family default
 is required (no default value).
 Parameter 
\shape italic
C
\shape default
 is to determine how strong the selection mechanism is.
 If 
\shape italic
C
\shape default
 is too large, all the walkers will be replaced with the most dominant one.
 If 
\shape italic
C
\shape default
 is too small, there will be no killing/duplicating of walkers.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
selection_epsilon
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
selection_epsilon
\end_layout

\end_inset

 positive real number (typically less than unity) that sets the stopping
 criterion parameter ε .
 Parameter ε determines the threshold for stopping the selection algorithm.
 If 
\family typewriter
selection_epsilon
\family default
 is not specified, there will be no stop to the algorithm.
 If 
\family typewriter
selection_epsilon
\family default
 is equal or larger than one, the algorithm will be stopped after the first
 attempt.
 
\end_layout

\begin_layout Standard
The well-tempered flavor can be used within either 
\family typewriter
&abmd
\family default
 or 
\family typewriter
&bbmd
\family default
 namelist.
 There are two entries relevant to the well-tempered feature:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
wt_temperature
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
wt_temperature
\end_layout

\end_inset

 positive real number that sets the pseudo-temperature T'.
 If this flag is not specified, conventional ABMD will be used (
\shape italic
i.e.
\shape default
, T' 
\begin_inset Formula $\rightarrow$
\end_inset

 ∞ or β' 
\begin_inset Formula $\rightarrow$
\end_inset

 0).
 The smaller the T'; the smoother/slower the convergence.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
wt_umbrella_file
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
wt_umbrella_file
\end_layout

\end_inset

 the file name of true biasing potential after modification by 1 + ( T /T'
 ) in which T is the reference temperature of the system (temp0).
 
\end_layout

\begin_layout Standard
An example 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for the 
\family typewriter
&abmd
\family default
 flavor of 
\family typewriter
ABMD
\family default
 is shown in the Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:abmd"

\end_inset

.
 
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

title line
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

..., infe = 1
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

&abmd
\end_layout

\begin_layout Plain Layout

   mode = 'FLOODING'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   monitor_file = 'abmd.txt'
\end_layout

\begin_layout Plain Layout

   monitor_freq = 33
\end_layout

\begin_layout Plain Layout

   cv_file = 'cv.in'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   umbrella_file = 'umbrella.nc'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   timescale = 100.0 ! in ps
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   selection_freq = 10000
\end_layout

\begin_layout Plain Layout

   selection_constant = 0.001
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   wt_temperature = 10000.0
\end_layout

\begin_layout Plain Layout

   wt_umbrella_file = 'wt_umbrella.nc'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

cv_file
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

  cv_type = 'DISTANCE'
\end_layout

\begin_layout Plain Layout

  cv_ni = 2, cv_i = 5, 9
\end_layout

\begin_layout Plain Layout

  cv_min = -1.0, cv_max = 10.0 ! min is not needed for DISTANCE
\end_layout

\begin_layout Plain Layout

  resolution = 0.5 ! required for mode = FLOODING
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:abmd"

\end_inset

 An example 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for 
\family typewriter
ABMD
\family default
 (only the relevant part is presented in full).
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
In this example, the reaction coordinate is defined as the distance between
 the 5th and 9th atoms (more than one reaction coordinates might be requested
 by mere inclusion of additional 
\family typewriter
&colvar
\family default
 subsections).
 The 
\family typewriter
mode
\family default
 is set to 
\family typewriter
FLOODING
\family default
 thus enabling the adaptive biasing with flooding timescale 
\begin_inset Formula $\tau_{F}=100ps$
\end_inset

.
 The region of interest of the reaction coordinate is specified to be between
 -1 Å
\begin_inset space ~
\end_inset

and 10 Å and the resolution is set to 0.5 Å.
 The lower bound (-1 Å) could have been omitted for 
\family typewriter
DISTANCE
\family default
 variable: the default value of zero would be used in such case.
 The code will try to load the biasing potential from the 
\family typewriter
umbrella.nc
\family default
 file and use it as the value of 
\begin_inset Formula $U(t|\xi)$
\end_inset

 at the beginning of the run.
 The biasing potential built in the course of simulation will be saved to
 the same file (
\family typewriter
umbrella.nc
\family default
) every time the 
\family typewriter
RESTRT
\family default
 file is written.
 The selection algorithm is used with the frequency of selection defined
 as 10000 MD steps and selection constant defined as 0.001.
 The well-tempered algorithm is also used, with the pseudo-temperature defined
 as 10000 K in and the true biasing potential will be dumped as 
\family typewriter
wt_umbrella.nc
\family default
 file.
 The 
\family typewriter
nfe-umbrella-slice
\family default
 utility can then be used to access its content.
 An 
\family typewriter
MDIN
\family default
 file for the follow up biased run at equilibrium would look much like the
 one shown in the Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:abmd"

\end_inset

, but with 
\family typewriter
mode
\family default
 changed from 
\family typewriter
FLOODING
\family default
 to 
\family typewriter
UMBRELLA
\family default
.
\end_layout

\begin_layout Standard
Driven ABMD can be performed using &smd block (for the SMD part of the algorithm
) along with &abmd block (for the ABMD part of the algorithm).
 There is no additional flag for the &smd block relevant to the algorithm;
 however, there are two additional flags to ABMD relevant to the “driven”
 feature.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
driven_weight
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
driven_weight
\end_layout

\end_inset

 string that sets the weighting scheme.
 The default option (i.e., not using the flag) is NONE which indicates no
 reweighting is used (NOT RECOMMENDED if SMD is performed along ABMD).
 Other options include CONSTANT and PULLING for constant and pulling reweighting
 protocols.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
driven_cutoff
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
driven_cutoff
\end_layout

\end_inset

 positive real number that sets a cutoff for work for applying the reweighting
 algorithm (default: 0.0).
 If the work (accumulated or transferred depending on the scheme) at any
 given time is lower than the cutoff, no reweighting is done at that particular
 time.
 If the cutoff is too small, it may result in instability of the algorithm.
\end_layout

\begin_layout Standard
For both SANDER and PMEMD since Amber18, the 
\family typewriter
&abmd
\family default
 code works correctly with Amber replica-exchange  similar with 
\family typewriter
&pmd
\family default
 (that is, for 
\family typewriter
-rem
\family default
 flag set to different values).
 If
\family typewriter
-rem
\family default
 is set to 3, ABMD with replica-exchange is carried out.
 In such case  different replicas can have different temperatures, collective
 variables and even different 
\family typewriter
mode
\family default
.The monitor and umbrella files are 
\family typewriter
MDIN
\family default
-bound.
 If number of 
\family typewriter
sander
\family default
 groups exceeds one (the flag 
\family typewriter
-ng
\family default
 is greater than one) and 
\family typewriter
-rem
\family default
 flag is set to zero, the code runs 
\shape italic
multiple walkers
\shape default
 
\family typewriter
ABMD
\family default
.
 In both cases the number and type(s) of variable(s) must be the same across
 all replicas.
\end_layout

\begin_layout Standard
Finally, the 
\begin_inset Index idx
status open

\begin_layout Plain Layout
nfe_bbmd
\end_layout

\end_inset


\family typewriter
&bbmd
\family default
 flavor allows one to run replica-exchange (
\family typewriter
AB
\family default
)
\family typewriter
MD
\family default
 with different reaction coordinates and different modes (
\family typewriter
ANALYSIS
\family default
, 
\family typewriter
UMBRELLA
\family default
 or 
\family typewriter
FLOODING
\family default
) in different replicas (along with different temperatures, if desired).
 This module is outdated since 
\family typewriter
&abmd
\family default
 has been compatible with 
\family typewriter
-rem
\family default
 equals 3.
 The only advantage of 
\family typewriter
&bbmd
\family default
 is that the number of replicas can be odd numbers if desired by runs, while
 this cannot be achieved in any 
\family typewriter
-rem
\family default
 types.
 To applying 
\family typewriter
&bbmd
\family default
 module, the 
\family typewriter
-rem
\family default
 flag must be set to zero and the 
\family typewriter
&bbmd
\family default
 sections must be present in all 
\family typewriter
MDIN
\family default
 files.
 The 
\family typewriter
MDIN
\family default
 file for the replica of rank zero (first line in the group file) is expected
 to contain additional information as compared to 
\family typewriter
&abmd
\family default
 case (an example of such 
\family typewriter
MDIN
\family default
 file for replica zero is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:bbmd"

\end_inset

).
 The 
\family typewriter
MDIN
\family default
 files for all other replicas except zero do not need any additional information
, and therefore take the same form as in the 
\family typewriter
&abmd
\family default
 flavor (except that the namelist is changed from 
\family typewriter
&abmd
\family default
 to 
\family typewriter
&bbmd
\family default
, thus activating a slightly different code path).
 Each 
\family typewriter
MDIN
\family default
 file may define its own reaction coordinates, have different 
\family typewriter
mode
\family default
 and temperature if desired.
 
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

title line
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

..., infe = 1
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

&bbmd
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! 0th replica only
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   exchange_freq = 100 ! try for exchange every 100 steps
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   exchange_log_file = 'bbmd.log'
\end_layout

\begin_layout Plain Layout

   exchange_log_freq = 25
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   mt19937_seed = 123455 ! random generator seed
\end_layout

\begin_layout Plain Layout

   mt19937_file = 'mt19937.nc' ! file to store/load the PRG
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   ! not specific for 0th replica
\end_layout

\begin_layout Plain Layout

 
\end_layout

\begin_layout Plain Layout

   mode = 'ANALYSIS'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

   monitorfile = 'bbmd.01.txt' ! it is wise to have different
\end_layout

\begin_layout Plain Layout

                               ! names in different replicas
\end_layout

\begin_layout Plain Layout

   monitor_freq = 123
\end_layout

\begin_layout Plain Layout

   cv_file = 'cv.in'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

cv_file
\end_layout

\begin_layout Plain Layout

&colvar
\end_layout

\begin_layout Plain Layout

  cv_type = 'DISTANCE'
\end_layout

\begin_layout Plain Layout

  cv_ni = 2, cv_i = 5, 9
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:bbmd"

\end_inset

 An example 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for 
\family typewriter
&bbmd
\family default
 flavor of 
\family typewriter
ABMD
\family default
 (only the relevant part is presented in full).
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Within the first replica 
\family typewriter
&bbmd
\family default
 namelist the following additional entries are recognized: 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
exchange_freq
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
exchange_freq
\end_layout

\end_inset

 number of 
\family typewriter
MD
\family default
 steps between the exchange attempts.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
exchange_log_file
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
exchange_log_file
\end_layout

\end_inset

 the name of the file to which exchange statistics is to be reported.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
exchange_log_freq
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
exchange_log_freq
\end_layout

\end_inset

 frequency of 
\family typewriter
exchange_log_file
\family default
 updates.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
mt19937_seed
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
mt19937_seed
\end_layout

\end_inset

 seed for the random generator (Mersenne twister
\begin_inset space ~
\end_inset


\begin_inset CommandInset citation
LatexCommand cite
key "Matsumoto1998"
literal "true"

\end_inset

).
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
mt19937_file
\series default

\begin_inset Index idx
status open

\begin_layout Plain Layout
mt19937_file 
\end_layout

\end_inset

 the name of the file to which the state of the Mersenne twister is dumped
 periodically (for restarts).
 
\end_layout

\begin_layout Standard
The 
\family typewriter
MDOUT
\family default
, 
\family typewriter
MDCRD
\family default
, 
\family typewriter
RESTRT
\family default
, 
\family typewriter
umbrella_file
\family default
 and 
\family typewriter
monitor_file
\family default
 files are 
\family typewriter
MDIN
\family default
-bound in course of the 
\family typewriter
bbmd
\family default
-enabled run.
 An example that uses this kind of replica exchange is presented in Ref.
\begin_inset CommandInset citation
LatexCommand citealp
key "Babin_V_10"
literal "true"

\end_inset

.
\end_layout

\begin_layout Subsection
Swarms-of-Trajectories String Method
\end_layout

\begin_layout Standard
ABMD is a robust method for calculating free energy landscapes as a function
 of a small number of collective variables.
 Since the required computer time grows enormously with the number of collective
 variables, ABMD is best for exploring one- or two-dimensional phase spaces.
 However, rather than calculating full n-dimensional free energy maps, it
 is often fruitful to focus on the so-called Minimum Free Energy Path (MFEP)
 which the system is likely to take when transitioning between two minima.
 Calculating a MFEP in a complicated phase space is often difficult, and
 so-called ''string methods"
\begin_inset CommandInset citation
LatexCommand citep
key "Maragliano_L_06"
literal "true"

\end_inset


\begin_inset CommandInset citation
LatexCommand citep
key "Pan_A_08"
literal "true"

\end_inset

 represent one of the best approaches for finding the MFEP.
 Since sampling in string methods is essentially limited to regions around
 the MFEP, the cost of the method scales linearly with the length of the
 string or path, but only weakly on the number of collective variables.
 This results in considerable computational savings since the full free
 energy landscape is not calculated.
\end_layout

\begin_layout Standard
The swarms-of-trajectories string method (STSM)
\begin_inset CommandInset citation
LatexCommand citep
key "Pan_A_08"
literal "true"

\end_inset

 
\begin_inset Index idx
status open

\begin_layout Plain Layout
nfe_stsm
\end_layout

\end_inset

is one of the most popular versions of the string method and has been implemente
d here by Dr.
 Moradi (moradi@uark.edu).
 The module is available in both SANDER and PMEMD from Amber18 onwards.
 It is a path-finding algorithm that refines a putative transition pathway
 iteratively until the path is deemed to have been converged.
 The string is defined by a number of nodes or images parameterized in a
 high-dimensional space of collective variables, whose position is updated
 iteratively.
 The center of each image is first used as a restraining center to generate
 representative conformations at the current center before allowing of a
 small change in this center for the next iteration.
 The change in the center of each image is estimated by averaging over the
 drifts of a swarm of short unbiased trajectories all starting at the current
 image position (generated using the constrained simulations.
 Thus, each iteration consists of a series of restrained and free simulations.
 In the current serial version of the code, these simulations are performed
 independently.
 In parallel versions -- which are more efficient -- a very large number
 of replicas is required which are run in parallel; this method is particularly
 efficient on large supercomputers.
\end_layout

\begin_layout Standard
To invoke the swarms-of-trajectories string method, the 
\family typewriter
&stsm
\family default
 must be invoked in the 
\family typewriter
MDIN
\family default
 file.
 For a string consisting of 
\begin_inset Formula $N_{s}$
\end_inset

 nodes each requiring 
\begin_inset Formula $M$
\end_inset

 copies 
\begin_inset Formula $N_{s}\times M$
\end_inset

 replicas will be required.
 The parallel implemention of the STSM method is based on iterative restrained
 and free MD simulations followed by a reparametrization of the image centers
 defined in a multidimensional collective variable space 
\begin_inset Formula $\xi$
\end_inset

.
 For the 
\begin_inset Formula $i^{th}$
\end_inset

 iteration, first 
\begin_inset Formula $M$
\end_inset

 copies of the 
\begin_inset Formula $n^{th}$
\end_inset

 image are generated around the old center 
\begin_inset Formula $\xi_{n}^{i-1}$
\end_inset

 by MD equilibration lasting 
\begin_inset Formula $\tau_{E}$
\end_inset

 timesteps.
 The generated 
\begin_inset Formula $M$
\end_inset

 copies of the 
\begin_inset Formula $n^{th}$
\end_inset

 image are expected to be close to 
\begin_inset Formula $\xi_{n}^{i-1}$
\end_inset

 for time 
\begin_inset Formula $\tau_{E}$
\end_inset

, assuming that the invoked harmonic constant 
\begin_inset Formula $k$
\end_inset

 for the restraining potential is large enough.
 The parameters 
\begin_inset Formula $\tau_{E}$
\end_inset

 and 
\begin_inset Formula $k$
\end_inset

 thus need to be appropriately chosen in order to ensure that all copies
 of each image will be close to the image center.
 The restraint is then released, and each copy (swarm) is allowed to drift
 for 
\begin_inset Formula $\tau_{R}$
\end_inset

 timesteps.
 The newly shifted center 
\begin_inset Formula $\xi_{n}^{i}$
\end_inset

 for the 
\begin_inset Formula $n^{th}$
\end_inset

 image is then determined by averaging over all drifted copies 
\begin_inset Formula $\xi_{n,m}^{t}$
\end_inset

 at time 
\begin_inset Formula $t=\tau_{E}+\tau_{R}$
\end_inset

.
 The resulting string of images is then smoothed using a linear interpolation
 protocol.
 A smoothing parameter 
\begin_inset Formula $\epsilon$
\end_inset

 with 
\begin_inset Formula $0\leq\epsilon\leq1$
\end_inset

 determines the smoothness of the curve; it is recommended that 
\begin_inset Formula $\epsilon$
\end_inset

 be of the order of 
\begin_inset Formula $1/(N_{s}-1)$
\end_inset

.
 The last setep is a reparameterization, which gain follows a linear interpolati
on protocol in order to generate 
\begin_inset Formula $N_{s}$
\end_inset

 equidistant centers along the string.
 The two key parameters of the method are 
\begin_inset Formula $M$
\end_inset

 and 
\begin_inset Formula $\tau_{R}$
\end_inset

.
 Generally, the large the 
\begin_inset Formula $M$
\end_inset

 and the shorter 
\begin_inset Formula $\tau_{R}$
\end_inset

, the smoother (but slower) the evolution of the MFEP will be.
 These variables must be optimized empirically, but typically 10 - 30 copies
 and 5 - 20 ps are reasonable values.
 It is often advantageous to set 
\begin_inset Formula $\tau_{E}$
\end_inset

 = 
\begin_inset Formula $\tau_{R}$
\end_inset

.
\end_layout

\begin_layout Standard
An improved sequential repeat version of the algorithm has also been implemented
, which avoids the large number of copies and does not require a large number
 of processors to run.
 Here a new variable 
\begin_inset Formula $N_{R}$
\end_inset

 is introduced, as the number of repeat runs for each replica.
 Now for each copy, it will run around the old center 
\begin_inset Formula $\xi_{n}^{i-1}$
\end_inset

 for 
\begin_inset Formula $N_{R}$
\end_inset

 times sequentially.
 And each repeat run can be equally considered as a parallel run of a new
 copy around the old center.
 Namely, the new shifted center will be determined by averaging on 
\begin_inset Formula $N_{R}\times M$
\end_inset

 copies.
 So the number of processors needed will be reduced to 
\begin_inset Formula $1/N_{R}$
\end_inset

, while the running time will be multipled by 
\begin_inset Formula $N_{R}$
\end_inset

.
\end_layout

\begin_layout Standard
The following is recognized within the &stsm namelist:
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
image
\begin_inset Index idx
status open

\begin_layout Plain Layout
image
\end_layout

\end_inset


\series default
 positive integer number that sets the image id (between 1 and N).
 Default is 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
repeats
\begin_inset Index idx
status open

\begin_layout Plain Layout
repeats
\end_layout

\end_inset


\series default
 positive integer number that sets the number of repeat runs, should be
 the same for each image and each copy.
 Equal to parallel implementation when not set.
 Default is 1.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
equilibration
\begin_inset Index idx
status open

\begin_layout Plain Layout
equilibration
\end_layout

\end_inset


\series default
 non-negative integer number that sets the number of MD steps specified
 for biased equlibration (restraining) at each iteration.
 Default is 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
release
\begin_inset Index idx
status open

\begin_layout Plain Layout
release
\end_layout

\end_inset


\series default
 Number of MD steps specified for the release (drift) at each iteration.
 Note: the total number of iterations is determined by the total simulation
 time (
\family typewriter
nstlim
\family default
 flag in 
\family typewriter
mdin
\family default
 file) divided by total time for each iteration given by 
\family typewriter
equilibration
\family default
+
\family typewriter
release
\family default
.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
smoothing
\begin_inset Index idx
status open

\begin_layout Plain Layout
smoothing
\end_layout

\end_inset


\series default
 positive number that sets the smoothing parameter for reparametrization
 (between 0 and 1).
 Smoothing parameter should be, preferably, on the order of 
\begin_inset Formula $1/(N_{s}-1)$
\end_inset

.
 If this flag is not used, no smoothing will be performed.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000

\series bold
report_centers
\begin_inset Index idx
status open

\begin_layout Plain Layout
report_centers
\end_layout

\end_inset


\series default
 a string that determines if drifted and/or smoothed and/or reparametrized
 centers will be reported.
 The default value is 
\family typewriter
NONE
\family default
 and other available options include 
\family typewriter
ALL
\family default
,
\family typewriter
DRIFT
\family default
,
\family typewriter
SMOOTHED
\family default
, 
\family typewriter
REPARAMETRIZED
\family default
, 
\family typewriter
NO_DRIFT
\family default
, 
\family typewriter
NO_SMOOTHED
\family default
, 
\family typewriter
NO_REPARAMETRIZED
\family default
.
\end_layout

\begin_layout Standard

\family typewriter
The output_file
\family default
, 
\family typewriter
output_freq
\family default
 and 
\family typewriter
cv_file
\family default
 entries are recognized just as 
\family typewriter
&smd
\family default
 and 
\family typewriter
&pmd
\family default
, the information of reaction coordinates will be read from 
\family typewriter
cv_file
\family default
.
 The number of collective variables can not exceed five.
 (here be attention that the 
\family typewriter
anchor_postion
\family default
 and 
\family typewriter
anchor_strength
\family default
 will be defined using the traditional harmonical potential, different with
 
\family typewriter
&pmd
\family default
!).
 An example of 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for STSM in parallel case is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:stsm1"

\end_inset

.
 Here we run 8 images along the path, with 
\family typewriter
I
\family default
 defining the image ID.
 We run 980 MD steps for equlibration and 20 MD steps release at each iteration,
 so there are totally 1000 MD steps for each iteration.
 With nstlim set to 10000, 10 iterations will be carried out.
 The smoothing parameter is set to 0.1 and all the centers will be reported.
 For each image, 16 copies will be run in parallel, with 
\family typewriter
J
\family default
 defining the copy ID.
 The evolution of reaction coordinate will recorded in the file 
\family typewriter
stsm.00I.J.txt
\family default
.
 For this run, at least 
\begin_inset Formula $128(8\times16)$
\end_inset

 processors are needed.
 Another example of 
\family typewriter
MDIN
\family default
 file of equivalent sampling level in sequential case is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:stsm2"

\end_inset

.
 Here we still have 8 images to run.
 We set the number of repeats to be 16, namely 16 repeat runs for each image
 to get the new drifted center.
 Therefore, 16000 MD steps are needed for one iteration, and so we set nstlim
 to 160000 to complete 10 iterations.
 For this run, 8 processors are needed at least.
 
\end_layout

\begin_layout Standard
Part of sample 
\family typewriter
MDOUT
\family default
 file is shown in Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "code:stsm3"

\end_inset

.
 The restoring restraint part will be only in sequential run, since the
 restraint needs to be restored after each repeat.
 The values of reaction coordinates before reporting centers are the averaged
 value over repeats for this copy and the instantaneous value.
 All the centers will be reported only in the 
\family typewriter
MDOUT
\family default
 file of first copy of first image.
 The drifted centers are the averaged value over copies, and also the smoothed
 ans reparametrized centers can be reported.
 Always the reparametrized centers will be extracted to draw the MFEP in
 the phase space.
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

title line
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

..., nstlim = 10000
\end_layout

\begin_layout Plain Layout

..., infe = 1
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

&stsm      ! parallel case, I from 1 to 8, J from 1 to 16
\end_layout

\begin_layout Plain Layout

  image = I 
\end_layout

\begin_layout Plain Layout

  equilibration = 980   
\end_layout

\begin_layout Plain Layout

  release = 20   
\end_layout

\begin_layout Plain Layout

  smoothing = 0.1   
\end_layout

\begin_layout Plain Layout

  report_centers = 'ALL'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  output_file = 'stsm.00I.J.txt'  
\end_layout

\begin_layout Plain Layout

  output_freq = 10   
\end_layout

\begin_layout Plain Layout

  cv_file = 'cv.I'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

cv_file
\end_layout

\begin_layout Plain Layout

&colvar ! phi
\end_layout

\begin_layout Plain Layout

   cv_type = 'TORSION'
\end_layout

\begin_layout Plain Layout

   cv_ni = 4, cv_i = 5, 7, 9, 15
\end_layout

\begin_layout Plain Layout

   anchor_position = -3.00
\end_layout

\begin_layout Plain Layout

   anchor_strength = 20.0
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&colvar ! psi
\end_layout

\begin_layout Plain Layout

   cv_type = 'TORSION'
\end_layout

\begin_layout Plain Layout

   cv_ni = 4, cv_i = 7, 9, 15, 17
\end_layout

\begin_layout Plain Layout

   anchor_position = 3.00
\end_layout

\begin_layout Plain Layout

   anchor_strength = 20.0
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:stsm1"

\end_inset

 An example 
\family typewriter
MDIN
\family default
 file and 
\family typewriter
CV.IN
\family default
 file for 
\family typewriter
&stsm
\family default
 in parallel case (only the relevant part is presented in full)
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

title line
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

..., nstlim = 160000
\end_layout

\begin_layout Plain Layout

..., infe = 1
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

&stsm      ! sequential case, I from 1 to 8
\end_layout

\begin_layout Plain Layout

  image = I
\end_layout

\begin_layout Plain Layout

  repeats = 16
\end_layout

\begin_layout Plain Layout

  equilibration = 980   
\end_layout

\begin_layout Plain Layout

  release = 20   
\end_layout

\begin_layout Plain Layout

  smoothing = 0.1   
\end_layout

\begin_layout Plain Layout

  report_centers = 'ALL'
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

  output_file = 'stsm.00I.txt'   
\end_layout

\begin_layout Plain Layout

  output_freq = 10   
\end_layout

\begin_layout Plain Layout

  cv_file = 'cv.I'
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:stsm2"

\end_inset

 An example 
\family typewriter
MDIN
\family default
 file for 
\family typewriter
&stsm
\family default
 in sequential case (only the relevant part is presented in full) 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement tbh!
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

NFE : #   restoring restraint:  
\end_layout

\begin_layout Plain Layout

NFE : #   << colvar(1) = -3.000000 >>  
\end_layout

\begin_layout Plain Layout

NFE : #   << colvar(2) = 3.000000 >> 
\end_layout

\begin_layout Plain Layout

NFE : #   equilibration begins...
    
\end_layout

\begin_layout Plain Layout

......
\end_layout

\begin_layout Plain Layout

NFE : #   << colvar(1) = -2.500688 -2.586429 >>  
\end_layout

\begin_layout Plain Layout

NFE : #   << colvar(2) = 2.782725 3.082205 >>  
\end_layout

\begin_layout Plain Layout

NFE : #  drifted center of image 1 :            8      -2.54041796      
 2.70644813  
\end_layout

\begin_layout Plain Layout

NFE : #  drifted center of image 2 :            8      -2.54963153      
 2.71715138  
\end_layout

\begin_layout Plain Layout

......
\end_layout

\begin_layout Plain Layout

NFE : #  drifted center of image 8 :            8       1.02191205      
 0.16837852  
\end_layout

\begin_layout Plain Layout

NFE : #  smoothed center of image 1 :            8      -2.54041796     
  2.70644813  
\end_layout

\begin_layout Plain Layout

NFE : #  smoothed center of image 2 :            8      -2.60416697     
  2.75924174  
\end_layout

\begin_layout Plain Layout

......
\end_layout

\begin_layout Plain Layout

NFE : #  smoothed center of image 8 :            8       1.02191205     
  0.16837852  
\end_layout

\begin_layout Plain Layout

NFE : #  reparametrized center of image 1 :            8      -2.54041796
       2.70644813  
\end_layout

\begin_layout Plain Layout

NFE : #  reparametrized center of image 2 :            8      -2.06027108
       2.47738701  
\end_layout

\begin_layout Plain Layout

......
\end_layout

\begin_layout Plain Layout

NFE : #  reparametrized center of image 8 :            8       1.02191205
       0.16837852
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "code:stsm3"

\end_inset

 An example of 
\family typewriter
MDOUT
\family default
 file for STSM run (only part is presented, and some centers are also omitted)
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Post-processing of biasing potential 
\begin_inset CommandInset label
LatexCommand label
name "subsec:Post-processing-of-biasing"

\end_inset


\end_layout

\begin_layout Standard
When you get the biasing potential (
\family typewriter
*.nc
\family default
 file), you can always use the 
\family typewriter
nfe-umbrella-slice
\family default
 utility to access its content and get a friendly-written ASCII file from
 which one can obtain the free energy map.
 The output is the free energy value, which is the opposite of the biasing
 potential ( 
\begin_inset Formula $f=-U$
\end_inset

 (
\begin_inset Formula $units~kcal/mol$
\end_inset

)).
 The 
\family typewriter
nfe-umbrella-slice
\family default
 utility has been included in AmberTools.
\end_layout

\begin_layout Description
\paragraph_spacing onehalf
Usage: 
\family typewriter
nfe-umbrella-slice [options] bias_potential.nc
\end_layout

\begin_layout Description
\paragraph_spacing onehalf
Options:
\end_layout

\begin_layout Description

\family typewriter
-h,--help
\family default
 Print out a usage summary
\end_layout

\begin_layout Description

\family typewriter
-p,--pretend
\family default
 Only print out the basic properties of source without biasing potential
 data (off by default)
\end_layout

\begin_layout Description

\family typewriter
-g,--gradient
\family default
 Print out the gradients (off by default)
\end_layout

\begin_layout Description

\family typewriter
-r,--reset
\family default
 Set the value of minimum to zero (off by default)
\end_layout

\begin_layout Description

\family typewriter
-t,--translate
\family default
 Translate the numerical value of biasing potential by a real number (0
 by default)
\end_layout

\begin_layout Description

\family typewriter
-d,--dimensions
\family default
 Set the way of slice in different dimensions.
 The format is 
\begin_inset Quotes eld
\end_inset

D1:D2:...:Dn
\begin_inset Quotes erd
\end_inset

, where n is the number of dimensions.
 Each D can only be set with one number or three numbers separated by commas.
 If only one number is set, the variable will be fixed at that value.
 If three numbers are set, the first two define the boundary of the slice
 and the last one defines the number of points.
 
\end_layout

\begin_layout Description
Example:
\end_layout

\begin_layout Itemize

\family typewriter
nfe-umbrella-slice -r -d 
\begin_inset Quotes eld
\end_inset

-5.0,5.0,50
\begin_inset Quotes erd
\end_inset

 1d-bias.nc > FE.dat
\end_layout

\begin_layout Standard
This processes the 1-dimensional biasing potential file 
\family typewriter
1d-bias.nc
\family default
 and prints out the results to 
\family typewriter
FE.dat
\family default
.
 The minimum of free energy will be set to zero.
  The variable will be taken from -5.0 to 5.0 using 50 points.
\end_layout

\begin_layout Itemize

\family typewriter
nfe-umbrella-slice -g -t 50.0 -d 
\begin_inset Quotes eld
\end_inset

1.0:-2.0,2.0,20
\begin_inset Quotes erd
\end_inset

 2d-bias.nc > FE.dat
\end_layout

\begin_layout Standard
This processes the 2-dimensional biasing potential file 
\family typewriter
2d-bias.nc
\family default
 and prints out the results to 
\family typewriter
FE.dat
\family default
.
 All the free energy will be incremented by a constant 50.0.
 The gradients in both dimensions will be printed out.
 For the first dimension, the variable will be fixed at 1.0; for the second
 dimension, the variable will be taken from -2.0 to 2.0 using 20 points.
 
\end_layout

\begin_layout Itemize

\family typewriter
nfe-umbrella-slice wt_umbrella.nc > wt_FE.dat
\end_layout

\begin_layout Standard
This processes the biasing potential after WT-ABMD and prints out the results
 to 
\family typewriter
wt_FE.dat
\family default
.
 The default dimensional information is obtained and used by the program
 from the biasing potential file.
\end_layout

\begin_layout Chapter

\series bold
NMR refinement
\begin_inset CommandInset label
LatexCommand label
name "chap:NMR"

\end_inset


\end_layout

\begin_layout Standard
We find the 
\shape italic
sander
\shape default
 module to be a flexible way of incorporating a variety of restraints into
 a optimization procedure that includes energy minimization and dynamical
 simulated annealing.
 The "standard" sorts of NMR restraints, derived from NOE and J-coupling
 data, can be entered in a way very similar to that of programs like DISGEO,
 DIANA or X-PLOR; an aliasing syntax allows for definitions of pseudo-atoms,
 connections with peak numbers in spectra, and the use of "ambiguous" constraint
s from incompletely-assigned spectra.
 More "advanced" features include the use of time-averaged constraints,
 use of multiple copies (LES) in conjunction with NMR refinement, and direct
 refinement against NOESY intensities, paramagnetic and diamagnetic chemical
 shifts, or residual dipolar couplings.
 In addition, a key strength of the program is its ability to carry out
 the refinements (usually near the final stages) using an explicit-solvent
 representation that incorporates force fields and simulation protocols
 that are known to give pretty accurate results in many cases for unconstrained
 simulations; this ability should improve predictions in regions of low
 constraint density and should help reduce the number of places where the
 force field and the NMR constraints are in "competition" with one another.
\end_layout

\begin_layout Standard
Since there is no generally-accepted "recipe" for obtaining solution structures
 from NMR data, the comments below are intended to provide a guide to some
 commonly-used procedures.
 Generally speaking, the programs that need to be run to obtain NMR structures
 can be divided into three parts:
\end_layout

\begin_layout Enumerate

\shape italic
front-end
\shape default
 modules, which interact with NMR databases that provide information about
 assignments, chemical shifts, coupling constants, NOESY intensities, and
 so on.
 We have tried to make the general format of the input straightforward enough
 so that it could be interfaced to a variety of programs.
 We generally use the FELIX and NMRView codes, but the principles should
 be similar for other ways of keeping track of a database of NMR spectral
 information.
 As the flow-chart in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:nmr-to-rst"

\end_inset

 indicates, there are only a few files that need to be created for NMR restraint
s; these are indicated by the solid rectangles.
 The primary distance and torsion angle files have a fairly simple format
 that is largely compatible with the DIANA programs; if one wishes to use
 information from ambiguous or overlapped peaks, there is an additional
 "MAP" file that makes a translation from peak identifiers to ambiguous
 (or partial) assignments.
 Finally, there are some specialized (but still pretty straightforward)
 file formats for chemical shift or residual dipolar coupling restraints.
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Standard
There are a variety of tools, besides the ones described below, that can
 assist in preparing input for structure refinement in Amber.
\end_layout

\begin_layout Itemize
The SANE (Structure Assisted NOE Evaluation) package, 
\emph on
https://ambermd.org/sane.zip
\emph default
, is widely used at The Scripps Research Institute.
\begin_inset CommandInset citation
LatexCommand cite
key "Duggan01"
literal "true"

\end_inset

 
\end_layout

\begin_layout Itemize
If you use Bruce Johnson's NmrView package, you might also want to look
 at the additions to that: 
\emph on
http://garbanzo.scripps.edu/nmrgrp/wisdom/pipe/tips_scripts.html
\emph default
.
 In particular, the 
\shape italic
xpkTOupl
\shape default
 and 
\shape italic
starTOupl
\shape default
 scripts there convert NmrView peak lists into the "7-column" needed for
 input to makeDIST_RST.
\end_layout

\begin_layout Itemize
Users of the MARDIGRAS programs from UCSF can use the 
\shape italic
mardi2amber
\shape default
 program to do conversion to Amber format: 
\emph on
http://picasso.ucsf.edu/mardihome.html
\end_layout

\end_deeper
\begin_layout Enumerate

\shape italic
restrained molecular dynamics,
\shape default
 which is at the heart of the conformational searching procedures.
 This is the part that 
\shape italic
sander
\shape default
 itself handles.
\end_layout

\begin_layout Enumerate

\shape italic
back-end
\shape default
 routines that do things like compare families of structures, generate statistic
s, simulate spectra, and the like.
 For many purposes, such as visualization, or the running of procheck-NMR,
 the "interface" to such programs is just the set of PDB files that contain
 the family of structures to be analyzed.
 These general-purpose structure analysis programs are available in many
 locations and are not discussed here.
 The principal 
\shape italic
sander
\shape default
-specific tool is 
\shape italic
sviol
\shape default
, which prepares tables and statistics of energies, restraint violations,
 and the like.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:disang"

\end_inset


\series bold
Distance, angle and torsional restraints
\end_layout

\begin_layout Standard
Distance, angle, and other restraints are read from the DISANG file if 
\shape italic
nmropt
\shape default
 
\begin_inset Formula $>$
\end_inset

 0.
 Namelist rst ("&rst") contains the following variables; it is read repeatedly
 until a namelist &rst statement is found with IAT(1)=0, or until reaching
 the end of the DISANG file.
\end_layout

\begin_layout Standard
[In many cases, the user will not prepare this section of the input by hand,
 but will use the auxiliary programs 
\shape italic
makeDIST_RST, makeANG_RST
\shape default
 and 
\shape italic
makeCHIR_RST
\shape default
 to prepare input from simpler files.
 See also the programs 
\emph on
cyanarest_to_amberRST
\emph default
 and 
\emph on
nef_to_RST
\emph default
 if you have restraints in Cyana or NEF (NMR Exchange Format) formats.]
\end_layout

\begin_layout Subsection

\series bold
Variables in the
\series default
 &rst 
\series bold
namelist:
\series default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iat(1)
\begin_inset Formula $\to$
\end_inset

iat
\begin_inset Index idx
status open

\begin_layout Plain Layout
iat
\end_layout

\end_inset

(8) 
\end_layout

\begin_layout Itemize

\shape italic
If IRESID = 0 (normal operation):
\shape default
 The atoms defining the restraint.
 Type of restraint is determined (in order) by:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Enumerate
If IAT(3) = 0, this is a distance restraint.
 
\end_layout

\begin_layout Enumerate
If IAT(4) = 0, this is an angle restraint.
\end_layout

\begin_layout Enumerate
If IAT(5) = 0, this is a torsional (or J-coupling, if desired) restraint
 or a genereralized distance restraint of 4 atoms, a type of restraint new
 as of Amber 10 (
\shape italic
sander
\shape default
 only, see below).
 
\end_layout

\begin_layout Enumerate
If IAT(6) = 0, this is a plane-point angle restraint, a second restraint
 new as of Amber 10 (
\shape italic
sander
\shape default
 only).
 The angle is measured between the normal of a plane defined by IAT(1)..IAT(4)
 and the vector from the center of mass of atoms IAT(1)..IAT(4) to the position
 of IAT(5).
 The normal is defined by (r1 - r2) 
\begin_inset Formula $\times$
\end_inset

 (r3 - r4), where rn is the position of IAT(n).
\end_layout

\begin_layout Enumerate
If IAT(7) = 0, this is a generalized distance restraint of 6 atoms (see
 below).
\end_layout

\begin_layout Enumerate
Otherwise, if IAT(1)..IAT(8) are all nonzero, this is a plane- plane angle
 restraint, a third new restraint type as of Amber 10 (
\shape italic
sander
\shape default
 only, or a generalized distance restraint of 8 atoms (see below).
 For the plane-plane restraint, the angle is measured between the two normals
 of the two planes, which are defined by (r1 - r2) 
\begin_inset Formula $\times$
\end_inset

 (r3 - r4) and (r5 - r6) 
\begin_inset Formula $\times$
\end_inset

 (r7 - r8).
 In the case of either planar restraint, the plane may be defined using
 three atoms instead of four simply by using one atom twice.
 
\end_layout

\begin_layout Standard
If any of IAT(n) are 
\begin_inset Formula $<$
\end_inset

 0, then a corresponding group of atoms is defined below, and the coordinate-
 averaged position of this group will be used in place of atom IAT(n).
 A new feature as of Amber 10, atom groups may be used not only in distance
 restraints, but also in angle, torsion, the new plane restraints, or the
 new generalized restraints.
 If this is a distance restraint, and IAT1 
\begin_inset Formula $<$
\end_inset

0, then a group of atoms is defined below, and the coordinate-averaged position
 of this group will be used in place of the coordinates of atom 1 [IAT(1)].
 Similarly, if IAT(2) 
\begin_inset Formula $<$
\end_inset

 0, a group of atoms will be defined below whose coordinate-averaged position
 will be used in place of the coordinates for atom 2 [IAT(2)].
\end_layout

\end_deeper
\begin_layout Itemize

\shape italic
If IRESID=1:
\shape default
 IAT(1)..IAT(8) point to the *residues* containing the atoms comprising the
 internal.
 Residue numbers are the absolute in the entire system.
 In this case, the variables ATNAM(1)..ATNAM(8) must be specified and give
 the character names of the atoms within the respective residues.
 If any of IAT(n) are less than zero, then group input will still be read
 in place of the corresponding atom, as described below.
 
\end_layout

\begin_layout Itemize

\shape italic
Defaults for IAT(1)
\begin_inset Formula $\to$
\end_inset

IAT(8) are 0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
rstwt(1)
\begin_inset Formula $\to$
\end_inset

rstwt(4) 
\begin_inset Index idx
status open

\begin_layout Plain Layout
rstwt
\end_layout

\end_inset

 New as of Amber 10 (
\shape italic
sander
\shape default
 only), users may now define a single restraint that is a function of multiple
 distance restraints, called a "generalized distance coordinate" restraint.
 The energy of such a restraint has the following form:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $U=k(w_{\text{1}}|\mathbf{r_{\text{1}}-r_{\text{2}}|}+w_{\text{2}}|\mathbf{r_{\text{3}}-r_{\text{4}}|}+w_{\text{3}}|\mathbf{r_{\text{5}}-r_{\text{6}}|}+w_{\text{4}}|\mathbf{r_{\text{7}}-r_{\text{8}}|}-r_{\text{0}})^{\text{2}}$
\end_inset


\end_layout

\begin_layout Standard
\noindent
where the weights 
\begin_inset Formula $w_{\text{n}}$
\end_inset

are given in rstwt(1)..rstwt(4) and the positions 
\begin_inset Formula $\mathbf{r_{\text{n}}}$
\end_inset

are the positions of the atoms in iat(1)..iat(8).
\end_layout

\begin_layout Standard
Generalized distance coordinate restraints must be defined with either 4,
 6, or 8 atoms and 2, 3, or 4 corresponding nonzero weights in rstwt(1)..rstwt(4).
 Weights may be any positive or negative real number.
 
\end_layout

\begin_layout Standard
If all the weights in rstwt(1)..rstwt(4) are zero and four atoms are given
 in iat(1)..iat(4) for the restraint, the restraint is a torsional or J-coupling
 restraint.
 If eight atoms are given in iat(1)..iat(8) and all weights are zero, the
 restraint is a plane-plane angle restraint.
 However, if the weights are nonzero, the restraint will be a generalized
 distance coordinate restraint.
\end_layout

\begin_layout Standard

\shape italic
Default for rstwt(1)..rstwt(4) is 0.0
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
restraint
\begin_inset Index idx
status open

\begin_layout Plain Layout
restraint
\end_layout

\end_inset

 New as of Amber 10 (
\shape italic
sander
\shape default
 only), users may now use a "natural language" system to define restraints
 by using the RESTRAINT character variable.
 Valid restraints defined in this manner will begin with a "distance( )"
 "angle( )" "torsion( )" or "coordinate( )" keyword.
 Within the parentheses, the atoms that make up the restraint are specified.
 Atoms may be defined either with an explicit atom number or by using ambmask
 format, namely :(residue#)@(atom name).
 Atoms may be separated by commas, spaces, or parentheses.
 Additionally, negative integers may be used if atom groupings are defined
 in other variables in the namelist as described below.
 In addition to the principle distance, angle, torsion, and coordinate keywords,
 Some keywords may be used within the principle keywords to define more
 complicated restraints.
 The keyword "plane( )" may be used once or twice within the parentheses
 of the "angle( ) keyword to define a planar restraint.
 Defining one plane grouping plus one other atom in this manner will create
 a plane-point angle restraint as described above.
 Defining two plane groupings will create a plane-plane angle restraint.
 The keyword "plane( )" may only be used inside of "angle( )," and is necessary
 to define either a plane-point or plane-plane restraint.
\begin_inset Newline newline
\end_inset

 Within the "coordinate( )" keyword, the user must use 2 to 4 "distance(
 )" keywords to define a generalized distance coordinate restraint.
 The "distance( )" keyword functions just like it does when used to define
 a traditional distance restraint.
 The user may specify any two atom numbers, masks, or negative numbers correspon
ding to atom groups defined outside of RESTRAINT.
 Additionally, following each "distance( )" keyword inside "coordinate(
 )" the user must specify a real-number weight to be applied to each distance
 making up the generalized coordinate.
\begin_inset Newline newline
\end_inset

 The "com( )" keyword may be used within any other keyword to define a center
 of mass grouping of atoms.
 Within the parenthesis, the user will enter a list of atom numbers or masks.
 Negative numbers, which correspond to externally-defined groups, may not
 be used.
 
\begin_inset Newline newline
\end_inset

 Any type of parenthetical character, i.e., ( ), [ ], or { }, may be used
 wherever parentheses have been used above.
\begin_inset Newline newline
\end_inset


\begin_inset Newline newline
\end_inset

 The following are all examples of valid restraint definitions:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout LyX-Code
restraint = "distance( (45) (49) )"
\end_layout

\begin_layout LyX-Code
= "angle (:21@C5' :21@C4' 108)"
\end_layout

\begin_layout LyX-Code
= "torsion[-1,-1,-1, com(67, 68, 69)]"
\end_layout

\begin_layout LyX-Code
= "angle( -1, plane(81, 85, 87, 90) )"
\end_layout

\begin_layout LyX-Code
= "angle(plane(com(9,10),:5@CA,31,32),plane(14,15,15,16))"
\end_layout

\begin_layout LyX-Code
= "coordinate(distance(:5@C3',:6@O5'),-1.0,distance(134,-1),1.0)"
\end_layout

\begin_layout Standard
There is a 256 character limit on RESTRAINT, so if a particularly large
 atom grouping is desired, it is necessary to specify a negative number
 instead of "com( )" and define the group as described below.
 RESTRAINT will only be parsed if IAT(1) = 0, otherwise the information
 in IAT(1) ..
 IAT(8) will define the restraint.
 
\shape italic
Default for restraint is ' '.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
atnam
\begin_inset Index idx
status open

\begin_layout Plain Layout
atnam
\end_layout

\end_inset

 If IRESID = 1, then the character names of the atoms defining the internal
 are contained in ATNAM(1)
\begin_inset Formula $\to$
\end_inset

ATNAM(8).
 Residue IAT(1) is searched for atom name ATNAM(1); residue IAT(2) is searched
 for atom name ATNAM(2); etc.
 
\shape italic
Defaults for ATNAM(1)
\begin_inset Formula $\to$
\end_inset

ATNAM(8) are ' '.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iresid
\begin_inset Index idx
status open

\begin_layout Plain Layout
iresid
\end_layout

\end_inset

 Indicates whether IAT(I) points to an atom # or a residue #.
 See descriptions of IAT() and ATNAM() above.
 If RESTRAINT is used to define the internal instead of IAT(), IRESID has
 no effect on how RESTRAINT is parsed.
 However, it will affect the behavior of atom group definitions as described
 below if negative numbers are specified within RESTRAINT.
 
\shape italic
Default = 0
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nstep1
\begin_inset Index idx
status open

\begin_layout Plain Layout
nstep1
\end_layout

\end_inset

,
\begin_inset space ~
\end_inset

nstep2 This restraint is applied for steps/iterations NSTEP1 through NSTEP2.
 If NSTEP2 = 0, the restraint will be applied from NSTEP1 through the end
 of the run.
 Note that the first step/iteration is considered step zero (0).
 
\shape italic
Defaults for NSTEP1, NSTEP2 are both 0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
irstyp
\begin_inset Index idx
status open

\begin_layout Plain Layout
irstyp
\end_layout

\end_inset

 Normally, the restraint target values defined below (R1
\begin_inset Formula $\to$
\end_inset

R4) are used directly.
 If IRSTYP = 1, the values given for R1
\begin_inset Formula $\to$
\end_inset

R4 define relative displacements from the current value (value determined
 from the starting coordinates) of the restrained internal.
 For example, if IRSTYP=1, the current value of a restrained distance is
 1.25, and R1 (below) is -0.20, then a value of R1=1.05 will be used.
 
\shape italic
Default is IRSTYP=0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ialtd
\begin_inset Index idx
status open

\begin_layout Plain Layout
ialtd
\end_layout

\end_inset

 Determines what happens when a distance restraint gets very large.
 If IALTD=1, then the potential "flattens out", and there is no force for
 large violations; this allows for errors in constraint lists, but might
 tend to ignore constraints that 
\shape italic
should
\shape default
 be included to pull a bad initial structure towards a more correct one.
 When IALTD=0 the penalty energy continues to rise for large violations.
 See below for the detailed functional forms that are used for distance
 restraints.
 Set IALTD=0 to recover the behavior of earlier versions of 
\shape italic
sander
\shape default
.
 Default value is 0, or the last value that was explicitly set in a previous
 restraint.
 This value is set to 1 if 
\shape italic
makeDIST_RST
\shape default
 is called with the 
\shape italic
-altdis
\shape default
 flag.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ifvari
\begin_inset Index idx
status open

\begin_layout Plain Layout
ifvari
\end_layout

\end_inset

 If IFVARI 
\begin_inset Formula $>$
\end_inset

 0, then the force constants/positions of the restraint will vary with step
 number.
 Otherwise, they are constant throughout the run.
 If IFVARI 
\begin_inset Formula $>$
\end_inset

0, then the values R1A
\begin_inset Formula $\to$
\end_inset

R4A, RK2A, and RK3A must be specified (see below).
 
\shape italic
Default is IFVARI=0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ninc
\begin_inset Index idx
status open

\begin_layout Plain Layout
ninc
\end_layout

\end_inset

 If IFVARI 
\begin_inset Formula $>$
\end_inset

 and NINC 
\begin_inset Formula $>$
\end_inset

 0, then the change in the target values of of R1
\begin_inset Formula $\to$
\end_inset

R4 and K2,K3 is applied as a step function, with NINC steps/ iterations
 between each change in the target values.
 If NINC = 0, the change is effected continuously (at every step).
 
\shape italic
Default for NINC is the value assigned to NINC in the most recent namelist
 where NINC was specified.
 If NINC has not been specified in any namelist, it defaults to 0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
imult
\begin_inset Index idx
status open

\begin_layout Plain Layout
imult
\end_layout

\end_inset

 If IMULT=0, and the values of force constants RK2 and RK3 are changing
 with step number, then the changes in the force constants will be linearly
 interpolated from rk2
\begin_inset Formula $\to$
\end_inset

rk2a and rk3
\begin_inset Formula $\to$
\end_inset

rk3a as the step number changes.
 If IMULT=1 and the force constants are changing with step number, then
 the changes in the force constants will be effected by a series of multiplicati
ve scalings, using a single factor, R, for all scalings.
 
\begin_inset Formula $i.e.$
\end_inset


\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout LyX-Code
rk2a = R**INCREMENTS * rk2 
\begin_inset Newline newline
\end_inset

rk3a = R**INCREMENTS * rk3.
 
\end_layout

\begin_layout Standard
INCREMENTS is the number of times the target value changes, which is determined
 by NSTEP1, NSTEP2, and NINC.
 
\shape italic
Default for IMULT is the value assigned to IMULT in the most recent namelist
 where IMULT was specified.
 If IMULT has not been specified in any namelist, it defaults to 0.

\shape default
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
r1
\begin_inset Formula $\to$
\end_inset

r4,
\begin_inset space ~
\end_inset

rk2,
\begin_inset space ~
\end_inset

rk3,
\begin_inset space ~
\end_inset

r1a
\begin_inset Formula $\to$
\end_inset

r4a,
\begin_inset space ~
\end_inset

rk2a,
\begin_inset space ~
\end_inset

rk3a If IALTD=0, the restraint is a well with a square bottom with parabolic
 sides out to a defined distance, and then linear sides beyond that.
 If R is the value of the restraint in question: 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
R 
\begin_inset Formula $<$
\end_inset

 r1 Linear, with the slope of the "left-hand" parabola at the point R=r1.
 
\end_layout

\begin_layout Itemize
r1 
\begin_inset Formula $<$
\end_inset

= R 
\begin_inset Formula $<$
\end_inset

 r2 Parabolic, with restraint energy 
\begin_inset Formula $k_{2}(R-r_{2})^{2}$
\end_inset

.
 
\end_layout

\begin_layout Itemize
r2 
\begin_inset Formula $<$
\end_inset

= R 
\begin_inset Formula $<$
\end_inset

 r3 E = 0.
 
\end_layout

\begin_layout Itemize
r3 
\begin_inset Formula $<$
\end_inset

= R 
\begin_inset Formula $<$
\end_inset

 r4 Parabolic, with restraint energy 
\begin_inset Formula $k_{3}(R-r_{3})^{2}$
\end_inset

.
 
\end_layout

\begin_layout Itemize
r4 
\begin_inset Formula $<$
\end_inset

= R Linear, with the slope of the "right-hand" parabola at the point R=r4.
 
\end_layout

\begin_layout Standard
For torsional restraints, the value of the torsion is translated by +-n*360,
 if necessary, so that it falls closest to the mean of r2 and r3.
 Specified distances are in Angstroms.
 Specified angles are in degrees.
 Force constants for distances are in kcal/mol-
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

 2 Force constants for angles are in kcal/mol-rad 2 .
 (Note that angle positions are specified in degrees, but force constants
 are in radians, consistent with typical reporting procedures in the literature).
 
\end_layout

\begin_layout Standard
If IALTD=1, distance restraints are interpreted in a slightly different
 fashion.
 Again, If R is the value of the restraint in question: 
\end_layout

\begin_layout Itemize
R 
\begin_inset Formula $<$
\end_inset

 r2 Parabolic, with restraint energy 
\begin_inset Formula $k_{2}(R-r_{2})^{2}$
\end_inset

.
 
\end_layout

\begin_layout Itemize
r2 
\begin_inset Formula $<$
\end_inset

= R 
\begin_inset Formula $<$
\end_inset

 r3 E = 0.
 
\end_layout

\begin_layout Itemize
r3 
\begin_inset Formula $<$
\end_inset

= R 
\begin_inset Formula $<$
\end_inset

 r4 Parabolic, with restraint energy 
\begin_inset Formula $k_{3}(R-r_{3})^{2}$
\end_inset

.
 
\end_layout

\begin_layout Itemize
r4 
\begin_inset Formula $<$
\end_inset

= R Hyperbolic, with energy 
\begin_inset Formula $k_{3}[b/(R-r_{3})+a]$
\end_inset

, where 
\begin_inset Formula $a=3(r_{4}-r_{3})^{2}$
\end_inset

 and 
\begin_inset Formula $b=-2(r_{4}-r_{3})^{3}$
\end_inset

.
 This function matches smoothly to the parabola at 
\begin_inset Formula $R=r_{4}$
\end_inset

, and tends to an asymptote of 
\begin_inset Formula $ak_{3}$
\end_inset

at large R.
 The functional form is adapted from that suggested by Michael Nilges, 
\shape italic
Prot.
 Eng.

\shape default
 
\series bold
2,
\series default
 27-38 (1988).
 Note that if 
\shape italic
ialtd=1
\shape default
, the value of r1 is ignored.
 
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
ifvari
\begin_inset Index idx
status open

\begin_layout Plain Layout
ifvari
\end_layout

\end_inset

 
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
=
\begin_inset space ~
\end_inset

0 The values of r1
\begin_inset Formula $\to$
\end_inset

r4, rk2, and rk3 will remain constant throughout the run.
 
\end_layout

\begin_layout Description
>
\begin_inset space ~
\end_inset

0 The values r1a, r2a, r3a, r4a, r2ka and r3ka are also used.
 These variables are defined as for r1
\begin_inset Formula $\to$
\end_inset

r4 and rk2, rk3, but correspond to the values appropriate for NSTEP = NSTEP2:
 e.g., if IVARI 
\begin_inset Formula $>$
\end_inset

0, then the value of r1 will vary between NSTEP1 and NSTEP2, so that, e.g.
 r1(NSTEP1) = r1 and r1(NSTEP2) = r1a.
 Note that you 
\shape italic
must
\shape default
 specify an explicit value for 
\shape italic
nstep1
\shape default
 and 
\shape italic
nstep2
\shape default
 if you use this option.
 
\shape italic
Defaults for r1
\begin_inset Formula $\to$
\end_inset

r4,rk2,rk3,r1a
\begin_inset Formula $\to$
\end_inset

r4a,rk2a and rk3a are the values assigned to them in the most recent namelist
 where they were specified.
 They should always be specified in the first
\shape default
 &rst 
\shape italic
namelist.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
r0,
\begin_inset space ~
\end_inset

k0,
\begin_inset space ~
\end_inset

r0a,
\begin_inset space ~
\end_inset

k0a
\begin_inset Index idx
status open

\begin_layout Plain Layout
r0
\end_layout

\end_inset

 New as of Amber 10 (
\shape italic
sander
\shape default
 only), the user may more easily specify a large parabolic well if desired
 by using R0 and K0, and then R0A and K0A if IFVARI > 0.
 The parabolic well will have its zero at R = R0 and a force constant of
 K0.
 These variables simply map the disired parabolic well into r1
\begin_inset Formula $\to$
\end_inset

r4,
\begin_inset space ~
\end_inset

rk2,
\begin_inset space ~
\end_inset

rk3,
\begin_inset space ~
\end_inset

r1a
\begin_inset Formula $\to$
\end_inset

r4a,
\begin_inset space ~
\end_inset

rk2a,
\begin_inset space ~
\end_inset

and rk3a in the following manner:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Itemize
R1 = 0 for distance, angle, and planar restraints, R1 = R0 - 180 for torsion
 restraints
\end_layout

\begin_layout Itemize
R1A = 0 for distance, angle, and planar restraints, R1A = R0A - 180 for
 torsion restraints
\end_layout

\begin_layout Itemize
R2 = R0; R3 = R0
\end_layout

\begin_layout Itemize
R2A = R0A; R3A = R0A
\end_layout

\begin_layout Itemize
R4 = R0 + 500 for distance restraints, R4 = 180 for angle and planar restraints,
 R4 = R0 + 180 for torsion restraints
\end_layout

\begin_layout Itemize
RK2 = K0; RK3 = K0
\end_layout

\begin_layout Itemize
RK2A = K0A; RK3A = K0A
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
rjcoef
\begin_inset Index idx
status open

\begin_layout Plain Layout
rjcoef
\end_layout

\end_inset

(1)
\begin_inset Formula $\to$
\end_inset

rjcoef(3) By default, 4-atom sequences specify torsional restraints.
 It is also possible to impose restraints on the vicinal 3 J-coupling value
 related to the underlying torsion.
 J is related to the torsion 
\begin_inset Formula $\tau$
\end_inset

 by the approximate Karplus relationship: 
\begin_inset Formula $J=A\cos^{2}(\tau)+B\cos(\tau)+C$
\end_inset

.
 If you specify a nonzero value for either RJCOEF(1) or RJCOEF(2), then
 a J-coupling restraint, rather than a torsional restraint, will be imposed.
 At every MD step, J will be calculated from the Karplus relationship with
 A = RJCOEF(1), B = RJCOEF(2) and C = RJCOEF(3).
 In this case, the target values (R1-
\begin_inset Formula $>$
\end_inset

R4, R1A-
\begin_inset Formula $>$
\end_inset

R4A) and force constants (RK2, RK3, RK2A, RK3A) refer to J-values for this
 restraint.
 RJCOEF(1)-
\begin_inset Formula $>$
\end_inset

RJCOEF(3) must be set individually for each torsion for which you wish to
 apply a J-coupling restraint, and RJCOEF(1)-
\begin_inset Formula $>$
\end_inset

RJCOEF(3) may be different for each J-coupling restraint.
 With respect to other options and reporting, J-coupling restraints are
 treated identically to torsional restraints.
 This means that if time-averaging is requested for torsional restraints,
 it will apply to J-coupling restraints as well.
 The J-coupling restraint contribution to the energy is included in the
 "torsional" total.
 And changes in the relative weights of the torsional force constants also
 change the relative weights of the J-coupling restraint terms.
 Setting RJCOEF has no effect for distance and angle restraints.
 
\shape italic
Defaults for RJCOEF(1)-
\begin_inset Formula $>$
\end_inset

RJCOEF(3) are 0.0.
\end_layout

\begin_layout Standard
igr1
\begin_inset Index idx
status open

\begin_layout Plain Layout
igr1
\end_layout

\end_inset

(i),i=1
\begin_inset Formula $\to$
\end_inset

200,
\begin_inset space ~
\end_inset

igr2(i),i=1
\begin_inset Formula $\to$
\end_inset

200,
\begin_inset space ~
\end_inset

...
\begin_inset space ~
\end_inset

igr8(i),i..1=1
\begin_inset Formula $\to$
\end_inset

200 If IAT(n) 
\begin_inset Formula $<$
\end_inset

 0, then IGRn() gives the atoms defining the group whose coordinate averaged
 position is used to define "atom n" in a restraint.
 Alternatively, if RESTRAINT is used to define the internal, then if the
 nth atom specified is a number less than zero, IGRn() gives the atoms defining
 the group whose coordinate averaged position is used to define "atom n"
 in a restraint.
 If IRESID = 0, absolute atom numbers are specified by the elements of IGRn().
 If IRESID = 1, then IGRn(I) specifies the number of the residue containing
 atom I, and the name of atom I must be specified using GRNAMn(I).
 A maximum of 200 atoms (N # of atoms if using pmemd) are allowed in any
 group.
 Only specify those atoms that are needed.
 Default value for any unspecified element of IGRn(i) is 0.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
fxyz
\begin_inset Index idx
status open

\begin_layout Plain Layout
fxyz
\end_layout

\end_inset

 If iat(3)=0 and igr1 and/or igr2 is defined then it is possible to weight
 the x, y, z components of the force in the restraint to 0 (no force) or
 1 (full restraint force).
 Ex: fxyz=0, 0, 1.
 This sets no additional restraint force on the x component or y-component
 of the restraint force, and full z-component restraint force.
 Default fxyz=1,1,1.
 Note: When setting fxyz, the r1, r2, r3, r4 values should be set relative
 to a weighted distance 
\begin_inset Formula $\sqrt{\left(w_{x}*d_{x}\right)^{2}+\left(w_{y}*d_{y}\right)^{2}+\left(w_{z}*d_{z}\right)^{2}}$
\end_inset

, so if fxyz=0,0,1 then the only distance taken into account when comparing
 to r1,r2,r3,r4 is the z distance between the molecule and the center of
 mass.
 Note that the DUMPAVE value when outxyz=0 is also just the weighted distance.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
outxyz
\begin_inset Index idx
status open

\begin_layout Plain Layout
outxyz
\end_layout

\end_inset

 If iat(3)=0 and igr1 and/or igr2 is defined then it is possible to output
 the x, y, z components of the force in the restraint if outxyz is set to
 1.
 Default outyz=0.
 When outxyz is set to 1, the components of the distance and total distance
 are outputed in DUMPAVE in the order of the x-component, y-component, z-compone
nt, total distance.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
grnam1
\begin_inset Index idx
status open

\begin_layout Plain Layout
grnam1
\end_layout

\end_inset

(i),i=1
\begin_inset Formula $\to$
\end_inset

200, grnam2(i),i=1
\begin_inset Formula $\to$
\end_inset

200, ...
 grnam8(i),i=1
\begin_inset Formula $\to$
\end_inset

200 If group input is being specified (IGRn(1) 
\begin_inset Formula $>$
\end_inset

 0), 
\shape italic
and
\shape default
 IRESID = 1, then the character names of the atoms defining the group are
 contained in GRNAMn(i), as described above.
 In the case IAT(1) 
\begin_inset Formula $<$
\end_inset

 0, each residue IGR1(i) is searched for an atom name GRNAM1(i) and added
 to the first group list.
 In the case IAT(2) 
\begin_inset Formula $<$
\end_inset

 0, each residue IGR2(i) is searched for an atom name GRNAM2(i) and added
 to the second group list.
 
\shape italic
Defaults for GRNAMn(i) are '
\shape default

\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset


\begin_inset space ~
\end_inset

 
\shape italic
'.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ir6
\begin_inset Index idx
status open

\begin_layout Plain Layout
ir6
\end_layout

\end_inset

 If a group coordinate-averaged position is being used (see IGR1 and IGR2
 above), the average position can be calculated in either of two manners:
 If IR6 = 0, center-of-mass averaging will be used.
 If IR6=1, the 
\begin_inset Formula $\left\langle r^{-6}\right\rangle ^{-1/6}$
\end_inset

 average of all interaction distances to atoms of the group will be used.
 
\shape italic
Default for IR6 is the value assigned to IR6 in the most recent namelist
 where IR6 was specified.
 If IR6 has not been specified in any namelist, it defaults to 0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ifntyp
\begin_inset Index idx
status open

\begin_layout Plain Layout
ifntyp
\end_layout

\end_inset

 If time-averaged restraints have been requested (see DISAVE/ANGAVE/TORAVE
 above), they are, by default, applied to all restraints of the class specified.
 Time-averaging can be overridden for specific internals of that class by
 setting IFNTYP for that internal to 1.
 IFNTYP has no effect if time-averaged restraint are not being used.
 
\shape italic
Default value is IFNTYP=0.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ixpk
\begin_inset Index idx
status open

\begin_layout Plain Layout
ixpk
\end_layout

\end_inset

,
\begin_inset space ~
\end_inset

nxpk
\begin_inset Index idx
status open

\begin_layout Plain Layout
nxpk
\end_layout

\end_inset

 These are user-defined integers than can be set for each constraint.
 They are typically the "peak number" and "spectrum number" associated with
 the cross-peak that led to this particular distance restraint.
 Nothing is ever done with them except to print them out in the "violation
 summaries", so that NMR people can more easily go from a constraint violation
 to the corresponding peak in their spectral database.
 Default values are zero.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iconstr
\begin_inset Index idx
status open

\begin_layout Plain Layout
iconstr
\end_layout

\end_inset

 If 
\shape italic
iconstr
\shape default
 
\begin_inset Formula $>$
\end_inset

 0, (default is 0) a Lagrangian multiplier is also applied to the two-center
 internal coordinate defined by IAT(1) and IAT(2).
 The effect of this Lagrangian multiplier is to maintain the initial orientation
 of the internal coordinate.
 The rotation of the vector IAT(1)-
\begin_inset Formula $>$
\end_inset

IAT(2) is prohibited, though translation is allowed.
 For each defined two-center internal coordinate, a separate Lagrangian
 multiplier is used.
 Therefore, although one can use as many multipliers as needed, defining
 centers should NOT appear in more than one multiplier.
 This option is compatible with mass centers (i.e., negative IAT(1) or IAT(2)).
 ICONSTR can be used together with harmonic restraints.
 RK2 and RK3 should be set to 0.0 if the two-center internal coordinate is
 a simple Lagrangian multiplier.
 An example has been included in $AMBERHOME/example/lagmul.
\end_layout

\begin_layout Standard
Namelist &rst is read for each restraint.
 Restraint input ends when a namelist statement with iat(1) = 0 (or iat(1)
 not specified) is found.
 Note that comments can precede or follow any namelist statement, allowing
 comments and restraint definitions to be freely mixed.
\end_layout

\begin_layout Section

\series bold
\begin_inset CommandInset label
LatexCommand label
name "sec:noesy"

\end_inset

NOESY volume restraints
\end_layout

\begin_layout Standard
After the previous section, NOESY volume restraints may be read.
 This data described in this section is only read if NMROPT = 2.
 The molecule may be broken in overlapping submolecules, in order to reduce
 time and space requirements.
 Input 
\shape italic
for each submolecule
\shape default
 consists of namelist "&noeexp", followed 
\shape italic
immediately
\shape default
 by standard Amber "group" cards defining the atoms in the submolecule.
 In addition to the submolecule input ("&noeexp"), you may also need to
 specify some additional variables in the cntrl namelist; see the "NMR variables
" description in that section.
\end_layout

\begin_layout Standard
In many cases, the user will not prepare this section of the input by hand,
 but will use the auxiliary program 
\shape italic
makeDIST_RST
\shape default
 to prepare input from simpler files.
 
\end_layout

\begin_layout Subsection*

\series bold
Variables in the
\series default
 &noeexp 
\series bold
namelist:
\end_layout

\begin_layout Standard
For each submolecule, the namelist "&noeexp" is read (either from 
\shape italic
stdin
\shape default
 or from the NOESY redirection file) which contains the following variables.
 There are no effective defaults for 
\shape italic
npeak, emix, ihp, jhp,
\shape default
 and 
\shape italic
aexp
\shape default
: you must specify these.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
npeak
\shape italic

\begin_inset Index idx
status open

\begin_layout Plain Layout
npeak
\end_layout

\end_inset

(imix)
\shape default
 Number of peaks for each of the "imix" mixing times; if the last mixing
 time is 
\shape italic
mxmix
\shape default
, set NPEAK(
\shape italic
mxmix+1
\shape default
) = -1.
 End the input when NPEAK(1) 
\begin_inset Formula $<$
\end_inset

 0.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
emix
\shape italic

\begin_inset Index idx
status open

\begin_layout Plain Layout
emix
\end_layout

\end_inset

(imix)
\shape default
 Mixing times (in seconds) for each mixing time.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ihp
\shape italic

\begin_inset Index idx
status open

\begin_layout Plain Layout
ihp
\end_layout

\end_inset

(imix,ipeak)
\shape default
,
\begin_inset space ~
\end_inset

jhp
\shape italic
(imix,ipeak)
\shape default
 Atom numbers for the atoms involved in cross-peak "ipeak" at mixing time
 "imix" 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
aexp
\begin_inset Index idx
status open

\begin_layout Plain Layout
aexp
\end_layout

\end_inset

(imix,ipeak) Experimental target integrated intensity for this cross peak.
 If AEXP is negative, this cross peak is part of a set of overlapped peaks.
 The computed intensity is added to the peak that follows; the next time
 a peak with AEXP 
\begin_inset Formula $>$
\end_inset

 0 is encountered, the running sum for the calculated peaks will be compared
 to the value of AEXP for that last peak in the list.
 In other words, a set of overlapped peaks is represented by one or more
 peaks with AEXP 
\begin_inset Formula $<$
\end_inset

 0 followed by a peak with AEXP 
\begin_inset Formula $>$
\end_inset

 0.
 The computed total intensity for these peaks will be compared to the value
 of AEXP for the final peak.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
arange
\shape italic

\begin_inset Index idx
status open

\begin_layout Plain Layout
arange
\end_layout

\end_inset

(imix,ipeak)
\shape default
 "Uncertainty" range for this peak: if the calculated value is within 
\begin_inset Formula $\pm$
\end_inset

ARANGE of AEXP, then no penalty will be assessed.
 Default uncertainties are all zero.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
awt
\shape italic

\begin_inset Index idx
status open

\begin_layout Plain Layout
awt
\end_layout

\end_inset

(imix,ipeak)
\shape default
 Relative weight for this cross peak.
 Note that this will be multiplied by the overall weight given by the NOESY
 weight change cards in the weight changes section (Section 1).
 Default values are 1.0, unless INVWT1,INVWT2 are set (see below), in which
 case the input values of AWT are ignored.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
invwt1
\begin_inset Index idx
status open

\begin_layout Plain Layout
invwt1
\end_layout

\end_inset

,invwt2 Lower and upper bounds on the weights for the peaks respectively,
 such that the relative weight for each peak is 1/intensity if 1/intensity
 lies between the lower and upper bounds.
 This is the intensity after being scaled by 
\shape italic
oscale
\shape default
.
 The inverse weighing scheme adopted by this option prevents placing too
 much influence on the strong peaks at the expense of weaker peaks and was
 previously invoked using the compilation flag "INVWGT".
 Default values are INVWT1=INVWT2=1.0, placing equal weights on all peaks.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
omega
\begin_inset Index idx
status open

\begin_layout Plain Layout
omega
\end_layout

\end_inset

 Spectrometer frequency, in Mhz.
 Default is 500.
 It is possible for different sub-molecules to have different frequencies,
 but omega will only change when it is explicitly re-set.
 Hence, if all of your data is at 600 Mhz, you need only set 
\shape italic
omega
\shape default
 to 600.
 in the first submolecule.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
taurot
\begin_inset Index idx
status open

\begin_layout Plain Layout
taurot
\end_layout

\end_inset

 Rotational tumbling time of the molecule, in nsec.
 Default is 1.0 nsec.
 Like 
\shape italic
omega
\shape default
, this value is "sticky", so that a value set in one submolecule will remain
 until it is explicitly reset.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
taumet
\begin_inset Index idx
status open

\begin_layout Plain Layout
taumet
\end_layout

\end_inset

 Correlation time for methyl jump motion, in ns.
 This is only used in computing the intra-methyl contribution to the rate
 matrix.
 The ideas of Woessner are used, specifically as recommended by Kalk & Berendsen.
\begin_inset CommandInset citation
LatexCommand cite
key "Kalk76"
literal "true"

\end_inset

 Default is 0.0001 ns, which is effectively the fast motion limit.
 The default is consistent with the way the rest of the rate matrix elements
 are determined (also in the fast motion limit,) but probably is not the
 best value to use, since methyl groups appear to have T1 values that are
 systematically shorter than other protons, and this is likely to arise
 from the fact that the methyl correlation time can be near to the inverse
 of the spectrometer frequency.
 A value of 0.02 - 0.05 ns is probably better than 0.0001, but this is still
 an active research area, and you are on your own here, and should consult
 the literature for further discussion.
\begin_inset CommandInset citation
LatexCommand cite
key "Olejniczak90"
literal "true"

\end_inset

 As with 
\shape italic
omega
\shape default
, 
\shape italic
taumet
\shape default
 can be different for different sub-molecules, but will only change when
 it is explicitly re-set.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
id2o
\begin_inset Index idx
status open

\begin_layout Plain Layout
id2o
\end_layout

\end_inset

 Flag for determining if exchangeable protons are to be included in the
 spin-diffusion calculation.
 If ID2O=0 (default) then all protons are included.
 If ID2O=1, then all protons bonded to nitrogen or oxygen are assumed to
 not be present for the purposes of computing the relaxation matrix.
 No other options exist at present, but they could easily be added to the
 subroutine 
\shape italic
indexn
\shape default
.
 Alternatively, you can manually rename hydrogens in the 
\shape italic
prmtop
\shape default
 file so that they do not begin with "H": such protons will not be included
 in the relaxation matrix.
 (
\shape italic
Note:
\shape default
 for technical reasons, the HOH proton of tyrosine must always be present,
 so setting ID2O=1 will not remove it; we hope that this limitation will
 be of minor importance to most users.) The 
\shape italic
id2o
\shape default
 variable retains its value across namelist reads, 
\begin_inset Formula $i.e.$
\end_inset

 its value will only change if it is explicitly reset.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
oscale
\begin_inset Index idx
status open

\begin_layout Plain Layout
oscale
\end_layout

\end_inset

 overall scaling factor between experimental and computed volume units.
 The experimental intensities are multiplied by 
\shape italic
oscale
\shape default
 before being compared to calculated intensities.
 This means that the weights WNOESY and AWT always refer to "theoretical"
 intensity scales rather than to the (arbitrary) experimental units.
 The 
\shape italic
oscale
\shape default
 variable retains its value across namelist reads, 
\begin_inset Formula $i.e.$
\end_inset

 its value will only change if it is explicitly reset.
 The initial (default) value is 1.0.
\end_layout

\begin_layout Standard
The atom numbers 
\shape italic
ihp
\shape default
 and 
\shape italic
jhp
\shape default
 are the absolute atom numbers.
 For methyl groups, use the number of the last proton of the group; for
 the delta and epsilon protons of aromatic rings, use the delta-2 or epsilon-2
 atom numbers.
 Since this input requires you to know the absolute atom numbers assigned
 by Amber to each of the protons, you may wish to use the separate 
\shape italic
makeDIST_RST
\shape default
 program which provides a facility for more turning human-readable input
 into the required file for 
\shape italic
sander
\shape default
.
\end_layout

\begin_layout Standard
Following the &noeexp namelist, give the Amber "group" cards that identify
 this submolecule.
 This combination of "&noeexp" and "group" cards can be repeated as often
 as needed for many submolecules, subject to the limits described in the
 
\shape italic
nmr.h
\shape default
 file.
 As mentioned above, this input section ends when NPEAK(1) 
\begin_inset Formula $<$
\end_inset

 0, or when and end-of-file is reached.
 
\begin_inset space ~
\end_inset


\end_layout

\begin_layout Section

\series bold
\begin_inset CommandInset label
LatexCommand label
name "sec:shift"

\end_inset

Chemical shift restraints
\end_layout

\begin_layout Standard
After reading NOESY restraints above (if any), read the chemical shift restraint
s in namelist 
\shape italic
&shf
\shape default
, or the pseudocontact restraints in namelist 
\shape italic
&pcshift
\shape default
.
 Reading this input is triggered by the presence of a SHIFTS line in the
 I/O redirection section.
 In many cases, the user will not prepare this section of the input by hand,
 but will use the auxiliary programs 
\shape italic
shifts
\shape default
 or 
\shape italic
fantasian
\shape default
 to prepare input from simpler files.
\end_layout

\begin_layout Subsection*

\series bold
Variables in the
\series default
 &shf 
\series bold
namelist.

\series default
 
\end_layout

\begin_layout Standard
(Defaults are only available for 
\shape italic
shrang, wt
\shape default
, 
\shape italic
nter
\shape default
, and 
\shape italic
shcut
\shape default
; you must specify the rest.) 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nring
\begin_inset Index idx
status open

\begin_layout Plain Layout
nring
\end_layout

\end_inset

 Number of rings in the system.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
natr
\begin_inset Index idx
status open

\begin_layout Plain Layout
natr
\end_layout

\end_inset


\begin_inset Formula $(i)$
\end_inset

 Number of atoms in the 
\shape italic
i-th
\shape default
 ring.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iatr
\begin_inset Index idx
status open

\begin_layout Plain Layout
iatr
\end_layout

\end_inset


\begin_inset Formula $(j,i)$
\end_inset

 Absolute atom number for the 
\shape italic
j-th
\shape default
 atom of the 
\shape italic
i-th
\shape default
 ring.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
namr
\begin_inset Index idx
status open

\begin_layout Plain Layout
namr
\end_layout

\end_inset


\begin_inset Formula $(i)$
\end_inset

 Eight-character string that labels the 
\shape italic
i-th
\shape default
 ring.
 The first three characters give the residue name (in caps); the next three
 characters contain the residue number (right justified); column 7 is blank;
 column 8 may optionally contain an extra letter to distinguish the two
 rings of trp, or the 5 or 8 rings of the heme group.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
str
\begin_inset Index idx
status open

\begin_layout Plain Layout
str
\end_layout

\end_inset


\begin_inset Formula $(i)$
\end_inset

 Ring current intensity factor for the 
\shape italic
i-th
\shape default
 ring.
 Older values are summarized by Cross and Wright;
\begin_inset CommandInset citation
LatexCommand cite
key "Cross85"
literal "true"

\end_inset

 more recent empirical parametrizations seem to give improved results.
\begin_inset CommandInset citation
LatexCommand cite
key "Osapay91,Case95"
literal "true"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nprot
\begin_inset Index idx
status open

\begin_layout Plain Layout
nprot
\end_layout

\end_inset

 Number of protons for which penalty functions are to be set up.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iprot
\begin_inset Index idx
status open

\begin_layout Plain Layout
iprot
\end_layout

\end_inset


\begin_inset Formula $(i)$
\end_inset

 Absolute atom number of the 
\shape italic
i-th
\shape default
 proton whose shifts are to be evaluated.
 For equivalent protons, such as methyl groups or rapidly flipping phenylalanine
 rings, enter all two or three atom numbers in sequence; averaging will
 be controlled by the 
\shape italic
wt
\shape default
 parameter, described below.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
obs
\begin_inset Index idx
status open

\begin_layout Plain Layout
obs
\end_layout

\end_inset


\begin_inset Formula $(i)$
\end_inset

 Observed secondary shift for the 
\shape italic
i-th
\shape default
 proton.
 This is typically calculated as the observed value minus a random coil
 reference value.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
shrang
\begin_inset Index idx
status open

\begin_layout Plain Layout
shrang
\end_layout

\end_inset


\begin_inset Formula $(i)$
\end_inset

 "Uncertainty" range for the observed shift: if the calculated shift is
 within 
\begin_inset Formula $\pm$
\end_inset

SHRANG of the observed shift, then no penalty will be imposed.
 The default value is zero for all shifts.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
wt
\begin_inset Index idx
status open

\begin_layout Plain Layout
wt
\end_layout

\end_inset


\begin_inset Formula $(i)$
\end_inset

 Weight to be assigned to this penalty function.
 Note that this value will be multiplied by the overall weight (if any)
 given by the SHIFTS command in the assignment of weights (above).
 Default values are 1.0.
 For sets of equivalent protons, give a negative weight for all but the
 last proton in the group; the last proton gets a normal, positive value.
 The average computed shift of the group will be compared to 
\shape italic
obs
\shape default
 entered for the last proton.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
shcut
\begin_inset Index idx
status open

\begin_layout Plain Layout
shcut
\end_layout

\end_inset

 Values of calculated shifts will be printed only if the absolute error
 between calculated and observed shifts is greater than this value.
 
\shape italic
Default = 0.3 ppm.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nter
\begin_inset Index idx
status open

\begin_layout Plain Layout
nter
\end_layout

\end_inset

 Residue number of the N-terminus, for protein shift calculations; 
\shape italic
default = 1.

\shape default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
cter
\begin_inset Index idx
status open

\begin_layout Plain Layout
cter
\end_layout

\end_inset

 Residue number of the C-terminus, for protein shift calculations.
 Believe it or not, the current code cannot figure this out for itself.
 
\end_layout

\begin_layout Standard
In typical usage, the 
\emph on
shifts
\emph default
 program (
\family typewriter
http://casegroup.rutgers.edu/shifts.html
\family default
) would be used to create this file, with a typical command line:
\end_layout

\begin_layout LyX-Code
shifts -readobs -sander '::H*' gcg10
\end_layout

\begin_layout Standard
Sample input and output files are in 
\family typewriter
$AMBERHOME/test/rdc
\family default
.
\end_layout

\begin_layout Section
Pseudocontact shift restraints
\end_layout

\begin_layout Standard
The PCSHIFT module allows the inclusion of pseudocontact shifts as constraints
 in energy minimization and molecular dynamics calculations on paramagnetic
 molecules.
 The pseudocontact shift depends on the magnetic susceptibility anisotropy
 of the metal ion and on the location of the resonating nucleus with respect
 to the axes of the magnetic susceptibility tensor.
 For the nucleus i, it is given by: 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\delta_{pc}^{i}=\sum_{j}\frac{1}{12\pi r_{ij}^{3}}\left[\Delta\chi_{ax}^{j}(3n_{ij}^{2}-1)+(3/2)\Delta\chi_{rh}^{j}(l_{ij}^{2}-m_{ij}^{2})\right]
\]

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $l_{ij}$
\end_inset

, 
\begin_inset Formula $m_{ij}$
\end_inset

, and 
\begin_inset Formula $n_{ij}$
\end_inset

 are the direction cosines of the position vector of atom i with respect
 to the j-th magnetic susceptibility tensor coordinate system, 
\begin_inset Formula $r_{ij}$
\end_inset

 is the distance between the j-th paramagnetic center and the proton i,
 
\shape italic

\begin_inset Formula $\Delta\chi_{ax}$
\end_inset


\shape default
 and 
\shape italic

\begin_inset Formula $\Delta\chi_{rh}$
\end_inset


\shape default
 are the axial and the equatorial (rhombic) anisotropies of the magnetic
 susceptibility tensor of the j-th paramagnetic center.
 For a discussion, see Ref.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Banci97"
literal "true"

\end_inset

.
\end_layout

\begin_layout Standard
The PCSHIFT module to be used needs a namelist file which includes information
 on the magnetic susceptibility tensor and on the paramagnetic center, and
 a line of information for each nucleus.
 This module allows to include more than one paramagnetic center in the
 calculations.
 To include pseudocontact shifts as constraints in energy minimization and
 molecular dynamics calculations the NMROPT flag should be set to 2, and
 a 
\shape italic
PCSHIFT=filename
\shape default
 statement entered in the I/O redirection section.
\end_layout

\begin_layout Standard
To perform molecular dynamics calculations it is necessary to eliminate
 the rotational and translational degree of freedom about the center of
 mass (this because during molecular dynamics calculations the relative
 orientation between the external reference coordinate system and the magnetic
 anisotropy tensor coordinate system has to be fixed).This option can be
 obtained with the NSCM flag of 
\shape italic
sander
\shape default
.
\end_layout

\begin_layout Subsection*

\series bold
Variables in the
\series default
 pcshift 
\series bold
namelist
\series default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nprot
\begin_inset Index idx
status open

\begin_layout Plain Layout
nprot
\end_layout

\end_inset

 number of pseudocontact shift constraints.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nme
\begin_inset Index idx
status open

\begin_layout Plain Layout
nme
\end_layout

\end_inset

 number of paramagnetic centers.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
nmpmc
\begin_inset Index idx
status open

\begin_layout Plain Layout
nmpmc
\end_layout

\end_inset

 name of the paramagnetic atom 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
optphi
\begin_inset Index idx
status open

\begin_layout Plain Layout
optphi
\end_layout

\end_inset

(n),
\begin_inset space ~
\end_inset

opttet(n),
\begin_inset space ~
\end_inset

optomg(n),
\begin_inset space ~
\end_inset

opta1(n),
\begin_inset space ~
\end_inset

opta2(n) the five parameters of the magnetic anisotropy tensor for each
 paramagnetic center.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
optkon
\begin_inset Index idx
status open

\begin_layout Plain Layout
optkon
\end_layout

\end_inset

 force constant for the pseudocontact shift constraints
\end_layout

\begin_layout Standard
Following this, there is a line for each nucleus for which the pseudocontact
 shift information is given has to be added.
 Each line contains : 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
iprot
\begin_inset Index idx
status open

\begin_layout Plain Layout
iprot
\end_layout

\end_inset

(i) atom number of the i-th proton whose shift is to be used as constraint.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
obs
\begin_inset Index idx
status open

\begin_layout Plain Layout
obs
\end_layout

\end_inset

(i) observed pseudocontact shift value, in ppm 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
wt
\begin_inset Index idx
status open

\begin_layout Plain Layout
wt
\end_layout

\end_inset

(i) relative weight 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
tolpro
\begin_inset Index idx
status open

\begin_layout Plain Layout
tolpro
\end_layout

\end_inset

(i) relative tolerance ix mltpro 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mltpro
\begin_inset Index idx
status open

\begin_layout Plain Layout
mltpro
\end_layout

\end_inset

(i) multiplicity of the NMR signal (for example the protons of a methyl
 group have mltprot(i)=3)
\end_layout

\begin_layout Subsection*
Example
\end_layout

\begin_layout Standard
Here is a &pcshf namelist example: a molecule with three paramagnetic centers
 and 205 pseudocontact shift constraints.
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

&pcshf
\end_layout

\begin_layout Plain Layout

nprot=205,
\end_layout

\begin_layout Plain Layout

nme=3,
\end_layout

\begin_layout Plain Layout

nmpmc='FE ',
\end_layout

\begin_layout Plain Layout

optphi(1)=-0.315416,
\end_layout

\begin_layout Plain Layout

opttet(1)=0.407499,
\end_layout

\begin_layout Plain Layout

optomg(1)=0.0251676,
\end_layout

\begin_layout Plain Layout

opta1(1)=-71.233,
\end_layout

\begin_layout Plain Layout

opta2(1)=1214.511,
\end_layout

\begin_layout Plain Layout

optphi(2)=0.567127,
\end_layout

\begin_layout Plain Layout

opttet(2)=-0.750526,
\end_layout

\begin_layout Plain Layout

optomg(2)=0.355576,
\end_layout

\begin_layout Plain Layout

opta1(2)=-60.390,
\end_layout

\begin_layout Plain Layout

opta2(2)=377.459,
\end_layout

\begin_layout Plain Layout

optphi(3)=0.451203,
\end_layout

\begin_layout Plain Layout

opttet(3)=-0.0113097,
\end_layout

\begin_layout Plain Layout

optomg(3)=0.334824,
\end_layout

\begin_layout Plain Layout

opta1(3)=-8.657,
\end_layout

\begin_layout Plain Layout

opta2(3)=704.786,
\end_layout

\begin_layout Plain Layout

optkon=30,
\end_layout

\begin_layout Plain Layout

iprot(1)=26, obs(1)=1.140, wt(1)=1.000, tolpro(1)=1.00, mltpro(1)=1,
\end_layout

\begin_layout Plain Layout

iprot(2)=28, obs(2)=2.740, wt(2)=1.000, tolpro(2)=.500, mltpro(2)=1,
\end_layout

\begin_layout Plain Layout

iprot(3)=30, obs(3)=1.170, wt(3)=1.000, tolpro(3)=.500, mltpro(3)=1,
\end_layout

\begin_layout Plain Layout

iprot(4)=32, obs(4)=1.060, wt(4)=1.000, tolpro(4)=.500, mltpro(4)=3,
\end_layout

\begin_layout Plain Layout

iprot(5)=33, obs(5)=1.060, wt(5)=1.000, tolpro(5)=.500, mltpro(5)=3,
\end_layout

\begin_layout Plain Layout

iprot(6)=34, obs(6)=1.060, wt(6)=1.000, tolpro(6)=.500, mltpro(6)=3,
\end_layout

\begin_layout Plain Layout

...
\end_layout

\begin_layout Plain Layout

...
\end_layout

\begin_layout Plain Layout

iprot(205)=1215, obs(205)=.730, wt(205)=1.000, tolpro(205)=.500,
\end_layout

\begin_layout Plain Layout

mltpro(205)=1,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Standard
An 
\emph on
mdin
\emph default
 file that might go along with this, to perform a maximum of 5000 minimization
 cycles, starting with 500 cycles of steepest descent.
 PCSHIFT=./pcs.in redirects the input from the namelist "pcs.in" which contains
 the pseudocontact shift information.
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Example of minimization including pseudocontact shift constraints
\end_layout

\begin_layout Plain Layout

&cntrl
\end_layout

\begin_layout Plain Layout

ibelly=0,imin=1,ntpr=100,
\end_layout

\begin_layout Plain Layout

ntr=0,maxcyc=500,
\end_layout

\begin_layout Plain Layout

ncyc=50,ntmin=1,dx0=0.0001,
\end_layout

\begin_layout Plain Layout

drms=.1,cut=10.,
\end_layout

\begin_layout Plain Layout

nmropt=2,pencut=0.1, ipnlty=2,
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&wt type='REST', istep1=0,istep2=1,value1=0.,
\end_layout

\begin_layout Plain Layout

value2=1.0, /
\end_layout

\begin_layout Plain Layout

&wt type='END' /
\end_layout

\begin_layout Plain Layout

DISANG=./noe.in
\end_layout

\begin_layout Plain Layout

PCSHIFT=./pcs.in
\end_layout

\begin_layout Plain Layout

LISTOUT=POUT
\end_layout

\end_inset


\end_layout

\begin_layout Section

\series bold
\begin_inset CommandInset label
LatexCommand label
name "sec:rdc"

\end_inset

Direct dipolar coupling restraints
\end_layout

\begin_layout Standard
Energy restraints based on direct dipolar coupling constants are entered
 in this section.
 All variables are in the namelist &align; reading of this section is triggered
 by the presence of a DIPOLE line in the I/O redirection section.
\end_layout

\begin_layout Standard
When dipolar coupling restraints are turned on, the five unique elements
 of the alignment tensor are treated as additional variables, and are optimized
 along with the structural parameters.
 Their effective masses are determined by the 
\shape italic
scalm
\shape default
 parameter entered in the &cntrl namelist.
 Unlike some other programs, the variables used are the Cartesian components
 of the alignment tensor in the axis system defined by the molecule itself:
 
\begin_inset Formula $e.g.$
\end_inset

 
\begin_inset Formula $S_{mn}\equiv\left\langle (3\cos\theta_{m}\cos\theta_{n}-\delta_{mn})/2\right\rangle $
\end_inset

, where 
\begin_inset Formula $m,n=x,y,z$
\end_inset

, and 
\begin_inset Formula $\theta_{x}$
\end_inset

 is the angle between the 
\begin_inset Formula $x$
\end_inset

 axis and the spectrometer field.
\begin_inset CommandInset citation
LatexCommand cite
key "Sanders94"
literal "true"

\end_inset

 The factor of 10
\begin_inset Formula $^{5}$
\end_inset

 is just to make the values commensurate with atomic coordinates, since
 both the coordinates and the alignment tensor values will be updated during
 the refinement.
 The calculated dipolar splitting is then 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
D_{calc}=-\left(\frac{10^{-5}\gamma_{i}\gamma_{j}h}{2\pi^{2}r_{ij}^{3}}\right)\sum_{m,n=xyz}\cos\phi_{m}\cdot S_{mn}\cdot\cos\phi_{n}
\]

\end_inset

where 
\begin_inset Formula $\phi_{x}$
\end_inset

 is the angle between the internuclear vector and the 
\begin_inset Formula $x$
\end_inset

 axis.
 Geometrically, the splitting is proportional to the transformation of the
 alignment tensor onto the internuclear axis.
 This is just Eqs.
 (5) and (13) of the above reference, with any internal motion corrections
 (which might be a part of 
\begin_inset Formula $S_{system}$
\end_inset

) set to unity.
 If there is an internal motion correction which is the same for all observation
s, this can be assimilated into the alignment tensor.
 The current code does not allow for variable corrections for internal motion.
 See Ref.
 
\begin_inset CommandInset citation
LatexCommand cite
key "Tsui00a"
literal "true"

\end_inset

 for a fuller discussion of these issues.
\end_layout

\begin_layout Standard
At the end of the calculation, the alignment tensor is diagonalized to obtain
 information about its principal components.
 This allows the alignment tensor to be written in terms of the "axial"
 and "rhombic" components that are often used to describe alignment.
\end_layout

\begin_layout Subsection*

\series bold
Variables in the
\series default
 &align 
\series bold
namelist.

\series default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ndip
\begin_inset Index idx
status open

\begin_layout Plain Layout
ndip
\end_layout

\end_inset

 Number of observed dipolar couplings to be used as restraints.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
id
\begin_inset Index idx
status open

\begin_layout Plain Layout
id
\end_layout

\end_inset

,jd Atom numbers of the two atoms involved in the dipolar coupling.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dobsl
\begin_inset Index idx
status open

\begin_layout Plain Layout
dobsl
\end_layout

\end_inset

,
\begin_inset space ~
\end_inset

dobsu Limiting values for the observed dipolar splitting, in Hz.
 If the calculated coupling is less than 
\shape italic
dobsl
\shape default
, the energy penalty is proportional to 
\begin_inset Formula $(D_{calc}-D_{obs,l})^{2}$
\end_inset

; if it is larger than 
\shape italic
dobsu
\shape default
, the penalty is proportional to 
\begin_inset Formula $(D_{calc}-D_{obs,lu})^{2}$
\end_inset

.
 Calculated values between 
\shape italic
dobsl
\shape default
 and 
\shape italic
dobsu
\shape default
 are not penalized.
 Note that 
\shape italic
dobsl
\shape default
 must be less than 
\shape italic
dobsu
\shape default
; for example, if the observed coupling is -6 Hz, and a 1 Hz "buffer" is
 desired, you could set 
\shape italic
dobsl
\shape default
 to -7 and 
\shape italic
dobsu
\shape default
 to -5.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dwt
\begin_inset Index idx
status open

\begin_layout Plain Layout
dwt
\end_layout

\end_inset

 The relative weight of each observed value.
 Default is 1.0.
 The penalty function is thus:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
\begin_inset Formula $E_{align}^{i}=D_{wt}^{i}(D_{calc}^{i}-D_{obs(u,l)}^{i})^{2}$
\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $D_{wt}$
\end_inset

 may vary from one observed value to the next.
 Note that the default value is arbitrary, and a smaller value may be required
 to avoid overfitting the dipolar coupling data.
\begin_inset CommandInset citation
LatexCommand cite
key "Tsui00a"
literal "true"

\end_inset


\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
dataset
\begin_inset Index idx
status open

\begin_layout Plain Layout
dataset
\end_layout

\end_inset

 Each dipolar peak can be associated with a "dataset", and a separate alignment
 tensor will be computed for each dataset.
 This is generally used if there are several sets of experiments, each with
 a different sample or temperature, etc., that would imply a different value
 for the alignment tensor.
 By default, there is one dataset to which each observed value is assigned.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
num_datasets
\begin_inset Index idx
status open

\begin_layout Plain Layout
num
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
_
\end_layout

\end_inset

datasets
\end_layout

\end_inset

 The number of datasets in the constraint list.
 Default is 1.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
s11
\begin_inset Index idx
status open

\begin_layout Plain Layout
s11
\end_layout

\end_inset

,s12,s13,s22,s23 Initial values for the Cartesian components of the alignment
 tensor.
 The tensor is traceless, so S33 is calculated as -(S11+S22).
 In order to have the order of magnitude of the S values be roughly commensurate
 with coordinates in Angstroms, the alignment tensor values must be multiplied
 by 10
\begin_inset Formula $^{5}$
\end_inset

.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
gigj
\begin_inset Index idx
status open

\begin_layout Plain Layout
gigj
\end_layout

\end_inset

 Product of the nuclear "g" factors for this dipolar coupling restraint.
 These are related to the nuclear gyromagnetic rations by 
\begin_inset Formula $\gamma_{N}=g_{N}\beta_{N}/$
\end_inset

.
 Common values are 
\begin_inset Formula $^{1}$
\end_inset

H = 5.5856, 
\begin_inset Formula $^{13}$
\end_inset

C = 1.4048, 
\begin_inset Formula $^{15}$
\end_inset

N = -0.5663, 
\begin_inset Formula $^{31}$
\end_inset

P = 2.2632.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dij
\begin_inset Index idx
status open

\begin_layout Plain Layout
dij
\end_layout

\end_inset

 The internuclear distance for observed dipolar coupling.
 If a nonzero value is given, the distance is considered to be fixed at
 the given value.
 If a 
\shape italic
dij
\shape default
 value is zero, its value is computed from the structure, and it is assumed
 to be a variable distance.
 For one-bond couplings, it is usually best to treat the bond distance as
 "fixed" to an effective zero-point vibration value.
\begin_inset CommandInset citation
LatexCommand cite
key "Case99"
literal "true"

\end_inset


\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
dcut
\begin_inset Index idx
status open

\begin_layout Plain Layout
dcut
\end_layout

\end_inset

 Controls printing of calculated and observed dipolar couplings.
 Only values where abs(dobs(u,l) - dcalc) is greater than 
\emph on
dcut
\emph default
 will be printed.
 Default is 0.1 Hz.
 Set to a negative value to print all dipolar restraint information.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
freezemol
\begin_inset Index idx
status open

\begin_layout Plain Layout
freezemol
\end_layout

\end_inset

 If this is set to 
\shape italic
.true.
\shape default
, the molecular coordinates are not allowed to vary during dynamics or minimizat
ion: only the elements of the alignment tensor will change.
 This is useful to fit just an alignment tensor to a given structure.
 Default is 
\shape italic
.false.
\shape default
.
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:csa"

\end_inset

Residual CSA or pseudo-CSA restraints
\end_layout

\begin_layout Standard
Resonance positions in partially aligned media will be shifted from their
 positions in isotropic media, and this can provide information that is
 very similar to residual dipolar coupling constriants.
 This section shows how to input these sorts of restraints.
 The entry of the alignment tensor is done as in Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:rdc"

\end_inset

, so you must have a DIPOLE file (with an &align namelist) even if you don't
 have any RDC restraints.
 Then, if there is a CSA line in I/O redirection section, that file will
 be read with the following inputs:
\end_layout

\begin_layout Subsection*

\series bold
Variables in the
\series default
 &csa 
\series bold
namelist.

\series default
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ncsa
\begin_inset Index idx
status open

\begin_layout Plain Layout
ndip
\end_layout

\end_inset

 Number of observed residual CSA peaks to be used as restraints.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
icsa
\begin_inset Index idx
status open

\begin_layout Plain Layout
icsa
\end_layout

\end_inset

,jcsa,kcsa Atom numbers for the csa of interest: 
\emph on
jcsa
\emph default
 is the atom whose 
\begin_inset Formula $\Delta\sigma$
\end_inset

 value has been measured; 
\emph on
icsa
\emph default
 and 
\emph on
kcsa
\emph default
 are two atoms bonded to it, used to define the local axis frame for the
 CSA tensor.
 See 
\emph on
amber12/test/pcsa/RST.csa
\emph default
 for examples of how to set these.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
cobsl
\begin_inset Index idx
status open

\begin_layout Plain Layout
cobsl
\end_layout

\end_inset

,
\begin_inset space ~
\end_inset

cobsu Limiting values for the observed residual CSA, in Hz (not ppm or ppb!).
 If the calculated value of 
\begin_inset Formula $\Delta\sigma$
\end_inset

 is less than 
\shape italic
cobsl
\shape default
, the energy penalty is proportional to 
\begin_inset Formula $(\Delta\sigma_{calc}-\Delta\sigma_{obs,l})^{2}$
\end_inset

; if it is larger than 
\shape italic
cobsu
\shape default
, the penalty is proportional to 
\begin_inset Formula $(\Delta\sigma_{calc}-\Delta\sigma_{obs,u})^{2}$
\end_inset

.
 Calculated values between 
\shape italic
cobsl
\shape default
 and 
\shape italic
cobsu
\shape default
 are not penalized.
 Note that 
\shape italic
cobsl
\shape default
 must be less than 
\shape italic
cobsu
\shape default
.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
cwt
\begin_inset Index idx
status open

\begin_layout Plain Layout
cwt
\end_layout

\end_inset

 The relative weight of each observed value.
 Default is 1.0.
 The penalty function is thus:
\begin_inset Separator latexpar
\end_inset


\end_layout

\begin_deeper
\begin_layout Description
\begin_inset Formula $E_{csa}^{i}=C_{wt}^{i}(\Delta\sigma_{calc}^{i}-\Delta\sigma_{obs(u,l)}^{i})^{2}$
\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $C_{wt}$
\end_inset

 may vary from one observed value to the next.
 Note that the default value is arbitrary, and a smaller value may be required
 to avoid overfitting the data.
\end_layout

\end_deeper
\begin_layout Labeling
\labelwidthstring 00.00.0000
datasetc
\begin_inset Index idx
status open

\begin_layout Plain Layout
datasetc
\end_layout

\end_inset

 Each residual CSA can be associated with a "dataset", and a separate alignment
 tensor will be computed for each dataset.
 This is generally used if there are several sets of experiments, each with
 a different sample or temperature, etc., that would imply a different value
 for the alignment tensor.
 By default, there is one dataset to which each observed value is assigned.
 The tensors themselves are entered for each dataset in the DIPOLE file.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
field Magnetic field (in MHz) for the residual CSA being considered here.
 This is indexed from 1 to 
\emph on
ncsa,
\emph default
 and is nucleus dependent.
 For example, if the proton frequency is 600 MHz, then 
\emph on
field
\emph default
 for 
\begin_inset Formula $^{13}$
\end_inset

C would be 150, and that for 
\begin_inset Formula $^{15}$
\end_inset

N would be 60.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
sigma11,
\begin_inset space ~
\end_inset

sigma22,
\begin_inset space ~
\end_inset

sigma12,
\begin_inset space ~
\end_inset

sigma13,
\begin_inset space ~
\end_inset

sigma23 Values of the CSA tensor (in ppm) for atom 
\emph on
icsa
\emph default
, in the local coordinate frame defined by atoms 
\emph on
icsa
\emph default
, 
\emph on
jcsa
\emph default
 and 
\emph on
kcsa
\emph default
.
 See 
\emph on
$AMBERHOME/test/pcsa/RST.csa
\emph default
 for examples of how to set these.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ccut
\begin_inset Index idx
status open

\begin_layout Plain Layout
ccut
\end_layout

\end_inset

 Controls printing of calculated and observed residual CSAs.
 Only values where abs(cobs(u,l) - ccalc) is greater than 
\emph on
ccut
\emph default
 will be printed.
 Default is 0.1 Hz.
 Set to a negative value to print all information.
 
\end_layout

\begin_layout Standard
The residual CSA facility is new as of Amber 10, and has not been used as
 much as other parts of the NMR refinement package.
 You should study the example files listed above to see how things work.
 The residual CSA values should closely match those found by the RAMAH package
 (
\emph on
http://www-personal.umich.edu/~hashimi/Software.html
\emph default
), and testing this should be a first step in making sure you have entered
 the data correctly.
\end_layout

\begin_layout Section

\series bold
Preparing restraint files for Sander
\begin_inset CommandInset label
LatexCommand label
name "sec:nmr-to-rst"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename nmrinfo.pdf
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:nmrinfo"

\end_inset

Notation: 
\emph on
circles
\emph default
 represent logical information, whose format might differ from one project
 to the next; 
\emph on
solid rectangles
\emph default
 are in a specific format (largely compatible with DIANA and other programs),
 and are intended to be read and edited by the user; 
\emph on
ellipses
\emph default
 are specific to 
\emph on
sander
\emph default
, and are generally not intended to be read or edited manually.
 The conversion of NOESY volumes to distance bounds can be carried out by
 a variety of programs such as 
\emph on
mardigras
\emph default
 or 
\emph on
xpk2bound
\emph default
 that are not included with Amber.
 Similarly, the analysis and partial assignment of ambiguous or overlapped
 peaks is a separate task; at TSRI, these are typically carried out using
 the programs 
\emph on
xpkasgn
\emph default
 and 
\emph on
filter.pl
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:nmrinfo"

\end_inset

 shows the general information flow for auxiliary programs that help prepare
 the restraint files.
 Once the restraint files are made, Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:nmrinfo2"

\end_inset

 shows a flow-chart of the general way in which 
\shape italic
sander
\shape default
 refinements are carried out.
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename nmrinfo2.pdf
	width 100text%

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:nmrinfo2"

\end_inset

General organization of NMR refinement calculations.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
The basic ideas of this scheme owe a lot to the general experience of the
 NMR community over the past decade.
 Several papers outline procedures in the Scripps group, from which a lot
 of the NMR parts of 
\shape italic
sander
\shape default
 are derived.
\begin_inset CommandInset citation
LatexCommand cite
key "Duggan01,Gippert90,Case93,Case94,Bruschweiler94,Case98"
literal "true"

\end_inset

 They are by no means the only way to proceed.
 We hope that the flexibility incorporated into 
\shape italic
sander
\shape default
 will encourage folks to experiment with refinement protocols.
\end_layout

\begin_layout Subsection

\series bold
Preparing distance restraints: makeDIST_RST
\end_layout

\begin_layout Standard
The 
\shape italic
makeDIST_RST
\shape default
 program converts a simplified description of distance bounds into a detailed
 input for 
\shape italic
sander
\shape default
.
 A variety of input and output filenames may be specified on the command
 line:
\end_layout

\begin_layout Standard
input:
\end_layout

\begin_layout LyX-Code
-upb 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
7-col file of upper distance bounds, OR
\end_layout

\begin_layout LyX-Code
-ual 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
8-col file of upper and lower bounds, OR
\end_layout

\begin_layout LyX-Code
-vol 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
7-col file of NOESY volumes
\end_layout

\begin_layout LyX-Code
-pdb 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
Brookhaven format file
\end_layout

\begin_layout LyX-Code
-map 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
MAP file (default:map.DG-AMBER)
\end_layout

\begin_layout LyX-Code
-les 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
LES atom mappings, made by addles
\end_layout

\begin_layout Standard
output:
\end_layout

\begin_layout LyX-Code
-dgm 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
DGEOM95 restraint format
\end_layout

\begin_layout LyX-Code
-rst 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
SANDER restraint format
\end_layout

\begin_layout LyX-Code
-svf 
\begin_inset Formula $<$
\end_inset

filename
\begin_inset Formula $>$
\end_inset

 
\shape italic
Sander Volume Format, for NOESY refinement
\end_layout

\begin_layout Standard
other options:
\end_layout

\begin_layout LyX-Code
-help 
\shape italic
(gives you this explanation, overrides other parameters)
\end_layout

\begin_layout LyX-Code
-report 
\shape italic
(gives you short runtime diagnostic output)
\end_layout

\begin_layout LyX-Code
-nocorr 
\shape italic
(do not correct upper bound for r**-6 averaging)
\end_layout

\begin_layout LyX-Code
-altdis 
\shape italic
(use alternative form for the distance restraints)
\end_layout

\begin_layout Standard
The 
\shape italic
7/8 column distance bound
\shape default
 file is essentially that used by the DIANA or DISGEO programs.
 It consists of one-line per restraint, which would typically look like
 the following:
\end_layout

\begin_layout LyX-Code
23 ALA HA 52 VAL H 3.8 # comments go here
\end_layout

\begin_layout Standard
The first three columns identify the first proton, the next three the second
 proton, and the seventh column gives the upper bound.
 Only the first three letters of the residue name are used, so that DIANA
 files that contain residues like "ASP-" will be correctly interpreted.
 An alternate, 8-column, format has both upper and lower bounds as the seventh
 and eighth columns, respectively.
 A typical line might in an "8-col" file might look like this:
\end_layout

\begin_layout LyX-Code
23 ALA HA 52 VAL H 3.2 3.8 # comments go here
\end_layout

\begin_layout Standard
Here the lower bound is 3.2 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

 and the upper bound is 3.8 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

.
 Comments typically identify the spectrum and peak-number or other identificatio
n that allow cross-referencing back to the appropriate spectrum.
 If the comment contains the pattern "
\begin_inset Formula $<$
\end_inset

integer
\begin_inset Formula $>$
\end_inset

:
\begin_inset Formula $<$
\end_inset

integer
\begin_inset Formula $>$
\end_inset

", then the first integer is treated as a peak-identifier, and the second
 as a spectrum-identifier.
 These identifiers go into the 
\shape italic
ixpk
\shape default
 and 
\shape italic
nxpk
\shape default
 variables, and will later be printed out in 
\shape italic
sander
\shape default
, to facilitate going back to the original spectra to track down violations,
 etc.
\end_layout

\begin_layout Standard
The format for the 
\shape italic
-vol
\shape default
 option is the same as for the 
\shape italic
-upb
\shape default
 option except that the seventh column holds a peak intensity (volume) value,
 rather than a distance upper bound.
\end_layout

\begin_layout Standard
The input PDB file must exactly match the Amber 
\shape italic
prmtop
\shape default
 file that will be used; use the ambpdb -aatm command to create this.
\end_layout

\begin_layout Standard
If all peaks involved just single protons, and were fully assigned, this
 is all that one would need.
 In general, though, some peaks (especially methyl groups or fast-rotating
 aromatic rings) represent contributions from more than one proton, and
 many other peaks may not be fully assigned.
 
\shape italic
Sander
\shape default
 handles both of these situations in the same way, through the notion of
 an "ambiguous" peak, that may correspond to several assignments.
 These peaks are given two types of special names in the 7/8-column format
 file:
\end_layout

\begin_layout Enumerate
Commonly-occurring ambiguities, like the lack of stereospecific assignments
 to two methylene protons, are given names defined in the default MAP file.
 These names, also more-or-less consistent with DIANA, are like the names
 of "pseudo-atoms" that have long been used to identify such partially assigned
 peaks, e.g.
 "QB" refers to the (HB2,HB3) combination in most residues, and "MG1" in
 valine refers collectively to the three methyl protons at position CG1,
 etc.
\end_layout

\begin_layout Enumerate
There are generally also molecule-specific ambiguities, arising from potential
 overlap in a NOESY spectrum.
 Here, the user assigns a unique name to each such ambiguity or overlap,
 and prepares a list of the potential assignments.
 The names are arbitrary, but might be constructed, for example, from the
 chemical shifts that identify the peak, e.g.
 "p_2.52" might identify the set of protons that could contribute to a peak
 at 2.52 ppm.
 The chemical shift list can be used to prepare a list of potential assignments,
 and these lists can often be pruned by comparison to approximate or initial
 structures.
\end_layout

\begin_layout Standard
The default and molecule-specific MAP files are combined into a single file,
 which is used, along with the 7-column restraint file, the the program
 
\shape italic
makeDIST_RST
\shape default
 to construct the actual 
\shape italic
sander
\shape default
 input files.
 You should consult the help file for makeDIST_RST for more information.
 For example, here are some lines added to the MAP file for a recent TSRI
 refinement:
\end_layout

\begin_layout LyX-Code
AMBIG n2:68 = HE 86 HZ 86
\end_layout

\begin_layout LyX-Code
AMBIG n2:72 = HE 24 HD 24 HZ 24
\end_layout

\begin_layout LyX-Code
AMBIG n2:73 = HN 81 HZ 13 HE 13 HD 13 HZ 24
\end_layout

\begin_layout LyX-Code
AMBIG n2:78 = HN 76 HZ 13 HE 13 HZ 24
\end_layout

\begin_layout LyX-Code
AMBIG n2:83 = HN 96 HN 97 HD 97 HD 91
\end_layout

\begin_layout LyX-Code
AMBIG n2:86 = HD1 66 HZ2 66
\end_layout

\begin_layout LyX-Code
AMBIG n2:87 = HN 71 HH2 66 HZ3 66 HD1 66
\end_layout

\begin_layout Standard
Here the spectrum name and peak number were used to construct a label for
 each ambiguous peak.
 Then, an entry in the restraint file might look like this:
\end_layout

\begin_layout LyX-Code
123 GLY HN 0 AMB n2:68 5.5
\end_layout

\begin_layout Standard
indicating a 5.5 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
AA
\end_layout

\end_inset

 upper bound between the amide proton of Gly 123 and a second proton, which
 might be either the HE or HZ protons of residue 86.
 (The "zero" residue number just serves as a placeholder, so that there
 will be the same number of columns as for non-ambiguous restraints.) If
 it is possible that the ambiguous list might not be exhaustive (e.g.
 if some protons have not been assigned), it is safest to set 
\shape italic
ialtd
\shape default
=1, which will allow "mistakes" to be present in the constraint list.
 On the other hand, if you want to be sure that every violation is "active",
 set 
\shape italic
ialtd
\shape default
=0.
\end_layout

\begin_layout Standard
If the 
\shape italic
-les
\shape default
 flag is set, the program will prepare distance restraints for multiple
 copies (LES) simulations.
 In this case, the input PDB file is one 
\shape italic
without
\shape default
 LES copies, i.e.
 with just a single copy of the molecule.
 The "lesfile" specified by this flag is created by the 
\shape italic
addles
\shape default
 program, and contains a mapping from original atom numbers into the copy
 numbers used in the multiple-copies simulation.
\end_layout

\begin_layout Standard
The 
\shape italic
-rst
\shape default
 and 
\shape italic
-svf
\shape default
 flags specify outputs for 
\shape italic
sander
\shape default
, for distance restraints and NOESY restraints, respectively.
 In each case, you may need to hand-edit the outputs to add additional parameter
s.
 You should make it a habit to compare the outputs with the descriptions
 given earlier in this chapter to make sure that the restraints are what
 you want them to be.
\end_layout

\begin_layout Standard
It is common to run makeDIST_RST several times, with different inputs that
 correspond to different spectra, different mixing times, etc.
 It is then expected that you will manually edit the various output files
 to combine them into the single file required by 
\shape italic
sander
\shape default
.
\end_layout

\begin_layout Subsection

\series bold
Preparing torsion angle restraints: makeANG_RST
\end_layout

\begin_layout Standard
There are fewer "standards" for representing coupling constant information.
 We have followed the DIANA convention in the program 
\shape italic
makeANG_RST
\shape default
.
 This program takes as input a five-column torsion angle constraint file
 along with an Amber PDB file of the molecule.
 It creates as output (to standard out) a list of constraints in RST format
 that is readable by Amber.
\end_layout

\begin_layout LyX-Code
Usage: makeANG_RST -help
\end_layout

\begin_layout LyX-Code
makeANG_RST -pdb ambpdb_file [-con constraint] [-lib libfile]
\end_layout

\begin_layout LyX-Code
[-les lesfile ]
\end_layout

\begin_layout Standard
The input torsion angle constraint file can be read from standard in or
 from a file specified by the -con option on the command line.
 The input constraint file should look something like this:
\end_layout

\begin_layout LyX-Code
1 GUA PPA 111.5 144.0
\end_layout

\begin_layout LyX-Code
2 CYT EPSILN 20.9 100.0
\end_layout

\begin_layout LyX-Code
2 CYT PPA 115.9 134.2
\end_layout

\begin_layout LyX-Code
3 THY ALPHA 20.4 35.6
\end_layout

\begin_layout LyX-Code
4 ADE GAMMA 54.7 78.8
\end_layout

\begin_layout LyX-Code
5 GLY PHI 30.5 60.3
\end_layout

\begin_layout LyX-Code
6 ALA CHI 20.0 50.0
\end_layout

\begin_layout LyX-Code
....
\end_layout

\begin_layout Standard
Lines beginning with "#" are ignored.
 The first column is the residue number; the second is the residue name
 (three letter code, or as defined in your personal torsion library file).
 Only the first three letters of the residue name are used, so that DIANA
 files that contain residues like "ASP-" will be correctly interpreted.
 Third is the angle name (taken from the torsion library described below).The
 fourth column contains the lower bound, and the fifth column specifies
 the upper bound.
 Additional material on the line is (presently) ignored.
\end_layout

\begin_layout Standard

\shape italic
Note
\shape default
: It is assumed that the lower bound and the upper bound define a region
 of allowed conformation on the unit circle that is swept out in a clockwise
 direction from 
\begin_inset Formula $lb\rightarrow ub$
\end_inset

.
 If the number in the 
\shape italic
lb
\shape default
 column is greater than the the number in the 
\shape italic
ub
\shape default
 column, 360
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
textdegree
\end_layout

\end_inset

 will successively be subtracted from the 
\shape italic
lb
\shape default
 until 
\begin_inset Formula $lb<ub$
\end_inset

.
 This preserves the clockwise definition of the allowed conformation space,
 while also making the number that specifies the lower bound less than the
 number that specifies the upper bound, as is required by Amber.
 If this occurs, a warning message will be printed to 
\shape italic
stderr
\shape default
 to notify the user that the data has been modified.
\end_layout

\begin_layout Standard
The angles that one can constrain in this manner are defined in the library
 file that can be optionally specified on the command line with the -lib
 flag, or the default library "tordef.lib" (written by Garry P.
 Gippert) will be used.
 If you wish to specify your own nomenclature, or add angles that are not
 already defined in the default file, you should make a copy of this file
 and modify it to suit your needs.
 The general format for an entry in the library is:
\end_layout

\begin_layout LyX-Code
LEU PSI N CA C N+
\end_layout

\begin_layout Standard
where the first column is the residue name, the second column is the angle
 name that will appear in the input file when specifying this angle, and
 the last four columns are the atom names that define the torsion angle.
 When a torsion angle contains atom(s) from a preceding or succeeding residue
 in the structure, a "-" or "+" is appended to those atom names in the library,
 thereby specifying that this is the case.
 In the example above, the atoms that define PSI for LEU residues are the
 N, CA, and C atoms of that same LEU and the N atom of the residue after
 that LEU in the primary structure.
 Note that the order of atoms in the definition is important and should
 reflect that the torsion angle rotates about the two central atoms as well
 as the fact that the four atoms are bonded in the order that is specified
 in the definition.
\end_layout

\begin_layout Standard
If the first letter of the second field is "J", this torsion is assumed
 to be a J-coupling constraint.
 In that case, three additional floats are read at the end of the line,
 giving the A,B and C coefficients for the Karplus relation for this torsion.
 For example:
\end_layout

\begin_layout LyX-Code
ALA JHNA H N CA HA 9.5 -1.4 0.3
\end_layout

\begin_layout Standard
will set up a J-coupling restraint for the HN-HA 3-bond coupling, assuming
 a Karplus relation with A,B, C as 9.5, -1.4 and 0.3.
 (These particular values are from Brüschweiler and Case, JACS 116: 11199
 (1994).)
\end_layout

\begin_layout Standard
This program also supports pseudorotation phase angle constraints for prolines
 and nucleic acid sugars; each of these will generate restraints for the
 5 component angles which correspond to the 
\shape italic
lb
\shape default
 and 
\shape italic
ub
\shape default
 values of the input pseudorotation constraint.
 In the torsion library, a pseudorotation definition looks like:
\end_layout

\begin_layout LyX-Code
PSEUDO CYT PPA NU0 NU1 NU2 NU3 NU4
\end_layout

\begin_layout LyX-Code
CYT NU0 C4' O4' C1' C2'
\end_layout

\begin_layout LyX-Code
CYT NU1 O4' C1' C2' C3'
\end_layout

\begin_layout LyX-Code
CYT NU2 C1' C2' C3' C4'
\end_layout

\begin_layout LyX-Code
CYT NU3 C2' C3' C4' O4'
\end_layout

\begin_layout LyX-Code
CYT NU4 C3' C4' O4' C1'
\end_layout

\begin_layout Standard
The first line describes that a PSEUDOrotation angle is to be defined for
 CYT that is called PPA and is made up of the five angles NU0-NU4.
 Then the definition for NU0-NU4 should also appear in the file in the same
 format as the example given above for LEU PSI.
\end_layout

\begin_layout Standard
PPA stands for Pseudorotation Phase Angle and is the angle that should appear
 in the input constraint file when using pseudorotation constraints.
 The program then uses the definition of that PPA angle in the library file
 to look for the 5 other angles (NU0-NU4 in this case) which it then generates
 restraints for.
 PPA for proline residues is included in the standard library as well as
 for the DNA nucleotides.
\end_layout

\begin_layout Standard
If the 
\shape italic
-les
\shape default
 flag is set, the program will prepare torsion angle restraints for multiple
 copies (LES) simulations.
 In this case, the input PDB file is one 
\shape italic
without
\shape default
 LES copies, i.e.
 with just a single copy of the molecule.
 The "lesfile" specified by this flag is created by the 
\shape italic
addles
\shape default
 program, and contains a mapping from original atom numbers into the copy
 numbers used in the multiple-copies simulation.
\end_layout

\begin_layout Standard
Torsion angle constraints defined here cannot span two different copy sets,
 i.e., there cannot be some atoms of a particular torsion that are in one
 multiple copy set, and other atoms from the same torsion that are in other
 copy sets.
 It 
\shape italic
is
\shape default
 OK to have some atoms with single copies, and others with multiple copies
 in the same torsion.
 The program will create as many duplicate torsions as there are copies.
\end_layout

\begin_layout Standard
A good alternative to interpreting J-coupling constants in terms of torsion
 angle restraints is to refine directly against the coupling constants themselve
s, using an appropriate Karplus relation.
 See the discussion of the variable RJCOEF, above.
\end_layout

\begin_layout Subsection

\series bold
Chirality restraints: makeCHIR_RST
\end_layout

\begin_layout LyX-Code
Usage: makeCHIR_RST 
\begin_inset Formula $<$
\end_inset

pdb-file
\begin_inset Formula $>\quad<$
\end_inset

output-constraint-file
\begin_inset Formula $>$
\end_inset


\end_layout

\begin_layout Standard
We also find it useful to add chirality constraints and 
\shape italic
trans
\shape default
-peptide 
\begin_inset Formula $\omega$
\end_inset

 constraints (where appropriate) to prevent chirality inversions or peptide
 bond flips during the high-temperature portions of simulated annealing
 runs.
 The program 
\shape italic
makeCHIR_RST
\shape default
 will create these constraints.
 Note that you may have to edit the output of this program to change 
\shape italic
trans
\shape default
 peptide constraints to 
\shape italic
cis
\shape default
, as appropriate.
\end_layout

\begin_layout Subsection

\series bold
Direct dipolar coupling restraints: makeDIP_RST
\end_layout

\begin_layout Standard
For simulations with residual dipolar coupling restraints, the 
\shape italic
makeDIP_RST.protein
\shape default
, 
\shape italic
makeDIP_RST.dna
\shape default
 and 
\shape italic
makeDIP_RST.diana
\shape default
 are simple codes to prepare the input file.
 Use 
\shape italic
-help
\shape default
 to obtain a more detailed description of the usage.
 For now, this code only handles backbone NH and C
\begin_inset Formula $\alpha$
\end_inset

H data.
 The header specifying values for various parameters needs to be manually
 added to the output of 
\shape italic
makeDIP_RST
\shape default
.
\end_layout

\begin_layout Standard
Use of residual dipolar coupling restraints is new both for Amber and for
 the general NMR community.
 Refinement against these data should be carried out with care, and the
 optimal values for the force constant, penalty function, and initial guesses
 for the alignment tensor components are still under investigation.
 Here are some suggestions from the experiences so far:
\end_layout

\begin_layout Enumerate
Beware of overfitting the dipolar coupling data in the expense of Amber
 force field energy.
 These dipolar coupling data are very sensitive to tiny changes in the structure.
 It is often possible to drastically improve the fitting by making small
 distortions in the backbone angles.
 We recommend inclusion of explicit angle restraints to enforce ideal backbone
 geometry, especially for those residues that have corresponding residual
 dipolar coupling data.
\end_layout

\begin_layout Enumerate
The initial values for the Cartesian components of the alignment tensor
 can influence the final structure and alignment if the structure is not
 fixed (ibelly = 0).
 For a fixed structure (ibelly = 1), these values do not matter.
 Therefore, the current "best" strategy is to fit the experimental data
 to the fixed starting structure, and use the alignment tensor[s] obtained
 from this fitting as the initial guesses for further refinement.
\end_layout

\begin_layout Enumerate
Amber is capable of simultaneously fitting more than one set of alignment
 data.
 This allows the use of individually obtained datasets with different alignment
 tensors.
 However, if the different sets of data have equal directions of alignment
 but different magnitudes, using an overall scaling factor for these data
 with a single alignment tensor could greatly reduce the number of fitting
 parameters.
\end_layout

\begin_layout Enumerate
Because the dipolar coupling splittings depend on the square root of the
 order parameters (0 
\begin_inset Formula $\le$
\end_inset

 S2 
\begin_inset Formula $\le$
\end_inset

1), these order parameters describing internal motion of individual residues
 are often neglected (N.
 Tjandra and A.
 Bax, 
\shape italic
Science
\shape default
 
\series bold
278
\series default
, 1111-1113, 1997).
 However, the square root of a small number can still be noticeably smaller
 than 1, so this may introduce undesirable errors in the calculations.
\end_layout

\begin_layout Subsection
Using NMR exchange format (NEF) files
\end_layout

\begin_layout Standard
The NMR community, in collaboration with the worldwide PDB, is developing
 a common format for encoding of NMR restraints, including all of the kinds
 discussed above.
 This format is not yet finalized, but we are including here a conversion
 script, 
\emph on
nef_to_RST
\emph default
, that would convert these files to 
\emph on
sander
\emph default
 format.
 Because this format is so new, and is still subject to revisions, care
 should be taken in using this script: make sure that the output files do
 what they should be doing.
 Here are the usage instructions (which you can also get by typing 
\begin_inset Quotes eld
\end_inset

nef_to_RST -help
\begin_inset Quotes erd
\end_inset

 at the command line:
\end_layout

\begin_layout LyX-Code
# nef_to_RST
\end_layout

\begin_layout LyX-Code
convert NEF restraints to Amber format
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
input:
\end_layout

\begin_layout LyX-Code
   -nef <filename>: NEF file
\end_layout

\begin_layout LyX-Code
   -pdb <filename>: PDBFILE using AMBER nomenclature and numbering
\end_layout

\begin_layout LyX-Code
   -map <filename>: MAP file  (default:map.NEF-AMBER)
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
output:
\end_layout

\begin_layout LyX-Code
   -rst <filename>:  SANDER restraint format
\end_layout

\begin_layout LyX-Code
   -rdc <filename>:  SANDER DIP format
\end_layout

\begin_layout LyX-Code
   
\end_layout

\begin_layout LyX-Code
other options:
\end_layout

\begin_layout LyX-Code
   -nocorr (do not correct upper bound for r**-6 averaging)
\end_layout

\begin_layout LyX-Code
   -altdis (use alternative form for the distance restraints)
\end_layout

\begin_layout LyX-Code
   -help   (gives you this explanation, overrides other parameters)
\end_layout

\begin_layout LyX-Code
   -report (gives you short runtime diagnostic output)
\end_layout

\begin_layout LyX-Code

\end_layout

\begin_layout LyX-Code
errors come to stderr.
\end_layout

\begin_layout Section

\series bold
Getting summaries of NMR violations
\end_layout

\begin_layout Standard
If you specify LISTOUT=POUT when running 
\shape italic
sander
\shape default
, the output file will contain a lot of detailed information about the remaining
 restraint violations at the end of the run.
 When running a family of structures, it can be useful to process these
 output files with 
\shape italic
sviol
\shape default
, which takes a list of 
\shape italic
sander
\shape default
 output files on the command line, and sends a summary of energies and violation
s to STDOUT.
 If you have more than 20 or so structures to analyze, the output from 
\shape italic
sviol
\shape default
 becomes unwieldy.
 In this case you may also wish to use 
\shape italic
sviol2
\shape default
, which prints out somewhat less detailed information, but which can be
 used on larger families of structures.
 The 
\shape italic
senergy
\shape default
 script gives a more detailed view of force-field energies from a series
 of structures.
 (We thank the TSRI NMR community for helping to put these scripts together,
 and for providing many useful suggestions.)
\end_layout

\begin_layout Section

\series bold
Time-averaged restraints
\end_layout

\begin_layout Standard
The model of the previous sections involves the "single-average-structure"
 idea, and tries to fit all constraints to a single model, with minimal
 deviations.
 A generalization of this model treats distance constraints arising from
 from NOE crosspeaks (for example) as being the average distance determined
 from a trajectory, rather than as the single distance derived from an average
 structure.
\end_layout

\begin_layout Standard
Time-averaged bonds and angles are calculated as
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\bar{r}=(1/C)\left\{ \int_{0}^{t}e^{(t'-t)/\tau}r(t')^{-i}dt'\right\} ^{-1/i}\label{eq:timeav}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $\bar{r}$
\end_inset

 = time-averaged value of the internal coordinate (distance or angle)
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $t$
\end_inset

 = the current time
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $\tau$
\end_inset

 = the exponential decay constant
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $r(t')$
\end_inset

 = the value of the internal coordinate at time t'
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $i$
\end_inset

 = average is over internals to the inverse of 
\begin_inset Formula $i$
\end_inset

.
 Usually 
\begin_inset Formula $i$
\end_inset

 = 3 or 6 for NOE distances, and -1 (linear averaging) for angles and torsions.
 
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
\begin_inset Formula $C$
\end_inset

 = a normalization integral.
\end_layout

\begin_layout Standard
Time-averaged torsions are calculated as
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
<\varphi>=\tan^{-1}\left(<\sin(\phi)>/<\cos(\phi)>\right)
\]

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $\phi$
\end_inset

 is the torsion, and 
\begin_inset Formula $<\sin(\phi)>$
\end_inset

 and 
\begin_inset Formula $<\cos(\phi)>$
\end_inset

 are calculated using the equation above with 
\begin_inset Formula $\sin(\phi(t'))$
\end_inset

 or 
\begin_inset Formula $\cos(\phi(t'))$
\end_inset

 substituted for 
\begin_inset Formula $r(t')$
\end_inset

.
\end_layout

\begin_layout Standard
Forces for time-averaged restraints can be calculated either of two ways.
 This option is chosen with the DISAVI / ANGAVI / TORAVI commands.
 In the first (the default), 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\partial E/\partial x=(\partial E/\partial\bar{r})(\partial\bar{r}/\partial r(t))(\partial r(t)/\partial x)\label{eq:tavforce1}
\end{equation}

\end_inset

(and analogously for y and z).
 The forces then correspond to the standard flat-bottomed well functional
 form, with the instantaneous value of the internal replaced by the time-average
d value.
 For example, when 
\begin_inset Formula $r_{3}<\bar{r}<r_{4}$
\end_inset

,
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
E=k_{3}(\bar{r}-r_{3})^{2}
\]

\end_inset

and similarly for other ranges of 
\begin_inset Formula $\bar{r}$
\end_inset

.
\end_layout

\begin_layout Standard
When the second option for calculating forces is chosen (IINC = 1 on a DISAVI,
 ANGAVI or TORAVI card), forces are calculated as
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\partial E/\partial x=(\partial E/\partial\bar{r})(\partial r(t)/\partial x)\label{eq:tavforce2}
\end{equation}

\end_inset

For example, when 
\begin_inset Formula $r_{3}<\bar{r}<r_{4}$
\end_inset

, 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\partial E/\partial x=2k_{3}(\bar{r}-r_{3})(\partial r(t)/\partial x)
\]

\end_inset

Integration of this equation does not give Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:tavforce1"

\end_inset

, but rather a non-intuitive expression for the energy (although one that
 still forces the bond to the target range).
 The reason that it may sometimes be preferable to use this second option
 is that the term 
\begin_inset Formula $\partial\bar{r}/\partial r(t)$
\end_inset

, which occurs in the exact expression [Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:tavforce1"

\end_inset

], varies as 
\begin_inset Formula $(\bar{r}/r(t))^{1+i}$
\end_inset

.
 When 
\begin_inset Formula $i$
\end_inset

=3, this means the forces can be varying with the fourth power the distance,
 which can possibly lead to very large transient forces and instabilities
 in the molecular dynamics trajectory.
 [Note that this will not be the case when linear scaling is performed,
 i.e.
 when 
\begin_inset Formula $i=-$
\end_inset

1, as is generally the case for valence and torsion angles.
 Thus, for linear scaling, the default (exact) force calculation should
 be used].
\end_layout

\begin_layout Standard
It should be noted that forces calculated using Eq.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:tavforce2"

\end_inset

 are not conservative forces, and would cause the system to gradually heat
 up, if no velocity rescaling were performed.
 The temperature coupling algorithm should act to maintain the average temperatu
re near the target value.
 At any rate, this heating tendency should not be a problem in simulations,
 such as fitting NMR data, where MD is being used to sample conformational
 space rather than to extract thermodynamic data.
\end_layout

\begin_layout Standard
This section has described the methods of time-averaged restraints.
 For more discussion, the interested user is urged to consult studies where
 this method has been used.
\begin_inset CommandInset citation
LatexCommand cite
key "Torda89,Pearlman91,Torda93,Pearlman94,Pearlman94a"
literal "true"

\end_inset


\end_layout

\begin_layout Section

\series bold
Multiple copies refinement using LES
\end_layout

\begin_layout Standard
NMR restraints can be made compatible with the multiple copies (LES) facility;
 see the following chapter for more information about LES.
 To use NMR constraints with LES, you need to do two things:
\end_layout

\begin_layout Standard
(1) Add a line like "file wnmr name=(lesnmr) wovr" to your input to 
\shape italic
addles.

\shape default
 The filename (lesnmr in this example) may be whatever you wish.
 This will cause 
\shape italic
addles
\shape default
 to output an additional file that is needed at the next step.
\end_layout

\begin_layout Standard
(2) Add "-les lesnmr" to the command line arguments to 
\shape italic
makeDIST_RST
\shape default
.
 This will read in the file created by 
\shape italic
addles
\shape default
 containing information about the copies.
 All NMR restraints will then be interpreted as "ambiguous" restraints,
 so that if any of the copies satisfies the restraint, the penalty goes
 to zero.
\end_layout

\begin_layout Standard
Note that although this scheme has worked well on small peptide test cases,
 we have yet not used it extensively for larger problems.
 This should be treated as an experimental option, and users should use
 caution in applying or interpreting the results.
\end_layout

\begin_layout Section

\series bold
Some sample input files
\end_layout

\begin_layout Standard
The next few pages contain excerpts from some sample NMR refinement files
 used at TSRI.
 The first example just sets up a simple (but often effective) simulated
 annealing run.
 You may have to adjust the length, temperature maximum, etc.
 somewhat to fit your problem, but these values work well for many "ordinary"
 NMR problems.

\series bold
 
\end_layout

\begin_layout Subsection

\series bold
1.
 Simulated annealing NMR refinement
\series default
 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

15ps simulated annealing protocol 
\end_layout

\begin_layout Plain Layout

&cntrl 
\end_layout

\begin_layout Plain Layout

  nstlim=15000, ntt=1, !(time limit, temp.
 control) 
\end_layout

\begin_layout Plain Layout

  ntpr=500, pencut=0.1, !(control of printout) 
\end_layout

\begin_layout Plain Layout

  ipnlty=1, nmropt=1, !(NMR penalty function options)
\end_layout

\begin_layout Plain Layout

  vlimit=10, !(prevent bad temp.
 jumps)
\end_layout

\begin_layout Plain Layout

  ntb=0, !(non-periodic simulation)
\end_layout

\begin_layout Plain Layout

  igb=8, !(generalize Born solvent model)
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# Simple simulated annealing algorithm: 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# from steps 0 to 1000: raise target temperature 10-1200K 
\end_layout

\begin_layout Plain Layout

# from steps 1000 to 3000: leave at 1200K 
\end_layout

\begin_layout Plain Layout

# from steps 3000 to 15000: re-cool to low temperatures 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

&wt type='TEMP0', istep1=0,istep2=1000,value1=10., 
\end_layout

\begin_layout Plain Layout

  value2=1200., / 
\end_layout

\begin_layout Plain Layout

&wt type='TEMP0', istep1=1001, istep2=3000, value1=1200., 
\end_layout

\begin_layout Plain Layout

  value2=1200.0, / 
\end_layout

\begin_layout Plain Layout

&wt type='TEMP0', istep1=3001, istep2=15000, value1=0., 
\end_layout

\begin_layout Plain Layout

  value2=0.0, /  
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# Strength of temperature coupling:
\end_layout

\begin_layout Plain Layout

# steps 0 to 3000: tight coupling for heating and equilibration 
\end_layout

\begin_layout Plain Layout

# steps 3000 to 11000: slow cooling phase 
\end_layout

\begin_layout Plain Layout

# steps 11000 to 13000: somewhat faster cooling 
\end_layout

\begin_layout Plain Layout

# steps 13000 to 15000: fast cooling, like a minimization 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

&wt type='TAUTP', istep1=0,istep2=3000,value1=0.2,value2=0.2, / 
\end_layout

\begin_layout Plain Layout

&wt type='TAUTP', istep1=3001,istep2=11000,value1=4.0,value2=2.0, / 
\end_layout

\begin_layout Plain Layout

&wt type='TAUTP', istep1=11001,istep2=13000,value1=1.0,value2=1.0, /
\end_layout

\begin_layout Plain Layout

&wt type='TAUTP', istep1=13001,istep2=14000,value1=0.5,value2=0.5, /
\end_layout

\begin_layout Plain Layout

&wt type='TAUTP', istep1=14001,istep2=15000,value1=0.05,value2=0.05, /
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# "Ramp up" the restraints over the first 3000 steps:
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

&wt type='REST', istep1=0,istep2=3000,value1=0.1,value2=1.0, /
\end_layout

\begin_layout Plain Layout

&wt type='REST', istep1=3001,istep2=15000,value1=1.0,value2=1.0, /
\end_layout

\begin_layout Plain Layout

&wt type='END' /
\end_layout

\begin_layout Plain Layout

LISTOUT=POUT (get restraint violation list)
\end_layout

\begin_layout Plain Layout

DISANG=RST.f (file containing NMR restraints) 
\end_layout

\end_inset


\end_layout

\begin_layout Standard
The next example just shows some parts of the actual RST file that 
\shape italic
sander
\shape default
 would read.
 This file would ordinarily 
\shape italic
not
\shape default
 be made or edited by hand; rather, run the programs 
\shape italic
makeDIST_RST
\shape default
, 
\shape italic
makeANG_RST
\shape default
 and 
\shape italic
makeCHIR_RST
\shape default
, combining the three outputs together to construct the RST file.

\series bold
 
\end_layout

\begin_layout Subsection

\series bold
Part of the RST.f file referred to above
\series default
\shape italic
 
\end_layout

\begin_layout LyX-Code

\shape italic
# first, some distance constraints prepared by makeDIST_RST: 
\begin_inset Newline newline
\end_inset

 # (comment line is input to makeRST, &rst namelist is output) 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 #( proton 1 proton 2 upper bound) 
\begin_inset Newline newline
\end_inset

 #--------------------------------------------- 
\begin_inset Newline newline
\end_inset

 #
\shape default
 
\begin_inset Newline newline
\end_inset

 # 2 ILE HA 3 ALA HN 4.00 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 &rst iat= 23, 40, r3= 4.00, r4= 4.50, 
\begin_inset Newline newline
\end_inset

 r1 = 1.3, r2 = 1.8, rk2=0.0, rk3=32.0, ir6=1, / 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # 3 ALA HA 4 GLU HN 4.00 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 &rst iat= 42, 50, r3= 4.00, r4= 4.50, / 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # 3 ALA HN 3 ALA MB 5.50 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 &rst iat= 40, -1, r3= 6.22, r4= 6.72, 
\begin_inset Newline newline
\end_inset

 igr1= 0, 0, 0, 0, igr2= 44, 45, 46, 0, / 
\begin_inset Newline newline
\end_inset

 # 
\shape italic
 
\begin_inset Newline newline
\end_inset

 # .......etc......
 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # next, some dihedral angle constraints, from makeANG_RST: 
\begin_inset Newline newline
\end_inset

 #
\shape default
 
\begin_inset Newline newline
\end_inset

 &rst iat= 213, 215, 217, 233, r1=-190.0, 
\begin_inset Newline newline
\end_inset

 r2=-160.0, r3= -80.0, r4= -50.0, / 
\begin_inset Newline newline
\end_inset

 &rst iat= 233, 235, 237, 249, r1=-190.0, 
\begin_inset Newline newline
\end_inset

 r2=-160.0, r3= -80.0, r4= -50.0, / 
\shape italic
 
\begin_inset Newline newline
\end_inset

 # .......etc.......
 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # next, chirality and omega constraints prepared by makeCHIR_RST: 
\begin_inset Newline newline
\end_inset

 #
\shape default
 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # chirality for residue 1 atoms: CA CG HB2 HB3 
\begin_inset Newline newline
\end_inset

 &rst iat= 3 , 8 , 6 , 7 , 
\begin_inset Newline newline
\end_inset

 r1=10., r2=60., r3=80., r4=130., rk2 = 10., rk3=10., / 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # chirality for residue 1 atoms: CB SD HG2 HG3 
\begin_inset Newline newline
\end_inset

 &rst iat= 5 , 11 , 9 , 10 , / 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # chirality for residue 1 atoms: N C HA CB 
\begin_inset Newline newline
\end_inset

 &rst iat= 1 , 18 , 4 , 5 , / 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # chirality for residue 2 atoms: CA CG2 CG1 HB 
\begin_inset Newline newline
\end_inset

 &rst iat= 22 , 26 , 30 , 25 , / 
\begin_inset Newline newline
\end_inset

 # 
\shape italic
 
\begin_inset Newline newline
\end_inset

 ......etc........
 
\begin_inset Newline newline
\end_inset

 # trans-omega constraint for residue 2
\shape default
 
\begin_inset Newline newline
\end_inset

 &rst iat= 22 , 20 , 18 , 3 , 
\begin_inset Newline newline
\end_inset

 r1=155., r2=175., r3=185., r4=205., rk2 = 80., rk3=80., / 
\shape italic
 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # trans-omega constraint for residue 3
\shape default
 
\begin_inset Newline newline
\end_inset

 &rst iat= 41 , 39 , 37 , 22 , / 
\shape italic
 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # trans-omega constraint for residue 4
\shape default
 
\begin_inset Newline newline
\end_inset

 &rst iat= 51 , 49 , 47 , 41 , / 
\shape italic
 
\begin_inset Newline newline
\end_inset

 # 
\begin_inset Newline newline
\end_inset

 # ......etc........
\end_layout

\begin_layout LyX-Code
 
\shape italic
#
\end_layout

\begin_layout LyX-Code
 The next example is an input file for volume-based NOE refinement.
 As with the distance/angle RST file shown above, the user would generally
 not construct this file, but create it from a "7-column" file using the
 makeDIST_RST program.
 Hand-editing might be used at the top of the file, to change the correlation
 times, etc.
 
\end_layout

\begin_layout Subsection

\series bold
3.
 Sample NOESY intensity input file
\end_layout

\begin_layout LyX-Code
# 
\shape italic
A part of a NOESY intensity file:
\shape default
 
\begin_inset Newline newline
\end_inset

 &noeexp 
\begin_inset Newline newline
\end_inset

 id2o=1, 
\shape italic
(exchangeable protons removed)
\shape default
 
\begin_inset Newline newline
\end_inset

 oscale=6.21e-4, 
\shape italic
(scale between exp.
 and calc.
 intensity units)
\shape default
 
\begin_inset Newline newline
\end_inset

 taumet=0.04, 
\shape italic
(correlation time for methyl rotation, in ns.)
\shape default
 
\begin_inset Newline newline
\end_inset

 taurot=4.2, 
\shape italic
(protein tumbling time, in ns.)
\shape default
 
\begin_inset Newline newline
\end_inset

 NPEAK = 13*3, 
\shape italic
(three peaks, each with 13 mixing times)
\shape default
 
\begin_inset Newline newline
\end_inset

 EMIX = 2.0E-02, 3.0E-02, 4.0E-02, 5.0E-02, 6.0E-02, 
\begin_inset Newline newline
\end_inset

 8.0E-02, 0.1, 0.126, 0.175, 0.2, 0.25, 0.3, 0.35, 
\shape italic
 
\begin_inset Newline newline
\end_inset

 (mixing times, in sec.)
\shape default
 
\begin_inset Newline newline
\end_inset

 IHP(1,1) = 13*423, IHP(1,2) = 13*1029, IHP(1,3) = 13*421, 
\shape italic
 
\begin_inset Newline newline
\end_inset

 (number of the first proton)
\shape default
 
\begin_inset Newline newline
\end_inset

 JHP(1,1) = 78*568, JHP(1,2) = 65*1057, JHP(1,3) = 13*421, 
\shape italic
 
\begin_inset Newline newline
\end_inset

 (number of the second proton)
\shape default
 
\begin_inset Newline newline
\end_inset

 AEXP(1,1) = 5.7244, 7.6276, 7.7677, 9.3519, 
\begin_inset Newline newline
\end_inset

 10.733, 15.348, 18.601, 
\begin_inset Newline newline
\end_inset

 21.314, 26.999, 30.579, 
\begin_inset Newline newline
\end_inset

 33.57, 37.23, 40.011, 
\shape italic
 
\begin_inset Newline newline
\end_inset

 (intensities for the first cross-peak)
\shape default
 
\begin_inset Newline newline
\end_inset

 AEXP(1,2) = 8.067, 11.095, 13.127, 18.316, 
\begin_inset Newline newline
\end_inset

 22.19, 26.514, 30.748, 
\begin_inset Newline newline
\end_inset

 39.438, 44.065, 47.336, 
\begin_inset Newline newline
\end_inset

 54.467, 56.06, 60.113, 
\begin_inset Newline newline
\end_inset

 AEXP(1,3) = 7.708, 13.019, 15.943, 19.374, 
\begin_inset Newline newline
\end_inset

 25.322, 28.118, 35.118, 
\begin_inset Newline newline
\end_inset

 40.581, 49.054, 53.083, 
\begin_inset Newline newline
\end_inset

 56.297, 59.326, 62.174, 
\begin_inset Newline newline
\end_inset

 / 
\begin_inset Newline newline
\end_inset

 SUBMOL1 
\begin_inset Newline newline
\end_inset

 RES 27 27 29 29 39 41 57 57 70 70 72 72 82 82 
\shape italic
(residues in this submol)
\end_layout

\begin_layout LyX-Code
END END
\end_layout

\begin_layout Standard
Next, we illustrate the form of the file that holds residual dipolar coupling
 restraints.
 Again, this would generally be created from a human-readable input using
 the program 
\shape italic
makeDIP_RST
\shape default
.
\end_layout

\begin_layout Subsection

\series bold
Residual dipolar restraints, prepared by makeDIP_RST:
\end_layout

\begin_layout LyX-Code
&align
\end_layout

\begin_layout LyX-Code
ndip=91, dcut=-1.0, gigj = 37*-3.1631, 54*7.8467,
\end_layout

\begin_layout LyX-Code
s11=3.883, s22=53.922, s12=33.855, s13=-4.508, s23=-0.559,
\end_layout

\begin_layout LyX-Code
id(1)=188, jd(1)=189, dobsu(1)= 6.24, dobsl(1)= 6.24,
\end_layout

\begin_layout LyX-Code
id(2)=208, jd(2)=209, dobsu(2)= -10.39, dobsl(1)= -10.39,
\end_layout

\begin_layout LyX-Code
id(3)=243, jd(3)=244, dobsu(3)= -8.12, dobsl(1)= -8.12,
\end_layout

\begin_layout LyX-Code
....
\end_layout

\begin_layout LyX-Code
id(91)=1393, jd(91)=1394, dobsu(91)= -19.64, dobsl(91) = -19.64,
\end_layout

\begin_layout LyX-Code
/
\end_layout

\begin_layout Standard
Finally, we show how the detailed input to 
\shape italic
sander
\shape default
 could be used to generate a more complicated restraint.
 Here is where the user would have to understand the details of the RST
 file, since there are no "canned" programs to create this sort of restraint.
 This illustrates, though, the potential power of the program.

\series bold
 
\end_layout

\begin_layout Subsection

\series bold
A more complicated constraint
\series default
 
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

# 1) Define two centers of mass.
 COM1 is defined by 
\end_layout

\begin_layout Plain Layout

# {C1 in residue 2; C1 in residue 3; N2 in residue 4; C1 in residue 5}.
 
\end_layout

\begin_layout Plain Layout

# COM2 is defined by {C4 in residue 1; O4 in residue 1; N* in residue 1}.
 
\end_layout

\begin_layout Plain Layout

# (These definitions are effected by the igr1/igr2 and grnam1/grnam2 
\end_layout

\begin_layout Plain Layout

# variables; You can use up to 200 atoms to define a center-of-mass 
\end_layout

\begin_layout Plain Layout

# group) 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# 2) Set up a distance restraint between COM1 and COM2 which goes from a
 
\end_layout

\begin_layout Plain Layout

# target value of 5.0A to 2.5A, with a force constant of 1.0, over steps 1-5000.
 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# 3) Set up a distance restraint between COM1 and COM2 which remains fixed
 
\end_layout

\begin_layout Plain Layout

# at the value of 2.5A as the force slowly constant decreases from 
\end_layout

\begin_layout Plain Layout

# 1.0 to 0.01 over steps 5001-10000.
 
\end_layout

\begin_layout Plain Layout

# 
\end_layout

\begin_layout Plain Layout

# 4) Sets up no distance restraint past step 10000, so that free (unrestrained)
 
\end_layout

\begin_layout Plain Layout

# dynamics takes place past this step.
 
\end_layout

\begin_layout Plain Layout

#
\end_layout

\begin_layout Plain Layout

&rst iat=-1,-1, nstep1=1,nstep2=5000,
\end_layout

\begin_layout Plain Layout

  iresid=1,irstyp=0,ifvari=1,ninc=0,imult=0,ir6=0,ifntyp=0,
\end_layout

\begin_layout Plain Layout

  r1=0.00000E+00,r2=5.0000,r3=5.0000, r4=99.000,rk2=1.0000,rk3=1.0000,
\end_layout

\begin_layout Plain Layout

  r1a=0.00000E+00,r2a=2.5000,r3a=2.5000, r4a=99.000,rk2a=1.0000,rk3a=1.0000, 
\end_layout

\begin_layout Plain Layout

  igr1 = 2,3,4,5,0, grnam1(1)='C1',grnam1(2)='C1',grnam1(3)='N2',
\end_layout

\begin_layout Plain Layout

  grnam1(4)='C1', igr2 = 1,1,1,0, grnam2(1)='C4',grnam2(2)='O4',grnam2(3)='N*',
 
\end_layout

\begin_layout Plain Layout

/ 
\end_layout

\begin_layout Plain Layout

&rst iat=-1,-1, nstep1=5001,nstep2=10000,
\end_layout

\begin_layout Plain Layout

  iresid=1,irstyp=0,ifvari=1,ninc=0,imult=0,ir6=0,ifntyp=0,
\end_layout

\begin_layout Plain Layout

  r1=0.00000E+00,r2=2.5000,r3=2.5000, r4=99.000,rk2=1.0000,rk3=1.0000,
\end_layout

\begin_layout Plain Layout

  r1a=0.00000E+00,r2a=2.5000,r3a=2.5000, r4a=99.000,rk2a=1.0000,rk3a=0.0100,
\end_layout

\begin_layout Plain Layout

  igr1 = 2,3,4,5,0, grnam1(1)='C1',grnam1(2)='C1',grnam1(3)='N2',
\end_layout

\begin_layout Plain Layout

  grnam1(4)='C1', igr2 = 1,1,1,0, grnam2(1)='C4',grnam2(2)='O4',grnam2(3)='N*',
 
\end_layout

\begin_layout Plain Layout

/
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
Xray and cryoEM refinement
\end_layout

\begin_layout Section
EMAP restraints for rigid and flexible fitting into EM maps
\begin_inset CommandInset label
LatexCommand label
name "sec:EMAPcons"

\end_inset


\end_layout

\begin_layout Standard
EMAP restrained simulation
\begin_inset CommandInset citation
LatexCommand citep
key "Wu03a,Wu13"
literal "true"

\end_inset

 was developed to incorporate electron microscopy (EM) image information
 into macromolecular structure determination.
 Different from NMR and X-ray data, EM images have low resolutions (5~50Å).
 However, EM images of large molecular assemblies up to millions of atoms
 and in various biologically relevant environments are available.
 These low resolution images provide precious structural information that
 can help to determine structures of many molecular assemblies and machineries
\begin_inset CommandInset citation
LatexCommand citep
key "Wu03a,Wu06a,Wu07,Wu08a,Wu08b,Wu08c,Wu11c,Wu11d,wu14b,wu16b,Wu15s"
literal "true"

\end_inset

.
 
\end_layout

\begin_layout Standard
With EMAP restraints, Sander and PMEMD can be used to perform both rigid
\begin_inset CommandInset citation
LatexCommand citep
key "Wu03a"
literal "true"

\end_inset

 and flexible
\begin_inset CommandInset citation
LatexCommand citep
key "Wu13"
literal "true"

\end_inset

 fitting of molecules into experimental maps of complexes to obtain both
 complex structures and conformations agreeing with experimental maps.
 In addition to experimental map information, homologous structural information
 can be used by EMAP to perform targeted conformational search (TCS) to
 induce simulation systems to form structures of interest.
\end_layout

\begin_layout Standard
If the restraint map or structure is very different from the starting conformati
on, SGLD is recommended to induce large conformational change by setting
 
\shape italic
isgld
\shape default
=1.
 This is often used to simulate conformational transition between different
 states.
 See the Sampling and free energy search section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Self-Guided-Langevin-dynamics"

\end_inset

 for details on running SGLD.
\end_layout

\begin_layout Standard
If domain motion is desired while domain structures need to be maintained,
 one can use an EMAP restraint generated from the initial coordinates for
 each domain and set 
\shape italic
move
\shape default
=1 to allow the restraint map to move with the domain, so that domains can
 search the conformational space without unfolding or changing shape.
\end_layout

\begin_layout Standard
Each EMAP restraint is defined by a map file and a selection of atoms, as
 well as related parameters.
 Multiple EMAP restraints can be defined.
 The map can be either input from an image file, or generated from a pdb
 structure or derived from the starting coordinates.
 The definition of EMAP restraints are read in from the input file as 
\begin_inset Quotes eld
\end_inset

&emap
\begin_inset Quotes erd
\end_inset

 namelists.
 The following are variables in each &emap namelist.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mapfile
\begin_inset Index idx
status open

\begin_layout Plain Layout
mapfile
\end_layout

\end_inset

 The filename of a restraint map or structure.
 The restraint maps must be in 
\begin_inset Quotes eld
\end_inset

map
\begin_inset Quotes erd
\end_inset

, 
\begin_inset Quotes eld
\end_inset

ccp4
\begin_inset Quotes erd
\end_inset

, or 
\begin_inset Quotes eld
\end_inset

mrc
\begin_inset Quotes erd
\end_inset

 format.
 The structure must be in pdb format.
 The structure need not be the same as the simulation system.
 A resolution can be specified for the conversion to a density map.
 When a blank filename is specified, 
\shape italic
mapfile
\shape default
='', the input coordinates of the masked atoms will be used to generate
 a restraint map (default='').
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
atmask
\begin_inset Index idx
status open

\begin_layout Plain Layout
atmask
\end_layout

\end_inset

 The atom mask for selecting atoms to be restrained (default=':*').
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
fcons
\begin_inset Index idx
status open

\begin_layout Plain Layout
fcons
\end_layout

\end_inset

 The restraining constant (default=0.05 kcal/g).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
move
\begin_inset Index idx
status open

\begin_layout Plain Layout
move
\end_layout

\end_inset

 Allow the restraint map to move when 
\shape italic
move
\shape default
>0 (default=0).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
resolution
\begin_inset Index idx
status open

\begin_layout Plain Layout
resolution
\end_layout

\end_inset

 The resolution used to convert an atomic structure to a map (default=2
 Å).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
ifit
\begin_inset Index idx
status open

\begin_layout Plain Layout
ifit
\end_layout

\end_inset

 Perform rigid fitting before simulation when 
\shape italic
ifit
\shape default
>0.
 One would do this when the initial coordinates don't match those of the
 map (default=0).
 When ifit=1, the map is transformed (by translation and rotation) to match
 the coordinates; the coordinates are not altered.
 EMAP allows output of the re-oriented map (
\emph on
mapfit
\emph default
=...) that matches the (final) simulation coordinates, 
\emph on
and/or
\emph default
 output of the coordinates (
\emph on
molfit
\emph default
=...) that would match the orientation of the original map.
 When ifit=2, the masked atoms will be transformed to fit the map and the
 transformed coordinates will be used for the following simulation.
 For periodic systems, ifit=2 may cause atoms to clash with periodic image
 atoms.
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
grids
\begin_inset Index idx
status open

\begin_layout Plain Layout
grids
\end_layout

\end_inset

 Grid numbers in x,y,z,phi,psi,theta dimensions for grid-threading rigid
 fitting
\begin_inset CommandInset citation
LatexCommand citep
key "Wu03a"
literal "true"

\end_inset

.
 For example, grids=2,2,2,3,3,3 defines 2 grid points in each of x,y,z direction
s between the minimum and maximum coordinates, and 3 grid points in each
 of phi (0-360), psi(0-360), theta(0-180) angles.
 A search for local minimums starts from every grid point and the global
 minimum is identified from all the local minimums (default=1,1,1,1,1,1).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
mapfit
\begin_inset Index idx
status open

\begin_layout Plain Layout
mapfit
\end_layout

\end_inset

 The filename for the final constraint map after rigid fitting and/or moving.
 The filename must has an extension of .map, .ccp4, or .mrc (default=
\family typewriter
''
\family default
, for no map output).
\end_layout

\begin_layout Labeling
\labelwidthstring 00.00.0000
molfit
\begin_inset Index idx
status open

\begin_layout Plain Layout
molfit
\end_layout

\end_inset

 The filename for the final restrained atom coordinates after rigid fitting
 and/or simulation.
 The filename must have an extension of .pdb (default=
\family typewriter
''
\family default
, for no structure output).
\end_layout

\begin_layout Standard
Here is an example input file for an EMAP constrained SGLD simulation:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

Map Constraint Self-Guided Langevin dynamics
\end_layout

\begin_layout Plain Layout

&cntrl ntx=1, ntb=0,nstlim=100000, imin=0, maxcyc=1, ntc=2, ntf=2, cut=9.0,
\end_layout

\begin_layout Plain Layout

ntpr=1000, ntwr=100000,ntwx=10000, ntt=3, gamma_ln=10.0,nscm=100, dt=0.001,
\end_layout

\begin_layout Plain Layout

ntb=0,igb=0,ips=1, isgld=1, tsgavg=1.0, sgft=0.5,tempsg=0,         (SGLD)
\end_layout

\begin_layout Plain Layout

iemap=1,                   (turn on EMAP )
\end_layout

\begin_layout Plain Layout

/
\end_layout

\begin_layout Plain Layout

&emap          (EMAP restraint 1 )
\end_layout

\begin_layout Plain Layout

mapfile='data/1gb1.ccp4',  (map is input from a map file)
\end_layout

\begin_layout Plain Layout

atmask=':1-20',            (residues 1-20 are restrained)
\end_layout

\begin_layout Plain Layout

fcons=0.1,
\end_layout

\begin_layout Plain Layout

move=1,                    (restraint map can move)
\end_layout

\begin_layout Plain Layout

ifit=1,                    (perform rigid fitting first)
\end_layout

\begin_layout Plain Layout

mapfit='scratch/gb1n_1.ccp4',  (final map)
\end_layout

\begin_layout Plain Layout

molfit='scratch/gb1n_1.pdb', / (final restrained atoms related to initial
 map)
\end_layout

\begin_layout Plain Layout

&emap          (EMAP restraint 2)
\end_layout

\begin_layout Plain Layout

mapfile='data/1gb1.pdb',  (map is generated from a pdb file)
\end_layout

\begin_layout Plain Layout

atmask=':22-37',          (residues 22-37 are restrained)
\end_layout

\begin_layout Plain Layout

fcons=0.1,move=0,         (restraint map is fixed)
\end_layout

\begin_layout Plain Layout

ifit=1,                   (perform rigid fitting first)
\end_layout

\begin_layout Plain Layout

mapfit='scratch/gb1h_1.ccp4',   (final map, same as initial)
\end_layout

\begin_layout Plain Layout

molfit='scratch/gb1h_1.pdb', / (final restrained atoms related to initial
 map)
\end_layout

\begin_layout Plain Layout

&emap          (EMAP restraint 3)
\end_layout

\begin_layout Plain Layout

mapfile='',    (map is generated from initial coordinates)
\end_layout

\begin_layout Plain Layout

atmask=':41-56',  (residues 41-56 are restrained)
\end_layout

\begin_layout Plain Layout

fcons=0.1,move=1, (restraint map can move)
\end_layout

\begin_layout Plain Layout

ifit=1,       (perform rigid fitting first)
\end_layout

\begin_layout Plain Layout

mapfit='scratch/gb1c_1.ccp4',  (final map)
\end_layout

\begin_layout Plain Layout

molfit='scratch/gb1c_1.pdb', / (final restrained atoms related to initial
 map)
\end_layout

\end_inset


\end_layout

\begin_layout Section
Setting up crystal simulations
\begin_inset CommandInset label
LatexCommand label
name "chap:crystals"

\end_inset


\end_layout

\begin_layout Standard
\align center

\emph on
David S.
 Cerutti
\end_layout

\begin_layout Standard
Simulations of biomolecular crystals are in principle no different than
 any of the simulations that AMBER does in periodic boundary conditions.
 However, the setup of these systems is not trivial and probably cannot
 be accomplished with the LEaP software.
 Of principal importance are the construction of the solvent conditions
 (packing precise amounts of multiple solvent species into the simulation
 cell), and tailoring the unit cell dimensions to accommodate the inherently
 periodic nature of the system.
 The LEaP software, designed to construct simulations of molecules in solution,
 will overlay a pre-equilibrated solvent mask over the (biomolecular) solute,
 tile that mask throughout the simulation cell, and then prune solvent residues
 which clash with the solute.
 The result of this procedure is a system which will likely contract under
 constant pressure dynamics as the pruning process has left vacuum bubbles
 at the solute:solvent interface.
 Simulations of biomolecular crystals require that the simulation cell begin
 at a size corresponding to the crystallographic unit cell, and deviate
 very little from that size over the course of equilibration and onset of
 constant pressure dynamics.
 This demands a different strategy for placing solvent in the simulation
 cell.
 Four programs in the 
\emph on
AmberTools
\emph default
 release are designed to accomplish this.
 An example of their use in given in a web-based tutorial at 
\emph on
https://ambermd.org/tutorials/advanced/tutorial13/XtalTutor1.html 
\emph default
.
 A recent (2018) review of crystal simulations is also worth consulting.
\begin_inset CommandInset citation
LatexCommand citep
key "Cerutti18"
literal "true"

\end_inset


\end_layout

\begin_layout Standard
For brevity, only basic descriptions of the programs are given in this manual.
 All of the programs may be run with command line input; the input options
 to each program may be listed by running each program with no arguments.
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:UnitCell"

\end_inset

UnitCell
\end_layout

\begin_layout Standard
A macromolecular crystal contains many repeating unit cells which stack
 like blocks in three dimensional space just as simulation cells do in periodic
 boundary conditions.
 Each unit cell, in turn, may contain multiple symmetry-related clusters
 of atoms.
 A PDB file contains one set of coordinates for the irreducible unit of
 the crystal, the 
\begin_inset Quotes eld
\end_inset

asymmetric unit,
\begin_inset Quotes erd
\end_inset

 and also information about the crystal space group and unit cell dimensions.
 The 
\emph on
UnitCell
\emph default
 program reads PDB files, seeking the SMTRY records within the REMARKs to
 enumerate the rotation and translation operations which may be applied
 to the coordinates given in the PDB file to reconstruct one complete unit
 cell.
\end_layout

\begin_layout Standard
Usage of the 
\shape italic
UnitCell
\shape default
 program is as follows.
 The simple command rests on a critical assumption, that the PDB file contains
 an accurate CRYST1 record and that the REMARK 290 SMTRY records provide
 its space group symmetry operations.
 
\end_layout

\begin_layout LyX-Code
UnitCell -p MyProtein.pdb -o UnitCell.pdb
\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "subsec:PropPDB"

\end_inset

PropPDB
\end_layout

\begin_layout Standard
Simulations in periodic boundary conditions require a minimum unit cell
 size: the simulation cell must be able to enclose a sphere of at least
 the nonbonded direct space cutoff radius plus a small buffer region for
 nonbonded pairlist updates.
 Many biomolecular crystal unit cells come in 
\begin_inset Quotes eld
\end_inset

shoebox
\begin_inset Quotes erd
\end_inset

 dimensions that may have one very short side; many unit cells are also
 not rectangular but triclinic, meaning that the size of the largest sphere
 they can enclose is further reduced.
 The workhorse simulation engine, pmemd.cuda, even requires that the simulation
 cell be at least three times as thick as the cutoff plus some buffer margin
 in order to run safely: for typical sum conditions this thickness is about
 30Å.
 For these reasons, and perhaps to ensure that the rigid symmetry imposed
 by periodic boundary conditions does not create artifacts (crystallographic
 unit cells are equivalent when averaged over all time and space, but are
 not necessarily identical at any given moment), it may be necessary to
 include multiple unit cells within the simulation cell.
 This is the purpose of the 
\emph on
PropPDB
\emph default
 program: to propagate a unit cell in one or more directions so that the
 complete simulation cell meets minimum size requirements.
\end_layout

\begin_layout Standard
Drawing on the hypothetical example above, if the unit cell is too small
 we can extend it in the 
\shape italic
x
\shape default
 and 
\shape italic
z
\shape default
 dimensions:
\end_layout

\begin_layout LyX-Code
PropPDB -p UnitCell -o ExpandedCell.pdb -ix 2 -iy 1 -iz 2
\end_layout

\begin_layout Subsection
AddToBox
\begin_inset CommandInset label
LatexCommand label
name "subsec:AddToBox"

\end_inset


\end_layout

\begin_layout Standard
The 
\emph on
AddToBox
\emph default
 program handles placement of solvent within a crystal unit cell or supercell
 (as may be created by PropPDB).
 As described in the introduction, the basic strategy is to place solvent
 such that added solvent molecules do not clash with biomolecule solutes,
 but 
\shape italic
may
\shape default
 clash with one another initially.
 This compromise is necessary because enough solvent must be added to the
 system to ensure that the correct unit cell dimensions are maintained in
 the long run, but it is not acceptable to place solvent within the interior
 of a biomolecule where it might not belong and never escape.
\end_layout

\begin_layout Standard
The 
\emph on
AddToBox
\emph default
 program takes a PDB file providing the coordinates of a complete biomolecular
 unit cell or supercell (argument -c), the dimensions by which that supercell
 repeats in space (the unit cell dimensions are taken from the CRYST1 record
 of this file), a PDB file describing the solvent residue to add (argument
 -a), and the number of copies of that solvent molecule to add (argument
 -na).
 
\emph on
AddToBox
\emph default
 inherently assumes that the biomolecular unit cell it is initially presented
 may contain some amount of solvent already, and according to the AMBER
 convention of listing macromolecular solute atoms first and solvent last
 assumes that the first -P atoms in the file are the protein (or biomolecule).
 
\emph on
AddToBox
\emph default
 will then color a very fine grid 
\begin_inset Quotes eld
\end_inset

black
\begin_inset Quotes erd
\end_inset

 if the grid point is within a certain distance of a biomolecular atom (argument
 -RP, default 5.0Å) or other solvent atom (argument -RW, default 1.0Å); the
 grid is 
\begin_inset Quotes eld
\end_inset

white
\begin_inset Quotes erd
\end_inset

 otherwise (the grid is stored in binary for memory efficiency).
 
\emph on
AddToBox
\emph default
 will the make a copy of the solvent residue and randomly rotate and translate
 it somewhere within the unit cell.
 If all atoms of the solvent residue land on 
\begin_inset Quotes eld
\end_inset

white
\begin_inset Quotes erd
\end_inset

 grid voxels, the solvent molecule will become part of the system and the
 grid around the newly added solvent will be blacked out accordingly.
 If the solvent molecule cannot be placed, this process will be repeated
 until a million consecutive failures are encountered, at which point the
 program will terminate.
 If 
\emph on
AddToBox
\emph default
 has not placed the requested number of solvent molecules by the time it
 terminates, the -V option can be used to order the program to recursively
 call itself with progressively smaller solvent buffer distances until all
 the requested solvent can be placed.
 The output of the 
\emph on
AddToBox
\emph default
 program is another PDB named by the -o option.
\end_layout

\begin_layout Standard
Successful operation of 
\emph on
AddToBox
\emph default
 may take practice.
 If multiple solvent species are required, as is the case with heterogeneous
 crystallization solutions, 
\emph on
AddToBox
\emph default
 may be called repeatedly with each input molecular cell being the previous
 call's output.
 When considering crystal solvation, the order of addition is important!
 It is recommended that rare species, such as trace buffer reagents, be
 added first, with large -RW argument to ensure that they are dispersed
 throughout the available crystal void zones.
 Large solvent species such as MPD (an isohexane diol commonly used in crystalli
zation conditions) should be added second, and with a sufficiently large
 -RW argument that methyl groups and ring systems cannot become interlocked
 (which will likely lead to SHAKE / vlimit errors).
 Small and abundant species such as water should be added last, as they
 can go anywhere that space remains.
\end_layout

\begin_layout Standard
Below is an example of the usage for a hypothetical protein with 5431 atoms
 and a net charge of +6 that is to be neutralized with ammonium sulfate:
\end_layout

\begin_layout LyX-Code
AddToBox -c ExpandedCell.pdb -a Sulfate.pdb -na 18 -RP 3.0 -P 5431 -o System.pdb
\end_layout

\begin_layout LyX-Code
AddToBox -c System.pdb -a Ammonium.pdb -na 30 -RP 3.0 -P 5431 -o System.pdb
\end_layout

\begin_layout LyX-Code
AddToBox -c System.pdb -a Water.pdb -na 1089 -RP 3.0 -P 5431 -o System.pdb
\end_layout

\begin_layout Standard
The use of the -V flag ensures that the desired amounts of each species
 are included.
 The protein clipping radius of 3Å is lower than the default, but safe (remember
, this radius stipulates that no solvent atom, regardless of the size of
 the solvent molecule, come within 3Å of the protein).
 Note how the original protein PDB file serves as the base for system, but
 thereafter we work with the System.pdb to accumulate more solvent particles.
 Here, the ammonium sulfate serves both to neutralize the system and replicate
 a salty bath, perhaps from a crystallization mother liquor, hence the break
 from the usual 2:1 stoichiometry of ammonium sulfate ions.
\end_layout

\begin_layout Standard
It is likely that the unobservable 
\begin_inset Quotes eld
\end_inset

void
\begin_inset Quotes erd
\end_inset

 regions between biomolecules in most crystals 
\shape italic
do not
\shape default
 contain solvent species in proportion to their abundance in the crystallization
 solution–the vast majority of these regions are within a few Ångstroms
 of some biomolecular surface, and different biomolecular functional groups
 will preferentially interact with some types of solvent over others.
 Also, in many crystals some solvent molecules 
\shape italic
are
\shape default
 observed; in many of these, the amount of solvent observed is such that
 it would be impossible to pack other species into the unit cell in proportion
 to their abundances in the crystallization fluid.
 In these cases, we recommend estimating the amount of volume that must
 be filled with solvent 
\shape italic
apart from solvent which has already been observed in the crystal
\shape default
, and filling this void with solvent in proportion to the composition of
 the crystallization fluid.
 For example, if a crystal were grown in a 1:1 mole-to-mole water/ethanol
 mixture, and the crystal coordinates as deposited in the PDB contained
 500 water molecules and 3 ethanol molecules, we would use 
\emph on
AddToBox
\emph default
 to add water and ethanol in a 1:1 ratio until the system contained enough
 solvent to maintain the correct volume during equilibrium dynamics at constant
 pressure.
\end_layout

\begin_layout Standard
Finally, it is difficult to estimate exactly how much solvent will be needed
 to maintain the correct equilibrium volume; the advisable approach is simply
 to make an initial guess and script the setup so that, over multiple runs
 and reconstructions, the correct system composition can be found.
 We recommend matching the equilibrium unit cell volume to within 0.3% to
 keep this simulation parameter within the error of most crystallographic
 measurements.
 While errors of 0.5-1% will show up quickly after constant pressure dynamics
 begin, a 10 to 20ns simulation may be needed to ensure that the correct
 equilibrium volume has been achieved.
\end_layout

\begin_layout Subsection
ChBox
\begin_inset CommandInset label
LatexCommand label
name "subsec:ChBox"

\end_inset


\end_layout

\begin_layout Standard
After the complex process of adding solvent, the LEaP program may be used
 to produce a topology and initial set of coordinates based on the PDB file
 produced by 
\emph on
AddToBox
\emph default
.
 By using the 
\shape italic
SetBox
\shape default
 command, LEaP will create a periodic system without adding any more solvent
 on its own.
 The only problem with using LEaP at this point is that the program will
 fail to realize that the system 
\shape italic
does
\shape default
 tile in three dimensions if only the box dimensions are set properly.
 If visualized, the output of UnitCell / PropPDB will likely look jagged,
 but the output of 
\emph on
AddToBox
\emph default
, containing lots of added water, will make it obvious how parts of biomolecules
 jutting out one face of the box fit neatly into open spaces on an opposite
 face.
 The topology produced by LEaP needs no editing; only the last line of the
 coordinates does.
 This can be done manually, but the 
\emph on
ChBox
\emph default
 program automates the process, taking the same coordinates supplied to
 AddToBox and grafting them into the input coordinates file.
\end_layout

\begin_layout Standard
The program is even unnecessary in the case of orthorhombic (rectangular)
 unit cells, as this the tleap command will substitute:
\end_layout

\begin_layout LyX-Code
set [unit] box { <x> <y> <z> }
\end_layout

\begin_layout Standard
For cells that do not have only 90-degree box angles, 
\shape italic
ChBox
\shape default
 will do the trick.
\end_layout

\begin_layout Section
X-ray functionality and diffraction-based restraints
\end_layout

\begin_layout Standard
The 
\emph on
msander
\emph default
 program includes a new module dedicated to biomolecular crystallography.
 It is envisioned that in future Amber can be used as a platform to address
 various crystallography-related problems, e.g.
 to refine crystallographic structures of proteins and nucleic acids (similar
 to the existing capability in the area of biomolecular NMR).
 This module is intended for use with an MD simulation of the crystal unit
 cell or a “supercell”
\begin_inset CommandInset citation
LatexCommand citep
key "Janowski2013"
literal "true"

\end_inset

.
 For information on how to set up a crystal simulation, including periodic
 boundary conditions to emulate crystalline lattice, see Chapter 
\begin_inset CommandInset ref
LatexCommand ref
reference "chap:crystals"

\end_inset

.
 It is expected that the crystal is solvated using an explicit (or implicit)
 solvent.
 While a number of crystallographic concepts are implemented in the new
 Amber module, many others have not yet been implemented.
 For example, an MD model of a crystal unit cell can naturally accommodate
 different side-chain conformations; however, the concept of alternate side-chai
n conformations, as employed in protein crystallography, is currently unavailabl
e in Amber.
\end_layout

\begin_layout Standard
Although it is not a part of Amber, it is worth noting that the 
\emph on
phenix
\emph default
 crystallographic package now allows for X-ray refinement using Amber (or
 other) force fields
\begin_inset CommandInset citation
LatexCommand citep
key "Moriarty20"
literal "true"

\end_inset

.
 This was accomplished by using the python API to 
\emph on
sander
\emph default
, and uses locally-enhanced sampling (see Chap.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "cha:LES"

\end_inset

) to handle alternate conformations.
 It supports all of the X-ray related options in 
\emph on
phenix.refine
\emph default
, but has limited options for molecular dynamics, and no GPU acceleration.
\end_layout

\begin_layout Subsection
Structure factor calculations
\end_layout

\begin_layout Standard
For the crystal simulation, the program can calculate crystallographic structure
 factors (SFs) for individual MD frames.
 The calculations are conducted using direct summation formula
\begin_inset CommandInset citation
LatexCommand citep
key "Afonine04"
literal "true"

\end_inset

; a mask is available to define the subset of atoms included in these calculatio
ns (
\emph on
atom_selection_mask
\emph default
).
 For example, this mask could select the macromolecules, but not the solvent
 or the neutralizing ions present in the simulation.
 The B-factors used in the direct summation formula are supplied through
 a designated PDB file.
 The set of Miller indices for SF calculations is supplied as a part of
 the 
\emph on
reflection_infile
\emph default
.
\end_layout

\begin_layout Standard
In principle, explicit solvent and ions can also be accounted for via the
 direct summation formula.
 However, any single individual frame does not offer an adequate statistical
 sampling with regard to the positioning of water molecules (if desired,
 such statistical sampling can be obtained by modeling of a very large supercell
 or otherwise by means of time averaging).
 As a commonly accepted alternative, Amber 22 offers two mask-based models
 of bulk solvent.
 The first one (
\emph on
bulk_solvent_model
\emph default
 = ‘simple’) is a simple variant of flat mask bulk solvent model
\begin_inset CommandInset citation
LatexCommand citep
key "Jiang94a"
literal "false"

\end_inset

, which calculates the contribution from interstitial solvent into SFs using
 two generic parameters (
\emph on
k_sol
\emph default
 and 
\emph on
b_sol
\emph default
), as reported by Fokine and Urzhumtsev
\begin_inset CommandInset citation
LatexCommand citep
key "Fokine02"
literal "false"

\end_inset

.
 The implementation, including the scheme to build solvent mask, is analogous
 to the one in cctbx library
\begin_inset CommandInset citation
LatexCommand citep
key "Grosse-Kunstleve02"
literal "false"

\end_inset

.
 The more advanced version (
\emph on
bulk_solvent_model
\emph default
 = ‘afonine-2013’) employs the varaible 
\begin_inset Formula $k_{mask}$
\end_inset

, which replaces 
\emph on
k_sol
\emph default
 and 
\emph on
b_sol
\emph default
; this variable is automatically optimized over the individual resolution
 bins
\begin_inset CommandInset citation
LatexCommand citep
key "Afonine13"
literal "false"

\end_inset

.
 The iterative optimization procedure to determinate 
\begin_inset Formula $k_{mask}$
\end_inset

 also adjusts the overall scaling coefficient that is applied to calculated
 SFs.
 The implementation follows the one in cctbx library with several minor
 modifications.
\end_layout

\begin_layout Standard
It is worth noting that crystal MD simulations in Amber (as described in
 Chap.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "chap:crystals"

\end_inset

) do not maintain a perfect space group symmetry.
 Therefore, strictly speaking, the calculated SFs correspond to P(1) space
 group with the unit cell that is identical to the simulation box.
 During the course of the simulation, the calculated SFs can be collected
 frame-by-frame at a specified interval (
\emph on
ntwsf
\emph default
) and stored in a form of special trajectory file (
\emph on
sf_outfile
\emph default
).
\end_layout

\begin_layout Subsection
Structure-factor-based potential
\end_layout

\begin_layout Standard
The X-ray energy term 
\begin_inset Formula $E_{xray}$
\end_inset

 is added to the total potential energy with the user-specified weight 
\begin_inset Formula $w_{xray}$
\end_inset

 (controlled by 
\emph on
xray_weight_initial
\emph default
 / 
\emph on
xray_weight_final 
\emph default
variables): 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
E_{total}=E_{force-field}+w_{xray}E_{xray}\label{eq:exray1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $E_{xray}$
\end_inset

 uses the set of target (i.e.
 experimentally observed) SFs, which are supplied via the input file 
\emph on
reflection_infile
\emph default
.
 This file must also contain flags to divide all reflections into a “working”
 set and a “free” (test) set.
 Currently 
\emph on
pmemd
\emph default
 offers two variants of the 
\begin_inset Formula $E_{xray}$
\end_inset

 term.
 The first one is a very simple least squares objective function (
\emph on
target
\emph default
 = ‘ls’) involving the aplitudes and of calculated and observed structure
 factors: 
\begin_inset Formula 
\begin{equation}
E_{xray}=\frac{\sum_{h,k,l}\left(F_{calc}(h,k,l)-F_{obs}(h,k,l)\right)^{2}}{\sum_{h,k,l}F_{obs}^{2}(h,k,l)}\label{eq:exray}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
The sum in this expression is over the working set of reflections.
\end_layout

\begin_layout Standard
The second option for 
\begin_inset Formula $E_{xray}$
\end_inset

 is the Maximum Likelihood target function (
\emph on
target
\emph default
 = ‘ml’)
\begin_inset CommandInset citation
LatexCommand citep
key "Lunin95,Afonine2005"
literal "false"

\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
E_{xray}=\sum_{h,k,l}\left(-\ln\left(\frac{2F_{obs}(h,k,l)}{\varepsilon\beta}\right)+\frac{F_{obs}^{2}(h,k,l)}{\varepsilon\beta}+\frac{\alpha^{2}F_{calc}^{2}(h,k,l)}{\varepsilon\beta}-\ln I_{0}\left(\frac{2\alpha F_{obs}(h,k,l)F_{calc}(h,k,l)}{\varepsilon\beta}\right)\right)\label{eq:exray_ml}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
where 
\begin_inset Formula $\alpha$
\end_inset

 and 
\begin_inset Formula $\beta$
\end_inset

 are (resolution-shell-dependent) ML likelihood distribution parameters,
 
\begin_inset Formula $\varepsilon$
\end_inset

 is the symmetry coefficient (
\begin_inset Formula $\varepsilon=1$
\end_inset

 for the space group P(1) at hand), 
\begin_inset Formula $I_{0}(x)$
\end_inset

 is the zeroth-order modified Bessel function of the first kind, and the
 summation is over the working set of reflections.
 For practical applications, we recommend using 
\emph on
target
\emph default
 = ‘ml’ along with the more advanced version of solvent, 
\emph on
bulk_solvent_model
\emph default
 = ‘afonine-2013’.
\end_layout

\begin_layout Standard
The expression for 
\begin_inset Formula $E_{xray}$
\end_inset

, along with the direct-summation formula for 
\begin_inset Formula $F_{calc}$
\end_inset

, provides a basis to evaluate forces.
 These 
\begin_inset Quotes eld
\end_inset

restraint
\begin_inset Quotes erd
\end_inset

 forces act like those used in NMR refinement, discussed in Chap.
\begin_inset CommandInset ref
LatexCommand ref
reference "chap:NMR"

\end_inset

, and are generally used to drive minimization or MD simulations that minimize
 
\begin_inset Formula $E_{total}$
\end_inset

.
 The value of 
\begin_inset Formula $E_{xray}$
\end_inset

 is reported in the mdout file, together with 
\begin_inset Formula $R_{work}$
\end_inset

 and 
\begin_inset Formula $R_{free}$
\end_inset

.
\end_layout

\begin_layout Standard
We envisage that SF-based restraints can be used for a number of purposes.
 For example, they can be viewed as an empirical addition to the force fields,
 which can potentially remedy certain existing biases
\begin_inset CommandInset citation
LatexCommand citep
key "Xue14c,Raval12a"
literal "true"

\end_inset

.
 Another promising application is refinement of crystallographic structures.
 Such an Amber-based protocol has been reported by Mikhailovskii et al.
\begin_inset CommandInset citation
LatexCommand citep
key "Mikhailovskii22"
literal "false"

\end_inset

 (the web interface is available at 
\begin_inset CommandInset href
LatexCommand href
name "https://arx.bio-nmr.spbu.ru"
target "https://arx.bio-nmr.spbu.ru"
literal "false"

\end_inset

).
 Ultimately, the entire process of crystallographic structure determination
 can be incorporated into Amber.
 This approach may be particularly valuable for lower-quality diffraction
 data sets and incomplete structural models (e.g.
 in the case of weak or missing electron density for mobile side chains,
 loops or terminal regions in protein molecules).
 In this situation, the state-of-the-art force field provides a natural
 solution to model the poorly resolved or unresolved elements of the structure.
 This is accomplished in a highly realistic manner, by using the explicit
 representation of the crystal unit cell (supercell), taking into consideration
 the effect of solvent, crystal contacts, etc.
\end_layout

\begin_layout Subsection
Inputs and file formats
\end_layout

\begin_layout Standard
System setup follows the general procedures outlined in Chap.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "chap:crystals"

\end_inset

.
 For users with access to the 
\emph on
phenix
\emph default
 package of crystallographic analysis tools, the XrayPrep tool can prepare
 the system: inputs are simply a PDB file (
\emph on
xxxx.pdb,
\emph default
 where xxxx is a PDB id) and the corresponding structure factor file (
\emph on
xxxx-sf.cif
\emph default
).
\end_layout

\begin_layout Standard
For those who will prepare their own inputs, one needs a PDB file, expanded
 to the unit cell (see Chap.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "chap:crystals"

\end_inset

) that contains the B-factors.
 The structure factors have to be listed in the r
\emph on
eflection_infile
\emph default
, which is a human-readable ascii file containing the same information that
 can be normally found in .mtz files.
 The first line contains a total number of reflections followed by a zero.
 Subsequent lines list Miller indices 
\emph on
h, k
\emph default
 and 
\emph on
l
\emph default
, followed by the respective SF values and their standard deviations, followed
 by an R-free flag (we adopt the convention that 
\begin_inset Quotes eld
\end_inset

1
\begin_inset Quotes erd
\end_inset

 indicates a member of the working set, and 
\begin_inset Quotes eld
\end_inset

0
\begin_inset Quotes erd
\end_inset

 a member of the test set).
 An example file is given below.
 Note that column spacing or number formatting is not critical, but each
 entry should be separated by at least one space.
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

41243 0
\end_layout

\begin_layout Plain Layout

-19        -6        1        13.86329        9.685285        0
\end_layout

\begin_layout Plain Layout

-19        -6        2        46.38137        3.528763        1
\end_layout

\begin_layout Plain Layout

-19        -5        1        9.675193        21.28529        1
\end_layout

\begin_layout Plain Layout

...
\end_layout

\begin_layout Plain Layout

 19         6        1        13.86329        9.685285        0
\end_layout

\begin_layout Plain Layout

 19         6        2        46.38137        3.528763        1
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
Input variables in the &xray namelist
\end_layout

\begin_layout Standard
The X-ray functionalities are activated by adding the 
\emph on
&xray
\emph default
 namelist to the mdin file.
 User-assigned parameters that are not used by the algorithm are silently
 ignored(e.g.
\backslash
 
\emph on
k_sol
\emph default
 and 
\emph on
b_sol
\emph default
 in 'afonine-2013' bulk solvent model).
 The keywords in 
\emph on
&xray
\emph default
 namelist include the following:
\end_layout

\begin_layout Standard
\begin_inset VSpace defskip
\end_inset


\end_layout

\begin_layout Standard

\series bold
File handling:
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
pdb_infile
\begin_inset Index idx
status open

\begin_layout Plain Layout
pdb
\backslash
_infile
\end_layout

\end_inset

 name of the PDB input file containing B-factors
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
pdb_read_coordinates
\begin_inset Index idx
status open

\begin_layout Plain Layout
pdb
\backslash
_read
\backslash
_coordinates
\end_layout

\end_inset

 if true, use coordinates from the PDB file, not inpcrd, as starting coordinates
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
pdb_outfile
\begin_inset Index idx
status open

\begin_layout Plain Layout
pdb_outfile
\end_layout

\end_inset

 name of PDB file to write the final atomic coordinates from the simulation.
 Currently writes back the input B-factors and occupancies as read from
 
\emph on
pdb_infile
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
reflection_infile
\begin_inset Index idx
status open

\begin_layout Plain Layout
reflection
\backslash
_infile
\end_layout

\end_inset

 name of the input file containing experimental SFs and R-flags
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
fmtz_outfile
\begin_inset Index idx
status open

\begin_layout Plain Layout
sf
\backslash
_outfile
\end_layout

\end_inset

 name of the file with calculated SFs, in 
\begin_inset Quotes eld
\end_inset

formatted MTZ
\begin_inset Quotes erd
\end_inset

 format
\end_layout

\begin_layout Standard

\series bold
Bulk solvent parameters:
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
bulk_solvent_model
\begin_inset Index idx
status open

\begin_layout Plain Layout
bulk
\backslash
_solvent
\backslash
_model
\end_layout

\end_inset

 the type of bulk solvent to use.
 Possible values: ‘none’ for disabled bulk solvent contribution, ‘simple’
 or ‘afonine-2013’ (default)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
k_sol
\begin_inset Index idx
status open

\begin_layout Plain Layout
k_sol
\end_layout

\end_inset

 solvent electron density (default 0.35 e 
\begin_inset Formula $\text{Å}^{-3}$
\end_inset

)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
b_sol
\begin_inset Index idx
status open

\begin_layout Plain Layout
b_sol
\end_layout

\end_inset

 determines the blurring of the boundary between the solvent region and
 the macromolecule (default 46 Å
\begin_inset Formula $^{2}$
\end_inset

) 
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
solvent_mask_adjustment
\begin_inset Index idx
status open

\begin_layout Plain Layout
solvent
\backslash
_mask
\backslash
_adjustment
\end_layout

\end_inset

 increment to be added to atomic radii of the atoms selected by 
\emph on
atom_selection_mask
\emph default
 as a part of the algorithm to build bulk solvent mask (default 1.11 Å)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
solvent_mask_probe_radius
\begin_inset Index idx
status open

\begin_layout Plain Layout
solvent
\backslash
_mask
\backslash
_probe
\backslash
_radius
\end_layout

\end_inset

 the radius of solvent probe to apply as a part of the algorithm to build
 bulk solvent mask (default 0.9 Å)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
mask_update_period
\begin_inset Index idx
status open

\begin_layout Plain Layout
mask
\backslash
_update
\backslash
_period
\end_layout

\end_inset

 time interval for bulk solvent grid update (expressed as a multiple of
 integration step, default 100 steps)
\end_layout

\begin_layout Standard

\series bold
Structure-factor-based potential:
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
atom_selection_mask
\begin_inset Index idx
status open

\begin_layout Plain Layout
atom
\backslash
_selection
\backslash
_mask
\end_layout

\end_inset

 ambmask-format mask to specify the atoms that contribute to 
\begin_inset Formula $F_{calc}$
\end_inset

 via direct summation formula (default ‘!@H=’)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
scale_update_period
\begin_inset Index idx
status open

\begin_layout Plain Layout
scale_update_period
\end_layout

\end_inset

 time interval to re-scale 
\begin_inset Formula $F_{calc}$
\end_inset

 to 
\begin_inset Formula $F_{obs}$
\end_inset

 (expressed as a multiple of integration step, default 100 steps)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
target
\begin_inset Index idx
status open

\begin_layout Plain Layout
target
\end_layout

\end_inset

 the type of crystallographic target function.
 Possible values: ‘ls’ for Least Squares, ‘ml’ for Maximum Likelihood (default)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
ml_update_period
\begin_inset Index idx
status open

\begin_layout Plain Layout
ml_update_period
\end_layout

\end_inset

 time interval to update ML parameters 
\begin_inset Formula $\alpha$
\end_inset

 and 
\begin_inset Formula $\beta$
\end_inset

 (expressed as a multiple of integration step, default 100 steps)
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
xray_weight
\begin_inset Index idx
status collapsed

\begin_layout Plain Layout
xray
\backslash
_weight
\backslash
_initial
\end_layout

\end_inset

 Sets the value of 
\begin_inset Formula $w_{xray}$
\end_inset

 (default 1.0) This value can be variable: see Section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Varying-conditions"
plural "false"
caps "false"
noprefix "false"

\end_inset

 for more information.
\end_layout

\begin_layout Labeling
\labelwidthstring solvent\_mask\_probe\_radius
xray_weight_final
\begin_inset Index idx
status open

\begin_layout Plain Layout
xray
\backslash
_weight
\backslash
_final
\end_layout

\end_inset

 final value that defines linear scaling of 
\begin_inset Formula $w_{xray}$
\end_inset

 weight along the trajectory (if unassigned, assumed to be equal to 
\emph on
xray_weight_initial
\emph default
)
\end_layout

\begin_layout Section
Preparing inputs X-ray refinement
\end_layout

\begin_layout Standard
Coming(?!)....
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
btprint "btPrintAll"
bibfiles "amber"
options "jacs"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset index_print
LatexCommand printindex
type "idx"
name "Index"
literal "true"

\end_inset


\end_layout

\end_body
\end_document
