#!/bin/sh

sander="../../../bin/msander"

if [ ! -z "$DO_PARALLEL" ]; then
   sander=$sander.MPI
fi

cat > mdin <<EOF
4lzt crystal unit cell
 &cntrl
    ntx=1, ntpr=1, ntwx=0, ntwr=0,
    imin=0, nstlim=0, tempi=0.0,
    ig=314159,
    irism=1,
    cut=9.0,
 /
 &rism
    periodic='pme',
    closure='kh',
    grdspc=0.5,0.5,0.5,
    solvcut=9.0,
    verbose=1,
    npropagate=0,
    mdiis_del=0.7, mdiis_nvec=5, tolerance=1e-10,
    apply_rism_force=0,
 /
EOF

$DO_PARALLEL $sander -O -i mdin -o mdout -p 4lzt.parm7 -c 4lzt.rst7 \
    -xvv ../xvv/spc-nacl.kh.xvv \
    < /dev/null || { echo "  $0:  Program error"; exit 1; }

grep -E "^rism_|^solutePotentialEnergy" mdout | grep -v "rism_DCFintegral" > erism.out
../../dacdif -r 1.e-3 erism.out.save erism.out
/bin/rm -f mdin mdinfo restrt mdout
exit 0 

