#!/bin/sh

sander="../../bin/msander"

if [ ! -z "$DO_PARALLEL" ]; then
   sander=$sander.MPI
   export OMP_NUM_THREADS=1
fi

cat > gbin <<EOF
 Relaxtion of trpcage using SINR (isokinetic ensemble)
 &cntrl                                                                        
  imin=0, irest=1, ntx=5,
  nstlim=10, dt=0.001,
  ntc=1, ntf=1, ioutfm=1,
  ntpr=1, ntwx=0, ntwr=50,
  tempi=298.15 temp0=298.15, ntp=0,
  ntb=1, irism=1, cut=8.0, 
  ig=314159, ntt=10, nrespa=8, nkija=2,
  gamma_ln=10.0, sinrtau=20.4
 /
&rism
    periodic='pme',
    closure='kh',
    grdspc=0.5,0.5,0.5,
    solvcut=8.d0,
    verbose=2,
    write_thermo=0,
    npropagate=5, maxstep=1000,
    mdiis_del=0.7, mdiis_nvec=10, tolerance=1e-8,
    apply_rism_force=1,
    rismnrespa=8, 
 /
EOF

output=mdout.sander.SINR
cp sinrvels.rst.save sinrvels.rst

$DO_PARALLEL $sander -O -i gbin -c init.rst7 -p complex.parm7 \
   -xvv ../rism3d/xvv/spc.kh.xvv -o $output \
   < /dev/null || { echo "  $0:  Program error"; exit 1; }

# ../dacdif -r 0.00001 $output.save $output
# /bin/rm -f gbin restrt mdinfo mdcrd *.rst
exit 0 

